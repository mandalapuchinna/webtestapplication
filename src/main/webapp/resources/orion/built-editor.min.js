/*

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation
  Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2009, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others. All rights reserved.
 This program and the accompanying materials are made available under the
 terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: 
 IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation
               Alex Lakatos - fix for bug#369781

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
 RequireJS i18n 2.0.2 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/i18n for details

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
*/
var requirejs,require,define;
(function(n){function t(a,d){var b,m,q,z,e,s,g,f,u,h=d&&d.split("/"),p=l.map,v=p&&p["*"]||{};if(a&&"."===a.charAt(0))if(d){h=h.slice(0,h.length-1);a=h.concat(a.split("/"));for(f=0;f<a.length;f+=1)if(b=a[f],"."===b)a.splice(f,1),f-=1;else if(".."===b)if(1===f&&(".."===a[2]||".."===a[0]))break;else 0<f&&(a.splice(f-1,2),f-=2);a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((h||v)&&p){b=a.split("/");for(f=b.length;0<f;f-=1){m=b.slice(0,f).join("/");if(h)for(u=h.length;0<u;u-=1)if(q=p[h.slice(0,
u).join("/")])if(q=q[m]){z=q;e=f;break}if(z)break;!s&&(v&&v[m])&&(s=v[m],g=f)}!z&&s&&(z=s,e=g);z&&(b.splice(0,e,z),a=b.join("/"))}return a}function r(a,d){return function(){return b.apply(n,A.call(arguments,0).concat([a,d]))}}function k(a){return function(d){return t(d,a)}}function f(a){return function(d){m[a]=d}}function h(a){if(v.call(s,a)){var d=s[a];delete s[a];u[a]=!0;e.apply(n,d)}if(!v.call(m,a)&&!v.call(u,a))throw Error("No "+a);return m[a]}function g(a){var d,b=a?a.indexOf("!"):-1;-1<b&&(d=
a.substring(0,b),a=a.substring(b+1,a.length));return[d,a]}function p(a){return function(){return l&&l.config&&l.config[a]||{}}}var e,b,a,d,m={},s={},l={},u={},v=Object.prototype.hasOwnProperty,A=[].slice;a=function(a,d){var b,m=g(a),q=m[0];a=m[1];q&&(q=t(q,d),b=h(q));q?a=b&&b.normalize?b.normalize(a,k(d)):t(a,d):(a=t(a,d),m=g(a),q=m[0],a=m[1],q&&(b=h(q)));return{f:q?q+"!"+a:a,n:a,pr:q,p:b}};d={require:function(a){return r(a)},exports:function(a){var d=m[a];return"undefined"!==typeof d?d:m[a]={}},
module:function(a){return{id:a,uri:"",exports:m[a],config:p(a)}}};e=function(b,l,e,g){var q,z,C,p,B=[],A;g=g||b;if("function"===typeof e){l=!l.length&&e.length?["require","exports","module"]:l;for(p=0;p<l.length;p+=1)if(C=a(l[p],g),z=C.f,"require"===z)B[p]=d.require(b);else if("exports"===z)B[p]=d.exports(b),A=!0;else if("module"===z)q=B[p]=d.module(b);else if(v.call(m,z)||v.call(s,z)||v.call(u,z))B[p]=h(z);else if(C.p)C.p.load(C.n,r(g,!0),f(z),{}),B[p]=m[z];else throw Error(b+" missing "+z);l=e.apply(m[b],
B);if(b)if(q&&q.exports!==n&&q.exports!==m[b])m[b]=q.exports;else if(l!==n||!A)m[b]=l}else b&&(m[b]=e)};requirejs=require=b=function(m,s,g,f,q){if("string"===typeof m)return d[m]?d[m](s):h(a(m,s).f);m.splice||(l=m,s.splice?(m=s,s=g,g=null):m=n);s=s||function(){};"function"===typeof g&&(g=f,f=q);f?e(n,m,s,g):setTimeout(function(){e(n,m,s,g)},4);return b};b.config=function(a){l=a;return b};define=function(a,d,b){d.splice||(b=d,d=[]);!v.call(m,a)&&!v.call(s,a)&&(s[a]=[a,d,b])};define.amd={jQuery:!0}})();
define("almond",function(){});define("orion/editor/config",[],function(){return{languages:{}}});
define("orion/editor/shim",[],function(){Object.create||(Object.create=function(n,t){function r(){}r.prototype=n;var k=new r;if(t)for(var f in t)t.hasOwnProperty(f)&&(t[f].hasOwnProperty("value")?k[f]=t[f].value:k[f]=function(){if(0<arguments.length)return t[f].get();t[f].set(arguments)});return k});Object.keys||(Object.keys=function(n){var t=[],r;for(r in n)n.hasOwnProperty(r)&&t.push(r);return t});Function.prototype.bind||(Function.prototype.bind=function(n){var t=this,r=Array.prototype.slice.call(arguments,
1);return r.length?function(){return arguments.length?t.apply(n,r.concat(Array.prototype.slice.call(arguments))):t.apply(n,r)}:function(){return arguments.length?t.apply(n,arguments):t.call(n)}});Array.isArray||(Array.isArray=function(n){return"[object Array]"===Object.prototype.toString.call(n)});Array.prototype.indexOf||(Array.prototype.indexOf=function(n){for(var t=0;t<this.length;t++)if(this[t]===n)return t;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(n){for(var t=0;t<
this.length;t++)n(this[t],t)});Array.prototype.map||(Array.prototype.map=function(n){for(var t=Array(this.length),r=0;r<this.length;r++)t[r]=n(this[r]);return t});Array.prototype.reduce||(Array.prototype.reduce=function(n,t){var r,k=!1;1<arguments.length&&(r=t,k=!0);for(var f=0;this.length>f;++f)k?r=n(r,this[f],f,this):(r=this[f],k=!0);return r});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/g,
"")});String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")});return{}});
(function(){function n(f,h,g,p,e,b){h[f]&&(g.push(f),(!0===h[f]||1===h[f])&&p.push(e+f+"/"+b))}function t(f,h,g,p,e){h=p+h+"/"+e;require._fileExists(f.toUrl(h+".js"))&&g.push(h)}function r(f,h,g){for(var p in h)h.hasOwnProperty(p)&&(!f.hasOwnProperty(p)||g)?f[p]=h[p]:"object"===typeof h[p]&&r(f[p],h[p],g)}var k=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(f){var h=f.config?f.config():{},h=h||{};return{version:"2.0.1+",load:function(g,f,e,b){b=b||{};b.locale&&(h.locale=
b.locale);var a=k.exec(g),d=a[1],m=a[4],s=a[5],l=m.split("-"),u=[],v={},A,w="";a[5]?(d=a[1],g=d+s):(s=a[4],m=h.locale,m||(m=h.locale="undefined"===typeof navigator?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),l=m.split("-"));if(b.isBuild){u.push(g);t(f,"root",u,d,s);for(A=0;A<l.length;A++)b=l[A],w+=(w?"-":"")+b,t(f,w,u,d,s);f(u,function(){e()})}else f([g],function(a){var b=[],m;n("root",a,b,u,d,s);for(A=0;A<l.length;A++)m=l[A],w+=(w?"-":"")+m,n(w,a,b,u,d,s);f(u,function(){var q,
z,m;for(q=b.length-1;-1<q&&b[q];q--){m=b[q];z=a[m];if(!0===z||1===z)z=f(d+m+"/"+s);r(v,z)}e(v)})})}}})})();define("orion/editor/i18n",{load:function(n,t,r,k){t.specified&&t.specified("orion/bootstrap")?t(["orion/i18n!"+n],function(f){r(f)}):t(["orion/editor/config"],function(f){r(f&&f.languages||{})})}});
define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",matchingSearch:"Matching Search",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",lineUp:"Line Up",lineDown:"Line Down",lineStart:"Line Start",lineEnd:"Line End",charPrevious:"Previous Character",charNext:"Next Character",pageUp:"Page Up",
pageDown:"Page Down",scrollPageUp:"Scroll Page Up",scrollPageDown:"Scroll Page Down",scrollLineUp:"Scroll Line Up",scrollLineDown:"Scroll Line Down",wordPrevious:"Previous Word",wordNext:"Next Word",textStart:"Document Start",textEnd:"Document End",scrollTextStart:"Scroll Document Start",scrollTextEnd:"Scroll Document End",centerLine:"Center Line",selectLineUp:"Select Line Up",selectLineDown:"Select Line Down",selectWholeLineUp:" Select Whole Line Up",selectWholeLineDown:"Select Whole Line Down",
selectLineStart:"Select Line Start",selectLineEnd:"Select Line End",selectCharPrevious:"Select Previous Character",selectCharNext:"Select Next Character",selectPageUp:"Select Page Up",selectPageDown:"Select Page Down",selectWordPrevious:"Select Previous Word",selectWordNext:"Select Next Word",selectTextStart:"Select Document Start",selectTextEnd:"Select Document End",deletePrevious:"Delete Previous Character",deleteNext:"Delete Next Character",deleteWordPrevious:"Delete Previous Word",deleteWordNext:"Delete Next Word",
deleteLineStart:"Delete Line Start",deleteLineEnd:"Delete Line End",tab:"Insert Tab",enter:"Insert Line Delimiter",enterNoCursor:"Insert Line Delimiter",selectAll:"Select All",copy:"Copy",cut:"Cut",paste:"Paste",uppercase:"To Upper Case",lowercase:"To Lower Case",capitalize:"Capitalize",reversecase:"Reverse Case",toggleWrapMode:"Toggle Wrap Mode",toggleTabMode:"Toggle Tab Mode",toggleOverwriteMode:"Toggle Overwrite Mode",committerOnTime:"${0} on ${1}",emacs:"Emacs",exchangeMarkPoint:"Exchange Mark and Point",
setMarkCommand:"Set Mark",clearMark:"Clear Mark",digitArgument:"Digit Argument ${0}",negativeArgument:"Negative Argument",Comment:"Comment","Flat outline":"Flat outline",incrementalFindStr:"Incremental find: ${0}",incrementalFindStrNotFound:"Incremental find: ${0} (not found)",incrementalFindReverseStr:"Reverse Incremental find: ${0}",incrementalFindReverseStrNotFound:"Reverse Incremental find: ${0} (not found)",find:"Find...",undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",
findPrevious:"Find Previous Occurrence",incrementalFind:"Incremental Find",incrementalFindReverse:"Incremental Find Reverse",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",collapse:"Collapse",expandAll:"Expand All",
collapseAll:"Collapse All",lastEdit:"Last Edit Location",trimTrailingWhitespaces:"Trim Trailing Whitespaces",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode entered",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Col ${1}",vi:"vi",vimove:"(Move)",viyank:"(Yank)",videlete:"(Delete)",vichange:"(Change)",viLeft:"${0} Left",viRight:"${0} Right",
viUp:"${0} Up",viDown:"${0} Down",viw:"${0} Next Word",vib:"${0} Beginning of Word",viW:"${0} Next Word (ws stop)",viB:"${0} Beginning of Word (ws stop)",vie:"${0} End of Word",viE:"${0} End of Word (ws stop)",vi$:"${0} End of the line","vi^_":"${0} First non-blank Char Current Line","vi+":"${0} First Char Next Line","vi-":"${0} First Char Previous Line","vi|":"${0} nth Column in Line",viH:"${0} Top of Page",viM:"${0} Middle of Page",viL:"${0} Bottom of Page","vi/":"${0} Search Forward","vi?":"${0} Search Backward",
vin:"${0} Next Search",viN:"${0} Previous Search",vif:"${0} Search Char Fwd",viF:"${0} Search Char Bckwd",vit:"${0} Search Before Char Fwd",viT:"${0} Search Before Char Bckwd","vi,":"${0} Repeat Reverse Char Search","vi;":"${0} Repeat Char Search",viG:"${0} Go to Line",viycd:"${0} Current Line",via:"Append After Cursor",viA:"Append to End of Line",vii:"Insert Before Cursor",viI:"Insert at Beginning of Line",viO:"Insert Line Above",vio:"Insert Line Below",viR:"Begin Overwriting Text",vis:"Substitute a Character",
viS:"Substitute Entire Line",viC:"Change Text Until Line End",vip:"Paste After Char or Line",viP:"Paste Before Char or Line",viStar:"Search Word Under Cursor",next:"Next",previous:"Previous",replace:"Replace",replaceAll:"Replace All",findWith:"Find With",replaceWith:"Replace With",caseInsensitive:"Aa",regex:"/.*/",wholeWord:"\\b",caseInsensitiveTooltip:"Toggle Case Insensitive",regexTooltip:"Toogle Regex",wholeWordTooltip:"Toggle Whole Word",closeTooltip:"Close",replacingAll:"Replacing all...",replacedMatches:"Replaced ${0} matches",
nothingReplaced:"Nothing replaced",notFound:"Not found"});define("orion/editor/nls/messages",["orion/editor/i18n!orion/editor/nls/messages","orion/editor/nls/root/messages"],function(n,t){var r={root:t},k;for(k in n)n.hasOwnProperty(k)&&"undefined"===typeof r[k]&&(r[k]=n[k]);return r});
define("orion/editor/eventTarget",[],function(){function n(){}n.addMixin=function(t){var r=n.prototype,k;for(k in r)r.hasOwnProperty(k)&&(t[k]=r[k])};n.prototype={addEventListener:function(n,r,k){this._eventTypes||(this._eventTypes={});var f=this._eventTypes[n];f||(f=this._eventTypes[n]={level:0,listeners:[]});f.listeners.push({listener:r,useCapture:k})},dispatchEvent:function(n){var r=n.type;this._dispatchEvent("pre"+r,n);this._dispatchEvent(r,n);this._dispatchEvent("post"+r,n)},_dispatchEvent:function(n,
r){var k=this._eventTypes?this._eventTypes[n]:null;if(k){var f=k.listeners;try{if(k.level++,f)for(var h=0,g=f.length;h<g;h++)if(f[h]){var p=f[h].listener;"function"===typeof p?p.call(this,r):p.handleEvent&&"function"===typeof p.handleEvent&&p.handleEvent(r)}}finally{if(k.level--,k.compact&&0===k.level){for(h=f.length-1;0<=h;h--)f[h]||f.splice(h,1);0===f.length&&delete this._eventTypes[n];k.compact=!1}}}},isListening:function(n){return!this._eventTypes?!1:void 0!==this._eventTypes[n]},removeEventListener:function(n,
r,k){if(this._eventTypes){var f=this._eventTypes[n];if(f){for(var h=f.listeners,g=0,p=h.length;g<p;g++){var e=h[g];if(e&&e.listener===r&&e.useCapture===k){0!==f.level?(h[g]=null,f.compact=!0):h.splice(g,1);break}}0===h.length&&delete this._eventTypes[n]}}}};return{EventTarget:n}});define("orion/regex",[],function(){return{escape:function(n){return n.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26")},parse:function(n){return(n=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(n))?{pattern:n[1],flags:n[2]}:null}}});
define("orion/util",[],function(){var n=navigator.userAgent,t=-1!==n.indexOf("MSIE")||-1!==n.indexOf("Trident")?document.documentMode:void 0,r=parseFloat(n.split("Firefox/")[1]||n.split("Minefield/")[1])||void 0,k=-1!==n.indexOf("Opera")?parseFloat(n.split("Version/")[1]):void 0,f=parseFloat(n.split("Chrome/")[1])||void 0,h=-1!==n.indexOf("Safari")&&!f,g=parseFloat(n.split("WebKit/")[1])||void 0,p=-1!==n.indexOf("Android"),e=-1!==n.indexOf("iPad"),n=-1!==n.indexOf("iPhone"),b=e||n,a=-1!==navigator.platform.indexOf("Mac"),
d=-1!==navigator.platform.indexOf("Win"),m=-1!==navigator.platform.indexOf("Linux"),s="undefined"!==typeof document&&"ontouchstart"in document.createElement("input");return{formatMessage:function(a){var d=arguments;return a.replace(/\$\{([^\}]+)\}/g,function(a,b){return d[(b<<0)+1]})},createElement:function(a,d){return a.createElementNS?a.createElementNS("http://www.w3.org/1999/xhtml",d):a.createElement(d)},isIE:t,isFirefox:r,isOpera:k,isChrome:f,isSafari:h,isWebkit:g,isAndroid:p,isIPad:e,isIPhone:n,
isIOS:b,isMac:a,isWindows:d,isLinux:m,isTouch:s,platformDelimiter:d?"\r\n":"\n"}});
define("orion/editor/textModel",["orion/editor/eventTarget","orion/regex","orion/util"],function(n,t,r){function k(f,h){this._lastLineIndex=-1;this._text=[""];this._lineOffsets=[0];this.setText(f);this.setLineDelimiter(h)}k.prototype={destroy:function(){},find:function(f){1<this._text.length&&(this._text=[this._text.join("")]);var h=f.string,g=f.regex,p=h,e="",b=f.caseInsensitive;if(p)if(g){if(h=t.parse(p))p=h.pattern,e=h.flags}else p=h.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26"),b&&(p=p.replace(/[iI\u0130\u0131]/g,
"[Ii\u0130\u0131]"));var a=null,d;if(p){var h=f.reverse,m=f.wrap,g=f.wholeWord,s=f.start||0;f=f.end;var l=null!==f&&void 0!==f;-1===e.indexOf("g")&&(e+="g");-1===e.indexOf("m")&&(e+="m");b&&-1===e.indexOf("i")&&(e+="i");g&&(p="\\b"+p+"\\b");var u=this._text[0],v,A,k=0;l&&(b=s<f?s:f,u=u.substring(b,s<f?f:s),k=b);var n=RegExp(p,e);h?d=function(){var a=null;for(n.lastIndex=0;;){A=n.lastIndex;v=n.exec(u);if(A===n.lastIndex)return null;if(v){if(!(v.index+k<s)){if(!m||a)break;s=u.length+k}a={start:v.index+
k,end:n.lastIndex+k}}else break}a&&(s=a.start);return a}:(l||(n.lastIndex=s),d=function(){for(;;){A=n.lastIndex;v=n.exec(u);if(A===n.lastIndex)break;if(v)return{start:v.index+k,end:n.lastIndex+k};if(!(0!==A&&m))break}return null});a=d()}return{next:function(){var b=a;b&&(a=d());return b},hasNext:function(){return null!==a}}},getCharCount:function(){for(var f=0,h=0;h<this._text.length;h++)f+=this._text[h].length;return f},getLine:function(f,h){var g=this.getLineCount();if(!(0<=f&&f<g))return null;
var p=this._lineOffsets[f];if(f+1<g){g=this.getText(p,this._lineOffsets[f+1]);if(h)return g;for(var p=g.length,e;10===(e=g.charCodeAt(p-1))||13===e;)p--;return g.substring(0,p)}return this.getText(p)},getLineAtOffset:function(f){var h=this.getCharCount();if(!(0<=f&&f<=h))return-1;var g=this.getLineCount();if(f===h)return g-1;var p,e,b=this._lastLineIndex;if(0<=b&&b<g&&(p=this._lineOffsets[b],e=b+1<g?this._lineOffsets[b+1]:h,p<=f&&f<e))return b;for(var a=g,d=-1;1<a-d;)if(b=Math.floor((a+d)/2),p=this._lineOffsets[b],
e=b+1<g?this._lineOffsets[b+1]:h,f<=p)a=b;else if(f<e){a=b;break}else d=b;return this._lastLineIndex=a},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},getLineEnd:function(f,h){var g=this.getLineCount();if(!(0<=f&&f<g))return-1;if(f+1<g){g=this._lineOffsets[f+1];if(h)return g;for(var p=this.getText(Math.max(this._lineOffsets[f],g-2),g),e=p.length,b;10===(b=p.charCodeAt(e-1))||13===b;)e--;return g-(p.length-e)}return this.getCharCount()},
getLineStart:function(f){return!(0<=f&&f<this.getLineCount())?-1:this._lineOffsets[f]},getText:function(f,h){void 0===f&&(f=0);void 0===h&&(h=this.getCharCount());if(f===h)return"";for(var g=0,p=0,e;p<this._text.length;){e=this._text[p].length;if(f<=g+e)break;g+=e;p++}for(var b=g,a=p;p<this._text.length;){e=this._text[p].length;if(h<=g+e)break;g+=e;p++}if(a===p)return this._text[a].substring(f-b,h-g);b=this._text[a].substring(f-b);g=this._text[p].substring(0,h-g);return b+this._text.slice(a+1,p).join("")+
g},onChanging:function(f){return this.dispatchEvent(f)},onChanged:function(f){return this.dispatchEvent(f)},setLineDelimiter:function(f,h){"auto"===f&&(f=void 0,1<this.getLineCount()&&(f=this.getText(this.getLineEnd(0),this.getLineEnd(0,!0))));this._lineDelimiter=f?f:r.platformDelimiter;if(h){var g=this.getLineCount();if(1<g){for(var p=Array(g),e=0;e<g;e++)p[e]=this.getLine(e);this.setText(p.join(this._lineDelimiter))}}},setText:function(f,h,g){void 0===f&&(f="");void 0===h&&(h=0);void 0===g&&(g=
this.getCharCount());if(!(h===g&&""===f)){for(var p=this.getLineAtOffset(h),e=this.getLineAtOffset(g),b=h,a=g-h,d=e-p,m=f.length,s=0,l=this.getLineCount(),u=0,v=0,k=0,w=[];;){-1!==u&&u<=k&&(u=f.indexOf("\r",k));-1!==v&&v<=k&&(v=f.indexOf("\n",k));if(-1===v&&-1===u)break;k=-1!==u&&-1!==v?u+1===v?v+1:(u<v?u:v)+1:-1!==u?u+1:v+1;w.push(h+k);s++}this.onChanging({type:"Changing",text:f,start:b,removedCharCount:a,addedCharCount:m,removedLineCount:d,addedLineCount:s});0===w.length&&(k=this.getLineStart(p),
e=e+1<l?this.getLineStart(e+1):this.getCharCount(),h!==k&&(f=this.getText(k,h)+f,h=k),g!==e&&(f+=this.getText(g,e),g=e));k=m-a;for(e=p+d+1;e<l;e++)this._lineOffsets[e]+=k;if(5E4>w.length)p=[p+1,d].concat(w),Array.prototype.splice.apply(this._lineOffsets,p);else{k=p+1;this._lineOffsets.splice(k,d);for(l=0;l<w.length;l+=5E4)p=[k,0].concat(w.slice(l,Math.min(w.length,l+5E4))),Array.prototype.splice.apply(this._lineOffsets,p),k+=5E4}for(k=l=0;k<this._text.length;){e=this._text[k].length;if(h<=l+e)break;
l+=e;k++}p=l;for(w=k;k<this._text.length;){e=this._text[k].length;if(g<=l+e)break;l+=e;k++}e=this._text[k];h=this._text[w].substring(0,h-p);g=e.substring(g-l);w=[w,k-w+1];h&&w.push(h);f&&w.push(f);g&&w.push(g);Array.prototype.splice.apply(this._text,w);0===this._text.length&&(this._text=[""]);this.onChanged({type:"Changed",start:b,removedCharCount:a,addedCharCount:m,removedLineCount:d,addedLineCount:s})}}};n.EventTarget.addMixin(k.prototype);return{TextModel:k}});
define("orion/keyBinding",["orion/util"],function(n){function t(k,f,h,g,p,e){this.type=e||"keydown";this.keyCode="string"===typeof k&&"keydown"===this.type?k.toUpperCase().charCodeAt(0):k;this.mod1=void 0!==f&&null!==f?f:!1;this.mod2=void 0!==h&&null!==h?h:!1;this.mod3=void 0!==g&&null!==g?g:!1;this.mod4=void 0!==p&&null!==p?p:!1}function r(k){this.keys=k}t.prototype={getKeys:function(){return[this]},match:function(k,f){if(void 0!==f){if(0!==f)return!1}else if(k instanceof Array){if(1<k.length)return!1;
k=k[0]}return k.type!==this.type?!1:this.keyCode===k.keyCode||this.keyCode===String.fromCharCode(n.isOpera?k.which:void 0!==k.charCode?k.charCode:k.keyCode)?this.mod1!==(n.isMac?k.metaKey:k.ctrlKey)||"keydown"===this.type&&this.mod2!==k.shiftKey||this.mod3!==k.altKey||n.isMac&&this.mod4!==k.ctrlKey?!1:!0:!1},equals:function(k){return!k||this.keyCode!==k.keyCode||this.mod1!==k.mod1||this.mod2!==k.mod2||this.mod3!==k.mod3||this.mod4!==k.mod4||this.type!==k.type?!1:!0}};r.prototype={getKeys:function(){return this.keys.slice(0)},
match:function(k,f){var h=this.keys;if(void 0!==f)return f>h.length?!1:h[f].match(k)?f===h.length-1?!0:f+1:!1;k instanceof Array||(k=[k]);if(k.length>h.length)return!1;var g;for(g=0;g<k.length;g++)if(!h[g].match(k[g]))return!1;return g===h.length?!0:g},equals:function(k){if(!k.keys||k.keys.length!==this.keys.length)return!1;for(var f=0;f<k.keys.length;f++)if(!k.keys[f].equals(this.keys[f]))return!1;return!0}};return{KeyBinding:t,KeyStroke:t,KeySequence:r}});
define("orion/editor/keyModes",["orion/keyBinding","orion/util"],function(n,t){function r(f){f&&(this._view=f,this._keyBindings=this.createKeyBindings(),this._keyBindingIndex=0)}function k(f){r.call(this,f)}r.prototype={createKeyBindings:function(){return[]},getKeyBindings:function(f){for(var h=[],g=this._keyBindings,p=0;p<g.length;p++)g[p].actionID===f&&h.push(g[p].keyBinding);return h},getView:function(){return this._view},isActive:function(){return-1!==this._view.getKeyModes().indexOf(this)},match:function(f){if("keydown"===
f.type)switch(f.keyCode){case 16:case 17:case 18:case 91:return}for(var h=this._keyBindingIndex,g=this._matchingKeyBindings||this._keyBindings,p=[],e=0;e<g.length;e++){var b=g[e],a=b.keyBinding.match(f,h);if(!0===a)return this._keyBindingIndex=0,this._matchingKeyBindings=null,b.actionID;"number"===typeof a&&p.push(b)}if(0===p.length)this._keyBindingIndex=0,this._matchingKeyBindings=null;else return this._keyBindingIndex++,this._matchingKeyBindings=p,"noop"},setKeyBinding:function(f,h){for(var g=this._keyBindings,
p=0;p<g.length;p++){var e=g[p];if(e.keyBinding.equals(f)){h?e.actionID=h:e.predefined?e.actionID="noop":g.splice(p,1);return}}h&&g.push({keyBinding:f,actionID:h})},setView:function(f){this._view=f}};k.prototype=new r;k.prototype.createKeyBindings=function(){var f=n.KeyBinding,h=[];h.push({actionID:"lineUp",keyBinding:new f(38),predefined:!0});h.push({actionID:"lineDown",keyBinding:new f(40),predefined:!0});h.push({actionID:"charPrevious",keyBinding:new f(37),predefined:!0});h.push({actionID:"charNext",
keyBinding:new f(39),predefined:!0});t.isMac?(h.push({actionID:"scrollPageUp",keyBinding:new f(33),predefined:!0}),h.push({actionID:"scrollPageDown",keyBinding:new f(34),predefined:!0}),h.push({actionID:"pageUp",keyBinding:new f(33,null,null,!0),predefined:!0}),h.push({actionID:"pageDown",keyBinding:new f(34,null,null,!0),predefined:!0}),h.push({actionID:"lineStart",keyBinding:new f(37,!0),predefined:!0}),h.push({actionID:"lineEnd",keyBinding:new f(39,!0),predefined:!0}),h.push({actionID:"wordPrevious",
keyBinding:new f(37,null,null,!0),predefined:!0}),h.push({actionID:"wordNext",keyBinding:new f(39,null,null,!0),predefined:!0}),h.push({actionID:"scrollTextStart",keyBinding:new f(36),predefined:!0}),h.push({actionID:"scrollTextEnd",keyBinding:new f(35),predefined:!0}),h.push({actionID:"textStart",keyBinding:new f(38,!0),predefined:!0}),h.push({actionID:"textEnd",keyBinding:new f(40,!0),predefined:!0}),h.push({actionID:"scrollPageUp",keyBinding:new f(38,null,null,null,!0),predefined:!0}),h.push({actionID:"scrollPageDown",
keyBinding:new f(40,null,null,null,!0),predefined:!0}),h.push({actionID:"lineStart",keyBinding:new f(37,null,null,null,!0),predefined:!0}),h.push({actionID:"lineEnd",keyBinding:new f(39,null,null,null,!0),predefined:!0}),h.push({actionID:"lineStart",keyBinding:new f(38,null,null,!0),predefined:!0}),h.push({actionID:"lineEnd",keyBinding:new f(40,null,null,!0),predefined:!0})):(h.push({actionID:"pageUp",keyBinding:new f(33),predefined:!0}),h.push({actionID:"pageDown",keyBinding:new f(34),predefined:!0}),
h.push({actionID:"lineStart",keyBinding:new f(36),predefined:!0}),h.push({actionID:"lineEnd",keyBinding:new f(35),predefined:!0}),h.push({actionID:"wordPrevious",keyBinding:new f(37,!0),predefined:!0}),h.push({actionID:"wordNext",keyBinding:new f(39,!0),predefined:!0}),h.push({actionID:"textStart",keyBinding:new f(36,!0),predefined:!0}),h.push({actionID:"textEnd",keyBinding:new f(35,!0),predefined:!0}));t.isFirefox&&t.isLinux&&(h.push({actionID:"lineUp",keyBinding:new f(38,!0),predefined:!0}),h.push({actionID:"lineDown",
keyBinding:new f(40,!0),predefined:!0}));t.isWindows&&(h.push({actionID:"scrollLineUp",keyBinding:new f(38,!0),predefined:!0}),h.push({actionID:"scrollLineDown",keyBinding:new f(40,!0),predefined:!0}));h.push({actionID:"selectLineUp",keyBinding:new f(38,null,!0),predefined:!0});h.push({actionID:"selectLineDown",keyBinding:new f(40,null,!0),predefined:!0});h.push({actionID:"selectCharPrevious",keyBinding:new f(37,null,!0),predefined:!0});h.push({actionID:"selectCharNext",keyBinding:new f(39,null,!0),
predefined:!0});h.push({actionID:"selectPageUp",keyBinding:new f(33,null,!0),predefined:!0});h.push({actionID:"selectPageDown",keyBinding:new f(34,null,!0),predefined:!0});t.isMac?(h.push({actionID:"selectLineStart",keyBinding:new f(37,!0,!0),predefined:!0}),h.push({actionID:"selectLineEnd",keyBinding:new f(39,!0,!0),predefined:!0}),h.push({actionID:"selectWordPrevious",keyBinding:new f(37,null,!0,!0),predefined:!0}),h.push({actionID:"selectWordNext",keyBinding:new f(39,null,!0,!0),predefined:!0}),
h.push({actionID:"selectTextStart",keyBinding:new f(36,null,!0),predefined:!0}),h.push({actionID:"selectTextEnd",keyBinding:new f(35,null,!0),predefined:!0}),h.push({actionID:"selectTextStart",keyBinding:new f(38,!0,!0),predefined:!0}),h.push({actionID:"selectTextEnd",keyBinding:new f(40,!0,!0),predefined:!0}),h.push({actionID:"selectLineStart",keyBinding:new f(37,null,!0,null,!0),predefined:!0}),h.push({actionID:"selectLineEnd",keyBinding:new f(39,null,!0,null,!0),predefined:!0}),h.push({actionID:"selectLineStart",
keyBinding:new f(38,null,!0,!0),predefined:!0}),h.push({actionID:"selectLineEnd",keyBinding:new f(40,null,!0,!0),predefined:!0})):(t.isLinux&&(h.push({actionID:"selectWholeLineUp",keyBinding:new f(38,!0,!0),predefined:!0}),h.push({actionID:"selectWholeLineDown",keyBinding:new f(40,!0,!0),predefined:!0})),h.push({actionID:"selectLineStart",keyBinding:new f(36,null,!0),predefined:!0}),h.push({actionID:"selectLineEnd",keyBinding:new f(35,null,!0),predefined:!0}),h.push({actionID:"selectWordPrevious",
keyBinding:new f(37,!0,!0),predefined:!0}),h.push({actionID:"selectWordNext",keyBinding:new f(39,!0,!0),predefined:!0}),h.push({actionID:"selectTextStart",keyBinding:new f(36,!0,!0),predefined:!0}),h.push({actionID:"selectTextEnd",keyBinding:new f(35,!0,!0),predefined:!0}));h.push({actionID:"undo",keyBinding:new n.KeyBinding("z",!0),predefined:!0});t.isMac?h.push({actionID:"redo",keyBinding:new n.KeyBinding("z",!0,!0),predefined:!0}):h.push({actionID:"redo",keyBinding:new n.KeyBinding("y",!0),predefined:!0});
h.push({actionID:"deletePrevious",keyBinding:new f(8),predefined:!0});h.push({actionID:"deletePrevious",keyBinding:new f(8,null,!0),predefined:!0});h.push({actionID:"deleteNext",keyBinding:new f(46),predefined:!0});h.push({actionID:"deleteWordPrevious",keyBinding:new f(8,!0),predefined:!0});h.push({actionID:"deleteWordPrevious",keyBinding:new f(8,!0,!0),predefined:!0});h.push({actionID:"deleteWordNext",keyBinding:new f(46,!0),predefined:!0});h.push({actionID:"tab",keyBinding:new f(9),predefined:!0});
h.push({actionID:"shiftTab",keyBinding:new f(9,null,!0),predefined:!0});h.push({actionID:"enter",keyBinding:new f(13),predefined:!0});h.push({actionID:"enter",keyBinding:new f(13,null,!0),predefined:!0});h.push({actionID:"selectAll",keyBinding:new f("a",!0),predefined:!0});h.push({actionID:"toggleTabMode",keyBinding:new f("m",!0),predefined:!0});t.isMac&&(h.push({actionID:"deleteNext",keyBinding:new f(46,null,!0),predefined:!0}),h.push({actionID:"deleteWordPrevious",keyBinding:new f(8,null,null,!0),
predefined:!0}),h.push({actionID:"deleteWordNext",keyBinding:new f(46,null,null,!0),predefined:!0}));h.push({actionID:"toggleWrapMode",keyBinding:new n.KeyBinding("w",!0,!1,!0)});h.push({actionID:"toggleOverwriteMode",keyBinding:new n.KeyBinding(45)});if(!t.isFirefox){var g=t.isMac&&t.isChrome;h.push({actionID:"noop",keyBinding:new f("u",!g,!1,!1,g),predefined:!0});h.push({actionID:"noop",keyBinding:new f("i",!g,!1,!1,g),predefined:!0});h.push({actionID:"noop",keyBinding:new f("b",!g,!1,!1,g),predefined:!0})}t.isFirefox&&
(h.push({actionID:"copy",keyBinding:new f(45,!0),predefined:!0}),h.push({actionID:"paste",keyBinding:new f(45,null,!0),predefined:!0}),h.push({actionID:"cut",keyBinding:new f(46,null,!0),predefined:!0}));t.isMac&&(h.push({actionID:"lineStart",keyBinding:new f("a",!1,!1,!1,!0),predefined:!0}),h.push({actionID:"lineEnd",keyBinding:new f("e",!1,!1,!1,!0),predefined:!0}),h.push({actionID:"lineUp",keyBinding:new f("p",!1,!1,!1,!0),predefined:!0}),h.push({actionID:"lineDown",keyBinding:new f("n",!1,!1,
!1,!0),predefined:!0}),h.push({actionID:"charPrevious",keyBinding:new f("b",!1,!1,!1,!0),predefined:!0}),h.push({actionID:"charNext",keyBinding:new f("f",!1,!1,!1,!0),predefined:!0}),h.push({actionID:"deletePrevious",keyBinding:new f("h",!1,!1,!1,!0),predefined:!0}),h.push({actionID:"deleteNext",keyBinding:new f("d",!1,!1,!1,!0),predefined:!0}),h.push({actionID:"deleteLineEnd",keyBinding:new f("k",!1,!1,!1,!0),predefined:!0}),t.isFirefox?(h.push({actionID:"scrollPageDown",keyBinding:new f("v",!1,
!1,!1,!0),predefined:!0}),h.push({actionID:"deleteLineStart",keyBinding:new f("u",!1,!1,!1,!0),predefined:!0}),h.push({actionID:"deleteWordPrevious",keyBinding:new f("w",!1,!1,!1,!0),predefined:!0})):(h.push({actionID:"pageDown",keyBinding:new f("v",!1,!1,!1,!0),predefined:!0}),h.push({actionID:"centerLine",keyBinding:new f("l",!1,!1,!1,!0),predefined:!0}),h.push({actionID:"enterNoCursor",keyBinding:new f("o",!1,!1,!1,!0),predefined:!0})));return h};return{KeyMode:r,DefaultKeyMode:k}});
define("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(n,t,r){function k(f){f=f||{};this._document=f.document||document}var f={};k.getTheme=function(h){h=h||"default";var g=f[h];g||(g=f[h]=new k);return g};k.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(f,g){var p=this,e=p._themeClass;p._themeClass=f;this._load(f,g,function(){p.onThemeChanged({type:"ThemeChanged",oldValue:e,newValue:p.getThemeClass()})})},onThemeChanged:function(f){return this.dispatchEvent(f)},
buildStyleSheet:function(f,g){function p(b,a,d){a&&(e.push("."+f+" ."+b+" {"),e.push("\t"+(d?"background-color":"color")+": "+a+";"),e.push("}"))}var e=[];e.push("");e.push("."+f+" {");g.fontFamily&&e.push("\tfont-family: "+g.fontFamily+";");g.fontSize&&e.push("\tfont-size: "+g.fontSize+";");g.fontSize&&e.push("\tcolor: "+g.text+";");e.push("}");e.push("."+f+".textview {");g.background&&e.push("\tbackground-color: "+g.background+";");e.push("}");e.push("."+f+" .textviewLeftRuler {");g.leftRuler&&
e.push("\tborder-right: 1px solid "+g.leftRuler+";");e.push("}");e.push("."+f+" .textviewRightRuler {");g.rightRuler&&e.push("\tborder-left: 1px solid "+g.rightRuler+";");e.push("}");p("ruler.annotations",g.annotationRuler,!0);p("ruler.lines",g.annotationRuler,!0);p("ruler.folding",g.annotationRuler,!0);p("ruler.overview",g.overviewRuler,!0);p("rulerLines",g.lineNumber,!1);p("rulerLines.even",g.lineNumberEven,!1);p("rulerLines.odd",g.lineNumberOdd,!1);p("annotationLine.currentLine",g.currentLine,
!0);p("entity-name-tag",g.keyword,!1);p("entity-other-attribute-name",g.attribute,!1);p("string-quoted",g.string,!1);p("meta.annotation.currentLine",g.currentLine,!0);p("keyword",g.keyword,!1);p("string",g.string,!1);p("constant",g.constant,!1);p("comment",g.comment,!1);p("comment.block.documentation",g.comment,!1);p("keyword.other.documentation.markup",g.comment,!1);p("keyword.other.documentation.markup",g.comment,!1);return e.join("\n")},_createStyle:function(f,g,p,e){var b=this._document;f="orion-theme-"+
f;var a=b.getElementById(f);if(a){if(e||a.firstChild.data===g)return;a.removeChild(a.firstChild);a.appendChild(b.createTextNode(g))}else e?(a=r.createElement(b,"link"),a.rel="stylesheet",a.type="text/css",a.href=g,a.addEventListener("load",function(){p()})):(a=r.createElement(b,"style"),a.appendChild(b.createTextNode(g))),a.id=f,(b.getElementsByTagName("head")[0]||b.documentElement).appendChild(a);e||p()},_load:function(f,g,p){if(f)if("string"===typeof g)this._createStyle(f,g,p);else if(g=g.href,
".css"!==g.substring(g.length-4)&&(g+=".css"),/^\//.test(g)||/[a-zA-Z0-9]+:\/\//i.test(g)||!n.toUrl)this._createStyle(f,g,p,!0);else{var e=this;n(["text!"+g],function(b){e._createStyle(f,b,p,!1)})}else p()}};t.EventTarget.addMixin(k.prototype);return{TextTheme:k}});
define("orion/editor/util",[],function(){return{contains:function(n,t){if(!t)return!1;if(!n.compareDocumentPosition){for(var r=t;r;){if(n===r)return!0;r=r.parentNode}return!1}return n===t||0!==(n.compareDocumentPosition(t)&16)},addEventListener:function(n,t,r,k){"function"===typeof n.addEventListener?n.addEventListener(t,r,!0===k):n.attachEvent("on"+t,r)},removeEventListener:function(n,t,r,k){"function"===typeof n.removeEventListener?n.removeEventListener(t,r,!0===k):n.detachEvent("on"+t,r)},Animation:function(){function n(n){this.options=
n}n.prototype.play=function(){var n="number"===typeof this.options.duration?this.options.duration:350,r=this.options.easing||this.defaultEasing,k=this.options.onAnimate||function(){},f=this.options.curve[0],h=this.options.curve[1],g=h-f,p=-1,e,b=this;this.interval=this.options.window.setInterval(function(){p=-1===p?(new Date).getTime():p;var a=((new Date).getTime()-p)/n;1>a?(a=r(a),e=f+a*g,k(e)):(k(h),b.stop())},"number"===typeof this.options.rate?this.options.rate:20)};n.prototype.stop=function(){this.options.window.clearInterval(this.interval);
(this.options.onEnd||function(){})()};n.prototype.defaultEasing=function(n){return Math.sin(n*(Math.PI/2))};return n}()}});
define("orion/editor/textView","i18n!orion/editor/nls/messages orion/editor/textModel orion/editor/keyModes orion/editor/eventTarget orion/editor/textTheme orion/editor/util orion/util".split(" "),function(n,t,r,k,f,h,g){function p(q,a,d){if(d){a.className="";d=a.attributes;for(var b=d.length;0<b--;)(!g.isIE||9<=g.isIE||9>g.isIE&&d[b].specified)&&a.removeAttribute(d[b].name)}if(q){q.styleClass&&(a.className=q.styleClass);if(d=q.style)for(var m in d)d.hasOwnProperty(m)&&(a.style[m]=d[m]);if(q=q.attributes)for(var l in q)q.hasOwnProperty(l)&&
a.setAttribute(l,q[l])}}function e(q){return q instanceof Array?q.slice(0):q}function b(q,a){if(!q)return a;if(!a)return q;for(var d in a)a.hasOwnProperty(d)&&(q.hasOwnProperty(d)||(q[d]=a[d]));return q}function a(q,d){if(q===d)return!0;if(q&&!d||!q&&d||q&&q.constructor===String||d&&d.constructor===String)return!1;if(q instanceof Array||d instanceof Array){if(!(q instanceof Array&&d instanceof Array)||q.length!==d.length)return!1;for(var b=0;b<q.length;b++)if(!a(q[b],d[b]))return!1;return!0}if(!(q instanceof
Object)||!(d instanceof Object))return!1;for(b in q)if(q.hasOwnProperty(b)&&(!d.hasOwnProperty(b)||!a(q[b],d[b])))return!1;for(b in d)if(!q.hasOwnProperty(b))return!1;return!0}function d(q,a,d){for(var b=0,m=0,l=0,e=q.length;l<e;){-1!==b&&b<=l&&(b=q.indexOf("\r",l));-1!==m&&m<=l&&(m=q.indexOf("\n",l));var s=l,g;if(-1===m&&-1===b){a(q.substring(l));break}-1!==b&&-1!==m?b+1===m?(g=b,l=m+1):(g=b<m?b:m,l=(b<m?b:m)+1):-1!==b?(g=b,l=b+1):(g=m,l=m+1);a(q.substring(s,g));d()}}function m(q){var a,d,b,m,l=
q.ownerDocument.defaultView||q.ownerDocument.parentWindow;l.getComputedStyle?(q=l.getComputedStyle(q,null),a=q.getPropertyValue("padding-left"),d=q.getPropertyValue("padding-top"),b=q.getPropertyValue("padding-right"),m=q.getPropertyValue("padding-bottom")):q.currentStyle&&(a=q.currentStyle.paddingLeft,d=q.currentStyle.paddingTop,b=q.currentStyle.paddingRight,m=q.currentStyle.paddingBottom);return{left:parseInt(a,10)||0,top:parseInt(d,10)||0,right:parseInt(b,10)||0,bottom:parseInt(m,10)||0}}function s(q){var a,
d,b,l,e=q._trim;if(!e){var e=m(q),s=q.ownerDocument.defaultView||q.ownerDocument.parentWindow;s.getComputedStyle?(l=s.getComputedStyle(q,null),a=l.getPropertyValue("border-left-width"),d=l.getPropertyValue("border-top-width"),b=l.getPropertyValue("border-right-width"),l=l.getPropertyValue("border-bottom-width")):q.currentStyle&&(a=q.currentStyle.borderLeftWidth,d=q.currentStyle.borderTopWidth,b=q.currentStyle.borderRightWidth,l=q.currentStyle.borderBottomWidth);a=parseInt(a,10)||0;d=parseInt(d,10)||
0;b=parseInt(b,10)||0;l=parseInt(l,10)||0;e.left+=a;e.top+=d;e.right+=b;e.bottom+=l;q._trim=e}return e}function l(q,a,d,b){function m(a){if(a.animationName===e){var d=a.target;"function"===typeof d.__DOMReady&&(q.defaultView||q.parentWindow).setTimeout(function(){d.__DOMReady()},0)}}function l(q,a){for(var d=["","-webkit-","-moz-","-ms-","-o-"],b="",z="body ."+q+" {\n",m=0;m<d.length;m++)b+="@"+d[m]+"keyframes "+a+" {\nfrom { opacity: 0.99; }\nto { opacity: 1; }\n}\n",z+=d[m]+"animation-duration: 0.001s;\n"+
d[m]+"animation-name: "+a+";\n";return b+(z+"}")}d="_"+d+"DOMReady";a.className=a.className?a.className+" "+d:d;a.__DOMReady=b;b=d+"Style";if(!q.getElementById(b)){var e=d+"Animation";y(q,"animationstart",m,!1);y(q,"MSAnimationStart",m,!1);y(q,"webkitAnimationStart",m,!1);a=q.createElement("style");a.id=b;b=q.getElementsByTagName("head")[0]||q.documentElement;a.appendChild(q.createTextNode(l(d,e)));b.insertBefore(a,b.firstChild)}}function u(q,a,d){this.start=q;this.end=a;this.caret=d}function v(q){this.left=
q.left;this.top=q.top;this.right=q.right;this.bottom=q.bottom}function A(q,a,d){this.view=q;this.lineIndex=a;this._lineDiv=d}function w(q){this._init(q||{})}var y=h.addEventListener,x=h.removeEventListener,D=h.Animation;u.prototype={clone:function(){return new u(this.start,this.end,this.caret)},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(q){this.caret?this.start=q:this.end=q;this.start>this.end&&(q=this.start,this.start=this.end,this.end=q,this.caret=!this.caret)},
setCaret:function(q){this.end=this.start=q;this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},toString:function(){return"start\x3d"+this.start+" end\x3d"+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(q){return this.caret===q.caret&&this.start===q.start&&this.end===q.end}};v.prototype={toString:function(){return"{l\x3d"+this.left+", t\x3d"+this.top+", r\x3d"+this.right+", b\x3d"+this.bottom+"}"}};
A.prototype={create:function(q,a){if(!this._lineDiv){var d=this._lineDiv=this._createLine(q,a,this.lineIndex);d._line=this;return d}},_createLine:function(q,d,b){var m=this.view,l=m._model,e=l.getLine(b),s=l.getLineStart(b),f={type:"LineStyle",textView:m,lineIndex:b,lineText:e,lineStart:s};m.onLineStyle(f);var u=q.ownerDocument,l=d||g.createElement(u,"div");if(!d||!a(d.viewStyle,f.style))p(f.style,l,d),d&&(d._trim=null),l.viewStyle=f.style,l.setAttribute("role","presentation");l.lineIndex=b;if(d&&
l.viewLineText===e&&a(f.ranges,l.viewRanges))return l;l.viewRanges=f.ranges;l.viewLineText=e;b=[];this._createRanges(f.ranges,e,0,e.length,s,{tabOffset:0,ranges:b});f=" ";!m._fullSelection&&9>g.isIE&&(f="\ufeff");m={text:f,style:m._metrics.largestFontStyle,ignoreChars:1};0===b.length||!b[b.length-1].style||"div"!==b[b.length-1].style.tagName?b.push(m):b.splice(b.length-1,0,m);var h,v,k,A=f=0;if(g.isFirefox&&2E3<e.length){d&&(l.innerHTML="",d.lineWidth=void 0);d=u.createDocumentFragment();for(e=0;e<
b.length;e++)m=b[e],s=m.text,h=m.style,h=this._createSpan(l,s,h,m.ignoreChars),d.appendChild(h);l.appendChild(d)}else{var w,n;if(d){if(v=d.modelChangedEvent)0===v.removedLineCount&&0===v.addedLineCount?(n=v.start-s,w=v.addedCharCount-v.removedCharCount):n=-1,d.modelChangedEvent=void 0;v=d.firstChild}for(e=0;e<b.length;e++){m=b[e];s=m.text;f+=s.length;h=m.style;if(v)if(k=v.firstChild.data,u=v.viewStyle,k===s&&a(h,u)){A+=k.length;v._rectsCache=void 0;h=v=v.nextSibling;continue}else for(;v;){if(-1!==
n){u=f;u>=n&&(u-=w);k=(k=v.firstChild.data)?k.length:0;if(A+k>u)break;A+=k}u=v.nextSibling;l.removeChild(v);v=u}h=this._createSpan(l,s,h,m.ignoreChars);v?l.insertBefore(h,v):l.appendChild(h);d&&(d.lineWidth=void 0)}if(d)for(w=h?h.nextSibling:null;w;)u=w.nextSibling,d.removeChild(w),w=u}l.parentNode||q.appendChild(l);return l},_createRanges:function(q,d,b,m,l,e){if(!(b>m)){if(q)for(var s=0;s<q.length;s++){var g=q[s];if(!(g.end<l+b)){var f=Math.max(l+b,g.start)-l;if(f>m)break;var u=Math.min(l+m,g.end)-
l;if(f<=u){f=Math.max(b,f);u=Math.min(m,u);b<f&&this._createRange(d,b,f,null,e);if(!g.style||!g.style.unmergeable)for(;s+1<q.length&&q[s+1].start-l===u&&a(g.style,q[s+1].style);)g=q[s+1],u=Math.min(l+m,g.end)-l,s++;this._createRange(d,f,u,g.style,e);b=u}}}b<m&&this._createRange(d,b,m,null,e)}},_createRange:function(q,a,d,b,m){if(!(a>d)){var l=this.view._customTabSize;if(l&&8!==l)for(var e=q.indexOf("\t",a);-1!==e&&e<d;){a<e&&(a={text:q.substring(a,e),style:b},m.ranges.push(a),m.tabOffset+=a.text.length);
a=l-m.tabOffset%l;if(0<a){for(var s="\u00a0",g=1;g<a;g++)s+=" ";a={text:s,style:b,ignoreChars:a-1};m.ranges.push(a);m.tabOffset+=a.text.length}a=e+1;if(a===d)return;e=q.indexOf("\t",a)}a<=d&&(a={text:q.substring(a,d),style:b},m.ranges.push(a),m.tabOffset+=a.text.length)}},_createSpan:function(q,a,d,b){var m=this.view,l="span";d&&d.tagName&&(l=d.tagName.toLowerCase());var e="a"===l;e&&(this.hasLink=!0);e&&!m._linksVisible&&(l="span");e=q.ownerDocument;q=g.createElement(q.ownerDocument,l);q.appendChild(e.createTextNode(d&&
d.text?d.text:a));d&&d.html?(q.innerHTML=d.html,q.ignore=!0):d&&d.node&&(q.appendChild(d.node),q.ignore=!0);p(d,q);if("a"===l){var s=m._getWindow();y(q,"click",function(q){return m._handleLinkClick(q?q:s.event)},!1)}q.viewStyle=d;b&&(q.ignoreChars=b);return q},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(q,a){var d=this._ensureCreated(),b=this.view;if(void 0===q)return this._getLineBoundingClientRect(d,
!0);var m=b._model,l=d.ownerDocument,e=this.lineIndex,s=null;if(q<m.getLineEnd(e)){var f=m.getLineStart(e);this.forEach(function(a){var m=a.firstChild,z=this._nodeLength(a);if(f+z>q){var e=q-f;if(1===m.length)s=new v(a.getBoundingClientRect());else if(b._isRangeRects)z=l.createRange(),z.setStart(m,e),z.setEnd(m,e+1),s=new v(z.getBoundingClientRect());else if(g.isIE)z=l.body.createTextRange(),z.moveToElementText(a),z.collapse(),(m=0===e&&8===g.isIE)&&(e=1),z.moveEnd("character",e+1),z.moveStart("character",
e),s=new v(z.getBoundingClientRect()),m&&(s.left=a.getClientRects()[0].left);else{var u=m.data;a.removeChild(m);a.appendChild(l.createTextNode(u.substring(0,e)));var h=g.createElement(l,"span");h.appendChild(l.createTextNode(u.substring(e,e+1)));a.appendChild(h);a.appendChild(l.createTextNode(u.substring(e+1)));s=new v(h.getBoundingClientRect());a.innerHTML="";a.appendChild(m);this._createdDiv||(a=b._getSelection(),(f<=a.start&&a.start<f+z||f<=a.end&&a.end<f+z)&&b._updateDOMSelection())}g.isIE&&(e=
d.ownerDocument.defaultView||d.ownerDocument.parentWindow,a=e.screen.logicalXDPI/e.screen.deviceXDPI,e=e.screen.logicalYDPI/e.screen.deviceYDPI,s.left*=a,s.right*=a,s.top*=e,s.bottom*=e);return!1}f+=z;return!0})}m=this.getBoundingClientRect();s||(b._wrapMode?(e=this.getClientRects(),s=e[e.length-1],s.left=s.right,s.left+=m.left,s.top+=m.top,s.right+=m.left,s.bottom+=m.top):(s=new v(m),s.left=s.right));if(a||void 0===a)s.left-=m.left,s.top-=m.top,s.right-=m.left,s.bottom-=m.top;return s},forEach:function(q){for(var a=
this._ensureCreated().firstChild;a;){var d=a.nextSibling;if(!a.ignore&&!q.call(this,a))break;a=d}},_getClientRects:function(q,a){var d,b,m,l;if(!q._rectsCache){d=q.getClientRects();b=Array(d.length);for(l=0;l<d.length;l++)m=b[l]=new v(d[l]),m.left-=a.left,m.top-=a.top,m.right-=a.left,m.bottom-=a.top;q._rectsCache=b}d=q._rectsCache;b=[d.length];for(l=0;l<d.length;l++)b[l]=new v(d[l]);return b},getClientRects:function(q){if(!this.view._wrapMode)return[this.getBoundingClientRect()];var a=[],d=this._ensureCreated().getBoundingClientRect();
this.forEach(function(q){q=this._getClientRects(q,d);for(var b=0;b<q.length;b++){var m=q[b],l,e;if(m.top!==m.bottom){var s=m.top+(m.bottom-m.top)/2;for(l=0;l<a.length&&!(e=a[l],e.top<=s&&s<e.bottom);l++);l===a.length?a.push(m):(m.left<e.left&&(e.left=m.left),m.top<e.top&&(e.top=m.top),m.right>e.right&&(e.right=m.right),m.bottom>e.bottom&&(e.bottom=m.bottom))}}return!0});return void 0!==q?a[q]:a},_getLineBoundingClientRect:function(q,a){var d=new v(q.getBoundingClientRect());if(!this.view._wrapMode){d.right=
d.left;for(var b=q.lastChild;b&&b.ignoreChars===b.firstChild.length;)b=b.previousSibling;b&&(b=b.getBoundingClientRect(),d.right=b.right+s(q).right)}a&&(b=s(q),d.left+=b.left,d.right-=b.right);return d},getLineCount:function(){return!this.view._wrapMode?1:this.getClientRects().length},getLineIndex:function(q){if(!this.view._wrapMode)return 0;var a=this.getClientRects();q=this.getBoundingClientRect(q);q=q.top+(q.bottom-q.top)/2;for(var d=0;d<a.length;d++)if(a[d].top<=q&&q<a[d].bottom)return d;return a.length-
1},getLineStart:function(q){if(!this.view._wrapMode||0===q)return this.view._model.getLineStart(this.lineIndex);var a=this.getClientRects();return this.getOffset(a[q].left+1,a[q].top+1)},_nodeLength:function(q){if(!q||q.ignore)return 0;var a=q.firstChild.length;q.ignoreChars&&(a-=q.ignoreChars);return a},getModelOffset:function(q,a){if(!q)return 0;var d=0;this.forEach(function(b){var m=b.firstChild;if(m===q)return b.ignoreChars&&(d-=b.ignoreChars),d+=a,!1;b.ignoreChars&&(d-=b.ignoreChars);d+=m.data.length;
return!0});return Math.max(0,d)+this.view._model.getLineStart(this.lineIndex)},getNodeOffset:function(q){var a=0,d,b,m=this.view._model,l=m.getLineStart(this.lineIndex),e=q-l,s=m.getLineEnd(this.lineIndex)-l;this.forEach(function(q){var m=q.firstChild,l=this._nodeLength(q);if(l+a>e||a+l>=s)return d=m,b=e-a,q.ignoreChars&&(0<l&&b===l)&&(b+=q.ignoreChars),!1;a+=l;return!0});return{node:d,offset:b}},getText:function(q){var a="",d=0;this.forEach(function(b){var m;if(b.ignoreChars){m=b.lastChild;for(var l=
0,e=[],s=-1;m;){var g=m.data;if(g)for(var f=g.length-1;0<=f;f--){var u=g.substring(f,f+1);l<b.ignoreChars&&(" "===u||"\ufeff"===u)?l++:e.push("\u00a0"===u?"\t":u)}q===m&&(s=e.length);m=m.previousSibling}e=e.reverse().join("");-1!==s&&(d=a.length+e.length-s);a+=e}else for(m=b.firstChild;m;)q===m&&(d=a.length),a+=m.data,m=m.nextSibling;return!0});return{text:a,offset:d}},getOffset:function(q,a){function d(b,f,C){var v=b.firstChild,k=p._nodeLength(b),E=u.ownerDocument,A=E.defaultView||E.parentWindow,
w=g.isIE?A.screen.logicalXDPI/A.screen.deviceXDPI:1,n=g.isIE?A.screen.logicalYDPI/A.screen.deviceYDPI:1,r,y,t,A=C.left+h.left,x,N;if(g.isIE||m._isRangeRects){for(var E=m._isRangeRects?E.createRange():E.body.createTextRange(),H=k,D=-1;1<H-D;){var P=Math.floor((H+D)/2);C=D+1;r=P===k-1&&b.ignoreChars?v.length:P+1;x=0===C&&8===g.isIE;m._isRangeRects?(E.setStart(v,C),E.setEnd(v,r)):(x&&(C=1),E.moveToElementText(b),E.move("character",C),E.moveEnd("character",r-C));N=E.getClientRects();for(var M=!1,S=0;S<
N.length;S++)if(C=N[S],r=(x?A:C.left)*w-h.left,t=C.right*w-h.left,y=C.top*n-h.top,C=C.bottom*n-h.top,r<=q&&q<t&&(!m._wrapMode||y<=a&&a<C)){M=!0;break}M?H=P:D=P}f+=H;C=H;r=H===k-1&&b.ignoreChars?v.length:Math.min(H+1,v.length);m._isRangeRects?(E.setStart(v,C),E.setEnd(v,r)):(E.moveToElementText(b),E.move("character",C),E.moveEnd("character",r-C));N=E.getClientRects();k=!1;0<N.length&&(C=N[0],r=(x?A:C.left)*w-h.left,t=C.right*w-h.left,k=q>r+(t-r)/2);b=f-s;v=l.getLine(e);w=v.charCodeAt(b);55296<=w&&
56319>=w&&k?b<v.length&&(w=v.charCodeAt(b+1),56320<=w&&57343>=w&&(f+=1)):56320<=w&&(57343>=w&&!k)&&0<b&&(w=v.charCodeAt(b-1),55296<=w&&56319>=w&&(f-=1));k&&f++}else{w=[];for(x=0;x<k;x++)w.push("\x3cspan\x3e"),x===k-1?w.push(v.data.substring(x)):w.push(v.data.substring(x,x+1)),w.push("\x3c/span\x3e");b.innerHTML=w.join("");for(w=b.firstChild;w;){C=w.getBoundingClientRect();r=C.left-h.left;t=C.right-h.left;if(r<=q&&q<t){q>r+(t-r)/2&&f++;break}f++;w=w.nextSibling}p._createdDiv||(b.innerHTML="",b.appendChild(v),
b=m._getSelection(),(f<=b.start&&b.start<f+k||f<=b.end&&b.end<f+k)&&m._updateDOMSelection())}return f}function b(d){if(d.ignore)return null;d=p._getClientRects(d,h);for(var l=0;l<d.length;l++){var e=d[l];if(e.left<=q&&q<e.right&&(!m._wrapMode||e.top<=a&&a<e.bottom))return e}return null}var m=this.view,l=m._model,e=this.lineIndex,s=l.getLineStart(e),f=l.getLineEnd(e);if(s===f)return s;var u=this._ensureCreated(),h=this.getBoundingClientRect(),p=this,v,k;if(m._wrapMode){v=this.getClientRects();a<v[0].top&&
(a=v[0].top);for(var A=0;A<v.length&&!(k=v[A],k.top<=a&&a<k.bottom);A++);q<k.left&&(q=k.left);q>k.right&&(q=k.right-1)}else 0>q&&(q=0),q>h.right-h.left&&(q=h.right-h.left);var w,n;if(this._lastHitChild&&this._lastHitChild.parentNode){if(w=this._lastHitOffset,n=this._lastHitChild,k=b(n),!k){v=w;for(var A=w+this._nodeLength(n),r=n.previousSibling,y=n.nextSibling;r||y;){if(r){v-=this._nodeLength(r);if(k=b(r)){n=r;w=v;break}r=r.previousSibling}if(y){if(k=b(y)){n=y;w=A;break}A+=this._nodeLength(y);y=y.nextSibling}}}}else w=
s,this.forEach(function(q){n=q;if(k=b(n))return!1;w+=this._nodeLength(n);return!0});n&&k&&(this._lastHitChild=n,this._lastHitOffset=w,w=d(n,w,k));return Math.min(f,Math.max(s,w))},getNextOffset:function(q,a){if("line"===a.unit){var d=this.view._model,b=d.getLineAtOffset(q);if(0<a.count)return a.count--,d.getLineEnd(b);a.count++;return d.getLineStart(b)}return"wordend"===a.unit||"wordWS"===a.unit||"wordendWS"===a.unit?this._getNextOffset_W3C(q,a):g.isIE?this._getNextOffset_IE(q,a):this._getNextOffset_W3C(q,
a)},_getNextOffset_W3C:function(q,a){function d(q){return 33<=q&&47>=q||58<=q&&64>=q||91<=q&&94>=q||96===q||123<=q&&126>=q}function b(q){return 32===q||9===q}var m=this.view._model,l=m.getLineAtOffset(q),e=m.getLine(l),s=m.getLineStart(l),m=m.getLineEnd(l),l=e.length,g=q-s,f,u=0>a.count?-1:1;if("word"===a.unit||"wordend"===a.unit||"wordWS"===a.unit||"wordendWS"===a.unit)for(var h,p,v;0!==a.count;){if(0<a.count){if(g===l)return m;f=e.charCodeAt(g);h=d(f);p=!h&&!b(f);for(g++;g<l;){f=e.charCodeAt(g);
if("wordWS"!==a.unit&&"wordendWS"!==a.unit){v=d(f);if("wordend"===a.unit){if(!v&&h)break}else if(v&&!h)break;f=!v&&!b(f)}else f=!b(f);if("wordend"===a.unit||"wordendWS"===a.unit){if(!f&&p)break}else if(f&&!p)break;p=f;h=v;g++}}else{if(0===g)return s;g--;f=e.charCodeAt(g);h=d(f);for(p=!h&&!b(f);0<g;){f=e.charCodeAt(g-1);if("wordWS"!==a.unit&&"wordendWS"!==a.unit){v=d(f);if("wordend"===a.unit){if(v&&!h)break}else if(!v&&h)break;f=!v&&!b(f)}else f=!b(f);if("wordend"===a.unit||"wordendWS"===a.unit){if(f&&
!p)break}else if(!f&&p)break;p=f;h=v;g--}}a.count-=u}else for(;0!==a.count&&0<=g+u&&g+u<=l;)g+=u,f=e.charCodeAt(g),56320<=f&&57343>=f&&0<g&&(f=e.charCodeAt(g-1),55296<=f&&56319>=f&&(g+=u)),a.count-=u;return s+g},_getNextOffset_IE:function(q,a){var d=this._ensureCreated(),b=this.view._model,m=this.lineIndex,l=0,e;e=b.getLineStart(m);var s=b.getLine(m),g=b.getLineStart(m),f=d.ownerDocument,u=0>a.count?-1:1;if(q===b.getLineEnd(m)){for(d=d.lastChild;d&&d.ignoreChars===d.firstChild.length;)d=d.previousSibling;
if(!d)return e;l=f.body.createTextRange();l.moveToElementText(d);e=l.text.length;l.moveEnd(a.unit,u);l=q+l.text.length-e}else if(q===e&&0>a.count)l=e;else for(d=d.firstChild;d;){b=this._nodeLength(d);if(e+b>q){l=f.body.createTextRange();if(q===e&&0>a.count){for(e=d.previousSibling;e&&(!e.firstChild||!e.firstChild.length);)e=e.previousSibling;l.moveToElementText(e?e:d.previousSibling)}else l.moveToElementText(d),l.collapse(),l.moveEnd("character",q-e);e=l.text.length;l.moveEnd(a.unit,u);l=q+l.text.length-
e;break}e=b+e;d=d.nextSibling}e=l-g;c=s.charCodeAt(e);56320<=c&&57343>=c&&0<e&&(c=s.charCodeAt(e-1),55296<=c&&56319>=c&&(e+=u));a.count-=u;return e+g},updateLinks:function(){var q=this._ensureCreated();if(this.hasLink){var a=this;this.forEach(function(d){var b=d.viewStyle;b&&(b.tagName&&"a"===b.tagName.toLowerCase())&&q.replaceChild(a._createSpan(q,d.firstChild.data,b),d);return!0})}},destroy:function(){var q=this._createdDiv;q&&(q.parentNode.removeChild(q),this._createdDiv=null)}};w.prototype={addKeyMode:function(q,
a){var d=this._keyModes;void 0!==a?d.splice(a,0,q):d.push(q);q._modeAdded&&q._modeAdded()},addRuler:function(q,a){q.setView(this);var d=this._rulers;if(void 0!==a){var b,m;for(m=b=0;b<d.length&&m<a;b++)q.getLocation()===d[b].getLocation()&&m++;d.splice(m,0,q);a=m}else d.push(q);this._createRuler(q,a);this._update()},computeSize:function(){var q=0,a=0,d=this._model,b=this._clientDiv;if(!b)return{width:q,height:a};var m=b.style.width;g.isWebkit&&(b.style.width="0x7fffffffpx");for(var d=d.getLineCount(),
l=0;l<d;l++){var e=this._getLine(l),s=e.getBoundingClientRect(),q=Math.max(q,s.right-s.left),a=a+(s.bottom-s.top);e.destroy()}g.isWebkit&&(b.style.width=m);b=this._getViewPadding();q+=b.right+b.left+this._metrics.scrollWidth;a+=b.bottom+b.top+this._metrics.scrollWidth;return{width:q,height:a}},convert:function(q,a,d){if(this._clientDiv){var b=this._getScroll(),m=this._getViewPadding(),l=this._viewDiv.getBoundingClientRect();"document"===a&&(void 0!==q.x&&(q.x+=-b.x+l.left+m.left),void 0!==q.y&&(q.y+=
-b.y+l.top+m.top));"document"===d&&(void 0!==q.x&&(q.x+=b.x-l.left-m.left),void 0!==q.y&&(q.y+=b.y-l.top-m.top));return q}},destroy:function(){for(var q=0;q<this._rulers.length;q++)this._rulers[q].setView(null);this.rulers=null;this._destroyView();this.onDestroy({type:"Destroy"});this._parent=null;this._model&&this._model.destroy&&this._model.destroy();this._actions=this._keyModes=this._doubleClickSelection=this._selection=this._theme=this._model=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),
this._clientDiv.focus(),this._updateDOMSelection())},hasFocus:function(){return this._hasFocus},getActionDescription:function(q){if(q=this._actions[q])return q.actionDescription},getActions:function(q){var a=[],d=this._actions,b;for(b in d)d.hasOwnProperty(b)&&(q||!d[b].defaultHandler)&&a.push(b);return a},getBottomIndex:function(q){return!this._clientDiv?0:this._getBottomIndex(q)},getBottomPixel:function(){return!this._clientDiv?0:this._getScroll().y+this._getClientHeight()},getCaretOffset:function(){return this._getSelection().getCaret()},
getClientArea:function(){if(!this._clientDiv)return{x:0,y:0,width:0,height:0};var q=this._getScroll();return{x:q.x,y:q.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return!this._clientDiv?0:this._getScroll().x},getKeyBindings:function(q){for(var a=[],d=this._keyModes,b=0;b<d.length;b++)a=a.concat(d[b].getKeyBindings(q));return a},getKeyModes:function(){return this._keyModes.slice(0)},getLineHeight:function(q){return!this._clientDiv?0:this._getLineHeight(q)},
getLineIndex:function(q){return!this._clientDiv?0:this._getLineIndex(q)},getLinePixel:function(q){return!this._clientDiv?0:this._getLinePixel(q)},getLocationAtOffset:function(q){if(!this._clientDiv)return{x:0,y:0};var a=this._model;q=Math.min(Math.max(0,q),a.getCharCount());var a=a.getLineAtOffset(q),d=this._getLine(a);q=d.getBoundingClientRect(q);d.destroy();d=q.left;a=this._getLinePixel(a)+q.top;return{x:d,y:a}},getNextOffset:function(q,a){var d=new u(q,q,!1);this._doMove(a,d);return d.getCaret()},
getOptions:function(){var q;if(0===arguments.length)q=this._defaultOptions();else if(1===arguments.length){if(q=arguments[0],"string"===typeof q)return e(this["_"+q])}else{q={};for(var a in arguments)arguments.hasOwnProperty(a)&&(q[arguments[a]]=void 0)}for(var d in q)q.hasOwnProperty(d)&&(q[d]=e(this["_"+d]));return q},getModel:function(){return this._model},getOffsetAtLocation:function(q,a){if(!this._clientDiv)return 0;var d=this._getLineIndex(a),b=this._getLine(d),d=b.getOffset(q,a-this._getLinePixel(d));
b.destroy();return d},getLineAtOffset:function(q){return this.getModel().getLineAtOffset(q)},getLineStart:function(q){this.getModel().getLineStart(q)},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){var q=this._getSelection();return{start:q.start,end:q.end}},getText:function(q,a){return this._model.getText(q,a)},getTopIndex:function(q){return!this._clientDiv?0:this._getTopIndex(q)},getTopPixel:function(){return!this._clientDiv?0:this._getScroll().y},invokeAction:function(q,
a,d){if(this._clientDiv){if(q=this._actions[q]){if(!a&&q.handler&&q.handler(d))return!0;if(q.defaultHandler)return"boolean"===typeof q.defaultHandler(d)}return!1}},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(q){return this.dispatchEvent(q)},onDragStart:function(q){return this.dispatchEvent(q)},onDrag:function(q){return this.dispatchEvent(q)},onDragEnd:function(q){return this.dispatchEvent(q)},onDragEnter:function(q){return this.dispatchEvent(q)},onDragOver:function(q){return this.dispatchEvent(q)},
onDragLeave:function(q){return this.dispatchEvent(q)},onDrop:function(q){return this.dispatchEvent(q)},onDestroy:function(q){return this.dispatchEvent(q)},onLineStyle:function(q){return this.dispatchEvent(q)},onKeyDown:function(q){return this.dispatchEvent(q)},onKeyPress:function(q){return this.dispatchEvent(q)},onKeyUp:function(q){return this.dispatchEvent(q)},onModelChanged:function(q){return this.dispatchEvent(q)},onModelChanging:function(q){return this.dispatchEvent(q)},onModify:function(q){return this.dispatchEvent(q)},
onMouseDown:function(q){return this.dispatchEvent(q)},onMouseUp:function(q){return this.dispatchEvent(q)},onMouseMove:function(q){return this.dispatchEvent(q)},onMouseOver:function(q){return this.dispatchEvent(q)},onMouseOut:function(q){return this.dispatchEvent(q)},onSelection:function(q){return this.dispatchEvent(q)},onScroll:function(q){return this.dispatchEvent(q)},onVerify:function(q){return this.dispatchEvent(q)},onFocus:function(q){return this.dispatchEvent(q)},onBlur:function(q){return this.dispatchEvent(q)},
redraw:function(){if(!(0<this._redrawCount)){var q=this._model.getLineCount();this.redrawRulers(0,q);this.redrawLines(0,q)}},redrawRulers:function(q,a){if(!(0<this._redrawCount))for(var d=this.getRulers(),b=0;b<d.length;b++)this.redrawLines(q,a,d[b])},redrawLines:function(q,a,d){if(!(0<this._redrawCount)&&(void 0===q&&(q=0),void 0===a&&(a=this._model.getLineCount()),q!==a)){var b=this._clientDiv;if(b){if(d)for(b=this._getRulerParent(d).firstChild;b&&b._ruler!==d;)b=b.nextSibling;d?b.rulerChanged=
!0:this._lineHeight&&this._resetLineHeight(q,a);if(!d||"page"===d.getOverview())for(b=b.firstChild;b;){var m=b.lineIndex;q<=m&&m<a&&(b.lineChanged=!0);b=b.nextSibling}!d&&(!this._wrapMode&&q<=this._maxLineIndex&&this._maxLineIndex<a)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._queueUpdate()}}},redrawRange:function(q,a){if(!(0<this._redrawCount)){var d=this._model;void 0===q&&(q=0);void 0===a&&(a=d.getCharCount());var b=d.getLineAtOffset(q),d=d.getLineAtOffset(Math.max(q,
a-1))+1;this.redrawLines(b,d)}},removeKeyMode:function(q){for(var a=this._keyModes,d=0;d<a.length;d++)if(a[d]===q){a.splice(d,1);break}q._modeRemoved&&q._modeRemoved()},removeRuler:function(q){for(var a=this._rulers,d=0;d<a.length;d++)if(a[d]===q){a.splice(d,1);q.setView(null);this._destroyRuler(q);this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(q,a,d){if(q){var b=this._actions,m=b[q];m||(m=b[q]={});m.handler=a;void 0!==d&&(m.actionDescription=
d)}},setKeyBinding:function(q,a){this._keyModes[0].setKeyBinding(q,a)},setCaretOffset:function(q,a,d){var b=this._model.getCharCount();q=Math.max(0,Math.min(q,b));q=new u(q,q,!1);this._setSelection(q,void 0===a||a,!0,d)},setHorizontalPixel:function(q){this._clientDiv&&(q=Math.max(0,q),this._scrollView(q-this._getScroll().x,0))},setRedraw:function(q){q?0===--this._redrawCount&&this.redraw():this._redrawCount++},setModel:function(q){if(q&&q!==this._model){this._model.removeEventListener("preChanging",
this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);var a=this._model.getLineCount(),d=this._model.getCharCount(),b=q.getLineCount(),m=q.getCharCount(),l={type:"ModelChanging",text:q.getText(),start:0,removedCharCount:d,addedCharCount:m,removedLineCount:a,addedLineCount:b};this.onModelChanging(l);this._model=q;l={type:"ModelChanged",start:0,removedCharCount:d,addedCharCount:m,removedLineCount:a,addedLineCount:b};this.onModelChanged(l);this._model.addEventListener("preChanging",
this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._reset();this._update()}},setOptions:function(q){var d=this._defaultOptions(),b;for(b in q)if(q.hasOwnProperty(b)){var m=q[b];if(!a(this["_"+b],m)){var l=d[b]?d[b].update:null;l?l.call(this,m):this["_"+b]=e(m)}}},setSelection:function(q,a,d,b){var m=q>a;if(m){var l=q;q=a;a=l}l=this._model.getCharCount();q=Math.max(0,Math.min(q,l));a=Math.max(0,Math.min(a,l));q=new u(q,a,m);this._setSelection(q,
void 0===d||d,!0,b)},setText:function(q,a,d){var b=void 0===a&&void 0===d;void 0===a&&(a=0);void 0===d&&(d=this._model.getCharCount());b&&(this._variableLineHeight=!1);this._modifyContent({text:q,start:a,end:d,_code:!0},!b);b&&(this._columnX=-1,this._setSelection(new u(0,0,!1),!0),13>g.isFirefox&&this._fixCaret())},setTopIndex:function(q){this._clientDiv&&this._scrollView(0,this._getLinePixel(Math.max(0,q))-this._getScroll().y)},setTopPixel:function(q){this._clientDiv&&this._scrollView(0,Math.max(0,
q)-this._getScroll().y)},showSelection:function(q,a){return this._showCaret(q?!1:!0,a,q)},update:function(a,d){this._clientDiv&&((a||this._metrics.invalid)&&this._updateStyle(),void 0===d||d?this._update():this._queueUpdate())},_handleRootMouseDown:function(a){this._cancelCheckSelection();if(!this._ignoreEvent(a)){13>g.isFirefox&&1===a.which&&(this._clientDiv.contentEditable=!1,this._ignoreBlur=(this._overlayDiv||this._clientDiv).draggable=!0);var d=this._overlayDiv||this._clientDiv;9>g.isIE&&(d=
this._viewDiv);for(var b=a.target?a.target:a.srcElement;b;){if(d===b||b.className&&-1!==b.className.indexOf("textViewFind"))return;b=b.parentNode}a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();if(!this._isW3CEvents){var m=this;this._getWindow().setTimeout(function(){m._clientDiv.focus()},0)}}},_handleRootMouseUp:function(a){!this._ignoreEvent(a)&&(13>g.isFirefox&&1===a.which)&&(this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1,this._fixCaret(),
this._ignoreBlur=!1)},_handleBlur:function(a){this._cancelCheckSelection();if(!this._ignoreBlur){this._commitIME();this._hasFocus=!1;if(9>g.isIE&&!this._getSelection().isEmpty()){a=this._rootDiv;var d=g.createElement(a.ownerDocument,"div");a.appendChild(d);a.removeChild(d)}this._cursorDiv&&(this._cursorDiv.style.display="none");if(this._selDiv1)if(this._selDiv1.style.background="lightgray",this._selDiv2.style.background="lightgray",this._selDiv3.style.background="lightgray",a=this._getWindow(),d=
this._selDiv1.ownerDocument,a.getSelection){d=a.getSelection();for(a=d.anchorNode;a;){if(a===this._clientDiv){0<d.rangeCount&&d.removeAllRanges();break}a=a.parentNode}}else if(d.selection){this._ignoreSelect=!1;for(a=d.selection.createRange().parentElement();a;){if(a===this._clientDiv){d.selection.empty();break}a=a.parentNode}this._ignoreSelect=!0}if(!this._ignoreFocus)this.onBlur({type:"Blur"})}},_handleCompositionStart:function(a){this._ignoreEvent(a)||(this._startIME(),this._mutationObserver&&
(this._mutationObserver.disconnect(),this._mutationObserver=null))},_handleCompositionEnd:function(a){this._ignoreEvent(a)||this._commitIME(a.data)},_handleContextMenu:function(a){if(!this._ignoreEvent(a)){g.isIE&&3===this._lastMouseButton&&this._updateDOMSelection();var d=!1;this.isListening("ContextMenu")?(d=this._createMouseEvent("ContextMenu",a),d.screenX=a.screenX,d.screenY=a.screenY,this.onContextMenu(d),d=d.defaultPrevented):g.isMac&&(g.isFirefox&&0===a.button)&&(d=!0);if(d)return a.preventDefault&&
a.preventDefault(),!1;this._contextMenuOpen=!0;g.isFirefox&&(this._checkSelectionChange=!0,this._pollSelectionChange(!0))}},_handleCopy:function(a){this._cancelCheckSelection();if(!this._ignoreEvent(a)&&!this._ignoreCopy&&this._doCopy(a))return a.preventDefault&&a.preventDefault(),!1},_handleCut:function(a){this._cancelCheckSelection();if(!this._ignoreEvent(a)&&this._doCut(a))return a.preventDefault&&a.preventDefault(),!1},_handleDataModified:function(a){this._ignoreEvent(a)||this._startIME()},_handleDblclick:function(a){this._ignoreEvent(a)||
(this._lastMouseTime=a.timeStamp?a.timeStamp:(new Date).getTime(),2!==this._clickCount&&(this._clickCount=2,this._handleMouse(a)))},_handleDragStart:function(a){if(!this._ignoreEvent(a)){if(13>g.isFirefox){var d=this;this._getWindow().setTimeout(function(){d._clientDiv.contentEditable=!0;d._clientDiv.draggable=!1;d._ignoreBlur=!1},0)}if(this.isListening("DragStart")&&-1!==this._dragOffset)this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",a)),this._dragOffset=-1;else return a.preventDefault&&
a.preventDefault(),!1}},_handleDrag:function(a){if(!this._ignoreEvent(a)&&this.isListening("Drag"))this.onDrag(this._createMouseEvent("Drag",a))},_handleDragEnd:function(a){if(!this._ignoreEvent(a)){this._dropTarget=!1;this._dragOffset=-1;if(this.isListening("DragEnd"))this.onDragEnd(this._createMouseEvent("DragEnd",a));13>g.isFirefox&&(this._fixCaret(),"none"===a.dataTransfer.dropEffect&&!a.dataTransfer.mozUserCancelled&&this._fixCaret())}},_handleDragEnter:function(a){if(!this._ignoreEvent(a)){var d=
!0;this._dropTarget=!0;this.isListening("DragEnter")&&(d=!1,this.onDragEnter(this._createMouseEvent("DragEnter",a)));if(g.isWebkit||d)return a.preventDefault&&a.preventDefault(),!1}},_handleDragOver:function(a){if(!this._ignoreEvent(a)){var d=!0;this.isListening("DragOver")&&(d=!1,this.onDragOver(this._createMouseEvent("DragOver",a)));if(g.isWebkit||d)return d&&(a.dataTransfer.dropEffect="none"),a.preventDefault&&a.preventDefault(),!1}},_handleDragLeave:function(a){if(!this._ignoreEvent(a)&&(this._dropTarget=
!1,this.isListening("DragLeave")))this.onDragLeave(this._createMouseEvent("DragLeave",a))},_handleDrop:function(a){if(!this._ignoreEvent(a)){this._dropTarget=!1;if(this.isListening("Drop"))this.onDrop(this._createMouseEvent("Drop",a));a.preventDefault&&a.preventDefault();return!1}},_handleFocus:function(a){this._hasFocus=!0;g.isIOS&&void 0!==this._lastTouchOffset?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=void 0):this._updateDOMSelection();this._cursorDiv&&(this._cursorDiv.style.display=
"block");this._selDiv1&&(a=this._highlightRGB,this._selDiv1.style.background=a,this._selDiv2.style.background=a,this._selDiv3.style.background=a);if(!this._ignoreFocus)this.onFocus({type:"Focus"})},_handleKeyDown:function(a){this._cancelCheckSelection();if(!this._ignoreEvent(a)){if(this.isListening("KeyDown")){var d=this._createKeyEvent("KeyDown",a);this.onKeyDown(d);if(d.defaultPrevented){g.isFirefox&&(this._keyDownPrevented=!0);a.preventDefault();return}}d=!1;switch(a.keyCode){case 16:case 17:case 18:case 91:d=
!0;break;default:this._setLinksVisible(!1)}if(229===a.keyCode){if(this._readonly)return a.preventDefault&&a.preventDefault(),!1;d=!0;g.isSafari&&g.isMac&&a.ctrlKey&&(d=!1,a.keyCode=129);d&&this._startIME()}else d||this._commitIME();if((g.isMac||g.isLinux)&&4>g.isFirefox||12.16>g.isOpera)return this._keyDownEvent=a,!0;if(this._doAction(a))return a.preventDefault?(a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1,a.keyCode=0),!1}},_handleKeyPress:function(a){if(!this._ignoreEvent(a))if(this._keyDownPrevented)a.preventDefault&&
(a.preventDefault(),a.stopPropagation()),this._keyDownPrevented=void 0;else{if(g.isMac&&g.isWebkit&&(63232<=a.keyCode&&63487>=a.keyCode||13===a.keyCode||8===a.keyCode)||((g.isMac||g.isLinux)&&4>g.isFirefox||12.16>g.isOpera)&&this._doAction(this._keyDownEvent))return a.preventDefault&&a.preventDefault(),!1;var d=g.isMac?a.metaKey:a.ctrlKey;if(void 0!==a.charCode&&d)switch(a.charCode){case 99:case 118:case 120:return!0}if(this.isListening("KeyPress")&&(d=this._createKeyEvent("KeyPress",a),this.onKeyPress(d),
d.defaultPrevented)){a.preventDefault();return}if(this._doAction(a))return a.preventDefault?(a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1,a.keyCode=0),!1;d=!1;if(g.isMac){if(a.ctrlKey||a.metaKey)d=!0}else if(g.isFirefox){if(a.ctrlKey||a.altKey)d=!0}else a.ctrlKey^a.altKey&&(d=!0);if(!d&&(d=g.isOpera?a.which:void 0!==a.charCode?a.charCode:a.keyCode,31<d))return this._doContent(String.fromCharCode(d)),a.preventDefault&&a.preventDefault(),!1}},_handleDocKeyUp:function(a){(g.isMac?
a.metaKey:a.ctrlKey)||this._setLinksVisible(!1)},_handleKeyUp:function(a){if(!this._ignoreEvent(a)){if(this.isListening("KeyUp")){var d=this._createKeyEvent("KeyUp",a);this.onKeyUp(d);if(d.defaultPrevented){a.preventDefault();return}}this._handleDocKeyUp(a);13===a.keyCode&&this._commitIME()}},_handleLinkClick:function(a){if(!(g.isMac?a.metaKey:a.ctrlKey))return a.preventDefault&&a.preventDefault(),!1},_handleMouse:function(a){var d=this._getWindow(),b=!0,m=d;if(g.isIE||g.isFirefox&&!this._overlayDiv)m=
this._clientDiv;if(this._overlayDiv){this._hasFocus&&(this._ignoreFocus=!0);var l=this;d.setTimeout(function(){l.focus();l._ignoreFocus=!1},0)}1===this._clickCount?(b=this._setSelectionTo(a.clientX,a.clientY,a.shiftKey,(!g.isOpera||12.16<=g.isOpera)&&this._hasFocus&&this.isListening("DragStart")))&&this._setGrab(m):(this._isW3CEvents&&this._setGrab(m),this._doubleClickSelection=null,this._setSelectionTo(a.clientX,a.clientY,a.shiftKey),this._doubleClickSelection=this._getSelection());return b},_handleMouseDown:function(a){if(!this._ignoreEvent(a)){if(this._linksVisible)if("A"!==
(a.target||a.srcElement).tagName)this._setLinksVisible(!1);else return;this._commitIME();var d=a.which;d||(4===a.button&&(d=2),2===a.button&&(d=3),1===a.button&&(d=1));var b=2!==d&&a.timeStamp?a.timeStamp:(new Date).getTime(),m=b-this._lastMouseTime,l=Math.abs(this._lastMouseX-a.clientX),e=Math.abs(this._lastMouseY-a.clientY),s=this._lastMouseButton===d;this._lastMouseX=a.clientX;this._lastMouseY=a.clientY;this._lastMouseTime=b;this._lastMouseButton=d;1===d&&(this._isMouseDown=!0,s&&m<=this._clickTime&&
l<=this._clickDist&&e<=this._clickDist?this._clickCount++:this._clickCount=1);if(this.isListening("MouseDown")&&(b=this._createMouseEvent("MouseDown",a),this.onMouseDown(b),b.defaultPrevented)){a.preventDefault();return}if(1===d&&this._handleMouse(a)&&(9<=g.isIE||g.isOpera||g.isChrome||g.isSafari||g.isFirefox&&!this._overlayDiv))this._hasFocus||this.focus(),a.preventDefault();g.isFirefox&&3===this._lastMouseButton&&this._updateDOMSelection()}},_handleMouseOver:function(a){if(!this._ignoreEvent(a)&&
!this._animation&&this.isListening("MouseOver"))this.onMouseOver(this._createMouseEvent("MouseOver",a))},_handleMouseOut:function(a){if(!this._ignoreEvent(a)&&!this._animation&&this.isListening("MouseOut"))this.onMouseOut(this._createMouseEvent("MouseOut",a))},_handleMouseMove:function(a){if(!this._animation){var d=this._isClientDiv(a);if(this.isListening("MouseMove")&&d)this.onMouseMove(this._createMouseEvent("MouseMove",a));if(!this._dropTarget){var b=this._linksVisible||this._lastMouseMoveX!==
a.clientX||this._lastMouseMoveY!==a.clientY;this._lastMouseMoveX=a.clientX;this._lastMouseMoveY=a.clientY;this._setLinksVisible(b&&!this._isMouseDown&&(g.isMac?a.metaKey:a.ctrlKey));this._checkOverlayScroll();if(!this._isW3CEvents){if(0===a.button)return this._setGrab(null),!0;if(!this._isMouseDown&&1===a.button&&0!==(this._clickCount&1)&&d)return this._clickCount=2,this._handleMouse(a,this._clickCount)}if(this._isMouseDown&&-1===this._dragOffset){d=a.clientX;a=a.clientY;var m=this._getViewPadding(),
l=this._viewDiv.getBoundingClientRect(),e=this._getClientWidth(),s=this._getClientHeight(),b=l.left+m.left,f=l.top+m.top,e=l.left+m.left+e,m=l.top+m.top+s;a<f?this._doAutoScroll("up",d,a-f):a>m?this._doAutoScroll("down",d,a-m):d<b&&!this._wrapMode?this._doAutoScroll("left",d-b,a):d>e&&!this._wrapMode?this._doAutoScroll("right",d-e,a):(this._endAutoScroll(),this._setSelectionTo(d,a,!0))}}}},_isClientDiv:function(a){var d=this._overlayDiv||this._clientDiv;for(a=a.target?a.target:a.srcElement;a;){if(d===
a)return!0;a=a.parentNode}return!1},_createKeyEvent:function(a,d){return{type:a,event:d,preventDefault:function(){this.defaultPrevented=!0}}},_createMouseEvent:function(a,d){var b=this.convert({x:d.clientX,y:d.clientY},"page","document");return{type:a,event:d,clickCount:this._clickCount,x:b.x,y:b.y,preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(a){var d=a.which?0===a.button:1===a.button;if(this.isListening("MouseUp")&&(this._isClientDiv(a)||d&&this._isMouseDown))this.onMouseUp(this._createMouseEvent("MouseUp",
a));if(!this._linksVisible){if(d&&this._isMouseDown){if(-1!==this._dragOffset){var b=this._getSelection();b.extend(this._dragOffset);b.collapse();this._setSelection(b,!0,!0);this._dragOffset=-1}this._isMouseDown=!1;this._endAutoScroll();this._isW3CEvents&&this._setGrab(null)}d&&g.isFirefox&&(this._updateDOMSelection(),a.preventDefault())}},_handleMouseWheel:function(a){var d=this._getLineHeight(),b=0,m=0;g.isIE||g.isOpera?m=-a.wheelDelta/40*d:g.isFirefox?"wheel"===a.type?a.deltaMode?(b=Math.max(-256,
Math.min(256,a.deltaX))*d,m=Math.max(-256,Math.min(256,a.deltaY))*d):(b=a.deltaX,m=a.deltaY):(d=g.isMac?3*a.detail:Math.max(-256,Math.min(256,a.detail))*d,a.axis===a.HORIZONTAL_AXIS?b=d:m=d):g.isMac?(m=a.timeStamp-this._wheelTimeStamp,this._wheelTimeStamp=a.timeStamp,b=0!==a.wheelDeltaX%120?1:40>m?40/(40-m):40,m=0!==a.wheelDeltaY%120?1:40>m?40/(40-m):40,b=Math.ceil(-a.wheelDeltaX/b),-1<b&&0>b&&(b=-1),0<b&&1>b&&(b=1),m=Math.ceil(-a.wheelDeltaY/m),-1<m&&0>m&&(m=-1),0<m&&1>m&&(m=1)):(b=-a.wheelDeltaX,
m=8*(-a.wheelDeltaY/120)*d);if(g.isSafari||g.isChrome&&g.isMac){for(d=a.target;d&&void 0===d.lineIndex;)d=d.parentNode;this._mouseWheelLine=d}d=this._getScroll();this._scrollView(b,m);b=this._getScroll();if(d.x!==b.x||d.y!==b.y)return a.preventDefault&&a.preventDefault(),!1},_handlePaste:function(a){this._cancelCheckSelection();if(!this._ignoreEvent(a)&&!this._ignorePaste&&this._doPaste(a)){if(g.isIE){var d=this;this._ignoreFocus=!0;this._getWindow().setTimeout(function(){d._updateDOMSelection();
d._ignoreFocus=!1},0)}a.preventDefault&&a.preventDefault();return!1}},_handleResize:function(d){d=this._rootDiv.clientWidth;var b=this._rootDiv.clientHeight;if(this._rootWidth!==d||this._rootHeight!==b)this._rootWidth!==d&&this._wrapMode&&this._resetLineHeight(),this._rootWidth=d,this._rootHeight=b,d=9>g.isIE,b=this._calculateMetrics(),a(b,this._metrics)||(this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight()),this._metrics=b,d=!0),d?this._queueUpdate():this._update()},_handleRulerEvent:function(a){for(var d=
a.target?a.target:a.srcElement,b=d.lineIndex;d&&!d._ruler;)void 0===b&&void 0!==d.lineIndex&&(b=d.lineIndex),d=d.parentNode;var m=d?d._ruler:null;if(void 0===b&&m&&"document"===m.getOverview()){var b=this._getClientHeight(),l=this._model.getLineCount(),e=this._getViewPadding(),s=this._viewDiv.getBoundingClientRect(),b=Math.floor((a.clientY-s.top-this._metrics.scrollWidth)*l/(b+e.top+e.bottom-2*this._metrics.scrollWidth));0<=b&&b<l||(b=void 0)}if(m)switch(a.type){case "click":if(m.onClick)m.onClick(b,
a);break;case "dblclick":if(m.onDblClick)m.onDblClick(b,a);break;case "mousemove":if(m.onMouseMove)m.onMouseMove(b,a);break;case "mouseover":if(m.onMouseOver)m.onMouseOver(b,a);break;case "mouseout":if(m.onMouseOut){for(l=a.relatedTarget;l&&l!==this._rootDiv;){if(l===d)return;l=l.parentNode}m.onMouseOut(b,a)}}},_handleScroll:function(){this._lastScrollTime=(new Date).getTime();var a=this._getScroll(!1),d=this._hScroll,b=this._vScroll;if(d!==a.x||b!==a.y)this._hScroll=a.x,this._vScroll=a.y,this._commitIME(),
this._update(b===a.y),this.onScroll({type:"Scroll",oldValue:{x:d,y:b},newValue:a})},_handleSelectStart:function(a){var d=this._contextMenuOpen;this._contextMenuOpen=!1;if(d)this._checkSelectionChange=!0;else if(this._ignoreSelect)return a&&a.preventDefault&&a.preventDefault(),!1},_getModelOffset:function(a,d){if(a){var b;b="DIV"===a.tagName?a:a.parentNode.parentNode;return!b._line?0:b._line.getModelOffset(a,d)}},_updateSelectionFromDOM:function(){if(!g.isIOS&&!g.isAndroid&&!this._checkSelectionChange)return!1;
var a=this._getWindow().getSelection(),d=this._getModelOffset(a.anchorNode,a.anchorOffset),b=this._getModelOffset(a.focusNode,a.focusOffset),m=this._getSelection();if(void 0===d||void 0===b||m.start===d&&m.end===b)return!1;if(this._checkSelectionChange){var m=this._getLineNext(),l=this._getLinePrevious();if(a.anchorNode===m.firstChild.firstChild&&0===a.anchorOffset&&a.focusNode===l.firstChild.firstChild&&0===a.focusOffset)return!1;if(a.anchorNode===m.firstChild.firstChild&&0===a.anchorOffset&&a.focusNode===
l.lastChild.firstChild||a.anchorNode===this._clientDiv&&a.focusNode===this._clientDiv)d=0,b=this.getModel().getCharCount()}this._setSelection(new u(d,b),!1,!1);this._checkSelectionChange=!1;return!0},_cancelCheckSelection:function(){this._checkSelectionChange&&(this._checkSelectionChange=!1,this._cancelPollSelectionChange())},_cancelPollSelectionChange:function(){this._selPollTimer&&(this._getWindow().clearTimeout(this._selPollTimer),this._selPollTimer=null)},_pollSelectionChange:function(a){var d=
this,b=this._getWindow();this._cancelPollSelectionChange();this._selPollTimer=b.setTimeout(function(){d._selPollTimer=null;d._clientDiv&&!d._updateSelectionFromDOM()&&a&&d._pollSelectionChange(a)},100)},_handleSelectionChange:function(a){-1===this._imeOffset&&(g.isAndroid?this._pollSelectionChange():this._updateSelectionFromDOM())},_handleTextInput:function(a){if(!this._ignoreEvent(a)){this._imeOffset=-1;var d=this._getWindow().getSelection();if(d.anchorNode!==this._anchorNode||d.focusNode!==this._focusNode||
d.anchorOffset!==this._anchorOffset||d.focusOffset!==this._focusOffset){for(var b=d.anchorNode;b&&void 0===b.lineIndex;)b=b.parentNode;if(b){var m=this._model,l=b.lineIndex,e=m.getLine(l),s=e,f=0,m=m.getLineStart(l);0<d.rangeCount&&(d.getRangeAt(0).deleteContents(),l=b.ownerDocument.createTextNode(a.data),d.getRangeAt(0).insertNode(l),f=this._getDOMText(b,l),s=f.text,f=f.offset,l.parentNode.removeChild(l));b.lineRemoved=!0;for(b=0;e.charCodeAt(b)===s.charCodeAt(b)&&b<f;)b++;d=e.length-1;for(l=s.length-
e.length;e.charCodeAt(d)===s.charCodeAt(d+l)&&d+l>=f+a.data.length;)d--;d++;e=s.substring(b,d+l);this._ignoreQueueUpdate=g.isSafari;this._modifyContent({text:e,start:b+m,end:d+m,_ignoreDOMSelection:!0,_ignoreDOMSelection1:g.isChrome},!0);this._ignoreQueueUpdate=!1}}else this._doContent(a.data);a.preventDefault()}},_handleTouchStart:function(a){this._commitIME();var d=this._getWindow();this._touchScrollTimer&&(this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",d.clearInterval(this._touchScrollTimer),
this._touchScrollTimer=null);var b=a.touches;if(1===b.length){var b=b[0],m=b.clientX,l=b.clientY;this._touchStartX=m;this._touchStartY=l;if(g.isAndroid&&(l<b.pageY-d.pageYOffset||m<b.pageX-d.pageXOffset))m=b.pageX-d.pageXOffset,l=b.pageY-d.pageYOffset;d=this.convert({x:m,y:l},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(d.x,d.y);this._touchStartTime=a.timeStamp;this._touching=!0}},_handleTouchMove:function(a){var d=a.touches;if(1===d.length){d=d[0];this._touchCurrentX=d.clientX;
this._touchCurrentY=d.clientY;if(!this._touchScrollTimer&&200>a.timeStamp-this._touchStartTime){this._vScrollDiv.style.display="block";this._wrapMode||(this._hScrollDiv.style.display="block");var b=this,m=this._getWindow();this._touchScrollTimer=m.setInterval(function(){var a=0,d=0;if(b._touching)a=b._touchStartX-b._touchCurrentX,d=b._touchStartY-b._touchCurrentY,b._touchSpeedX=a/10,b._touchSpeedY=d/10,b._touchStartX=b._touchCurrentX,b._touchStartY=b._touchCurrentY;else{if(0.1>Math.abs(b._touchSpeedX)&&
0.1>Math.abs(b._touchSpeedY)){b._vScrollDiv.style.display="none";b._hScrollDiv.style.display="none";m.clearInterval(b._touchScrollTimer);b._touchScrollTimer=null;return}a=10*b._touchSpeedX;d=10*b._touchSpeedY;b._touchSpeedX*=0.95;b._touchSpeedY*=0.95}b._scrollView(a,d)},10)}this._touchScrollTimer&&a.preventDefault()}},_handleTouchEnd:function(a){0===a.touches.length&&(this._touching=!1)},_doAction:function(a){var d,b,m=this._keyModes;for(b=m.length-1;0<=b;b--)if(d=m[b],"function"===typeof d.match&&
(d=d.match(a),void 0!==d))return this.invokeAction(d);return!1},_doMove:function(a,d){var b=this._model,m=d.getCaret(),l=b.getLineAtOffset(m);a.count||(a.count=1);for(;0!==a.count;){var e=b.getLineStart(l);if(0>a.count&&m===e)if(0<l)"character"===a.unit&&a.count++,l--,d.extend(b.getLineEnd(l));else break;else if(0<a.count&&m===b.getLineEnd(l))if(l+1<b.getLineCount())"character"===a.unit&&a.count--,l++,d.extend(b.getLineStart(l));else break;else{var s=!1;a.expandTab&&("character"===a.unit&&0===(m-
e)%this._tabSize)&&(e=b.getText(e,m),s=!/[^ ]/.test(e));s?(d.extend(m-this._tabSize),a.count+=0>a.count?1:-1):(e=this._getLine(l),d.extend(e.getNextOffset(m,a)),e.destroy())}m=d.getCaret()}return d},_doBackspace:function(a){var d=this._getSelection();d.isEmpty()&&(a.count||(a.count=1),a.count*=-1,a.expandTab=this._expandTab,this._doMove(a,d));this._modifyContent({text:"",start:d.start,end:d.end},!0);return!0},_doCase:function(a){var d=this._getSelection();this._doMove(a,d);var b=this.getText(d.start,
d.end);this._setSelection(d,!0);switch(a.type){case "lower":b=b.toLowerCase();break;case "capitalize":b=b.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()});break;case "reverse":a="";for(d=0;d<b.length;d++){var m=b[d],l=m.toLowerCase(),m=l!==m?l:m.toUpperCase();a+=m}b=a;break;default:b=b.toUpperCase()}this._doContent(b);return!0},_doContent:function(a){var d=this._getSelection();if(this._overwriteMode&&d.isEmpty()){var b=this._model,m=b.getLineAtOffset(d.end);d.end<b.getLineEnd(m)&&(b=this._getLine(m),
d.extend(b.getNextOffset(d.getCaret(),{unit:"character",count:1})),b.destroy())}return this._modifyContent({text:a,start:d.start,end:d.end,_ignoreDOMSelection:!0},!0)},_doCopy:function(a){var d=this._getSelection();return!d.isEmpty()?(d=this._getBaseText(d.start,d.end),this._setClipboardText(d,a)):!0},_doCursorNext:function(a){var d=this._getSelection();!d.isEmpty()&&!a.select?d.start=d.end:this._doMove(a,d);a.select||d.collapse();this._setSelection(d,!0);return!0},_doCursorPrevious:function(a){var d=
this._getSelection();!d.isEmpty()&&!a.select?d.end=d.start:(a.count||(a.count=1),a.count*=-1,this._doMove(a,d));a.select||d.collapse();this._setSelection(d,!0);return!0},_doCut:function(a){var d=this._getSelection();return!d.isEmpty()?(d=this._getBaseText(d.start,d.end),this._doContent(""),this._setClipboardText(d,a)):!0},_doDelete:function(a){var d=this._getSelection();d.isEmpty()&&this._doMove(a,d);this._modifyContent({text:"",start:d.start,end:d.end},!0);return!0},_doEnd:function(a){var d=this._getSelection(),
b=this._model,m;if(a.ctrl)d.extend(b.getCharCount()),m=function(){};else{var l=d.getCaret(),e=b.getLineAtOffset(l);if(this._wrapMode){var s=this._getLine(e),l=s.getLineIndex(l),l=l===s.getLineCount()-1?b.getLineEnd(e):s.getLineStart(l+1)-1;s.destroy()}else a.count&&0<a.count&&(e=Math.min(e+a.count-1,b.getLineCount()-1)),l=b.getLineEnd(e);d.extend(l)}a.select||d.collapse();this._setSelection(d,!0,!0,m);return!0},_doEnter:function(a){var d=this._model,b=this._getSelection();this._doContent(d.getLineDelimiter());
a&&a.noCursor&&(b.end=b.start,this._setSelection(b,!0));return!0},_doHome:function(a){var d=this._getSelection(),b=this._model,m;if(a.ctrl)d.extend(0),m=function(){};else{var l=d.getCaret(),e=b.getLineAtOffset(l);this._wrapMode?(b=this._getLine(e),l=b.getLineIndex(l),l=b.getLineStart(l),b.destroy()):l=b.getLineStart(e);d.extend(l)}a.select||d.collapse();this._setSelection(d,!0,!0,m);return!0},_doLineDown:function(a){var d=this._model,b=this._getSelection(),m=b.getCaret(),l=d.getLineAtOffset(m),e=
this._getLine(l),s=this._columnX,f=1,u=!1;if(-1===s||a.wholeLine||a.select&&g.isIE)s=a.wholeLine?d.getLineEnd(l+1):m,s=e.getBoundingClientRect(s).left;(m=e.getLineIndex(m))<e.getLineCount()-1?f=e.getClientRects(m+1).top+1:(m=d.getLineCount()-1,u=l===m,a.count&&0<a.count?l=Math.min(l+a.count,m):l++);m=!1;if(u){if(a.select||g.isMac||g.isLinux)b.extend(d.getCharCount()),m=!0}else e.lineIndex!==l&&(e.destroy(),e=this._getLine(l)),b.extend(e.getOffset(s,f)),m=!0;m&&(a.select||b.collapse(),this._setSelection(b,
!0,!0));this._columnX=s;e.destroy();return!0},_doLineUp:function(a){var d=this._model,b=this._getSelection(),m=b.getCaret(),l=d.getLineAtOffset(m),e=this._getLine(l),s=this._columnX,f=!1,u;if(-1===s||a.wholeLine||a.select&&g.isIE)s=a.wholeLine?d.getLineStart(l-1):m,s=e.getBoundingClientRect(s).left;0<(m=e.getLineIndex(m))?u=e.getClientRects(m-1).top+1:(f=0===l,f||(a.count&&0<a.count?l=Math.max(l-a.count,0):l--,u=this._getLineHeight(l)-1));m=!1;if(f){if(a.select||g.isMac||g.isLinux)b.extend(0),m=!0}else e.lineIndex!==
l&&(e.destroy(),e=this._getLine(l)),b.extend(e.getOffset(s,u)),m=!0;m&&(a.select||b.collapse(),this._setSelection(b,!0,!0));this._columnX=s;e.destroy();return!0},_doNoop:function(){return!0},_doPageDown:function(a){var d=this,b=this._model,m=this._getSelection(),l=m.getCaret(),e=b.getLineAtOffset(l),s=b.getLineCount(),f=this._getScroll(),b=this._getClientHeight(),u,h;if(this._lineHeight){u=this._columnX;f=this._getBoundsAtOffset(l);if(-1===u||a.select&&g.isIE)u=f.left;l=this._getLineIndex(f.top+b);
h=this._getLine(l);e=this._getLinePixel(l);l=h.getOffset(u,f.top+b-e);b=h.getBoundingClientRect(l);h.destroy();m.extend(l);a.select||m.collapse();this._setSelection(m,!0,!0,function(){d._columnX=u},b.top+e-f.top);return!0}if(e<s-1){var p=this._getLineHeight(),v=Math.min(s-e-1,Math.floor(b/p)),v=Math.max(1,v);u=this._columnX;if(-1===u||a.select&&g.isIE)h=this._getLine(e),u=h.getBoundingClientRect(l).left,h.destroy();h=this._getLine(e+v);m.extend(h.getOffset(u,0));h.destroy();a.select||m.collapse();
a=s*p;l=f.y+v*p;l+b>a&&(l=a-b);this._setSelection(m,!0,!0,function(){d._columnX=u},l-f.y)}return!0},_doPageUp:function(a){var d=this,b=this._model,m=this._getSelection(),l=m.getCaret(),e=b.getLineAtOffset(l),s=this._getScroll(),f=this._getClientHeight(),u;if(this._lineHeight){u=this._columnX;s=this._getBoundsAtOffset(l);if(-1===u||a.select&&g.isIE)u=s.left;l=this._getLineIndex(s.bottom-f);b=this._getLine(l);e=this._getLinePixel(l);l=b.getOffset(u,s.bottom-f-e);f=b.getBoundingClientRect(l);b.destroy();
m.extend(l);a.select||m.collapse();this._setSelection(m,!0,!0,function(){d._columnX=u},f.top+e-s.top);return!0}if(0<e){var h=this._getLineHeight(),f=Math.max(1,Math.min(e,Math.floor(f/h)));u=this._columnX;if(-1===u||a.select&&g.isIE)b=this._getLine(e),u=b.getBoundingClientRect(l).left,b.destroy();b=this._getLine(e-f);m.extend(b.getOffset(u,this._getLineHeight(e-f)-1));b.destroy();a.select||m.collapse();a=Math.max(0,s.y-f*h);this._setSelection(m,!0,!0,function(){d._columnX=u},a-s.y)}return!0},_doPaste:function(a){var d=
this;return null!==this._getClipboardText(a,function(a){a&&(g.isLinux&&2===d._lastMouseButton&&(new Date).getTime()-d._lastMouseTime<=d._clickTime&&d._setSelectionTo(d._lastMouseX,d._lastMouseY),d._doContent(a))})},_doScroll:function(a){var d=a.type,b=this._model,m=b.getLineCount();a=this._getClientHeight();var l=this._getLineHeight(),m=m*l,e=this._getScroll().y,s;switch(d){case "textStart":s=0;break;case "textEnd":s=m-a;break;case "pageDown":s=e+a;break;case "pageUp":s=e-a;break;case "lineDown":s=
e+l;break;case "lineUp":s=e-l;break;case "centerLine":d=this._getSelection(),s=b.getLineAtOffset(d.start),b=(b.getLineAtOffset(d.end)-s+1)*l,s=s*l-a/2+b/2}void 0!==s&&(s=Math.min(Math.max(0,s),m-a),this._scrollViewAnimated(0,s-e,function(){}));return!0},_doSelectAll:function(a){a=this._model;var d=this._getSelection();d.setCaret(0);d.extend(a.getCharCount());this._setSelection(d,!1);return!0},_doTab:function(a){if(this._tabMode&&!this._readonly){a="\t";if(this._expandTab){var d=this._model;a=this._getSelection().getCaret();
var b=d.getLineAtOffset(a),d=d.getLineStart(b);a=Array(this._tabSize-(a-d)%this._tabSize+1).join(" ")}this._doContent(a);return!0}},_doShiftTab:function(a){if(this._tabMode&&!this._readonly)return!0},_doOverwriteMode:function(a){if(!this._readonly)return this.setOptions({overwriteMode:!this.getOptions("overwriteMode")}),!0},_doTabMode:function(a){this._tabMode=!this._tabMode;return!0},_doWrapMode:function(a){this.setOptions({wrapMode:!this.getOptions("wrapMode")});return!0},_autoScroll:function(){var a=
this._model,d=this._getSelection(),b=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),m=d.getCaret(),l=a.getLineCount(),e=a.getLineAtOffset(m),s;if("up"===this._autoScrollDir||"down"===this._autoScrollDir)m=this._autoScrollY/this._getLineHeight(),m=0>m?Math.floor(m):Math.ceil(m),s=Math.max(0,Math.min(l-1,e+m));else if("left"===this._autoScrollDir||"right"===this._autoScrollDir)s=this._getLineIndex(b.y),e=this._getLine(e),b.x+=e.getBoundingClientRect(m,!1).left,e.destroy();
0===s&&(g.isMac||g.isLinux)?d.extend(0):s===l-1&&(g.isMac||g.isLinux)?d.extend(a.getCharCount()):(e=this._getLine(s),d.extend(e.getOffset(b.x,b.y-this._getLinePixel(s))),e.destroy());this._setSelection(d,!0)},_autoScrollTimer:function(){this._autoScroll();var a=this;this._autoScrollTimerID=this._getWindow().setTimeout(function(){a._autoScrollTimer()},this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(a){if(this._lineHeight&&!this._calculateLHTimer){var d=this._model.getLineCount(),b=0;if(a){a=
0;for(var m=(new Date).getTime(),l=0;b<d&&!(this._lineHeight[b]||(a++,l||(l=b),this._lineHeight[b]=this._calculateLineHeight(b)),b++,100<(new Date).getTime()-m););this.redrawRulers(0,d);this._queueUpdate()}a=this._getWindow();if(b!==d){var e=this;this._calculateLHTimer=a.setTimeout(function(){e._calculateLHTimer=null;e._calculateLineHeightTimer(!0)},0)}else this._calculateLHTimer&&(a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=void 0)}},_calculateLineHeight:function(a){a=this._getLine(a);
var d=a.getBoundingClientRect();a.destroy();return Math.max(1,d.bottom-d.top)},_calculateMetrics:function(){var a=this._clientDiv,d=a.ownerDocument,b=g.createElement(d,"div");b.style.lineHeight="normal";var l={type:"LineStyle",textView:this,0:0,lineText:this._model.getLine(0),lineStart:0};this.onLineStyle(l);p(l.style,b);b.style.position="fixed";b.style.left="-1000px";var e=g.createElement(d,"span");e.appendChild(d.createTextNode(" "));b.appendChild(e);var f=g.createElement(d,"span");f.style.fontStyle=
"italic";f.appendChild(d.createTextNode(" "));b.appendChild(f);var u=g.createElement(d,"span");u.style.fontWeight="bold";u.appendChild(d.createTextNode(" "));b.appendChild(u);l=g.createElement(d,"span");l.style.fontWeight="bold";l.style.fontStyle="italic";l.appendChild(d.createTextNode(" "));b.appendChild(l);a.appendChild(b);var h=b.getBoundingClientRect(),e=e.getBoundingClientRect(),f=f.getBoundingClientRect(),u=u.getBoundingClientRect(),l=l.getBoundingClientRect(),e=e.bottom-e.top,f=f.bottom-f.top,
u=u.bottom-u.top,v=l.bottom-l.top,k=0,l=0>=h.bottom-h.top,h=Math.max(1,h.bottom-h.top);f>e&&(k=1);u>f&&(k=2);v>u&&(k=3);var A;0!==k&&(A={style:{}},0!==(k&1)&&(A.style.fontStyle="italic"),0!==(k&2)&&(A.style.fontWeight="bold"));e=s(b);a.removeChild(b);v=m(this._viewDiv);b=g.createElement(d,"div");b.style.position="fixed";b.style.left="-1000px";b.style.paddingLeft=v.left+"px";b.style.paddingTop=v.top+"px";b.style.paddingRight=v.right+"px";b.style.paddingBottom=v.bottom+"px";b.style.width="100px";b.style.height=
"100px";v=g.createElement(d,"div");v.style.width="100%";v.style.height="100%";b.appendChild(v);a.appendChild(b);k=b.getBoundingClientRect();f=v.getBoundingClientRect();u=0;this._singleMode||(b.style.overflow="hidden",v.style.height="200px",u=b.clientWidth,b.style.overflow="scroll",u-=b.clientWidth);a.removeChild(b);v={left:f.left-k.left,top:f.top-k.top,right:k.right-f.right,bottom:k.bottom-f.bottom};f=k=0;if(!l&&(this._wrapOffset||this._marginOffset))b=g.createElement(d,"div"),b.style.position="fixed",
b.style.left="-1000px",b.innerHTML=Array(this._wrapOffset+1+(g.isWebkit?0:1)).join(" "),a.appendChild(b),k=b.getBoundingClientRect(),k=Math.ceil(k.right-k.left),b.innerHTML=Array(this._marginOffset+1).join(" "),f=b.getBoundingClientRect(),f=Math.ceil(f.right-f.left),a.removeChild(b);return{lineHeight:h,largestFontStyle:A,lineTrim:e,viewPadding:v,scrollWidth:u,wrapWidth:k,marginWidth:f,invalid:l}},_cancelAnimation:function(){this._animation&&(this._animation.stop(),this._animation=null)},_clearSelection:function(a){var d=
this._getSelection();if(d.isEmpty())return!1;"next"===a?d.start=d.end:d.end=d.start;this._setSelection(d,!0);return!0},_commitIME:function(a){if(-1!==this._imeOffset){var d=this._model,b=d.getLineAtOffset(this._imeOffset),m=d.getLineStart(b),l=this._getLineNode(b);if(!a){this._scrollDiv.focus();this._clientDiv.focus();var e=this._getDOMText(l).text,d=d.getLine(b),m=this._imeOffset-m,d=m+e.length-d.length;m!==d&&(a=e.substring(m,d))}a&&(!this._doContent(a)&&!g.isWebkit)&&(l.lineRemoved=!0,this._queueUpdate());
this._imeOffset=-1}},_createActions:function(){this.addKeyMode(new r.DefaultKeyMode(this));var a=this;this._actions={noop:{defaultHandler:function(){return a._doNoop()}},lineUp:{defaultHandler:function(d){return a._doLineUp(b(d,{select:!1}))},actionDescription:{name:n.lineUp}},lineDown:{defaultHandler:function(d){return a._doLineDown(b(d,{select:!1}))},actionDescription:{name:n.lineDown}},lineStart:{defaultHandler:function(d){return a._doHome(b(d,{select:!1,ctrl:!1}))},actionDescription:{name:n.lineStart}},
lineEnd:{defaultHandler:function(d){return a._doEnd(b(d,{select:!1,ctrl:!1}))},actionDescription:{name:n.lineEnd}},charPrevious:{defaultHandler:function(d){return a._doCursorPrevious(b(d,{select:!1,unit:"character"}))},actionDescription:{name:n.charPrevious}},charNext:{defaultHandler:function(d){return a._doCursorNext(b(d,{select:!1,unit:"character"}))},actionDescription:{name:n.charNext}},pageUp:{defaultHandler:function(d){return a._doPageUp(b(d,{select:!1}))},actionDescription:{name:n.pageUp}},
pageDown:{defaultHandler:function(d){return a._doPageDown(b(d,{select:!1}))},actionDescription:{name:n.pageDown}},scrollPageUp:{defaultHandler:function(d){return a._doScroll(b(d,{type:"pageUp"}))},actionDescription:{name:n.scrollPageUp}},scrollPageDown:{defaultHandler:function(d){return a._doScroll(b(d,{type:"pageDown"}))},actionDescription:{name:n.scrollPageDown}},scrollLineUp:{defaultHandler:function(d){return a._doScroll(b(d,{type:"lineUp"}))},actionDescription:{name:n.scrollLineUp}},scrollLineDown:{defaultHandler:function(d){return a._doScroll(b(d,
{type:"lineDown"}))},actionDescription:{name:n.scrollLineDown}},wordPrevious:{defaultHandler:function(d){return a._doCursorPrevious(b(d,{select:!1,unit:"word"}))},actionDescription:{name:n.wordPrevious}},wordNext:{defaultHandler:function(d){return a._doCursorNext(b(d,{select:!1,unit:"word"}))},actionDescription:{name:n.wordNext}},textStart:{defaultHandler:function(d){return a._doHome(b(d,{select:!1,ctrl:!0}))},actionDescription:{name:n.textStart}},textEnd:{defaultHandler:function(d){return a._doEnd(b(d,
{select:!1,ctrl:!0}))},actionDescription:{name:n.textEnd}},scrollTextStart:{defaultHandler:function(d){return a._doScroll(b(d,{type:"textStart"}))},actionDescription:{name:n.scrollTextStart}},scrollTextEnd:{defaultHandler:function(d){return a._doScroll(b(d,{type:"textEnd"}))},actionDescription:{name:n.scrollTextEnd}},centerLine:{defaultHandler:function(d){return a._doScroll(b(d,{type:"centerLine"}))},actionDescription:{name:n.centerLine}},selectLineUp:{defaultHandler:function(d){return a._doLineUp(b(d,
{select:!0}))},actionDescription:{name:n.selectLineUp}},selectLineDown:{defaultHandler:function(d){return a._doLineDown(b(d,{select:!0}))},actionDescription:{name:n.selectLineDown}},selectWholeLineUp:{defaultHandler:function(d){return a._doLineUp(b(d,{select:!0,wholeLine:!0}))},actionDescription:{name:n.selectWholeLineUp}},selectWholeLineDown:{defaultHandler:function(d){return a._doLineDown(b(d,{select:!0,wholeLine:!0}))},actionDescription:{name:n.selectWholeLineDown}},selectLineStart:{defaultHandler:function(d){return a._doHome(b(d,
{select:!0,ctrl:!1}))},actionDescription:{name:n.selectLineStart}},selectLineEnd:{defaultHandler:function(d){return a._doEnd(b(d,{select:!0,ctrl:!1}))},actionDescription:{name:n.selectLineEnd}},selectCharPrevious:{defaultHandler:function(d){return a._doCursorPrevious(b(d,{select:!0,unit:"character"}))},actionDescription:{name:n.selectCharPrevious}},selectCharNext:{defaultHandler:function(d){return a._doCursorNext(b(d,{select:!0,unit:"character"}))},actionDescription:{name:n.selectCharNext}},selectPageUp:{defaultHandler:function(d){return a._doPageUp(b(d,
{select:!0}))},actionDescription:{name:n.selectPageUp}},selectPageDown:{defaultHandler:function(d){return a._doPageDown(b(d,{select:!0}))},actionDescription:{name:n.selectPageDown}},selectWordPrevious:{defaultHandler:function(d){return a._doCursorPrevious(b(d,{select:!0,unit:"word"}))},actionDescription:{name:n.selectWordPrevious}},selectWordNext:{defaultHandler:function(d){return a._doCursorNext(b(d,{select:!0,unit:"word"}))},actionDescription:{name:n.selectWordNext}},selectTextStart:{defaultHandler:function(d){return a._doHome(b(d,
{select:!0,ctrl:!0}))},actionDescription:{name:n.selectTextStart}},selectTextEnd:{defaultHandler:function(d){return a._doEnd(b(d,{select:!0,ctrl:!0}))},actionDescription:{name:n.selectTextEnd}},deletePrevious:{defaultHandler:function(d){return a._doBackspace(b(d,{unit:"character"}))},actionDescription:{name:n.deletePrevious}},deleteNext:{defaultHandler:function(d){return a._doDelete(b(d,{unit:"character"}))},actionDescription:{name:n.deleteNext}},deleteWordPrevious:{defaultHandler:function(d){return a._doBackspace(b(d,
{unit:"word"}))},actionDescription:{name:n.deleteWordPrevious}},deleteWordNext:{defaultHandler:function(d){return a._doDelete(b(d,{unit:"word"}))},actionDescription:{name:n.deleteWordNext}},deleteLineStart:{defaultHandler:function(d){return a._doBackspace(b(d,{unit:"line"}))},actionDescription:{name:n.deleteLineStart}},deleteLineEnd:{defaultHandler:function(d){return a._doDelete(b(d,{unit:"line"}))},actionDescription:{name:n.deleteLineEnd}},tab:{defaultHandler:function(d){return a._doTab()},actionDescription:{name:n.tab}},
shiftTab:{defaultHandler:function(d){return a._doShiftTab()},actionDescription:{name:n.shiftTab}},enter:{defaultHandler:function(d){return a._doEnter()},actionDescription:{name:n.enter}},enterNoCursor:{defaultHandler:function(d){return a._doEnter(b(d,{noCursor:!0}))},actionDescription:{name:n.enterNoCursor}},selectAll:{defaultHandler:function(d){return a._doSelectAll()},actionDescription:{name:n.selectAll}},copy:{defaultHandler:function(d){return a._doCopy()},actionDescription:{name:n.copy}},cut:{defaultHandler:function(d){return a._doCut()},
actionDescription:{name:n.cut}},paste:{defaultHandler:function(d){return a._doPaste()},actionDescription:{name:n.paste}},uppercase:{defaultHandler:function(d){return a._doCase(b(d,{type:"upper"}))},actionDescription:{name:n.uppercase}},lowercase:{defaultHandler:function(d){return a._doCase(b(d,{type:"lower"}))},actionDescription:{name:n.lowercase}},capitalize:{defaultHandler:function(d){return a._doCase(b(d,{unit:"word",type:"capitalize"}))},actionDescription:{name:n.capitalize}},reversecase:{defaultHandler:function(d){return a._doCase(b(d,
{type:"reverse"}))},actionDescription:{name:n.reversecase}},toggleOverwriteMode:{defaultHandler:function(d){return a._doOverwriteMode()},actionDescription:{name:n.toggleOverwriteMode}},toggleTabMode:{defaultHandler:function(d){return a._doTabMode()},actionDescription:{name:n.toggleTabMode}},toggleWrapMode:{defaultHandler:function(d){return a._doWrapMode()},actionDescription:{name:n.toggleWrapMode}}}},_createRulerParent:function(a,d){var b=g.createElement(a,"div");b.className=d;b.tabIndex=-1;b.style.overflow=
"hidden";b.style.MozUserSelect="none";b.style.WebkitUserSelect="none";b.style.position="absolute";b.style.top="0px";b.style.bottom="0px";b.style.cursor="default";b.style.display="none";b.setAttribute("aria-hidden","true");this._rootDiv.appendChild(b);return b},_createRuler:function(a,d){if(this._clientDiv){var b=this._getRulerParent(a);if(b){if(b!==this._marginDiv||this._marginOffset)b.style.display="block";var m=g.createElement(b.ownerDocument,"div");m._ruler=a;m.rulerChanged=!0;m.style.position=
"relative";m.style.cssFloat="left";m.style.styleFloat="left";m.style.outline="none";if(void 0===d||0>d||d>=b.children.length)b.appendChild(m);else{for(var l=b.firstChild;l&&0<d--;)l=l.nextSibling;b.insertBefore(m,l)}}}},_createView:function(){function a(){s._rootDiv&&(s.update(!0),s._metrics.invalid&&s._getWindow().setTimeout(function(){a()},100))}if(!this._clientDiv){for(var d=this._parent;d.hasChildNodes();)d.removeChild(d.lastChild);var b=d.ownerDocument,m=g.createElement(b,"div");this._rootDiv=
m;m.tabIndex=-1;m.style.position="relative";m.style.overflow="hidden";m.style.width="100%";m.style.height="100%";m.style.overflow="hidden";m.style.WebkitTextSizeAdjust="100%";m.setAttribute("role","application");d.appendChild(m);this._leftDiv=this._createRulerParent(b,"textviewLeftRuler");d=g.createElement(b,"div");d.className="textviewScroll";this._viewDiv=d;d.tabIndex=-1;d.style.position="absolute";d.style.top="0px";d.style.bottom="0px";d.style.borderWidth="0px";d.style.margin="0px";d.style.outline=
"none";d.style.background="transparent";m.appendChild(d);var e=this._createRulerParent(b,"textviewRightRuler");this._rightDiv=e;e.style.right="0px";this._scrollDiv=e=g.createElement(b,"div");e.style.margin="0px";e.style.borderWidth="0px";e.style.padding="0px";d.appendChild(e);(this._marginDiv=this._createRulerParent(b,"textviewMarginRuler")).style.zIndex="4";!g.isIE&&!g.isIOS&&(this._clipDiv=d=g.createElement(b,"div"),d.style.position="absolute",d.style.overflow="hidden",d.style.margin="0px",d.style.borderWidth=
"0px",d.style.padding="0px",d.style.background="transparent",m.appendChild(d),this._clipScrollDiv=e=g.createElement(b,"div"),e.style.position="absolute",e.style.height="1px",e.style.top="-1000px",e.style.background="transparent",d.appendChild(e));this._setFullSelection(this._fullSelection,!0);d=g.createElement(b,"div");d.className="textviewContent";this._clientDiv=d;d.tabIndex=0;d.style.position="absolute";d.style.borderWidth="0px";d.style.margin="0px";d.style.padding="0px";d.style.outline="none";
d.style.zIndex="1";d.style.WebkitUserSelect="text";d.setAttribute("spellcheck","false");if(g.isIOS||g.isAndroid)d.style.WebkitTapHighlightColor="transparent";(this._clipDiv||m).appendChild(d);if(g.isIOS||g.isAndroid)this._vScrollDiv=e=g.createElement(b,"div"),e.style.position="absolute",e.style.borderWidth="1px",e.style.borderColor="white",e.style.borderStyle="solid",e.style.borderRadius="4px",e.style.backgroundColor="black",e.style.opacity="0.5",e.style.margin="0px",e.style.padding="0px",e.style.outline=
"none",e.style.zIndex="3",e.style.width="8px",e.style.display="none",m.appendChild(e),this._hScrollDiv=e=g.createElement(b,"div"),e.style.position="absolute",e.style.borderWidth="1px",e.style.borderColor="white",e.style.borderStyle="solid",e.style.borderRadius="4px",e.style.backgroundColor="black",e.style.opacity="0.5",e.style.margin="0px",e.style.padding="0px",e.style.outline="none",e.style.zIndex="3",e.style.height="8px",e.style.display="none",m.appendChild(e);g.isFirefox&&!d.setCapture&&(this._overlayDiv=
e=g.createElement(b,"div"),e.style.position=d.style.position,e.style.borderWidth=d.style.borderWidth,e.style.margin=d.style.margin,e.style.padding=d.style.padding,e.style.cursor="text",e.style.zIndex="2",(this._clipDiv||m).appendChild(e));d.contentEditable="true";d.setAttribute("role","textbox");d.setAttribute("aria-multiline","true");this._setWrapMode(this._wrapMode,!0);this._setReadOnly(this._readonly);this._setThemeClass(this._themeClass,!0);this._setTabSize(this._tabSize,!0);this._setMarginOffset(this._marginOffset,
!0);this._hookEvents();d=this._rulers;for(e=0;e<d.length;e++)this._createRuler(d[e]);this._update();var s=this;l(b,m,"textview",a)}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,update:this.setModel},scrollAnimation:{value:0,update:null},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,update:null},singleMode:{value:!1,
update:this._setSingleMode},overwriteMode:{value:!1,update:this._setOverwriteMode},blockCursorVisible:{value:!1,update:this._setBlockCursor},marginOffset:{value:0,update:this._setMarginOffset},wrapOffset:{value:0,update:this._setWrapOffset},wrapMode:{value:!1,update:this._setWrapMode},wrappable:{value:!1,update:null},theme:{value:f.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:void 0,update:this._setThemeClass}}},_destroyRuler:function(a){var d=this._getRulerParent(a);if(d)for(var b=
d.firstChild;b;){if(b._ruler===a){b._ruler=void 0;d.removeChild(b);if(0===d.children.length&&(d!==this._marginDiv||!this._marginOffset))d.style.display="none";break}b=b.nextSibling}},_destroyView:function(){if(this._clientDiv){this._setGrab(null);this._unhookEvents();var a=this._getWindow();this._autoScrollTimerID&&(a.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null);this._updateTimer&&(a.clearTimeout(this._updateTimer),this._updateTimer=null);a=this._rootDiv;a.parentNode.removeChild(a);
this._hScrollDiv=this._vScrollDiv=this._cursorDiv=this._marginDiv=this._rightDiv=this._leftDiv=this._overlayDiv=this._clientDiv=this._clipScrollDiv=this._clipDiv=this._viewDiv=this._scrollDiv=this._rootDiv=this._clipboardDiv=this._selDiv3=this._selDiv2=this._selDiv1=null}},_doAutoScroll:function(a,d,b){this._autoScrollDir=a;this._autoScrollX=d;this._autoScrollY=b;this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){this._autoScrollTimerID&&this._getWindow().clearTimeout(this._autoScrollTimerID);
this._autoScrollTimerID=this._autoScrollDir=void 0},_fixCaret:function(){var a=this._clientDiv;if(a){var d=this._hasFocus;this._ignoreFocus=!0;d&&a.blur();a.contentEditable=!1;a.contentEditable=!0;d&&a.focus();this._ignoreFocus=!1}},_getBaseText:function(a,d){var b=this._model;b.getBaseModel&&(a=b.mapOffset(a),d=b.mapOffset(d),b=b.getBaseModel());return b.getText(a,d)},_getBottomIndex:function(a){var d=this._bottomChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=d.getBoundingClientRect();
var b=this._clientDiv.getBoundingClientRect();a.bottom>b.bottom&&(d=this._getLinePrevious(d)||d)}return d.lineIndex},_getBoundsAtOffset:function(a){var d=this._getLine(this._model.getLineAtOffset(a));a=d.getBoundingClientRect(a);var b=this._getLinePixel(d.lineIndex);a.top+=b;a.bottom+=b;d.destroy();return a},_getClientHeight:function(){var a=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-a.top-a.bottom)},_getClientWidth:function(){var a=this._getViewPadding();return Math.max(0,
this._viewDiv.clientWidth-a.left-a.right)},_getClipboardText:function(a,b){var m=this._model.getLineDelimiter(),l,e,s=this._getWindow(),f=s.clipboardData;!f&&a&&(f=a.clipboardData);if(f)return l=[],e=f.getData(g.isIE?"Text":"text/plain"),d(e,function(a){l.push(a)},function(){l.push(m)}),e=l.join(""),b&&b(e),e;if(g.isFirefox){this._ignoreFocus=!0;var u=this._clipboardDiv,f=this._rootDiv.ownerDocument;u||(this._clipboardDiv=u=g.createElement(f,"div"),u.style.position="fixed",u.style.whiteSpace="pre",
u.style.left="-1000px",this._rootDiv.appendChild(u));u.innerHTML="\x3cpre contenteditable\x3d''\x3e\x3c/pre\x3e";u.firstChild.focus();var h=this,p=function(){var a=h._getTextFromElement(u);u.innerHTML="";l=[];d(a,function(a){l.push(a)},function(){l.push(m)});return l.join("")},v=!1;this._ignorePaste=!0;if(!g.isLinux||2!==this._lastMouseButton)try{v=f.execCommand("paste",!1,null)}catch(k){v=1<u.childNodes.length||u.firstChild&&0<u.firstChild.childNodes.length}this._ignorePaste=!1;if(!v){if(a)return s.setTimeout(function(){h.focus();
(e=p())&&b&&b(e);h._ignoreFocus=!1},0),null;this.focus();this._ignoreFocus=!1;return""}this.focus();this._ignoreFocus=!1;(e=p())&&b&&b(e);return e}return""},_getDOMText:function(a,d){return a._line.getText(d)},_getTextFromElement:function(a){var d=a.ownerDocument,b=d.defaultView;if(!b.getSelection)return a.innerText||a.textContent;d=d.createRange();d.selectNode(a);a=b.getSelection();var b=[],m;for(m=0;m<a.rangeCount;m++)b.push(a.getRangeAt(m));this._ignoreSelect=!0;a.removeAllRanges();a.addRange(d);
d=a.toString();a.removeAllRanges();for(m=0;m<b.length;m++)a.addRange(b[m]);this._ignoreSelect=!1;return d},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(a){var d=this._getLineNode(a);return d&&!d.lineChanged&&!d.lineRemoved?d._line:new A(this,a)},_getLineHeight:function(a,d){if(void 0!==a&&this._lineHeight){var b=this._lineHeight[a];if(b)return b;if(d||void 0===d)return this._lineHeight[a]=this._calculateLineHeight(a)}return this._metrics.lineHeight},_getLineNode:function(a){for(var d=
this._clientDiv.firstChild;d;){if(a===d.lineIndex)return d;d=d.nextSibling}},_getLineNext:function(a){for(a=a?a.nextSibling:this._clientDiv.firstChild;a&&(-1===a.lineIndex||!a._line);)a=a.nextSibling;return a},_getLinePrevious:function(a){for(a=a?a.previousSibling:this._clientDiv.lastChild;a&&(-1===a.lineIndex||!a._line);)a=a.previousSibling;return a},_getLinePixel:function(a){a=Math.min(Math.max(0,a),this._model.getLineCount());if(this._lineHeight){var d=this._getTopIndex(),b=-this._topIndexY+this._getScroll().y;
if(a>d)for(;d<a;d++)b+=this._getLineHeight(d);else for(d-=1;d>=a;d--)b-=this._getLineHeight(d);return b}return this._getLineHeight()*a},_getLineIndex:function(a){var d,b=0,m=this._model.getLineCount();if(this._lineHeight){var b=this._getTopIndex(),l=-this._topIndexY+this._getScroll().y;if(a!==l)if(a<l)for(;a<l&&0<b;)a+=this._getLineHeight(--b);else for(d=this._getLineHeight(b);a-d>=l&&b<m-1;)a-=d,d=this._getLineHeight(++b)}else d=this._getLineHeight(),b=Math.floor(a/d);return Math.max(0,Math.min(m-
1,b))},_getRulerParent:function(a){switch(a.getLocation()){case "left":return this._leftDiv;case "right":return this._rightDiv;case "margin":return this._marginDiv}return null},_getScroll:function(a){(void 0===a||a)&&this._cancelAnimation();a=this._viewDiv;return{x:a.scrollLeft,y:a.scrollTop}},_getSelection:function(){return this._selection.clone()},_getTopIndex:function(a){var d=this._topChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=d.getBoundingClientRect();var b=this._getViewPadding(),
m=this._viewDiv.getBoundingClientRect();a.top<m.top+b.top&&(d=this._getLineNext(d)||d)}return d.lineIndex},_hookEvents:function(){var a=this;this._modelListener={onChanging:function(d){a._onModelChanging(d)},onChanged:function(d){a._onModelChanged(d)}};this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._themeListener={onChanged:function(d){a._setThemeClass(a._themeClass)}};this._theme.addEventListener("ThemeChanged",
this._themeListener.onChanged);var d=this._handlers=[],b=this._clientDiv,m=this._viewDiv,l=this._rootDiv,e=this._overlayDiv||b,s=b.ownerDocument,f=this._getWindow(),u=g.isIE?s:f;d.push({target:f,type:"resize",handler:function(d){return a._handleResize(d?d:f.event)}});d.push({target:b,type:"blur",handler:function(d){return a._handleBlur(d?d:f.event)}});d.push({target:b,type:"focus",handler:function(d){return a._handleFocus(d?d:f.event)}});d.push({target:m,type:"focus",handler:function(a){b.focus()}});
d.push({target:m,type:"scroll",handler:function(d){return a._handleScroll(d?d:f.event)}});d.push({target:b,type:"textInput",handler:function(d){return a._handleTextInput(d?d:f.event)}});d.push({target:b,type:"keydown",handler:function(d){return a._handleKeyDown(d?d:f.event)}});d.push({target:b,type:"keypress",handler:function(d){return a._handleKeyPress(d?d:f.event)}});d.push({target:b,type:"keyup",handler:function(d){return a._handleKeyUp(d?d:f.event)}});g.isIE&&d.push({target:s,type:"keyup",handler:function(d){return a._handleDocKeyUp(d?
d:f.event)}});d.push({target:b,type:"contextmenu",handler:function(d){return a._handleContextMenu(d?d:f.event)}});d.push({target:b,type:"copy",handler:function(d){return a._handleCopy(d?d:f.event)}});d.push({target:b,type:"cut",handler:function(d){return a._handleCut(d?d:f.event)}});d.push({target:b,type:"paste",handler:function(d){return a._handlePaste(d?d:f.event)}});d.push({target:s,type:"selectionchange",handler:function(d){return a._handleSelectionChange(d?d:f.event)}});if(g.isIOS||g.isAndroid)d.push({target:b,
type:"touchstart",handler:function(d){return a._handleTouchStart(d?d:f.event)}}),d.push({target:b,type:"touchmove",handler:function(d){return a._handleTouchMove(d?d:f.event)}}),d.push({target:b,type:"touchend",handler:function(d){return a._handleTouchEnd(d?d:f.event)}});else{d.push({target:b,type:"selectstart",handler:function(d){return a._handleSelectStart(d?d:f.event)}});d.push({target:b,type:"mousedown",handler:function(d){return a._handleMouseDown(d?d:f.event)}});d.push({target:b,type:"mouseover",
handler:function(d){return a._handleMouseOver(d?d:f.event)}});d.push({target:b,type:"mouseout",handler:function(d){return a._handleMouseOut(d?d:f.event)}});d.push({target:u,type:"mouseup",handler:function(d){return a._handleMouseUp(d?d:f.event)}});d.push({target:u,type:"mousemove",handler:function(d){return a._handleMouseMove(d?d:f.event)}});d.push({target:l,type:"mousedown",handler:function(d){return a._handleRootMouseDown(d?d:f.event)}});d.push({target:l,type:"mouseup",handler:function(d){return a._handleRootMouseUp(d?
d:f.event)}});d.push({target:e,type:"dragstart",handler:function(d){return a._handleDragStart(d?d:f.event)}});d.push({target:e,type:"drag",handler:function(d){return a._handleDrag(d?d:f.event)}});d.push({target:e,type:"dragend",handler:function(d){return a._handleDragEnd(d?d:f.event)}});d.push({target:e,type:"dragenter",handler:function(d){return a._handleDragEnter(d?d:f.event)}});d.push({target:e,type:"dragover",handler:function(d){return a._handleDragOver(d?d:f.event)}});d.push({target:e,type:"dragleave",
handler:function(d){return a._handleDragLeave(d?d:f.event)}});d.push({target:e,type:"drop",handler:function(d){return a._handleDrop(d?d:f.event)}});d.push({target:this._clientDiv,type:26<g.isFirefox?"wheel":g.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(d){return a._handleMouseWheel(d?d:f.event)}});this._clipDiv&&d.push({target:this._clipDiv,type:26<g.isFirefox?"wheel":g.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(d){return a._handleMouseWheel(d?d:f.event)}});if(g.isFirefox&&
(!g.isWindows||15<=g.isFirefox))(m=f.MutationObserver||f.MozMutationObserver)?(this._mutationObserver=new m(function(d){a._handleDataModified(d)}),this._mutationObserver.observe(b,{subtree:!0,characterData:!0})):d.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(d){return a._handleDataModified(d?d:f.event)}});if(g.isFirefox&&(!g.isWindows||15<=g.isFirefox)||g.isIE)d.push({target:this._clientDiv,type:"compositionstart",handler:function(d){return a._handleCompositionStart(d?
d:f.event)}}),d.push({target:this._clientDiv,type:"compositionend",handler:function(d){return a._handleCompositionEnd(d?d:f.event)}});this._overlayDiv&&(d.push({target:this._overlayDiv,type:"mousedown",handler:function(d){return a._handleMouseDown(d?d:f.event)}}),d.push({target:this._overlayDiv,type:"mouseover",handler:function(d){return a._handleMouseOver(d?d:f.event)}}),d.push({target:this._overlayDiv,type:"mouseout",handler:function(d){return a._handleMouseOut(d?d:f.event)}}),d.push({target:this._overlayDiv,
type:"contextmenu",handler:function(d){return a._handleContextMenu(d?d:f.event)}}));this._isW3CEvents||d.push({target:this._clientDiv,type:"dblclick",handler:function(d){return a._handleDblclick(d?d:f.event)}})}this._hookRulerEvents(this._leftDiv,d);this._hookRulerEvents(this._rightDiv,d);this._hookRulerEvents(this._marginDiv,d);for(m=0;m<d.length;m++)l=d[m],y(l.target,l.type,l.handler,l.capture)},_hookRulerEvents:function(a,d){if(a){var b=this,m=this._getWindow();g.isIE&&d.push({target:a,type:"selectstart",
handler:function(){return!1}});d.push({target:a,type:26<g.isFirefox?"wheel":g.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(a){return b._handleMouseWheel(a?a:m.event)}});d.push({target:a,type:"click",handler:function(a){b._handleRulerEvent(a?a:m.event)}});d.push({target:a,type:"dblclick",handler:function(a){b._handleRulerEvent(a?a:m.event)}});d.push({target:a,type:"mousemove",handler:function(a){b._handleRulerEvent(a?a:m.event)}});d.push({target:a,type:"mouseover",handler:function(a){b._handleRulerEvent(a?
a:m.event)}});d.push({target:a,type:"mouseout",handler:function(a){b._handleRulerEvent(a?a:m.event)}})}},_getWindow:function(){return this._parent.ownerDocument.defaultView||this._parent.ownerDocument.parentWindow},_ignoreEvent:function(a){for(a=a.target;a&&a!==this._clientDiv;){if(a.ignore)return!0;a=a.parentNode}return!1},_init:function(a){var d=a.parent;"string"===typeof d&&(d=(a.document||document).getElementById(d));if(!d)throw"no parent";a.parent=d;a.model=a.model||new t.TextModel;var b=this._defaultOptions(),
m;for(m in b)b.hasOwnProperty(m)&&(this["_"+m]=void 0!==a[m]?a[m]:b[m].value);this._keyModes=[];this._rulers=[];this._selection=new u(0,0,!1);this._linksVisible=!1;this._maxLineWidth=this._redrawCount=0;this._maxLineIndex=-1;this._ignoreSelect=!0;this._hasFocus=this._ignoreFocus=!1;this._dragOffset=this._columnX=-1;this._isRangeRects=(!g.isIE||9<=g.isIE)&&"function"===typeof d.ownerDocument.createRange().getBoundingClientRect;this._isW3CEvents=d.addEventListener;this._autoScrollTimerID=this._autoScrollY=
this._autoScrollX=null;this._AUTO_SCROLL_RATE=50;this._mouseUpClosure=this._moseMoveClosure=this._grabControl=null;this._clickCount=this._lastMouseTime=this._lastMouseY=this._lastMouseX=0;this._clickTime=250;this._clickDist=5;this._isMouseDown=!1;this._doubleClickSelection=null;this._vScroll=this._hScroll=0;this._imeOffset=-1;this._createActions();this._createView()},_checkOverlayScroll:function(){if(g.isMac&&g.isWebkit&&!this._metrics.invalid&&0===this._metrics.scrollWidth){var a=this._viewDiv,d=
this._isOverOverlayScroll();a.style.pointerEvents=d.vertical||d.horizontal?"":"none"}},_isOverOverlayScroll:function(){if(!(200>(new Date).getTime()-this._lastScrollTime))return{};var a=this._viewDiv.getBoundingClientRect(),d=this._lastMouseMoveX,b=this._lastMouseMoveY;return{vertical:a.top<=b&&b<a.bottom&&a.right-15<=d&&d<a.right,horizontal:a.bottom-15<=b&&b<a.bottom&&a.left<=d&&d<a.right}},_modifyContent:function(a,d){if(this._readonly&&!a._code)return!1;a.type="Verify";this.onVerify(a);if(null===
a.text||void 0===a.text)return!1;var b=this._model;try{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!0),b.setText(a.text,a.start,a.end)}finally{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!1)}if(d){b=this._getSelection();b.setCaret(a.start+a.text.length);try{a._ignoreDOMSelection1&&(this._ignoreDOMSelection=!0),this._setSelection(b,!0)}finally{a._ignoreDOMSelection1&&(this._ignoreDOMSelection=!1)}}this.onModify({type:"Modify"});return!0},_onModelChanged:function(a){a.type="ModelChanged";
this.onModelChanged(a);a.type="Changed";var d=a.start,b=a.addedCharCount,m=a.removedCharCount,l=a.addedLineCount,e=a.removedLineCount,s=this._getSelection();s.end>d&&(s.end>d&&s.start<d+m?s.setCaret(d+b):(s.start+=b-m,s.end+=b-m),this._setSelection(s,!1,!1));d=this._model.getLineAtOffset(d);for(b=this._getLineNext();b;)m=b.lineIndex,d<=m&&m<=d+e&&(d===m&&!b.modelChangedEvent&&!b.lineRemoved?(b.modelChangedEvent=a,b.lineChanged=!0):(b.lineRemoved=!0,b.lineChanged=!1,b.modelChangedEvent=null)),m>d+
e&&(b.lineIndex=m+l-e,b._line.lineIndex=b.lineIndex),b=this._getLineNext(b);this._lineHeight&&(a=[d,e].concat(Array(l)),Array.prototype.splice.apply(this._lineHeight,a));!this._wrapMode&&(d<=this._maxLineIndex&&this._maxLineIndex<=d+e)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._update()},_onModelChanging:function(a){a.type="ModelChanging";this.onModelChanging(a);a.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&!this._ignoreQueueUpdate){var a=
this;this._updateTimer=this._getWindow().setTimeout(function(){a._updateTimer=null;a._update()},0)}},_resetLineHeight:function(a,d){if(this._wrapMode||this._variableLineHeight){if(void 0!==a&&void 0!==d)for(var b=a;b<d;b++)this._lineHeight[b]=void 0;else this._lineHeight=Array(this._model.getLineCount());this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var a=this._clientDiv;if(a)for(a=a.firstChild;a;)a.lineWidth=void 0,a=a.nextSibling},_reset:function(){this._maxLineIndex=
-1;this._maxLineWidth=0;this._columnX=-1;this._bottomChild=this._topChild=null;this._topIndexY=0;this._variableLineHeight=!1;this._resetLineHeight();this._setSelection(new u(0,0,!1),!1,!1);this._viewDiv&&(this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0);var a=this._clientDiv;if(a){for(a=a.firstChild;a;)a.lineRemoved=!0,a=a.nextSibling;13>g.isFirefox&&this._fixCaret()}},_scrollViewAnimated:function(a,d,b){var m=this._getWindow();if(b&&this._scrollAnimation){var l=this;this._animation=new D({window:m,
duration:this._scrollAnimation,curve:[d,0],onAnimate:function(a){a=d-Math.floor(a);l._scrollView(0,a);d-=a},onEnd:function(){l._animation=null;l._scrollView(a,d);b&&m.setTimeout(b,0)}});this._animation.play()}else this._scrollView(a,d),b&&m.setTimeout(b,0)},_scrollView:function(a,d){this._ensureCaretVisible=!1;var b=this._viewDiv;a&&(b.scrollLeft+=a);d&&(b.scrollTop+=d)},_setClipboardText:function(a,b){var m,l=this._getWindow(),e=l.clipboardData;!e&&b&&(e=b.clipboardData);if(e&&(m=[],d(a,function(a){m.push(a)},
function(){m.push(g.platformDelimiter)}),e.setData(g.isIE?"Text":"text/plain",m.join(""))||21<g.isFirefox))return!0;var s=this._parent.ownerDocument,f=g.createElement(s,"pre");f.style.position="fixed";f.style.left="-1000px";d(a,function(a){f.appendChild(s.createTextNode(a))},function(){f.appendChild(g.createElement(s,"br"))});f.appendChild(s.createTextNode(" "));this._clientDiv.appendChild(f);e=s.createRange();e.setStart(f.firstChild,0);e.setEndBefore(f.lastChild);var u=l.getSelection();0<u.rangeCount&&
u.removeAllRanges();u.addRange(e);var h=this,e=function(){f&&f.parentNode===h._clientDiv&&h._clientDiv.removeChild(f);h._updateDOMSelection()},u=!1;this._ignoreCopy=!0;try{u=s.execCommand("copy",!1,null)}catch(p){}this._ignoreCopy=!1;if(!u&&b)return l.setTimeout(e,0),!1;e();return!0},_setDOMSelection:function(a,d,b,m,l){this._setDOMFullSelection(a,d,b,m);a=a._line.getNodeOffset(d);b=b._line.getNodeOffset(m);m=this._getWindow();d=this._parent.ownerDocument;if(m.getSelection){var e=m.getSelection();
m=d.createRange();m.setStart(a.node,a.offset);m.setEnd(b.node,b.offset);if(this._hasFocus&&(e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==b.node||e.focusOffset!==b.offset||e.anchorNode!==b.node||e.anchorOffset!==b.offset||e.focusNode!==a.node||e.focusOffset!==a.offset))this._anchorNode=a.node,this._anchorOffset=a.offset,this._focusNode=b.node,this._focusOffset=b.offset,this._ignoreSelect=!1,0<e.rangeCount&&e.removeAllRanges(),e.addRange(m),this._ignoreSelect=!0;this._cursorDiv&&
(m=d.createRange(),l?(m.setStart(a.node,a.offset),m.setEnd(a.node,a.offset)):(m.setStart(b.node,b.offset),m.setEnd(b.node,b.offset)),l=m.getClientRects()[0],a=this._cursorDiv.parentNode,b=a.getBoundingClientRect(),l&&b&&(this._cursorDiv.style.top=l.top-b.top+a.scrollTop+"px",this._cursorDiv.style.left=l.left-b.left+a.scrollLeft+"px"))}else d.selection&&this._hasFocus&&(l=d.body,m=g.createElement(d,"div"),l.appendChild(m),l.removeChild(m),m=l.createTextRange(),m.moveToElementText(a.node.parentNode),
m.moveStart("character",a.offset),l=l.createTextRange(),l.moveToElementText(b.node.parentNode),l.moveStart("character",b.offset),m.setEndPoint("EndToStart",l),this._ignoreSelect=!1,m.select(),this._ignoreSelect=!0)},_setDOMFullSelection:function(a,d,b,m){if(this._selDiv1){var l=this._selDiv1;l.style.width="0px";l.style.height="0px";l=this._selDiv2;l.style.width="0px";l.style.height="0px";l=this._selDiv3;l.style.width="0px";l.style.height="0px";if(!(a===b&&d===m)){var e=this._getViewPadding(),s=this._clientDiv.getBoundingClientRect(),
f=this._viewDiv.getBoundingClientRect(),l=f.left+e.left,g=s.right,e=f.top+e.top,u=s.bottom,f=s=0;this._clipDiv?(f=this._clipDiv.getBoundingClientRect(),s=f.left-this._clipDiv.scrollLeft):(f=this._rootDiv.getBoundingClientRect(),s=f.left);f=f.top;this._ignoreDOMSelection=!0;var h=(new A(this,a.lineIndex,a)).getBoundingClientRect(d,!1),p=h.left;d=(new A(this,b.lineIndex,b)).getBoundingClientRect(m,!1);var v=d.left;this._ignoreDOMSelection=!1;var k=this._selDiv1,p=Math.min(g,Math.max(l,p)),w=Math.min(u,
Math.max(e,h.top)),n=g;m=Math.min(u,Math.max(e,h.bottom));k.style.left=p-s+"px";k.style.top=w-f+"px";k.style.width=Math.max(0,n-p)+"px";k.style.height=Math.max(0,m-w)+"px";a.lineIndex===b.lineIndex?(n=Math.min(v,g),k.style.width=Math.max(0,n-p)+"px"):(h=Math.min(u,Math.max(e,d.top)),v=Math.min(g,Math.max(l,v)),e=Math.min(u,Math.max(e,d.bottom)),u=this._selDiv3,u.style.left=l-s+"px",u.style.top=h-f+"px",u.style.width=Math.max(0,v-l)+"px",u.style.height=Math.max(0,e-h)+"px",1<Math.abs(a.lineIndex-b.lineIndex)&&
(a=this._selDiv2,a.style.left=l-s+"px",a.style.top=m-f+"px",a.style.width=Math.max(0,g-l)+"px",a.style.height=Math.max(0,h-m)+"px"))}}},_setGrab:function(a){a!==this._grabControl&&(a?(a.setCapture&&a.setCapture(),this._grabControl=a):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null))},_setLinksVisible:function(a){if(this._linksVisible!==a){this._linksVisible=a;g.isIE&&a&&(this._hadFocus=this._hasFocus);var d=this._clientDiv;d.contentEditable=!a;this._hadFocus&&
!a&&d.focus();this._overlayDiv&&(this._overlayDiv.style.zIndex=a?"-1":"1");for(a=this._getLineNext();a;)a._line.updateLinks(),a=this._getLineNext(a);this._updateDOMSelection()}},_setSelection:function(a,d,b,m,l){if(a){this._columnX=-1;void 0===b&&(b=!0);var e=this._selection;this._selection=a;!1!==d&&this._showCaret(!1,m,d,l);b&&this._updateDOMSelection();if(!e.equals(a))this.onSelection({type:"Selection",oldValue:{start:e.start,end:e.end},newValue:{start:a.start,end:a.end}})}},_setSelectionTo:function(a,
d,b,m){var l=this._model,e=this._getSelection();d=this.convert({x:a,y:d},"page","document");a=this._getLineIndex(d.y);if(1===this._clickCount){l=this._getLine(a);a=l.getOffset(d.x,d.y-this._getLinePixel(a));l.destroy();if(m&&!b&&e.start<=a&&a<e.end)return this._dragOffset=a,!1;e.extend(a);b||e.collapse()}else 0===(this._clickCount&1)?(l=this._getLine(a),a=l.getOffset(d.x,d.y-this._getLinePixel(a)),this._doubleClickSelection?a>=this._doubleClickSelection.start?(b=this._doubleClickSelection.start,m=
l.getNextOffset(a,{unit:"wordend",count:1})):(b=l.getNextOffset(a,{unit:"word",count:-1}),m=this._doubleClickSelection.end):(b=l.getNextOffset(a,{unit:"word",count:-1}),m=l.getNextOffset(b,{unit:"wordend",count:1})),l.destroy()):this._doubleClickSelection?(m=l.getLineAtOffset(this._doubleClickSelection.start),a>=m?(b=l.getLineStart(m),m=l.getLineEnd(a)):(b=l.getLineStart(a),m=l.getLineEnd(m))):(b=l.getLineStart(a),m=l.getLineEnd(a)),e.setCaret(b),e.extend(m);this._setSelection(e,!0,!0);return!0},
_setFullSelection:function(a,d){this._fullSelection=a;g.isWebkit&&(this._fullSelection=!0);var b=this._clipDiv||this._rootDiv;if(b)if(this._fullSelection){if(!this._selDiv1&&this._fullSelection&&!g.isIOS){var m=b.ownerDocument;this._highlightRGB=g.isWebkit?"transparent":"Highlight";var l=g.createElement(m,"div");this._selDiv1=l;l.style.position="absolute";l.style.borderWidth="0px";l.style.margin="0px";l.style.padding="0px";l.style.outline="none";l.style.background=this._highlightRGB;l.style.width=
"0px";l.style.height="0px";l.style.zIndex="0";b.appendChild(l);var e=g.createElement(m,"div");this._selDiv2=e;e.style.position="absolute";e.style.borderWidth="0px";e.style.margin="0px";e.style.padding="0px";e.style.outline="none";e.style.background=this._highlightRGB;e.style.width="0px";e.style.height="0px";e.style.zIndex="0";b.appendChild(e);this._selDiv3=m=g.createElement(m,"div");m.style.position="absolute";m.style.borderWidth="0px";m.style.margin="0px";m.style.padding="0px";m.style.outline="none";
m.style.background=this._highlightRGB;m.style.width="0px";m.style.height="0px";m.style.zIndex="0";b.appendChild(m);if(g.isFirefox&&g.isMac){b=this._getWindow().getComputedStyle(m,null).getPropertyValue("background-color");switch(b){case "rgb(119, 141, 168)":b="rgb(199, 208, 218)";break;case "rgb(127, 127, 127)":b="rgb(198, 198, 198)";break;case "rgb(255, 193, 31)":b="rgb(250, 236, 115)";break;case "rgb(243, 70, 72)":b="rgb(255, 176, 139)";break;case "rgb(255, 138, 34)":b="rgb(255, 209, 129)";break;
case "rgb(102, 197, 71)":b="rgb(194, 249, 144)";break;case "rgb(140, 78, 184)":b="rgb(232, 184, 255)";break;default:b="rgb(180, 213, 255)"}this._highlightRGB=b;l.style.background=b;e.style.background=b;m.style.background=b}d||this._updateDOMSelection()}}else this._selDiv1&&(b.removeChild(this._selDiv1),this._selDiv1=null),this._selDiv2&&(b.removeChild(this._selDiv2),this._selDiv2=null),this._selDiv3&&(b.removeChild(this._selDiv3),this._selDiv3=null)},_setBlockCursor:function(a){this._blockCursorVisible=
a;this._updateBlockCursorVisible()},_setOverwriteMode:function(a){this._overwriteMode=a;this._updateBlockCursorVisible()},_updateBlockCursorVisible:function(){if(this._blockCursorVisible||this._overwriteMode){if(!this._cursorDiv){var a=this._viewDiv,d=g.createElement(a.ownerDocument,"div");d.className="textviewBlockCursor";this._cursorDiv=d;d.tabIndex=-1;d.style.zIndex="2";d.style.color="transparent";d.style.position="absolute";d.style.pointerEvents="none";d.innerHTML="\x26nbsp;";a.appendChild(d);
this._updateDOMSelection()}}else this._cursorDiv&&(this._cursorDiv.parentNode.removeChild(this._cursorDiv),this._cursorDiv=null)},_setMarginOffset:function(a,d){this._marginOffset=a;this._marginDiv.style.display=a?"block":"none";d||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setWrapOffset:function(a,d){this._wrapOffset=a;d||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setReadOnly:function(a){this._readonly=a;this._clientDiv.setAttribute("aria-readonly",a?"true":
"false")},_setSingleMode:function(a,d){this._singleMode=a;this._updateOverflow();this._updateStyle(d)},_setTabSize:function(a,d){this._tabSize=a;this._customTabSize=void 0;var b=this._clientDiv;g.isOpera?b&&(b.style.OTabSize=this._tabSize+""):537.1<=g.isWebkit?b&&(b.style.tabSize=this._tabSize+""):4<=g.isFirefox?b&&(b.style.MozTabSize=this._tabSize+""):8!==this._tabSize&&(this._customTabSize=this._tabSize);d||(this.redrawLines(),this._resetLineWidth())},_setTheme:function(a){this._theme&&this._theme.removeEventListener("ThemeChanged",
this._themeListener.onChanged);(this._theme=a)&&this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);this._setThemeClass(this._themeClass)},_setThemeClass:function(a,d){this._themeClass=a;var b="textview",m=this._theme.getThemeClass();m&&(b+=" "+m);this._themeClass&&m!==this._themeClass&&(b+=" "+this._themeClass);this._rootDiv.className=b;this._updateStyle(d)},_setWrapMode:function(a,d){this._wrapMode=a&&this._wrappable;var b=this._clientDiv;this._wrapMode?(b.style.whiteSpace=
"pre-wrap",b.style.wordWrap="break-word"):(b.style.whiteSpace="pre",b.style.wordWrap="normal");this._updateOverflow();d||(this.redraw(),this._resetLineWidth());this._resetLineHeight()},_showCaret:function(a,d,b,m){if(this._clientDiv&&!(0<this._redrawCount)&&!this._ignoreDOMSelection){var l=this._model,e=this._getSelection(),s=this._getScroll(),f=e.getCaret(),g=e.start,u=e.end,h=l.getLineAtOffset(g),p=l.getLineAtOffset(u),v=Math.max(Math.max(g,l.getLineStart(p)),u-1),l=this._getClientWidth(),k=this._getClientHeight(),
A=l/4,w=this._getBoundsAtOffset(f===g?g:v),n=w.left,r=w.right,y=w.top,t=w.bottom,x=0,D="object"===typeof b;if((a||D)&&!e.isEmpty())w=this._getBoundsAtOffset(f===u?g:v),x=(w.bottom>t?w.bottom:t)-(w.top<y?w.top:y),a&&(w.top===y?f===g?r=n+Math.min(w.right-n,l):n=r-Math.min(r-w.left,l):f===g?t=y+Math.min(w.bottom-y,k):y=t-Math.min(t-w.top,k));a=0;n<s.x&&(a=Math.min(n-s.x,-A));r>s.x+l&&(a=Math.max(r-s.x-l,A));e=0;y<s.y?e=y-s.y:t>s.y+k&&(e=t-s.y-k);m&&(0<m?0<e&&(e=Math.max(e,m)):0>e&&(e=Math.min(e,m)));
m=D&&"always"===b.scrollPolicy;if(0!==a||0!==e||m)return D?(m=0<e,0===e&&(e=y-s.y),s=b.viewAnchor,y=b.selectionAnchor,b=Math.min(Math.max(0,b.viewAnchorOffset||0)),e="top"===s?e+Math.floor(m?(1-b)*k:-b*k):"bottom"===s?e+Math.floor(m?b*k:-(1-b)*k):"center"===s?e+Math.floor(m?k/2+b*k:k/2-(1-b)*k):e+Math.floor(m?b*k:-b*k),h!==p&&("top"===y&&f!==g?e+=Math.floor(-x):"bottom"===y&&f!==u?e+=Math.floor(x):"center"===y&&(e+=Math.floor(x/2)))):0!==e&&"number"===typeof b&&(0>b&&(b=0),1<b&&(b=1),e+=Math.floor(0<
e?b*k:-b*k)),this._scrollViewAnimated(a,e,d),k!==this._getClientHeight()||l!==this._getClientWidth()?this._showCaret():this._ensureCaretVisible=!0,!0;d&&d();return!1}},_startIME:function(){if(-1===this._imeOffset){var a=this._getSelection();a.isEmpty()||this._modifyContent({text:"",start:a.start,end:a.end},!0);this._imeOffset=a.start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);
this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);this._modelListener=null;for(var a=0;a<this._handlers.length;a++){var d=this._handlers[a];x(d.target,d.type,d.handler)}this._handlers=null;this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null)},_updateDOMSelection:function(){if(!(0<this._redrawCount)&&!this._ignoreDOMSelection&&this._clientDiv){var a=this._getSelection(),d=this._model,b=d.getLineAtOffset(a.start),m=d.getLineAtOffset(a.end),
l=this._getLineNext();if(l){var e=this._getLinePrevious(),s;b<l.lineIndex?(b=l,s=d.getLineStart(l.lineIndex)):b>e.lineIndex?(b=e,s=d.getLineStart(e.lineIndex)):(b=this._getLineNode(b),s=a.start);m<l.lineIndex?(m=l,d=d.getLineStart(l.lineIndex)):m>e.lineIndex?(m=e,d=d.getLineStart(e.lineIndex)):(m=this._getLineNode(m),d=a.end);this._setDOMSelection(b,s,m,d,a.caret)}}},_update:function(a){if(!(0<this._redrawCount)){this._updateTimer&&(this._getWindow().clearTimeout(this._updateTimer),this._updateTimer=
null,a=!1);var d=this._clientDiv,b=this._viewDiv;if(d){this._metrics.invalid&&(this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1);var m=this._model,l=this._getScroll(!1),e=this._getViewPadding(),s=m.getLineCount(),f=this._getLineHeight(),u=!1,h=!1,p=!1,v=this._metrics.scrollWidth;this._wrapMode&&(d.style.width=(this._metrics.wrapWidth||this._getClientWidth())+"px");var k,w,n,r,y=0,t=0,x;if(this._lineHeight){for(;t<s;){x=this._getLineHeight(t);if(y+x>l.y)break;y+=x;t++}k=t;
w=Math.max(0,k-1);n=m=l.y-y;0<k&&(m+=this._getLineHeight(k-1))}else r=Math.max(0,l.y)/f,k=Math.floor(r),w=Math.max(0,k-1),m=Math.round((r-w)*f),n=Math.round((r-k)*f);this._topIndexY=n;r=this._rootDiv;var D=r.clientWidth,K=r.clientHeight;if(a){f=0;this._leftDiv&&(k=this._leftDiv.getBoundingClientRect(),f=k.right-k.left);k=this._getClientWidth();r=this._getClientHeight();h=k;this._wrapMode?this._metrics.wrapWidth&&(h=this._metrics.wrapWidth):h=Math.max(this._maxLineWidth,h);for(;t<s;)x=this._getLineHeight(t,
!1),y+=x,t++;s=y}else{r=this._getClientHeight();n=Math.min(k+Math.floor((r+n)/f),s-1);var l=Math.min(n+1,s-1),F;for(x=d.firstChild;x;){F=x.lineIndex;var G=x.nextSibling;if(!(w<=F&&F<=l)||x.lineRemoved||-1===x.lineIndex)this._mouseWheelLine===x?(x.style.display="none",x.lineIndex=-1):d.removeChild(x);x=G}x=this._getLineNext();var G=b.ownerDocument,J=G.createDocumentFragment();for(F=w;F<=l;F++)!x||x.lineIndex>F?(new A(this,F)).create(J,null):(J.firstChild&&(d.insertBefore(J,x),J=G.createDocumentFragment()),
x&&x.lineChanged&&(x=(new A(this,F)).create(J,x),x.lineChanged=!1),x=this._getLineNext(x));J.firstChild&&d.insertBefore(J,x);g.isWebkit&&!this._wrapMode&&(d.style.width="0x7fffffffpx");x=this._getLineNext();F=r+m;for(J=!1;x;)w=x.lineWidth,void 0===w&&(G=x._line.getBoundingClientRect(),w=x.lineWidth=Math.ceil(G.right-G.left),G=G.bottom-G.top,this._lineHeight?this._lineHeight[x.lineIndex]=G:0!==f&&(0!==G&&Math.ceil(f)!==Math.ceil(G))&&(this._variableLineHeight=!0,this._lineHeight=[],this._lineHeight[x.lineIndex]=
G)),this._lineHeight&&!J&&(F-=this._lineHeight[x.lineIndex],0>F&&(n=x.lineIndex,J=!0)),this._wrapMode||(w>=this._maxLineWidth&&(this._maxLineWidth=w,this._maxLineIndex=x.lineIndex),this._checkMaxLineIndex===x.lineIndex&&(this._checkMaxLineIndex=-1)),x.lineIndex===k&&(this._topChild=x),x.lineIndex===n&&(this._bottomChild=x),x=this._getLineNext(x);-1!==this._checkMaxLineIndex&&(F=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,0<=F&&F<s&&(f=new A(this,F),G=f.getBoundingClientRect(),w=G.right-G.left,
w>=this._maxLineWidth&&(this._maxLineWidth=w,this._maxLineIndex=F),f.destroy()));for(;t<s;)x=this._getLineHeight(t,t<=n),y+=x,t++;s=y;this._updateRuler(this._leftDiv,k,l,K);this._updateRuler(this._rightDiv,k,l,K);this._updateRuler(this._marginDiv,k,l,K);f=0;this._leftDiv&&(k=this._leftDiv.getBoundingClientRect(),f=k.right-k.left);l=0;this._rightDiv&&(l=this._rightDiv.getBoundingClientRect(),l=l.right-l.left);b.style.left=f+"px";b.style.right=l+"px";l=this._scrollDiv;l.style.height=s+"px";k=this._getClientWidth();
!this._singleMode&&!this._wrapMode&&(y=u=r,(t="scroll"===b.style.overflowX)?u+=v:y-=v,x=n=k,(w="scroll"===b.style.overflowY)?n+=v:x-=v,r=u,k=n,s>r&&(p=!0,k=x),this._maxLineWidth>k&&(h=!0,r=y,s>r&&(p=!0,k=x)),t!==h&&(b.style.overflowX=h?"scroll":"hidden"),w!==p&&(b.style.overflowY=p?"scroll":"hidden"),u=t!==h||w!==p);p=k;this._wrapMode?this._metrics.wrapWidth&&(p=this._metrics.wrapWidth):p=Math.max(this._maxLineWidth,p);h=p;if((!g.isIE||9<=g.isIE)&&this._maxLineWidth>k)p+=e.right+e.left;l.style.width=
p+"px";this._clipScrollDiv&&(this._clipScrollDiv.style.width=p+"px");l=this._getScroll(!1)}this._vScrollDiv&&(p=r-8,y=Math.max(15,Math.ceil(Math.min(1,p/(s+e.top+e.bottom))*p)),this._vScrollDiv.style.left=f+k-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,l.y*p/s))+"px",this._vScrollDiv.style.height=y+"px");!this._wrapMode&&this._hScrollDiv&&(p=k-8,y=Math.max(15,Math.ceil(Math.min(1,p/(this._maxLineWidth+e.left+e.right))*p)),this._hScrollDiv.style.left=f+Math.floor(Math.max(0,Math.floor(l.x*
p/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=r-9+"px",this._hScrollDiv.style.width=y+"px");t=l.x;y=this._clipDiv;p=this._overlayDiv;if(n=this._marginDiv)n.style.left=-t+f+this._metrics.marginWidth+e.left+"px",n.style.bottom=("scroll"===b.style.overflowX?v:0)+"px";y?(y.scrollLeft=t,y.scrollTop=0,b=f+e.left,v=e.top,a=k,f=r,t=0,n=-m,0===l.x&&(b-=e.left,a+=e.left,t=e.left),l.x+k===h&&(a+=e.right),0===l.y&&(v-=e.top,f+=e.top,n+=e.top),l.y+r===s&&(f+=e.bottom),y.style.left=b+"px",y.style.top=
v+"px",y.style.right=D-a-b+"px",y.style.bottom=K-f-v+"px",d.style.left=t+"px",d.style.top=n+"px",d.style.width=h+"px",d.style.height=r+m+"px",p&&(p.style.left=d.style.left,p.style.top=d.style.top,p.style.width=d.style.width,p.style.height=d.style.height)):(b=t,v=m,D=t+k,K=m+r,0===b&&(b-=e.left),0===v&&(v-=e.top),D===h&&(D+=e.right),l.y+r===s&&(K+=e.bottom),d.style.clip="rect("+v+"px,"+D+"px,"+K+"px,"+b+"px)",d.style.left=-t+f+e.left+"px",d.style.width=(this._wrapMode||g.isWebkit?h:k+t)+"px",a||(d.style.top=
-m+e.top+"px",d.style.height=r+m+"px"),p&&(p.style.clip=d.style.clip,p.style.left=d.style.left,p.style.width=d.style.width,a||(p.style.top=d.style.top,p.style.height=d.style.height)));this._updateDOMSelection();u&&(d=this._ensureCaretVisible,this._ensureCaretVisible=!1,d&&this._showCaret(),this._queueUpdate())}}},_updateOverflow:function(){var a=this._viewDiv;this._wrapMode?(a.style.overflowX="hidden",a.style.overflowY="scroll"):a.style.overflow="hidden"},_updateRuler:function(a,d,b,m){if(a){var l=
this._parent.ownerDocument,e=this._getLineHeight(),s=this._getViewPadding();for(a=a.firstChild;a;){var f=a._ruler,u=e,h=f.getOverview();"page"===h&&(u+=this._topIndexY);a.style.top=-u+"px";a.style.height=m+u+"px";a.rulerChanged&&p(f.getRulerStyle(),a);var v,k=a.firstChild;k?(v=k,k=k.nextSibling):(v=g.createElement(l,"div"),v.style.visibility="hidden",a.appendChild(v));var A;if(a.rulerChanged&&v){u=-1;if(A=f.getWidestAnnotation())p(A.style,v),A.html&&(v.innerHTML=A.html);v.lineIndex=u;v.style.height=
e+s.top+"px"}var w;if("page"===h){for(f=f.getAnnotations(d,b+1);k;)u=k.lineIndex,A=k.nextSibling,(!(d<=u&&u<=b)||k.lineChanged)&&a.removeChild(k),k=A;k=a.firstChild.nextSibling;w=l.createDocumentFragment();for(u=d;u<=b;u++)if(!k||k.lineIndex>u){v=g.createElement(l,"div");if(A=f[u])p(A.style,v),A.html&&(v.innerHTML=A.html),v.annotation=A;v.lineIndex=u;v.style.height=this._getLineHeight(u)+"px";w.appendChild(v)}else w.firstChild&&(a.insertBefore(w,k),w=l.createDocumentFragment()),k&&(k=k.nextSibling);
w.firstChild&&a.insertBefore(w,k)}else{A=this._getClientHeight();u=this._model.getLineCount();k=A+s.top+s.bottom-2*this._metrics.scrollWidth;h=e*u<k?e:k/u;if(a.rulerChanged){for(A=a.childNodes.length;1<A;)a.removeChild(a.lastChild),A--;f=f.getAnnotations(0,u);w=l.createDocumentFragment();for(var n in f)u=n>>>0,0>u||(v=g.createElement(l,"div"),A=f[n],p(A.style,v),v.style.position="absolute",v.style.top=this._metrics.scrollWidth+e+Math.floor(u*h)+"px",A.html&&(v.innerHTML=A.html),v.annotation=A,v.lineIndex=
u,w.appendChild(v));a.appendChild(w)}else if(a._oldTrackHeight!==k)for(v=a.firstChild?a.firstChild.nextSibling:null;v;)v.style.top=this._metrics.scrollWidth+e+Math.floor(v.lineIndex*h)+"px",v=v.nextSibling;a._oldTrackHeight=k}a.rulerChanged=!1;a=a.nextSibling}}},_updateStyleSheet:function(){var a="";g.isWebkit&&0<this._metrics.scrollWidth&&(a+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}");g.isFirefox&&(g.isMac&&this._highlightRGB&&"Highlight"!==this._highlightRGB)&&(a+="\n.textview ::-moz-selection {background: "+
this._highlightRGB+";}");if(a){var d=this._clientDiv.ownerDocument,b=d.getElementById("_textviewStyle");if(b)b.removeChild(b.firstChild),b.appendChild(d.createTextNode(a));else{b=g.createElement(d,"style");b.id="_textviewStyle";var m=d.getElementsByTagName("head")[0]||d.documentElement;b.appendChild(d.createTextNode(a));m.insertBefore(b,m.firstChild)}}},_updateStyle:function(a){!a&&g.isIE&&(this._rootDiv.style.lineHeight="normal");var d=this._metrics=this._calculateMetrics();this._variableLineHeight&&
(this._variableLineHeight=!1,this._resetLineHeight());this._rootDiv.style.lineHeight=g.isIE?d.lineHeight-(d.lineTrim.top+d.lineTrim.bottom)+"px":"normal";this._updateStyleSheet();if(g.isMac&&g.isWebkit){var b=this._viewDiv;!d.invalid&&0===d.scrollWidth?(b.style.pointerEvents="none",b.style.zIndex="2"):(b.style.pointerEvents="",b.style.zIndex="")}a||(this.redraw(),this._resetLineWidth())}};k.EventTarget.addMixin(w.prototype);return{TextView:w}});
define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(n,t){function r(k){this._model=k;this._projections=[];var f=this;this._listener={onChanged:function(h){f._onChanged(h)},onChanging:function(h){f._onChanging(h)}};k.addEventListener("postChanged",this._listener.onChanged);k.addEventListener("preChanging",this._listener.onChanging)}r.prototype={destroy:function(){this._model&&(this._model.removeEventListener("postChanged",this._listener.onChanged),
this._model.removeEventListener("preChanging",this._listener.onChanging),this._model=null)},addProjection:function(k){if(k){var f=this._model,h=this._projections;k._lineIndex=f.getLineAtOffset(k.start);k._lineCount=f.getLineAtOffset(k.end)-k._lineIndex;var g=k.text;g||(g="");k._model="string"===typeof g?new n.TextModel(g,f.getLineDelimiter()):g;var f=this.mapOffset(k.start,!0),g=k.end-k.start,p=k._lineCount,e=k._model.getCharCount(),b=k._model.getLineCount()-1,a={type:"Changing",text:k._model.getText(),
start:f,removedCharCount:g,addedCharCount:e,removedLineCount:p,addedLineCount:b};this.onChanging(a);a=this._binarySearch(h,k.start);h.splice(a,0,k);this.onChanged({type:"Changed",start:f,removedCharCount:g,addedCharCount:e,removedLineCount:p,addedLineCount:b})}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(k,f){var h=this._projections,g=0,p,e;if(f){for(p=0;p<h.length;p++){e=h[p];if(e.start>k)break;if(e.end>k)return-1;g+=
e._model.getCharCount()-(e.end-e.start)}return k+g}for(p=0;p<h.length;p++){e=h[p];if(e.start>k-g)break;var b=e._model.getCharCount();if(e.start+b>k-g)return-1;g+=b-(e.end-e.start)}return k-g},removeProjection:function(k){this._removeProjection(k)},_removeProjection:function(k,f){var h,g=0;for(h=0;h<this._projections.length;h++){var p=this._projections[h];if(p===k){k=p;break}g+=p._model.getCharCount()-(p.end-p.start)}if(h<this._projections.length){var p=this._model,g=k.start+g,e=k.end-k.start,b=k._lineCount,
a=k._model.getCharCount(),d=k._model.getLineCount()-1;f||(p={type:"Changing",text:p.getText(k.start,k.end),start:g,removedCharCount:a,addedCharCount:e,removedLineCount:d,addedLineCount:b},this.onChanging(p));this._projections.splice(h,1);if(!f)this.onChanged({type:"Changed",start:g,removedCharCount:a,addedCharCount:e,removedLineCount:d,addedLineCount:b})}},_binarySearch:function(k,f){for(var h=k.length,g=-1,p;1<h-g;)p=Math.floor((h+g)/2),f<=k[p].start?h=p:g=p;return h},getCharCount:function(){for(var k=
this._model.getCharCount(),f=this._projections,h=0;h<f.length;h++)var g=f[h],k=k+(g._model.getCharCount()-(g.end-g.start));return k},getLine:function(k,f){if(0>k)return null;var h=this._model,g=this._projections,p=0,e=[],b=0,a,d,m;for(a=0;a<g.length;a++){m=g[a];if(m._lineIndex>=k-p)break;d=m._model.getLineCount()-1;if(m._lineIndex+d>=k-p){b=k-(m._lineIndex+p);if(b<d)return m._model.getLine(b,f);e.push(m._model.getLine(d))}b=m.end;p+=d-m._lineCount}for(b=Math.max(b,h.getLineStart(k-p));a<g.length;a++){m=
g[a];if(m._lineIndex>k-p)break;e.push(h.getText(b,m.start));d=m._model.getLineCount()-1;if(m._lineIndex+d>k-p)return e.push(m._model.getLine(0,f)),e.join("");e.push(m._model.getText());b=m.end;p+=d-m._lineCount}g=h.getLineEnd(k-p,f);b<g&&e.push(h.getText(b,g));return e.join("")},getLineAtOffset:function(k){for(var f=this._model,h=this._projections,g=0,p=0,e=0;e<h.length;e++){var b=h[e];if(b.start>k-g)break;var a=b._model.getCharCount();if(b.start+a>k-g){h=k-(b.start+g);p+=b._model.getLineAtOffset(h);
g+=h;break}p+=b._model.getLineCount()-1-b._lineCount;g+=a-(b.end-b.start)}return f.getLineAtOffset(k-g)+p},getLineCount:function(){for(var k=this._projections,f=this._model.getLineCount(),h=0;h<k.length;h++)var g=k[h],f=f+(g._model.getLineCount()-1-g._lineCount);return f},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(k,f){if(0>k)return-1;for(var h=this._model,g=this._projections,p=0,e=0,b=0;b<g.length;b++){var a=g[b];if(a._lineIndex>k-p)break;var d=a._model.getLineCount()-
1;if(a._lineIndex+d>k-p)return a._model.getLineEnd(k-(a._lineIndex+p),f)+a.start+e;e+=a._model.getCharCount()-(a.end-a.start);p+=d-a._lineCount}return h.getLineEnd(k-p,f)+e},getLineStart:function(k){if(0>k)return-1;for(var f=this._model,h=this._projections,g=0,p=0,e=0;e<h.length;e++){var b=h[e];if(b._lineIndex>=k-g)break;var a=b._model.getLineCount()-1;if(b._lineIndex+a>=k-g)return b._model.getLineStart(k-(b._lineIndex+g))+b.start+p;p+=b._model.getCharCount()-(b.end-b.start);g+=a-b._lineCount}return f.getLineStart(k-
g)+p},getText:function(k,f){void 0===k&&(k=0);var h=this._model,g=this._projections,p=0,e=[],b,a,d;for(b=0;b<g.length;b++){a=g[b];if(a.start>k-p)break;d=a._model.getCharCount();if(a.start+d>k-p){if(void 0!==f&&a.start+d>f-p)return a._model.getText(k-(a.start+p),f-(a.start+p));e.push(a._model.getText(k-(a.start+p)));k=a.end+p+d-(a.end-a.start)}p+=d-(a.end-a.start)}var m=k-p;if(void 0!==f){for(;b<g.length;b++){a=g[b];if(a.start>f-p)break;e.push(h.getText(m,a.start));d=a._model.getCharCount();if(a.start+
d>f-p)return e.push(a._model.getText(0,f-(a.start+p))),e.join("");e.push(a._model.getText());m=a.end;p+=d-(a.end-a.start)}e.push(h.getText(m,f-p))}else{for(;b<g.length;b++)a=g[b],e.push(h.getText(m,a.start)),e.push(a._model.getText()),m=a.end;e.push(h.getText(m))}return e.join("")},_onChanged:function(k){k=this._change;var f=k.baseStart,h=k.baseEnd,g,p,e=this._projections;for(g=0;g<e.length&&!(p=e[g],p.end>f);g++);var b=g;for(g=0;g<e.length&&!(p=e[g],p.start>=h);g++);var a=g,d=this._model,f=k.baseText.length-
(h-f);for(g=a;g<e.length;g++)p=e[g],p.start+=f,p.end+=f,p._lineIndex=d.getLineAtOffset(p.start);p=e.splice(b,a-b);for(g=0;g<p.length;g++)p[g].annotation&&p[g].annotation._expand();this.onChanged({type:"Changed",start:k.start,removedCharCount:k.removedCharCount,addedCharCount:k.addedCharCount,removedLineCount:k.removedLineCount,addedLineCount:k.addedLineCount});this._change=void 0},_onChanging:function(k){var f=!!this._change,h=this._change||{},g=k.start,p=g+k.removedCharCount;h.baseStart=g;h.baseEnd=
p;h.baseText=k.text;h.addedLineCount=k.addedLineCount;if(!f){this._change=h;h.text=k.text;var e=this._projections,b,a,d;k=function(m){for(b=a=0;a<e.length;a++){d=e[a];if(d.start>m)break;if(d.end>m)return-1;b+=d._model.getCharCount()-(d.end-d.start)}return m+b};h.start=k(g);-1===h.start&&(h.text=this._model.getText(d.start,g)+h.text,h.addedLineCount+=this._model.getLineAtOffset(g)-this._model.getLineAtOffset(d.start),h.start=d.start+b);h.end=k(p);-1===h.end&&(h.text+=this._model.getText(p,d.end),h.addedLineCount+=
this._model.getLineAtOffset(d.end)-this._model.getLineAtOffset(p),h.end=d.start+b)}h.addedCharCount=h.text.length;h.removedCharCount=h.end-h.start;h.removedLineCount=this.getLineAtOffset(h.end)-this.getLineAtOffset(h.start);this.onChanging({type:"Changing",text:h.text,start:h.start,removedCharCount:h.removedCharCount,addedCharCount:h.addedCharCount,removedLineCount:h.removedLineCount,addedLineCount:h.addedLineCount})},onChanging:function(k){return this.dispatchEvent(k)},onChanged:function(k){return this.dispatchEvent(k)},
setLineDelimiter:function(k){this._model.setLineDelimiter(k)},setText:function(k,f,h){function g(d){for(e=b=0;b<p.length;b++){a=p[b];if(a.start>d-e)break;var m=a._model.getCharCount();if(a.start+m>d-e)return-1;e+=m-(a.end-a.start)}return d-e}this._change={text:k||"",start:f||0,end:void 0===h?this.getCharCount():h};var p=this._projections,e,b,a,d,m;k=g(this._change.start);-1===k&&(d={projection:a,start:this._change.start-(a.start+e)},k=a.end);f=g(this._change.end);-1===f&&(m={projection:a,end:this._change.end-
(a.start+e)},f=a.start);d&&m&&d.projection===m.projection?a._model.setText(this._change.text,d.start,m.end):(this._model.setText(this._change.text,k,f),d&&(a=d.projection,a._model.setText("",d.start)),m&&(a=m.projection,a._model.setText("",0,m.end),a.start=a.end,a._lineCount=0));this._change=void 0}};t.EventTarget.addMixin(r.prototype);return{ProjectionTextModel:r}});
define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(n,t){function r(){}function k(a,d,b){this.start=a;this.end=d;this._projectionModel=b;this.html=this._expandedHTML;this.style=this._expandedStyle;this.expanded=!0}function f(a,d){var b=a.lastIndexOf("."),b=a.substring(b+1),e={title:n[b],style:{styleClass:"annotation "+b},html:"\x3cdiv class\x3d'annotationHTML "+b+"'\x3e\x3c/div\x3e",overviewStyle:{styleClass:"annotationOverview "+b}};d?e.lineStyle=
{styleClass:"annotationLine "+b}:e.rangeStyle={styleClass:"annotationRange "+b};r.registerType(a,e)}function h(){}function g(a,d,b,e,l){var f;void 0===e&&(e=-1);void 0===l&&(l=a.length);for(;1<l-e;)if(f=Math.floor((l+e)/2),d<=a[f].start)l=f;else if(b&&d<a[f].end){l=f;break}else e=f;return l}function p(a){this._annotations=[];var d=this;this._listener={onChanged:function(a){d._onChanged(a)}};this.setTextModel(a)}function e(a,d){this._view=a;this._annotationModel=d;var b=this;this._listener={onDestroy:function(a){b._onDestroy(a)},
onLineStyle:function(a){b._onLineStyle(a)},onChanged:function(a){b._onAnnotationModelChanged(a)}};a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("postLineStyle",this._listener.onLineStyle);d.addEventListener("Changed",this._listener.onChanged)}k.prototype={_expandedHTML:"\x3cdiv class\x3d'annotationHTML expanded'\x3e\x3c/div\x3e",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"\x3cdiv class\x3d'annotationHTML collapsed'\x3e\x3c/div\x3e",_collapsedStyle:{styleClass:"annotation collapsed"},
_collapse:function(){if(!this.expanded)return!1;this.expanded=!1;this.html=this._collapsedHTML;this.style=this._collapsedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},_expand:function(){if(this.expanded)return!1;this.expanded=!0;this.html=this._expandedHTML;this.style=this._expandedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},_collapseImpl:function(a){if(this._collapse()){a&&this._forEachOverlaping(function(a){a.expanded||
(a._expandImpl(!1),a._recollapse=!0)});a=this._projectionModel;var d=a.getBaseModel();this._projection={annotation:this,start:d.getLineStart(d.getLineAtOffset(this.start)+1),end:d.getLineEnd(d.getLineAtOffset(this.end),!0)};a.addProjection(this._projection)}},_expandImpl:function(a){this._expand()&&(this._projectionModel._removeProjection(this._projection,!this._annotationModel),a&&this._forEachOverlaping(function(a){a._recollapse&&(a._collapseImpl(!1),a._recollapse=!1)}))},_forEachOverlaping:function(a){if(this._annotationModel)for(var d=
this._annotationModel.getAnnotations(this.start,this.end);d.hasNext();){var b=d.next();b!==this&&b.type===r.ANNOTATION_FOLDING&&a.call(this,b)}},collapse:function(){this._recollapse=!1;this._collapseImpl(!0)},expand:function(){this._recollapse=!1;this._expandImpl(!0)}};r.ANNOTATION_ERROR="orion.annotation.error";r.ANNOTATION_WARNING="orion.annotation.warning";r.ANNOTATION_TASK="orion.annotation.task";r.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";r.ANNOTATION_BOOKMARK="orion.annotation.bookmark";
r.ANNOTATION_FOLDING="orion.annotation.folding";r.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";r.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";r.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";r.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";r.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";r.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence";r.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";r.ANNOTATION_SELECTED_LINKED_GROUP=
"orion.annotation.selectedLinkedGroup";r.ANNOTATION_CURRENT_LINKED_GROUP="orion.annotation.currentLinkedGroup";r.ANNOTATION_LINKED_GROUP="orion.annotation.linkedGroup";r.ANNOTATION_BLAME="orion.annotation.blame";r.ANNOTATION_CURRENT_BLAME="orion.annotation.currentBlame";var b={};r.registerType=function(a,d){var m=d;"function"!==typeof m&&(m=function(a,d,b){this.start=a;this.end=d;void 0!==b&&(this.title=b)},m.prototype=d);m.prototype.type=a;b[a]=m;return a};r.createAnnotation=function(a,d,b,e){return new (this.getType(a))(d,
b,e)};r.getType=function(a){return b[a]};f(r.ANNOTATION_ERROR);f(r.ANNOTATION_WARNING);f(r.ANNOTATION_TASK);f(r.ANNOTATION_BREAKPOINT);f(r.ANNOTATION_BOOKMARK);f(r.ANNOTATION_CURRENT_BRACKET);f(r.ANNOTATION_MATCHING_BRACKET);f(r.ANNOTATION_CURRENT_SEARCH);f(r.ANNOTATION_MATCHING_SEARCH);f(r.ANNOTATION_READ_OCCURRENCE);f(r.ANNOTATION_WRITE_OCCURRENCE);f(r.ANNOTATION_SELECTED_LINKED_GROUP);f(r.ANNOTATION_CURRENT_LINKED_GROUP);f(r.ANNOTATION_LINKED_GROUP);f(r.ANNOTATION_CURRENT_LINE,!0);f(r.ANNOTATION_BLAME,
!0);f(r.ANNOTATION_CURRENT_BLAME,!0);r.registerType(r.ANNOTATION_FOLDING,k);h.addMixin=function(a){var d=h.prototype,b;for(b in d)d.hasOwnProperty(b)&&(a[b]=d[b])};h.prototype={addAnnotationType:function(a,d){this._annotationTypes||(this._annotationTypes=[]);var b=d-1;void 0==d||!(0<=b&&b<this._annotationTypes.length)?this._annotationTypes.push(a):this._annotationTypes.splice(b,0,a)},getAnnotationTypePriority:function(a){if(this._annotationTypes)for(var d=0;d<this._annotationTypes.length;d++)if(this._annotationTypes[d]===
a)return d+1;return 0},getAnnotationsByType:function(a,d,b){a=a.getAnnotations(d,b);for(b=[];a.hasNext();)d=a.next(),0!==this.getAnnotationTypePriority(d.type)&&b.push(d);var e=this;b.sort(function(a,d){return e.getAnnotationTypePriority(a.type)-e.getAnnotationTypePriority(d.type)});return b},isAnnotationTypeVisible:function(a){return 0!==this.getAnnotationTypePriority(a)},removeAnnotationType:function(a){if(this._annotationTypes)for(var d=0;d<this._annotationTypes.length;d++)if(this._annotationTypes[d]===
a){this._annotationTypes.splice(d,1);break}}};p.prototype={addAnnotation:function(a){if(a){var d=this._annotations,b=g(d,a.start);d.splice(b,0,a);a._annotationModel=this;this.onChanged({type:"Changed",added:[a],removed:[],changed:[]})}},getTextModel:function(){return this._model},getAnnotations:function(a,d){var b=this._annotations,e,l=0,f;f=void 0===a&&void 0===d?function(){return l<b.length?b[l++]:null}:function(){for(;l<b.length;){var e=b[l++];if(a===e.start||(a>e.start?a<e.end:e.start<d))return e;
if(e.start>=d)break}return null};e=f();return{next:function(){var a=e;a&&(e=f());return a},hasNext:function(){return null!==e}}},modifyAnnotation:function(a){if(a&&!(0>this._getAnnotationIndex(a)))this.onChanged({type:"Changed",added:[],removed:[],changed:[a]})},onChanged:function(a){return this.dispatchEvent(a)},removeAnnotations:function(a){var d=this._annotations,b,e;if(a){b=[];for(e=d.length-1;0<=e;e--){var l=d[e];l.type===a&&(d.splice(e,1),b.splice(0,0,l),l._annotationModel=null)}}else b=d;this.onChanged({type:"Changed",
removed:b,added:[],changed:[]})},removeAnnotation:function(a){if(a){var d=this._getAnnotationIndex(a);0>d||(a._annotationModel=null,a={type:"Changed",removed:this._annotations.splice(d,1),added:[],changed:[]},this.onChanged(a))}},replaceAnnotations:function(a,d){var b=this._annotations,e,l,f,h=[];if(a)for(e=a.length-1;0<=e;e--)f=a[e],l=this._getAnnotationIndex(f),0>l||(f._annotationModel=null,b.splice(l,1),h.splice(0,0,f));d||(d=[]);for(e=0;e<d.length;e++)f=d[e],l=g(b,f.start),f._annotationModel=
this,b.splice(l,0,f);this.onChanged({type:"Changed",removed:h,added:d,changed:[]})},setTextModel:function(a){this._model&&this._model.removeEventListener("Changed",this._listener.onChanged);(this._model=a)&&this._model.addEventListener("Changed",this._listener.onChanged)},_getAnnotationIndex:function(a){for(var d=this._annotations,b=g(d,a.start);b<d.length&&d[b].start===a.start;){if(d[b]===a)return b;b++}return-1},_onChanged:function(a){var d=a.start,b=a.addedCharCount,e=a.removedCharCount,l=this._annotations,
f=d+e;if(0<l.length){a={type:"Changed",added:[],removed:[],changed:[],textModelChangedEvent:a};b-=e;for(e=0;e<l.length;e++){var g=l[e];g.start>=f?(g._oldStart=g.start,g._oldEnd=g.end,g.start+=b,g.end+=b,a.changed.push(g)):g.end<=d||(g.start<d&&f<g.end?(g._oldStart=g.start,g._oldEnd=g.end,g.end+=b,a.changed.push(g)):(l.splice(e,1),a.removed.push(g),g._annotationModel=null,g.expand&&g.expand(),e--))}if(0<a.added.length||0<a.removed.length||0<a.changed.length)this.onChanged(a)}}};t.EventTarget.addMixin(p.prototype);
e.prototype={destroy:function(){var a=this._view;a&&(a.removeEventListener("Destroy",this._listener.onDestroy),a.removeEventListener("LineStyle",this._listener.onLineStyle),this.view=null);(a=this._annotationModel)&&a.removeEventListener("Changed",this._listener.onChanged)},_mergeStyle:function(a,d){if(d){a||(a={});a.styleClass=a.styleClass&&d.styleClass&&a.styleClass!==d.styleClass?a.styleClass+(" "+d.styleClass):d.styleClass;var b;d.tagName&&!a.tagName&&(a.tagName=d.tagName);if(d.style)for(b in a.style||
(a.style={}),d.style)a.style[b]||(a.style[b]=d.style[b]);if(d.attributes)for(b in a.attributes||(a.attributes={}),d.attributes)a.attributes[b]||(a.attributes[b]=d.attributes[b])}return a},_mergeStyleRanges:function(a,d){a||(a=[]);for(var b,e=g(a,d.start,!0);e<a.length&&d;e++){var l=a[e];if(d.end<=l.start)break;if(!(d.start>=l.end)){b=this._mergeStyle({},l.style);b=this._mergeStyle(b,d.style);var f=[];f.push(e,1);d.start<l.start&&f.push({start:d.start,end:l.start,style:d.style});d.start>l.start&&f.push({start:l.start,
end:d.start,style:l.style});f.push({start:Math.max(l.start,d.start),end:Math.min(l.end,d.end),style:b});d.end<l.end&&f.push({start:d.end,end:l.end,style:l.style});d=d.end>l.end?{start:l.end,end:d.end,style:d.style}:null;Array.prototype.splice.apply(a,f)}}d&&(b=this._mergeStyle({},d.style),a.splice(e,0,{start:d.start,end:d.end,style:b}));return a},_onAnnotationModelChanged:function(a){function d(a,d){f.getBaseModel&&(a=f.mapOffset(a,!0),d=f.mapOffset(d,!0));-1!==a&&-1!==d&&e.redrawRange(a,d)}function b(a,
m){for(var e=0;e<a.length;e++)if(l.isAnnotationTypeVisible(a[e].type)){var f=a[e];d(f.start,f.end);m&&(void 0!==f._oldStart&&f._oldEnd)&&d(f._oldStart,f._oldEnd)}}var e=this._view;if(e){var l=this,f=e.getModel();b(a.added);b(a.removed);b(a.changed,!0)}},_onDestroy:function(a){this.destroy()},_onLineStyle:function(a){var d=this._annotationModel,b=a.textView.getModel(),e=d.getTextModel(),l=a.lineStart,f=a.lineStart+a.lineText.length;e!==b&&(l=b.mapOffset(l),f=b.mapOffset(f));for(d=d.getAnnotations(l,
f);d.hasNext();)if(l=d.next(),this.isAnnotationTypeVisible(l.type)){if(l.rangeStyle){var f=l.start,g=l.end;e!==b&&(f=b.mapOffset(f,!0),g=b.mapOffset(g,!0));a.ranges=this._mergeStyleRanges(a.ranges,{start:f,end:g,style:l.rangeStyle})}l.lineStyle&&(a.style=this._mergeStyle({},a.style),a.style=this._mergeStyle(a.style,l.lineStyle))}}};h.addMixin(e.prototype);return{FoldingAnnotation:k,AnnotationType:r,AnnotationTypeList:h,AnnotationModel:p,AnnotationStyler:e}});
define("orion/editor/tooltip","i18n!orion/editor/nls/messages orion/editor/textView orion/editor/textModel orion/editor/projectionTextModel orion/editor/util orion/util".split(" "),function(n,t,r,k,f,h){function g(f){this._view=f;this._fadeDelay=500;this._hideDelay=200;this._showDelay=500;this._autoHideDelay=5E3;this._create(f.getOptions("parent").ownerDocument)}g.getTooltip=function(f){f._tooltip||(f._tooltip=new g(f));return f._tooltip};g.prototype={_create:function(g){if(!this._tooltipDiv){var e=
this._tooltipDiv=h.createElement(g,"div");e.tabIndex=0;e.className="textviewTooltip";e.setAttribute("aria-live","assertive");e.setAttribute("aria-atomic","true");var b=this._tooltipContents=h.createElement(g,"div");e.appendChild(b);g.body.appendChild(e);var a=this;f.addEventListener(e,"mouseover",function(d){a._hideDelay&&(d=a._getWindow(),a._delayedHideTimeout&&(d.clearTimeout(a._delayedHideTimeout),a._delayedHideTimeout=null),a._hideTimeout&&(d.clearTimeout(a._hideTimeout),a._hideTimeout=null),
a._nextTarget=null)},!1);f.addEventListener(e,"mouseout",function(d){d=d.relatedTarget||d.toElement;!(d===e||a._hasFocus())&&(!d||!f.contains(e,d))&&a._hide()},!1);f.addEventListener(e,"keydown",function(d){27===d.keyCode&&a._hide()},!1);f.addEventListener(g,"mousedown",this._mouseDownHandler=function(d){a.isVisible()&&(f.contains(e,d.target||d.srcElement)||a._hide())},!0);this._view.addEventListener("Destroy",function(){a.destroy()});this._hide()}},_getWindow:function(){var f=this._tooltipDiv.ownerDocument;
return f.defaultView||f.parentWindow},destroy:function(){if(this._tooltipDiv){this._hide();var g=this._tooltipDiv.parentNode;g&&g.removeChild(this._tooltipDiv);f.removeEventListener(this._tooltipDiv.ownerDocument,"mousedown",this._mouseDownHandler,!0);this._tooltipDiv=null}},_hasFocus:function(){var g=this._tooltipDiv;return!g?!1:f.contains(g,g.ownerDocument.activeElement)},hide:function(f){void 0===f&&(f=this._hideDelay);var e=this._getWindow();this._delayedHideTimeout&&(e.clearTimeout(this._delayedHideTimeout),
this._delayedHideTimeout=null);var b=this;f?b._delayedHideTimeout=e.setTimeout(function(){b._delayedHideTimeout=null;b._hide();b.setTarget(b._nextTarget,0)},f):(b._hide(),b.setTarget(b._nextTarget,0))},_hide:function(){var f=this._tooltipDiv;f&&(this._hasFocus()&&this._view.focus(),this._contentsView&&(this._contentsView.destroy(),this._contentsView=null),this._tooltipContents&&(this._tooltipContents.innerHTML=""),f.style.visibility="hidden",f=this._getWindow(),this._showTimeout&&(f.clearTimeout(this._showTimeout),
this._showTimeout=null),this._delayedHideTimeout&&(f.clearTimeout(this._delayedHideTimeout),this._delayedHideTimeout=null),this._hideTimeout&&(f.clearTimeout(this._hideTimeout),this._hideTimeout=null),this._fadeTimeout&&(f.clearInterval(this._fadeTimeout),this._fadeTimeout=null))},isVisible:function(){return this._tooltipDiv&&"visible"===this._tooltipDiv.style.visibility},setTarget:function(f,e,b){if(this.isVisible())this._hasFocus()||(this._nextTarget=f,this.hide(b));else if(this._target=f){var a=
this;f=a._getWindow();a._showTimeout&&(f.clearTimeout(a._showTimeout),a._showTimeout=null);0===e?a.show(!0):a._showTimeout=f.setTimeout(function(){a._showTimeout=null;a.show(!0)},e?e:a._showDelay)}},show:function(f){if(this._target){var e=this._target.getTooltipInfo();if(e){var b=this._tooltipDiv,a=this._tooltipContents;b.style.left=b.style.right=b.style.width=b.style.height=a.style.width=a.style.height="auto";var d=e.contents;d instanceof Array&&(d=this._getAnnotationContents(d));if("string"===typeof d)a.innerHTML=
d;else if(this._isNode(d))a.appendChild(d);else if(d instanceof k.ProjectionTextModel){var m=this._view,s=m.getOptions();s.wrapMode=!1;s.parent=a;var l=s.themeClass;l?((l=l.replace("tooltipTheme",""))&&(l=" "+l),l="tooltipTheme"+l):l="tooltipTheme";s.themeClass=l;s=this._contentsView=new t.TextView(s);s.addEventListener("LineStyle",function(a){m.onLineStyle(a)});s.setModel(d);d=s.computeSize();a.style.width=d.width+"px";a.style.height=d.height+"px";s.resize()}else return;a=b.ownerDocument.documentElement;
"right"===e.anchor?(d=a.clientWidth-e.x,b.style.right=d+"px"):(d=parseInt(this._getNodeStyle(b,"padding-left","0"),10),d+=parseInt(this._getNodeStyle(b,"border-left-width","0"),10),d=e.x-d,b.style.left=d+"px");b.style.maxWidth=a.clientWidth-d-10+"px";d=parseInt(this._getNodeStyle(b,"padding-top","0"),10);d+=parseInt(this._getNodeStyle(b,"border-top-width","0"),10);d=e.y-d;b.style.top=d+"px";b.style.maxHeight=a.clientHeight-d-10+"px";b.style.opacity="1";b.style.visibility="visible";if(f){var g=this,
h=this._getWindow();g._hideTimeout=h.setTimeout(function(){g._hideTimeout=null;var a=parseFloat(g._getNodeStyle(b,"opacity","1"));g._fadeTimeout=h.setInterval(function(){"visible"===b.style.visibility&&0<a?(a-=0.1,b.style.opacity=a):g._hide()},g._fadeDelay/10)},g._autoHideDelay)}}}},_getAnnotationContents:function(g){function e(a,d){var b=A.getLineStart(A.getLineAtOffset(a)),m=A.getLineEnd(A.getLineAtOffset(d),!0);return A.getText(b,m)}function b(a){var d=a.title,b=h.createElement(l,"div");b.className=
"tooltipRow";a.html&&(b.innerHTML=a.html,b.lastChild&&f.addEventListener(b.lastChild,"click",function(d){d=a.start;var b=a.end;v.getBaseModel&&(d=v.mapOffset(d,!0),b=v.mapOffset(b,!0));u.setSelection(d,b,1/3,function(){s._hide()})},!1),b.appendChild(l.createTextNode("\u00a0")));d||(d=e(a.start,a.end));"function"===typeof d&&(d=a.title());if("string"===typeof d){var m=h.createElement(l,"span");m.appendChild(l.createTextNode(d));d=m}b.appendChild(d);return b}for(var a,d=[],m=0;m<g.length;m++)a=g[m],
""!==a.title&&!a.groupAnnotation&&d.push(a);g=d;if(0===g.length)return null;var s=this,l=this._tooltipDiv.ownerDocument,u=this._view,v=u.getModel(),A=v.getBaseModel?v.getBaseModel():v;if(1===g.length){a=g[0];if(void 0!==a.title)return a=b(a),a.firstChild&&((g=a.firstChild.className)&&(g+=" "),a.firstChild.className=g+"single"),a;g=new k.ProjectionTextModel(A);d=A.getLineStart(A.getLineAtOffset(a.start));m=A.getCharCount();a.end!==m&&g.addProjection({start:a.end,end:m});0<d&&g.addProjection({start:0,
end:d});return g}d=h.createElement(l,"div");a=h.createElement(l,"em");a.appendChild(l.createTextNode(n.multipleAnnotations));d.appendChild(a);for(m=0;m<g.length;m++)a=g[m],(a=b(a))&&d.appendChild(a);return d},_getNodeStyle:function(f,e,b){var a;if(f&&(a=f.style[e],!a))if(f.currentStyle){for(a=0;-1!==(a=e.indexOf("-",a));)e=e.substring(0,a)+e.substring(a+1,a+2).toUpperCase()+e.substring(a+2);a=f.currentStyle[e]}else a=(f=f.ownerDocument.defaultView.getComputedStyle(f,null))?f.getPropertyValue(e):null;
return a||b},_isNode:function(f){return"object"===typeof Node?f instanceof Node:f&&"object"===typeof f&&"number"===typeof f.nodeType&&"string"===typeof f.nodeName}};return{Tooltip:g}});
define("orion/editor/rulers",["i18n!orion/editor/nls/messages","orion/editor/annotations","orion/editor/tooltip","orion/util"],function(n,t,r,k){function f(b,a,d,m){this._location=a||"left";this._overview=d||"page";this._rulerStyle=m;this._view=null;var e=this;this._listener={onTextModelChanged:function(a){e._onTextModelChanged(a)},onAnnotationModelChanged:function(a){e._onAnnotationModelChanged(a)}};this.setAnnotationModel(b)}function h(b,a,d,m,e){f.call(this,b,a,"page",d);this._oddStyle=m||{style:{backgroundColor:"white"}};
this._evenStyle=e||{style:{backgroundColor:"white"}};this._numOfDigits=0;this._firstLine=1}function g(b,a,d){f.call(this,b,a,"page",d)}function p(b,a,d){f.call(this,b,a,"document",d)}function e(b,a,d){g.call(this,b,a,d)}f.prototype={getAnnotations:function(b,a){var d=this._annotationModel;if(!d)return[];var m=this._view.getModel(),e=m.getLineStart(b),l=m.getLineEnd(a-1),f=m;m.getBaseModel&&(f=m.getBaseModel(),e=m.mapOffset(e),l=m.mapOffset(l));for(var g=[],d=this.getAnnotationsByType(d,e,l),e=0;e<
d.length;e++)for(var l=d[e],h=f.getLineAtOffset(l.start),p=f.getLineAtOffset(Math.max(l.start,l.end-1)),k=h;k<=p;k++){var n=k;if(m!==f){n=f.getLineStart(k);n=m.mapOffset(n,!0);if(-1===n)continue;n=m.getLineAtOffset(n)}if(b<=n&&n<a){var r=this._mergeAnnotation(g[n],l,k-h,p-h+1);r&&(g[n]=r)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var q in g)g[q]._multiple&&(g[q].html+=this._multiAnnotationOverlay.html);return g},getAnnotationModel:function(){return this._annotationModel},getLocation:function(){return this._location},
getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},getView:function(){return this._view},getWidestAnnotation:function(){return null},setAnnotationModel:function(b){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged);(this._annotationModel=b)&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(b){this._multiAnnotation=b},setMultiAnnotationOverlay:function(b){this._multiAnnotationOverlay=
b},setView:function(b){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged);this._view=b;this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)},onClick:function(b,a){if(void 0!==b){var d=this._view,m=d.getModel(),e=m,l=m.getLineStart(b),f=l,g=l,h=this._annotationModel;if(h){d=d.getSelection();g=m.getLineEnd(b,!0);l<=d.start&&d.start<g&&(l=d.start);m.getBaseModel&&(l=m.mapOffset(l),
g=m.mapOffset(g),e=m.getBaseModel());for(var p,g=h.getAnnotations(l,g),h=null;!p&&g.hasNext();)d=g.next(),this.isAnnotationTypeVisible(d.type)&&(h=d,d.start<=l||(p=d));h&&void 0!==h.groupId&&(this._currentClickGroup=this._currentClickGroup===h.groupId?null:h.groupId,this._setCurrentGroup(b));p&&e.getLineAtOffset(p.start)===e.getLineAtOffset(l)?(l=p.start,g=p.end):g=l=f;m.getBaseModel&&(l=m.mapOffset(l,!0),g=m.mapOffset(g,!0))}(m=r.Tooltip.getTooltip(this._view))&&m.setTarget(null);this._view.setSelection(g,
l,1/3,function(){})}},onDblClick:function(b,a){},onMouseMove:function(b,a){var d=r.Tooltip.getTooltip(this._view);if(d&&!(d.isVisible()&&this._tooltipLineIndex===b)){this._tooltipLineIndex=b;var m=this;d.setTarget({y:a.clientY,getTooltipInfo:function(){return m._getTooltipInfo(m._tooltipLineIndex,this.y)}})}},onMouseOver:function(b,a){this.onMouseMove(b,a);this._currentClickGroup||this._setCurrentGroup(b)},onMouseOut:function(b,a){this._currentClickGroup||this._setCurrentGroup(-1);var d=r.Tooltip.getTooltip(this._view);
d&&d.setTarget(null)},_getTooltipInfo:function(b,a){if(void 0!==b){var d=this._view,m=d.getModel(),e=this._annotationModel,l=[];if(e){var l=m.getLineStart(b),f=m.getLineEnd(b);m.getBaseModel&&(l=m.mapOffset(l),f=m.mapOffset(f));l=this.getAnnotationsByType(e,l,f)}e=this._getTooltipContents(b,l);if(!e)return null;e={contents:e,anchor:this.getLocation()};l=d.getClientArea();"document"===this.getOverview()?l.y=d.convert({y:a},"view","document").y:l.y=d.getLocationAtOffset(m.getLineStart(b)).y;d.convert(l,
"document","page");e.x=l.x;e.y=l.y;"right"===e.anchor&&(e.x+=l.width);return e}},_getTooltipContents:function(b,a){return a},_onAnnotationModelChanged:function(b){function a(a){for(var b=0;b<a.length;b++)if(e.isAnnotationTypeVisible(a[b].type)){var l=a[b].start,f=a[b].end;m.getBaseModel&&(l=m.mapOffset(l,!0),f=m.mapOffset(f,!0));-1!==l&&-1!==f&&d.redrawLines(m.getLineAtOffset(l),m.getLineAtOffset(Math.max(l,f-1))+1,e)}}var d=this._view;if(d){var m=d.getModel(),e=this,l=m.getLineCount();b.textModelChangedEvent?
(b=b.textModelChangedEvent.start,m.getBaseModel&&(b=m.mapOffset(b,!0)),b=m.getLineAtOffset(b),d.redrawLines(b,l,e)):(a(b.added),a(b.removed),a(b.changed))}},_mergeAnnotation:function(b,a,d,m){b||(b={});0===d&&(b.html&&a.html?(a.html!==b.html&&(!b._multiple&&this._multiAnnotation)&&(b.html=this._multiAnnotation.html),b._multiple=!0):b.html=a.html);b.style=this._mergeStyle(b.style,a.style);return b},_mergeStyle:function(b,a){if(a){b||(b={});b.styleClass=b.styleClass&&a.styleClass&&b.styleClass!==a.styleClass?
b.styleClass+(" "+a.styleClass):a.styleClass;var d;if(a.style)for(d in b.style||(b.style={}),a.style)void 0===b.style[d]&&(b.style[d]=a.style[d]);if(a.attributes)for(d in b.attributes||(b.attributes={}),a.attributes)void 0===b.attributes[d]&&(b.attributes[d]=a.attributes[d])}return b},_setCurrentGroup:function(b){var a=this._annotationModel,d=null,m=a.getTextModel(),e,l=this._currentGroupAnnotation;if(-1!==b){var f=m.getLineStart(b),g=m.getLineEnd(b);m.getBaseModel&&(f=m.mapOffset(f),g=m.mapOffset(g));
for(e=a.getAnnotations(f,g);e.hasNext();)if(m=e.next(),this.isAnnotationTypeVisible(m.type)&&m.start<=f&&m.end>=g&&void 0!==m.groupId){d=m;break}if(l&&d&&l.groupId===d.groupId)return}this._currentGroupAnnotation=null;l&&a.removeAnnotations(l.groupType);if(d&&-1!==b){this._currentGroupAnnotation=d;e=a.getAnnotations();for(b=[];e.hasNext();)m=e.next(),delete m.groupAnnotation,m.groupId===d.groupId&&(m=m.createGroupAnnotation(),b.push(m));a.replaceAnnotations(null,b)}}};t.AnnotationTypeList.addMixin(f.prototype);
h.prototype=new f;h.prototype.getAnnotations=function(b,a){for(var d=f.prototype.getAnnotations.call(this,b,a),m=this._view.getModel(),e=b;e<a;e++){var l=e&1?this._oddStyle:this._evenStyle,g=e;m.getBaseModel&&(g=m.getLineStart(g),g=m.getBaseModel().getLineAtOffset(m.mapOffset(g)));d[e]||(d[e]={});d[e].html=this._firstLine+g+"";d[e].style||(d[e].style=l)}return d};h.prototype.getWidestAnnotation=function(){var b=this._view.getModel().getLineCount();return this.getAnnotations(b-1,b)[b-1]};h.prototype.setFirstLine=
function(b){this._firstLine=void 0!==b?b:1};h.prototype._onTextModelChanged=function(b){var a=b.start;b=this._view.getModel();var d=b.getBaseModel?b.getBaseModel().getLineCount():b.getLineCount(),d=(this._firstLine+d-1+"").length;this._numOfDigits!==d&&(this._numOfDigits=d,a=b.getLineAtOffset(a),this._view.redrawLines(a,b.getLineCount(),this))};g.prototype=new f;p.prototype=new f;p.prototype.getRulerStyle=function(){var b={style:{lineHeight:"1px",fontSize:"1px"}};return b=this._mergeStyle(b,this._rulerStyle)};
p.prototype._getTooltipContents=function(b,a){if(0===a.length){var d=this._view.getModel(),e=b;d.getBaseModel&&(e=d.getLineStart(e),e=d.getBaseModel().getLineAtOffset(d.mapOffset(e)));return k.formatMessage(n.line,e+1)}return f.prototype._getTooltipContents.call(this,b,a)};p.prototype._mergeAnnotation=function(b,a,d,e){if(0===d)return b||(b={html:"\x26nbsp;",style:{style:{height:3*e+"px"}}},b.style=this._mergeStyle(b.style,a.overviewStyle)),b};e.prototype=new g;e.prototype.onClick=function(b,a){if(void 0!==
b){var d=this._annotationModel;if(d){var e=this._view.getModel(),f=e.getLineStart(b),l=e.getLineEnd(b,!0);e.getBaseModel&&(f=e.mapOffset(f),l=e.mapOffset(l),e=e.getBaseModel());for(var g,d=d.getAnnotations(f,l);!g&&d.hasNext();)l=d.next(),this.isAnnotationTypeVisible(l.type)&&e.getLineAtOffset(l.start)===e.getLineAtOffset(f)&&(g=l);g&&((e=r.Tooltip.getTooltip(this._view))&&e.setTarget(null),g.expanded?g.collapse():g.expand())}}};e.prototype._getTooltipContents=function(b,a){if(0<a.length){var d=this._view.getModel(),
e=d.getLineStart(b);d.getBaseModel&&(e=d.mapOffset(e),d=d.getBaseModel());for(var e=d.getLineAtOffset(e),f=0;f<a.length;f++){var l=a[f];if(this.isAnnotationTypeVisible(l.type)&&d.getLineAtOffset(l.start)===e){if(a[f].expanded)break;return g.prototype._getTooltipContents.call(this,b,[l])}}}return null};e.prototype._onAnnotationModelChanged=function(b){function a(a){for(l=0;l<a.length;l++)if(f.isAnnotationTypeVisible(a[l].type)){var d=a[l].start;e.getBaseModel&&(d=e.mapOffset(d,!0));-1!==d&&(p=Math.min(p,
e.getLineAtOffset(d)))}}if(b.textModelChangedEvent)g.prototype._onAnnotationModelChanged.call(this,b);else{var d=this._view;if(d){var e=d.getModel(),f=this,l,h=e.getLineCount(),p=h;a(b.added);a(b.removed);a(b.changed);b=d.getRulers();for(l=0;l<b.length;l++)d.redrawLines(p,h,b[l])}}};return{Ruler:f,AnnotationRuler:g,LineNumberRuler:h,OverviewRuler:p,FoldingRuler:e}});
define("orion/editor/undoStack",[],function(){function n(k,f,h,g,p){this.model=k;this.offset=f;this.text=h;this.previousText=g;this.type=p}function t(k){this.owner=k;this.changes=[]}function r(k,f){this.size=void 0!==f?f:100;this.reset();var h=this;this._listener={onChanging:function(f){h._onChanging(f)},onDestroy:function(f){h._onDestroy(f)}};if(k.getModel){var g=k.getModel();g.getBaseModel&&(g=g.getBaseModel());this.model=g;this.setView(k)}else this.shared=!0,this.model=k;this.model.addEventListener("Changing",
this._listener.onChanging)}n.prototype={getRedoChanges:function(){return[{start:this.offset,end:this.offset+this.previousText.length,text:this.text}]},getUndoChanges:function(){return[{start:this.offset,end:this.offset+this.text.length,text:this.previousText}]},undo:function(k,f){this._doUndoRedo(this.offset,this.previousText,this.text,k,f);return!0},redo:function(k,f){this._doUndoRedo(this.offset,this.text,this.previousText,k,f);return!0},merge:function(k,f,h,g,p){if(g===this.type){if(1===g&&k===
this.offset+this.text.length)return this.text+=f,!0;if(-1===g&&p===this.offset)return this.offset=k,this.previousText=h+this.previousText,!0;if(-1===g&&k===this.offset)return this.previousText+=h,!0}return!1},_doUndoRedo:function(k,f,h,g,p){this.model.setText(f,k,k+h.length);p&&g&&(h=g.getModel(),h!==this.model&&(k=h.mapOffset(k,!0)),g.setSelection(k,k+f.length))}};t.prototype={getRedoChanges:function(){for(var k=[],f=0;f<this.changes.length;f++)k=k.concat(this.changes[f].getRedoChanges());return k},
getUndoChanges:function(){for(var k=[],f=this.changes.length-1;0<=f;f--)k=k.concat(this.changes[f].getUndoChanges());return k},add:function(k){this.changes.push(k)},end:function(k){k&&(this.endSelection=k.getSelection(),this.endCaret=k.getCaretOffset());(k=this.owner)&&k.end&&k.end()},undo:function(k,f){1<this.changes.length&&k&&k.setRedraw(!1);for(var h=this.changes.length-1;0<=h;h--)this.changes[h].undo(k,!1);1<this.changes.length&&k&&k.setRedraw(!0);if(f&&k){var h=this.startSelection.start,g=this.startSelection.end;
k.setSelection(this.startCaret?h:g,this.startCaret?g:h)}(h=this.owner)&&h.undo&&h.undo();return 0<this.changes.length},redo:function(k,f){1<this.changes.length&&k&&k.setRedraw(!1);for(var h=0;h<this.changes.length;h++)this.changes[h].redo(k,!1);(1<this.changes.length,k)&&k.setRedraw(!0);if(f&&k){var h=this.endSelection.start,g=this.endSelection.end;k.setSelection(this.endCaret?h:g,this.endCaret?g:h)}(h=this.owner)&&h.redo&&h.redo();return 0<this.changes.length},merge:function(k,f,h,g,p){var e=this.changes.length;
return 0<e?this.changes[e-1].merge(k,f,h,g,p):!1},start:function(k){k&&(this.startSelection=k.getSelection(),this.startCaret=k.getCaretOffset());(k=this.owner)&&k.start&&k.start()}};r.prototype={destroy:function(){this._onDestroy()},add:function(k){this.compoundChange?this.compoundChange.add(k):(this.stack.splice(this.index,this.stack.length-this.index,k),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--))},markClean:function(){this._commitUndo();if(this.cleanChange=this.stack[this.index-
1])this.cleanChange.type=2},isClean:function(){return this.cleanChange===this.stack[this.index-1]},canUndo:function(){return 0<this.index},canRedo:function(){return 0<this.stack.length-this.index},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view);this.compoundChange=void 0},getSize:function(){return{undo:this.index,redo:this.stack.length-this.index}},getRedoChanges:function(){this._commitUndo();for(var k=[],f=this.index;f<this.stack.length;f++)k=k.concat(this.stack[f].getRedoChanges());
return k},getUndoChanges:function(){this._commitUndo();for(var k=[],f=this.index;0<=f;f--)k=k.concat(this.stack[f].getUndoChanges());return k},undo:function(){this._commitUndo();var k;k=!1;this._ignoreUndo=!0;do{if(0>=this.index)break;k=this.stack[--this.index]}while(!(k=k.undo(this.view,!0)));this._ignoreUndo=!1;return k},redo:function(){this._commitUndo();var k;this._ignoreUndo=!0;do{if(this.index>=this.stack.length)break;k=this.stack[this.index++]}while(!k.redo(this.view,!0));this._ignoreUndo=
!1;return!0},reset:function(){this.index=0;this.cleanChange=void 0;this.stack=[];this._ignoreUndo=!1;this._compoundChange=void 0},setView:function(k){this.view!==k&&(this.view&&k.removeEventListener("Destroy",this._listener.onDestroy),(this.view=k)&&k.addEventListener("Destroy",this._listener.onDestroy))},startCompoundChange:function(k){this._commitUndo();k=new t(k);this.add(k);this.compoundChange=k;this.compoundChange.start(this.view);return this.compoundChange},_commitUndo:function(){this.endCompoundChange()},
_onDestroy:function(k){(!k||!this.shared)&&this.model.removeEventListener("Changing",this._listener.onChanging);this.view&&(this.view.removeEventListener("Destroy",this._listener.onDestroy),this.view=null)},_onChanging:function(k){if(!this._ignoreUndo){var f=k.text,h=k.start,g=k.addedCharCount,p=k.removedCharCount;k=h+p;var e=0;0===g&&1===p?e=-1:1===g&&0===p&&(e=1);g=this.stack.length;p=this.model.getText(h,k);(!(0<g&&this.index===g)||!this.stack[g-1].merge(h,f,p,e,k))&&this.add(new n(this.model,
h,f,p,e))}}};return{UndoStack:r}});
define("orion/editor/textDND",["orion/util"],function(n){function t(n,k){this._view=n;this._undoStack=k;this._dragSelection=null;this._dropOffset=-1;this._dropText=null;var f=this;this._listener={onDragStart:function(h){f._onDragStart(h)},onDragEnd:function(h){f._onDragEnd(h)},onDragEnter:function(h){f._onDragEnter(h)},onDragOver:function(h){f._onDragOver(h)},onDrop:function(h){f._onDrop(h)},onDestroy:function(h){f._onDestroy(h)}};n.addEventListener("DragStart",this._listener.onDragStart);n.addEventListener("DragEnd",
this._listener.onDragEnd);n.addEventListener("DragEnter",this._listener.onDragEnter);n.addEventListener("DragOver",this._listener.onDragOver);n.addEventListener("Drop",this._listener.onDrop);n.addEventListener("Destroy",this._listener.onDestroy)}t.prototype={destroy:function(){var n=this._view;n&&(n.removeEventListener("DragStart",this._listener.onDragStart),n.removeEventListener("DragEnd",this._listener.onDragEnd),n.removeEventListener("DragEnter",this._listener.onDragEnter),n.removeEventListener("DragOver",
this._listener.onDragOver),n.removeEventListener("Drop",this._listener.onDrop),n.removeEventListener("Destroy",this._listener.onDestroy),this._view=null)},_onDestroy:function(n){this.destroy()},_onDragStart:function(n){var k=this._view,f=k.getSelection(),k=k.getModel();k.getBaseModel&&(f.start=k.mapOffset(f.start),f.end=k.mapOffset(f.end),k=k.getBaseModel());if(k=k.getText(f.start,f.end))this._dragSelection=f,n.event.dataTransfer.effectAllowed="copyMove",n.event.dataTransfer.setData("Text",k)},_onDragEnd:function(r){if(this._dragSelection){var k=
this._view,f=r.event.dataTransfer.dropEffect;if(!n.isFirefox&&("none"!==f||this._dropText))f=r.event.dataTransfer.dropEffect=this._dropEffect;this._undoStack&&this._undoStack.startCompoundChange();(r="move"===f)&&k.setText("",this._dragSelection.start,this._dragSelection.end);if(this._dropText){var f=this._dropText,h=this._dropOffset;r&&(h>=this._dragSelection.end?h-=this._dragSelection.end-this._dragSelection.start:h>=this._dragSelection.start&&(h=this._dragSelection.start));k.setText(f,h,h);k.setSelection(h,
h+f.length);this._dropText=null;this._dropOffset=-1}this._undoStack&&this._undoStack.endCompoundChange()}this._dragSelection=null},_onDragEnter:function(n){this._onDragOver(n)},_onDragOver:function(r){var k=r.event.dataTransfer.types,f=!this._view.getOptions("readonly");f&&k&&(f=k.contains?k.contains("text/plain")||k.contains("Text"):-1!==k.indexOf("text/plain")||-1!==k.indexOf("Text"));f?n.isFirefox||(this._dropEffect=r.event.dataTransfer.dropEffect=(n.isMac?r.event.altKey:r.event.ctrlKey)?"copy":
"move"):r.event.dataTransfer.dropEffect="none"},_onDrop:function(r){var k=this._view,f=r.event.dataTransfer.getData("Text");f&&(n.isFirefox||(r.event.dataTransfer.dropEffect=this._dropEffect),r=k.getOffsetAtLocation(r.x,r.y),this._dragSelection?(this._dropOffset=r,this._dropText=f):(k.setText(f,r,r),k.setSelection(r,r+f.length)))}};return{TextDND:t}});
define("orion/objects",[],function(){function n(n){for(var r=Object.prototype.hasOwnProperty,k=1,f=arguments.length;k<f;k++){var h=arguments[k],g;for(g in h)r.call(h,g)&&(n[g]=h[g])}return n}return{clone:function(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var r=Object.create(Object.getPrototypeOf(t));n(r,t);return r},mixin:n,toArray:function(n){return Array.isArray(n)?n:[n]}}});
define("orion/editor/editor","i18n!orion/editor/nls/messages orion/editor/eventTarget orion/editor/tooltip orion/editor/annotations orion/objects orion/util".split(" "),function(n,t,r,k,f,h){function g(b){b=b||{};this._domNode=b.domNode;this._model=b.model;this._undoStack=b.undoStack;this._statusReporter=b.statusReporter;this._title=null;var a=this;this._listener={onChanged:function(d){a.onChanged(d)}};this._model&&this._model.addEventListener("Changed",this._listener.onChanged);this.checkDirty()}
function p(b){b=b||{};g.call(this,b);this._textViewFactory=b.textViewFactory;this._undoStackFactory=b.undoStackFactory;this._textDNDFactory=b.textDNDFactory;this._annotationFactory=b.annotationFactory;this._foldingRulerFactory=b.foldingRulerFactory;this._lineNumberRulerFactory=b.lineNumberRulerFactory;this._contentAssistFactory=b.contentAssistFactory;this._keyBindingFactory=b.keyBindingFactory;this._contentAssist=this._foldingRuler=this._overviewRuler=this._lineNumberRuler=this._annotationRuler=this._annotationModel=
this._annotationStyler=null}var e=k.AnnotationType;g.prototype={destroy:function(){this.uninstall();this._statusReporter=this._domNode=null;this._model&&this._model.removeEventListener("Changed",this._listener.onChanged)},checkDirty:function(){this.setDirty(this._undoStack&&!this._undoStack.isClean())},focus:function(){},getModel:function(){return this._model},getText:function(b,a){return this.getModel().getText(b,a)},getTitle:function(){return this._title},getUndoStack:function(){return this._undoStack},
install:function(){this.installed=!0},isDirty:function(){return this._dirty},markClean:function(){this.getUndoStack().markClean();this.setDirty(!1)},onDirtyChanged:function(b){return this.dispatchEvent(b)},onInputChanged:function(b){return this.dispatchEvent(b)},onChanged:function(b){this.checkDirty()},reportStatus:function(b,a,d){this._statusReporter&&this._statusReporter(b,a,d)},resize:function(){},setDirty:function(b){this._dirty!==b&&(this._dirty=b,this.onDirtyChanged({type:"DirtyChanged"}))},
_setModelText:function(b){this._model&&this._model.setText(b)},setInput:function(b,a,d,e){this._title=b;e||(a?this.reportStatus(a,"error"):null!==d&&(void 0!==d&&"string"===typeof d)&&this._setModelText(d),this._undoStack&&this._undoStack.reset());this.checkDirty();this.onInputChanged({type:"InputChanged",title:b,message:a,contents:d,contentsSaved:e})},setText:function(b,a,d){this.getModel().setText(b,a,d)},uninstall:function(){this.installed=!1}};t.EventTarget.addMixin(g.prototype);p.prototype=new g;
f.mixin(p.prototype,{destroy:function(){g.prototype.destroy.call(this);this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},getContentAssist:function(){return this._contentAssist},
getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getModel:function(){if(!this._textView)return null;var b=this._textView.getModel();b.getBaseModel&&(b=b.getBaseModel());return b},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getKeyModes:function(){return this._textView.getKeyModes()},getSourceCodeActions:function(){return this._sourceCodeActions},getLinkedMode:function(){return this._linkedMode},
getTextActions:function(){return this._textActions},focus:function(){this._textView&&this._textView.focus()},resize:function(){this._textView&&this._textView.resize()},setAnnotationRulerVisible:function(b,a){if(this._annotationRulerVisible!==b||a)if(this._annotationRulerVisible=b,this._annotationRuler){var d=this._textView;b?d.addRuler(this._annotationRuler,0):d.removeRuler(this._annotationRuler)}},setFoldingRulerVisible:function(b,a){if(this._foldingRulerVisible!==b||a)if(this._foldingRulerVisible=
b,this._foldingRuler){var d=this._textView;d.getModel().getBaseModel&&(b?d.addRuler(this._foldingRuler):d.removeRuler(this._foldingRuler))}},setLineNumberRulerVisible:function(b,a){if(this._lineNumberRulerVisible!==b||a)if(this._lineNumberRulerVisible=b,this._lineNumberRuler){var d=this._textView;b?d.addRuler(this._lineNumberRuler,!this._annotationRulerVisible?0:1):d.removeRuler(this._lineNumberRuler)}},setOverviewRulerVisible:function(b,a){if(this._overviewRulerVisible!==b||a)if(this._overviewRulerVisible=
b,this._overviewRuler){var d=this._textView;b?d.addRuler(this._overviewRuler):d.removeRuler(this._overviewRuler)}},mapOffset:function(b,a){var d=this._textView.getModel();d.getBaseModel&&(b=d.mapOffset(b,a));return b},getLineAtOffset:function(b){return this.getModel().getLineAtOffset(this.mapOffset(b))},getLineStart:function(b){return this.getModel().getLineStart(b)},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelection:function(){var b=this._textView,a=b.getSelection(),
b=b.getModel();b.getBaseModel&&(a.start=b.mapOffset(a.start),a.end=b.mapOffset(a.end));return a},_expandOffset:function(b){var a=this._textView.getModel(),d=this._annotationModel;if(d&&a.getBaseModel)for(b=d.getAnnotations(b,b+1);b.hasNext();)a=b.next(),a.type===e.ANNOTATION_FOLDING&&a.expand&&a.expand()},setCaretOffset:function(b,a,d){var e=this._textView,f=e.getModel();f.getBaseModel&&(this._expandOffset(b),b=f.mapOffset(b,!0));e.setCaretOffset(b,a,d)},setText:function(b,a,d){var e=this._textView,
f=e.getModel();f.getBaseModel&&(void 0!==a&&(this._expandOffset(a),a=f.mapOffset(a,!0)),void 0!==d&&(this._expandOffset(d),d=f.mapOffset(d,!0)));e.setText(b,a,d)},setSelection:function(b,a,d,e){var f=this._textView,l=f.getModel();l.getBaseModel&&(this._expandOffset(b),this._expandOffset(a),b=l.mapOffset(b,!0),a=l.mapOffset(a,!0));f.setSelection(b,a,d,e)},moveSelection:function(b,a,d,e){var f=this._textView;this.setSelection(b,a||b,1/3,function(){(void 0===e||e)&&f.focus();d&&d()})},_getTooltipInfo:function(b,
a){var d=this._textView,e=this.getAnnotationModel();if(!e)return null;var f=this._annotationStyler;if(!f)return null;var l=d.getOffsetAtLocation(b,a);if(-1===l)return null;l=this.mapOffset(l);f=f.getAnnotationsByType(e,l,l+1);e=[];for(l=0;l<f.length;l++)f[l].rangeStyle&&e.push(f[l]);if(0===e.length)return null;d=d.convert({x:b,y:a},"document","page");return{contents:e,anchor:"left",x:d.x+10,y:d.y+20}},_highlightCurrentLine:function(b,a){var d=this._annotationModel;if(d){var m=this._textView;if(!m.getOptions("singleMode")){var f=
m.getModel(),l=a?f.getLineAtOffset(a.start):-1,g=f.getLineAtOffset(b.start),m=b.start===b.end,h=!a||a.start===a.end,p=f.getLineStart(g),k=f.getLineEnd(g);f.getBaseModel&&(p=f.mapOffset(p),k=f.mapOffset(k));f=this._currentLineAnnotation;if(!(l===g&&h&&m&&f&&f.start===p&&f.end===k)){var l=f?[f]:null,n;m&&(f=e.createAnnotation(e.ANNOTATION_CURRENT_LINE,p,k),n=[f]);this._currentLineAnnotation=f;d.replaceAnnotations(l,n)}}}},installTextView:function(){this.install()},install:function(){if(!this._textView){this._textView=
this._textViewFactory();this._undoStackFactory&&(this._undoStack=this._undoStackFactory.createUndoStack(this),this.checkDirty());this._textDNDFactory&&(this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack));this._contentAssistFactory&&(this._contentAssist=this._contentAssistFactory.createContentAssistMode(this).getContentAssist());var b=this,a=this._textView,d=this;this._listener={onModelChanged:function(a){d.checkDirty()},onMouseOver:function(a){d._listener.onMouseMove(a)},onMouseMove:function(b){var e=
r.Tooltip.getTooltip(a);e&&!(d._listener.lastMouseX===b.event.clientX&&d._listener.lastMouseY===b.event.clientY)&&(d._listener.lastMouseX=b.event.clientX,d._listener.lastMouseY=b.event.clientY,e.setTarget({x:b.x,y:b.y,getTooltipInfo:function(){return d._getTooltipInfo(this.x,this.y)}}))},onMouseOut:function(b){var e=r.Tooltip.getTooltip(a);e&&!(d._listener.lastMouseX===b.event.clientX&&d._listener.lastMouseY===b.event.clientY)&&(d._listener.lastMouseX=b.event.clientX,d._listener.lastMouseY=b.event.clientY,
e.setTarget(null))},onScroll:function(d){(d=r.Tooltip.getTooltip(a))&&d.setTarget(null,0,0)},onSelection:function(a){d._updateCursorStatus();d._highlightCurrentLine(a.newValue,a.oldValue)}};a.addEventListener("ModelChanged",this._listener.onModelChanged);a.addEventListener("Selection",this._listener.onSelection);a.addEventListener("MouseOver",this._listener.onMouseOver);a.addEventListener("MouseOut",this._listener.onMouseOut);a.addEventListener("MouseMove",this._listener.onMouseMove);a.addEventListener("Scroll",
this._listener.onScroll);if(this._keyBindingFactory){var m;if(m="function"===typeof this._keyBindingFactory?this._keyBindingFactory(this,this.getKeyModes(),this._undoStack,this._contentAssist):this._keyBindingFactory.createKeyBindings(b,this._undoStack,this._contentAssist))this._textActions=m.textActions,this._linkedMode=m.linkedMode,this._sourceCodeActions=m.sourceCodeActions}m=function(a,d){if(void 0!==a&&-1!==a){for(var m=this.getView().getModel(),l=this.getAnnotationModel(),f=b.mapOffset(m.getLineStart(a)),
m=b.mapOffset(m.getLineEnd(a)),g=l.getAnnotations(f,m),s=null;g.hasNext();){var h=g.next();if(h.type===e.ANNOTATION_BOOKMARK){s=h;break}}s?l.removeAnnotation(s):(s=e.createAnnotation(e.ANNOTATION_BOOKMARK,f,m),s.title=void 0,l.addAnnotation(s))}};if(this._annotationFactory){var f=a.getModel();f.getBaseModel&&(f=f.getBaseModel());if(this._annotationModel=this._annotationFactory.createAnnotationModel(f))if(f=this._annotationStyler=this._annotationFactory.createAnnotationStyler(a,this._annotationModel))f.addAnnotationType(e.ANNOTATION_CURRENT_SEARCH),
f.addAnnotationType(e.ANNOTATION_MATCHING_SEARCH),f.addAnnotationType(e.ANNOTATION_ERROR),f.addAnnotationType(e.ANNOTATION_WARNING),f.addAnnotationType(e.ANNOTATION_MATCHING_BRACKET),f.addAnnotationType(e.ANNOTATION_CURRENT_BRACKET),f.addAnnotationType(e.ANNOTATION_CURRENT_LINE),f.addAnnotationType(e.ANNOTATION_READ_OCCURRENCE),f.addAnnotationType(e.ANNOTATION_WRITE_OCCURRENCE),f.addAnnotationType(e.ANNOTATION_SELECTED_LINKED_GROUP),f.addAnnotationType(e.ANNOTATION_CURRENT_LINKED_GROUP),f.addAnnotationType(e.ANNOTATION_LINKED_GROUP),
f.addAnnotationType("orion.annotation.highlightError");var f=this._annotationFactory.createAnnotationRulers(this._annotationModel),l=this._annotationRuler=f.annotationRuler;l&&(l.onDblClick=m,l.setMultiAnnotationOverlay({html:"\x3cdiv class\x3d'annotationHTML overlay'\x3e\x3c/div\x3e"}),l.addAnnotationType(e.ANNOTATION_ERROR),l.addAnnotationType(e.ANNOTATION_WARNING),l.addAnnotationType(e.ANNOTATION_TASK),l.addAnnotationType(e.ANNOTATION_BOOKMARK));this.setAnnotationRulerVisible(this._annotationRulerVisible||
void 0===this._annotationRulerVisible,!0);if(l=this._overviewRuler=f.overviewRuler)l.addAnnotationType(e.ANNOTATION_CURRENT_SEARCH),l.addAnnotationType(e.ANNOTATION_MATCHING_SEARCH),l.addAnnotationType(e.ANNOTATION_READ_OCCURRENCE),l.addAnnotationType(e.ANNOTATION_WRITE_OCCURRENCE),l.addAnnotationType(e.ANNOTATION_CURRENT_BLAME),l.addAnnotationType(e.ANNOTATION_ERROR),l.addAnnotationType(e.ANNOTATION_WARNING),l.addAnnotationType(e.ANNOTATION_TASK),l.addAnnotationType(e.ANNOTATION_BOOKMARK),l.addAnnotationType(e.ANNOTATION_MATCHING_BRACKET),
l.addAnnotationType(e.ANNOTATION_CURRENT_BRACKET),l.addAnnotationType(e.ANNOTATION_CURRENT_LINE);this.setOverviewRulerVisible(this._overviewRulerVisible||void 0===this._overviewRulerVisible,!0)}this._lineNumberRulerFactory&&(this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.addAnnotationType(e.ANNOTATION_CURRENT_BLAME),this._lineNumberRuler.addAnnotationType(e.ANNOTATION_BLAME),this._lineNumberRuler.onDblClick=m,this.setLineNumberRulerVisible(this._lineNumberRulerVisible||
void 0===this._lineNumberRulerVisible,!0));this._foldingRulerFactory&&(this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),this._foldingRuler.addAnnotationType(e.ANNOTATION_FOLDING),this.setFoldingRulerVisible(this._foldingRulerVisible||void 0===this._foldingRulerVisible,!0));this.dispatchEvent({type:"TextViewInstalled",textView:a});g.prototype.install.call(this)}},uninstallTextView:function(){this.uninstall()},uninstall:function(){var b=this._textView;b&&(b.destroy(),
this._annotationModel&&this._annotationModel.setTextModel(null),this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotation=this._title=null,this._dirty=!1,this._foldingRulerVisible=this._overviewRulerVisible=this._lineNumberRulerVisible=this._annotationRulerVisible=void 0,this.dispatchEvent({type:"TextViewUninstalled",textView:b}),
g.prototype.uninstall.call(this))},_updateCursorStatus:function(){for(var b=this.getModel(),a=this.getCaretOffset(),d=b.getLineAtOffset(a),b=b.getLineStart(d),a=a-b,b=this.getKeyModes(),e=0;e<b.length;e++){var f=b[e];if(f.isActive()&&f.isStatusActive&&f.isStatusActive())return}this.reportStatus(h.formatMessage(n.lineColumn,d+1,a+1))},showAnnotations:function(b,a,d,m){var f=this._annotationModel;if(f){for(var l=[],g=[],h=f.getTextModel(),p=f.getAnnotations(),k;p.hasNext();)k=p.next(),-1!==a.indexOf(k.type)&&
k.creatorID===this&&l.push(k);if(b)for(a=0;a<b.length;a++)if(k=b[a]){if(d)k=d(k);else{var n;"number"===typeof k.line?(n=h.getLineStart(k.line-1),p=n+k.start-1,n=n+k.end-1):(p=k.start,n=k.end);var r=m(k);if(!r)continue;k=e.createAnnotation(r,p,n,k.description)}k.creatorID=this;g.push(k)}f.replaceAnnotations(l,g)}},showProblems:function(b){this.showAnnotations(b,[e.ANNOTATION_ERROR,e.ANNOTATION_WARNING,e.ANNOTATION_TASK],null,function(a){switch(a.severity){case "error":return e.ANNOTATION_ERROR;case "warning":return e.ANNOTATION_WARNING;
case "task":return e.ANNOTATION_TASK}return null})},showOccurrences:function(b){this.showAnnotations(b,[e.ANNOTATION_READ_OCCURRENCE,e.ANNOTATION_WRITE_OCCURRENCE],null,function(a){return a.readAccess?e.ANNOTATION_READ_OCCURRENCE:e.ANNOTATION_WRITE_OCCURRENCE})},showBlame:function(b){var a=this._blameRGB,d=this.getTextView().getOptions("parent").ownerDocument;if(!a){var m=h.createElement(d,"div");m.className="annotation blame";d.body.appendChild(m);var g=(d.defaultView||d.parentWindow).getComputedStyle(m).getPropertyValue("background-color");
m.parentNode.removeChild(m);var m=g.indexOf("("),l=g.indexOf(")"),g=g.substring(m+1,l);this._blameRGB=a=g.split(",").slice(0,3)}var u=function(){var a=k.AnnotationType.createAnnotation(this.groupType,this.start,this.end,this.title);a.style=f.mixin({},a.style);a.style.style=f.mixin({},a.style.style);a.style.style.backgroundColor="";this.groupAnnotation=a;a.blame=this.blame;a.html=this.html;a.creatorID=this.creatorID;return a},p=function(){var a=h.createElement(d,"div");a.className="tooltipTitle";var b=
this.blame.Message.indexOf("\n");-1===b&&(b=this.blame.Message.length);var e=h.createElement(d,"a");e.href=this.blame.CommitLink;e.appendChild(d.createTextNode(this.blame.Message.substring(0,b)));a.appendChild(e);a.appendChild(h.createElement(d,"br"));a.appendChild(d.createTextNode(h.formatMessage(n.committerOnTime,this.blame.AuthorName,this.blame.Time)));return a},A=this.getModel();this.showAnnotations(b,[e.ANNOTATION_BLAME,e.ANNOTATION_CURRENT_BLAME],function(d){var b=A.getLineStart(d.Start-1),
m=A.getLineEnd(d.End-1,!0),b=k.AnnotationType.createAnnotation(e.ANNOTATION_BLAME,b,m,p),m=a.slice(0);m.push(d.Shade);b.style=f.mixin({},b.style);b.style.style=f.mixin({},b.style.style);b.style.style.backgroundColor="rgba("+m.join()+")";b.groupId=d.Name;b.groupType=e.ANNOTATION_CURRENT_BLAME;b.createGroupAnnotation=u;b.html='\x3cimg class\x3d"annotationHTML blame" src\x3d"'+d.AuthorImage+'"/\x3e';b.blame=d;return b})},showSelection:function(b,a,d,e,f){"number"===typeof b?("number"!==typeof a&&(a=
b),this.moveSelection(b,a)):"number"===typeof d&&(b=this.getModel().getLineStart(d-1),"number"===typeof e&&(b+=e),"number"!==typeof f&&(f=0),this.moveSelection(b,b+f))},_setModelText:function(b){this._textView&&(this._textView.setText(b),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelection()))},setInput:function(b,a,d,e,f){g.prototype.setInput.call(this,b,a,d,e);this._textView&&(!e&&!f)&&this._textView.focus()},onGotoLine:function(b,a,d,e){if(this._textView){var f=
this.getModel();b=Math.max(0,Math.min(b,f.getLineCount()-1));var l=f.getLineStart(b),g=0;void 0===d&&(d=0);"string"===typeof a?(b=f.getLine(b).indexOf(a),-1!==b&&(g=b,d=g+a.length)):(g=a,a=f.getLineEnd(b)-l,g=Math.min(g,a),d=Math.min(d,a));this.moveSelection(l+g,l+d,e)}}});return{BaseEditor:g,Editor:p}});
define("orion/editor/find","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/regex orion/objects orion/util".split(" "),function(n,t,r,k,f,h,g){function p(a){var d=a.getTextView();r.KeyMode.call(this,d);this.editor=a;this._active=!1;this._success=!0;this._ignoreSelection=!1;this._prefix="";d.setAction("incrementalFindCancel",function(){this.setActive(!1);return!0}.bind(this));d.setAction("incrementalFindBackspace",function(){return this._backspace()}.bind(this));
var b=this;this._listener={onVerify:function(a){var d=b.editor,e=d.getModel(),g=d.mapOffset(a.start),d=d.mapOffset(a.end),e=e.getText(g,d);if((e=b._prefix.match(RegExp("^"+f.escape(e),"i")))&&0<e.length)b._prefix+=a.text,b._success=!0,b._status(),b.find(b._forward,!0),a.text=null},onSelection:function(){b._ignoreSelection||b.setActive(!1)}}}function e(a,d,b){if(a){this._editor=a;this._undoStack=d;this._showAll=!0;this._visible=!1;this._wrap=this._caseInsensitive=!0;this._wholeWord=!1;this._incremental=
!0;this._regex=!1;this._findAfterReplace=!0;this._reverse=this._hideAfterFind=!1;this._timer=this._end=this._start=void 0;this._lastString="";var e=this;this._listeners={onEditorFocus:function(a){e._removeCurrentAnnotation(a)}};this.setOptions(b)}}var b={};p.prototype=new r.KeyMode;h.mixin(p.prototype,{createKeyBindings:function(){var a=t.KeyBinding,d=[];d.push({actionID:"incrementalFindBackspace",keyBinding:new a(8)});d.push({actionID:"incrementalFindCancel",keyBinding:new a(13)});d.push({actionID:"incrementalFindCancel",
keyBinding:new a(27)});d.push({actionID:"incrementalFindReverse",keyBinding:new a(38)});d.push({actionID:"incrementalFind",keyBinding:new a(40)});d.push({actionID:"incrementalFindReverse",keyBinding:new a("k",!0,!0)});d.push({actionID:"incrementalFind",keyBinding:new a("k",!0)});return d},find:function(a,d){this._forward=a;if(!this.isActive())return this.setActive(!0),!1;var b=this._prefix;if(0===b.length)return!1;var e=this.editor,l=e.getModel(),l=a?this._success?d?this._start:e.getCaretOffset()+
1:0:this._success?d?this._start:e.getCaretOffset():l.getCharCount()-1;(b=e.getModel().find({string:b,start:l,reverse:!a,caseInsensitive:b.toLowerCase()===b}).next())?(d||(this._start=l),this._ignoreSelection=this._success=!0,e.moveSelection(a?b.start:b.end,a?b.end:b.start),this._ignoreSelection=!1):this._success=!1;this._status();return!0},isActive:function(){return this._active},isStatusActive:function(){return this.isActive()},setActive:function(a){this._active!==a&&(this._active=a,this._prefix=
"",this._success=!0,a=this.editor.getTextView(),this._start=this.editor.getCaretOffset(),this.editor.setCaretOffset(this._start),this._active?(a.addEventListener("Verify",this._listener.onVerify),a.addEventListener("Selection",this._listener.onSelection),a.addKeyMode(this)):(a.removeEventListener("Verify",this._listener.onVerify),a.removeEventListener("Selection",this._listener.onSelection),a.removeKeyMode(this)),this._status())},_backspace:function(){var a=this._prefix,a=this._prefix=a.substring(0,
a.length-1);return 0===a.length?(this._ignoreSelection=this._success=!0,this.editor.setCaretOffset(this.editor.getSelection().start),this._ignoreSelection=!1,this._status(),!0):this.find(this._forward,!0)},_status:function(){if(this.isActive()){var a;a=this._forward?this._success?n.incrementalFindStr:n.incrementalFindStrNotFound:this._success?n.incrementalFindReverseStr:n.incrementalFindReverseStrNotFound;a=g.formatMessage(a,this._prefix);this.editor.reportStatus(a,this._success?"":"error")}else this.editor.reportStatus("")}});
b.IncrementalFind=p;e.prototype={find:function(a,d,b){this.setOptions({reverse:!a});var e=this.getFindString(),l;d&&(e=d.findString||e,l=d.count);a=this.getOptions();this.setOptions(d);d=b?this._startOffset:this.getStartOffset();if((l=this._doFind(e,d,l))&&!b)this._startOffset=l.start;this.setOptions(a);this._hideAfterFind&&this.hide();return l},getStartOffset:function(){return void 0!==this._start?this._start:this._reverse?this._editor.getSelection().start-1:this._editor.getCaretOffset()},getFindString:function(){var a=
this._editor.getSelection(),a=this._editor.getText(a.start,a.end);this._regex&&(a=f.escape(a));return a||this._lastString},getOptions:function(){return{showAll:this._showAll,caseInsensitive:this._caseInsensitive,wrap:this._wrap,wholeWord:this._wholeWord,incremental:this._incremental,regex:this._regex,findAfterReplace:this._findAfterReplace,hideAfterFind:this._hideAfterFind,reverse:this._reverse,findCallback:this._findCallback,start:this._start,end:this._end}},getReplaceString:function(){return""},
hide:function(){this._visible=!1;this._savedOptions&&(this.setOptions(this._savedOptions.pop()),0===this._savedOptions.length&&(this._savedOptions=null));this._removeAllAnnotations();var a=this._editor.getTextView();a&&(a.removeEventListener("Focus",this._listeners.onEditorFocus),a.focus())},_processReplaceString:function(a){var d=a;if(this._regex){for(var d="",b=!1,e=this._editor.getModel().getLineDelimiter(),l=0;l<a.length;l++){var f=a.substring(l,l+1);if(b){switch(f){case "R":d+=e;break;case "r":d+=
"\r";break;case "n":d+="\n";break;case "t":d+="\t";break;case "\\":d+="\\";break;default:d+="\\"+f}b=!1}else"\\"===f?b=!0:d+=f}b&&(d+="\\")}return d},isVisible:function(){return this._visible},replace:function(){var a=this.getFindString();if(a){var d=this._editor,b=this._processReplaceString(this.getReplaceString()),e=d.getSelection().start;if(d=d.getModel().find({string:a,start:e,reverse:!1,wrap:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive}).next())this.startUndo(),
this._doReplace(d.start,d.end,a,b),this.endUndo()}this._findAfterReplace&&a&&this._doFind(a,this.getStartOffset())},replaceAll:function(){var a=this.getFindString();if(a){this._replacingAll=!0;var d=this._editor,b=d.getTextView();d.reportStatus(n.replacingAll);var e=this._processReplaceString(this.getReplaceString()),l=this;window.setTimeout(function(){for(var f=0,h=0;;){var p=l._doFind(a,f,null,!0);if(!p)break;h++;1===h&&(b.setRedraw(!1),l.startUndo());l._doReplace(p.start,p.end,a,e);f=l.getStartOffset()}0<
h&&(l.endUndo(),b.setRedraw(!0));0<f?d.reportStatus(g.formatMessage(n.replacedMatches,h)):d.reportStatus(n.nothingReplaced,"error");l._replacingAll=!1},100)}},setOptions:function(a){if(a){if((!0===a.showAll||!1===a.showAll)&&this._showAll!==a.showAll)if(this._showAll=a.showAll,this.isVisible())if(this._showAll)this._markAllOccurrences();else{var d=this._editor.getAnnotationModel();d&&d.removeAnnotations(k.AnnotationType.ANNOTATION_MATCHING_SEARCH)}if(!0===a.caseInsensitive||!1===a.caseInsensitive)this._caseInsensitive=
a.caseInsensitive;if(!0===a.wrap||!1===a.wrap)this._wrap=a.wrap;if(!0===a.wholeWord||!1===a.wholeWord)this._wholeWord=a.wholeWord;if(!0===a.incremental||!1===a.incremental)this._incremental=a.incremental;if(!0===a.regex||!1===a.regex)this._regex=a.regex;if(!0===a.findAfterReplace||!1===a.findAfterReplace)this._findAfterReplace=a.findAfterReplace;if(!0===a.hideAfterFind||!1===a.hideAfterFind)this._hideAfterFind=a.hideAfterFind;if(!0===a.reverse||!1===a.reverse)this._reverse=a.reverse;a.hasOwnProperty("findCallback")&&
(this._findCallback=a.findCallback);a.hasOwnProperty("start")&&(this._start=a.start);a.hasOwnProperty("end")&&(this._end=a.end)}},show:function(a){this._visible=!0;a&&(this._savedOptions||(this._savedOptions=[]),this._savedOptions.push(this.getOptions()),this.setOptions(a));this._startOffset=this._editor.getSelection().start;this._editor.getTextView().addEventListener("Focus",this._listeners.onEditorFocus);var d=this;window.setTimeout(function(){d._incremental&&d.find(!0,null,!0)},0)},startUndo:function(){this._undoStack&&
this._undoStack.startCompoundChange()},endUndo:function(){this._undoStack&&this._undoStack.endCompoundChange()},_find:function(a,d,b){return this._editor.getModel().find({string:a,start:d,end:this._end,reverse:this._reverse,wrap:b?!1:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive})},_doFind:function(a,d,b,e){b=b||1;var l=this._editor;if(!a)return this._removeAllAnnotations(),null;this._lastString=a;var f,g;if(this._regex)try{g=this._find(a,d,e)}catch(h){l.reportStatus(h.message,
"error");return}else g=this._find(a,d,e);for(a=0;a<b&&g.hasNext();a++)f=g.next();if(!this._replacingAll){f?this._editor.reportStatus(""):this._editor.reportStatus(n.notFound,"error");if(this.isVisible()){b=k.AnnotationType.ANNOTATION_CURRENT_SEARCH;if(g=l.getAnnotationModel())g.removeAnnotations(b),f&&g.addAnnotation(k.AnnotationType.createAnnotation(b,f.start,f.end));if(this._showAll){this._timer&&window.clearTimeout(this._timer);var p=this;this._timer=window.setTimeout(function(){p._markAllOccurrences();
p._timer=null},500)}}this._findCallback?this._findCallback(f):f&&l.moveSelection(f.start,f.end,null,!1)}return f},_doReplace:function(a,d,b,e){var l=this._editor;this._regex&&(e=l.getText(a,d).replace(RegExp(b,this._caseInsensitive?"i":""),e));l.setText(e,a,d);l.setSelection(a,a+e.length,!0)},_markAllOccurrences:function(){var a=this._editor.getAnnotationModel();if(a){for(var d=k.AnnotationType.ANNOTATION_MATCHING_SEARCH,b=a.getAnnotations(),e=[],l;b.hasNext();){var f=b.next();f.type===d&&e.push(f)}if(this.isVisible()){b=
this.getFindString();b=this._editor.getModel().find({string:b,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive});for(l=[];b.hasNext();)f=b.next(),l.push(k.AnnotationType.createAnnotation(d,f.start,f.end))}a.replaceAnnotations(e,l)}},_removeAllAnnotations:function(){var a=this._editor.getAnnotationModel();a&&(a.removeAnnotations(k.AnnotationType.ANNOTATION_CURRENT_SEARCH),a.removeAnnotations(k.AnnotationType.ANNOTATION_MATCHING_SEARCH))},_removeCurrentAnnotation:function(a){(a=
this._editor.getAnnotationModel())&&a.removeAnnotations(k.AnnotationType.ANNOTATION_CURRENT_SEARCH)}};b.Find=e;return b});
define("orion/editor/findUI",["i18n!orion/editor/nls/messages","orion/editor/find","orion/objects","orion/editor/util","orion/util"],function(n,t,r,k,f){function h(f,h,e){t.Find.call(this,f,h,e)}h.prototype=new t.Find;r.mixin(h.prototype,{getFindString:function(){var f=this._findInput;return!f?t.Find.prototype.getFindString.call(this):f.value},getReplaceString:function(){var f=this._replaceInput;return!f?t.Find.prototype.getReplaceString(this):f.value},hide:function(){var f=this.isVisible();t.Find.prototype.hide.call(this);
f&&(this._rootDiv.className="textViewFind")},show:function(f){t.Find.prototype.show.call(this,f);var h=f.findString;f=f.replaceString;var e=this._findInput;e||(this._create(),e=this._findInput);h&&(e.value=h);f&&(this._replaceInput.value=f);var b=this;window.setTimeout(function(){b._rootDiv.className="textViewFind show";e.select();e.focus()},0)},_create:function(){var g=this,h=this._editor.getTextView(),e=h.getOptions("parent").ownerDocument,b=f.createElement(e,"div");b.className="textViewFind";k.addEventListener(b,
"keydown",function(a){g._handleKeyDown(a)});this._rootDiv=b;this._createContents(e,b);h._rootDiv.insertBefore(b,h._rootDiv.firstChild)},_createContents:function(g,h){var e=this,b=f.createElement(g,"input");b.className="textViewFindInput";this._findInput=b;b.type="text";b.placeholder=n.findWith;k.addEventListener(b,"input",function(a){return e._handleInput(a)});h.appendChild(b);b=f.createElement(g,"span");e._createButton(g,b,n.next,function(){e.find(!0)});e._createButton(g,b,n.previous,function(){e.find(!1)});
h.appendChild(b);e._editor.getTextView().getOptions("readonly")||(b=f.createElement(g,"input"),b.className="textViewReplaceInput",this._replaceInput=b,b.type="text",b.placeholder=n.replaceWith,h.appendChild(b),b=f.createElement(g,"span"),e._createButton(g,b,n.replace,function(){e.replace()}),e._createButton(g,b,n.replaceAll,function(){e.replaceAll()}),h.appendChild(b));b=f.createElement(g,"span");e._createButton(g,b,n.regex,function(a){e._toggle("regex",a.target)},this._regex,n.regexTooltip);e._createButton(g,
b,n.caseInsensitive,function(a){e._toggle("caseInsensitive",a.target)},this._caseInsensitive,n.caseInsensitiveTooltip);e._createButton(g,b,n.wholeWord,function(a){e._toggle("wholeWord",a.target)},this._wholeWord,n.wholeWordTooltip);h.appendChild(b);b=e._createButton(g,h,"",function(){e.hide()});b.className="textViewFindCloseButton";b.title=n.closeTooltip},_createButton:function(f,h,e,b,a,d){var m=f.createElement("button");this._checked(a,m);d&&(m.title=d);k.addEventListener(m,"click",function(a){b.call(this,
a)},!1);e&&m.appendChild(f.createTextNode(e));h.appendChild(m);return m},_toggle:function(f,h){var e={};e[f]=!this["_"+f];this.setOptions(e);this._checked(e[f],h)},_checked:function(f,h){h.className="textViewFindButton";f&&(h.className+=" checked")},_handleInput:function(){this._incremental&&this.find(!0,null,!0);return!0},_handleKeyDown:function(g){var h,e=(f.isMac?g.metaKey:g.ctrlKey)&&!g.altKey&&!g.shiftKey;e&&70===g.keyCode&&(h=!0);if((f.isMac?g.metaKey:g.ctrlKey)&&!g.altKey&&75===g.keyCode||
13===g.keyCode)13===g.keyCode?this.find(this._reverse?g.shiftKey:!g.shiftKey):this.find(!g.shiftKey),h=!0;e&&82===g.keyCode&&(this.replace(),h=!0);27===g.keyCode&&(this.hide(),h=!0);return h?(g.stopPropagation&&g.stopPropagation(),g.preventDefault&&g.preventDefault(),g.cancelBubble=!0,!1):!0}});return{FindUI:h}});
define("orion/editor/actions","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/annotations orion/editor/tooltip orion/editor/find orion/editor/findUI orion/util".split(" "),function(n,t,r,k,f,h,g){function p(a,b,e){this.editor=a;this.undoStack=b;this._incrementalFind=new f.IncrementalFind(a);this._find=e?e:new h.FindUI(a,b);this._lastEditLocation=null;this.init()}function e(a,b,e,l){this.editor=a;this.undoStack=b;this.contentAssist=e;this.linkedMode=l;this.contentAssist&&this.contentAssist.addEventListener("ProposalApplied",
this.contentAssistProposalApplied.bind(this));this.init()}var b=r.AnnotationType,a={};p.prototype={init:function(){var a=this.editor.getTextView();this._lastEditListener={onModelChanged:function(a){this.editor.isDirty()&&(this._lastEditLocation=a.start+a.addedCharCount)}.bind(this)};a.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);a.setAction("undo",function(a){if(this.undoStack){var d=1;a&&a.count&&(d=a.count);for(;0<d;)this.undoStack.undo(),--d;return!0}return!1}.bind(this),
{name:n.undo});a.setAction("redo",function(a){if(this.undoStack){var d=1;a&&a.count&&(d=a.count);for(;0<d;)this.undoStack.redo(),--d;return!0}return!1}.bind(this),{name:n.redo});a.setKeyBinding(new t.KeyBinding("f",!0),"find");a.setAction("find",function(){if(this._find){var a=this.editor.getSelection();this._find.show({findString:this.editor.getText(a.start,a.end)});return!0}return!1}.bind(this),{name:n.find});a.setKeyBinding(new t.KeyBinding("k",!0),"findNext");a.setAction("findNext",function(a){return this._find?
(this._find.find(!0,a),!0):!1}.bind(this),{name:n.findNext});a.setKeyBinding(new t.KeyBinding("k",!0,!0),"findPrevious");a.setAction("findPrevious",function(a){return this._find?(this._find.find(!1,a),!0):!1}.bind(this),{name:n.findPrevious});a.setKeyBinding(new t.KeyBinding("j",!0),"incrementalFind");a.setAction("incrementalFind",function(){this._incrementalFind&&this._incrementalFind.find(!0);return!0}.bind(this),{name:n.incrementalFind});a.setKeyBinding(new t.KeyBinding("j",!0,!0),"incrementalFindReverse");
a.setAction("incrementalFindReverse",function(){this._incrementalFind&&this._incrementalFind.find(!1);return!0}.bind(this),{name:n.incrementalFindReverse});a.setAction("tab",function(){return this.indentLines()}.bind(this));a.setAction("shiftTab",function(){return this.unindentLines()}.bind(this),{name:n.unindentLines});a.setKeyBinding(new t.KeyBinding(38,!1,!1,!0),"moveLinesUp");a.setAction("moveLinesUp",function(){return this.moveLinesUp()}.bind(this),{name:n.moveLinesUp});a.setKeyBinding(new t.KeyBinding(40,
!1,!1,!0),"moveLinesDown");a.setAction("moveLinesDown",function(){return this.moveLinesDown()}.bind(this),{name:n.moveLinesDown});a.setKeyBinding(new t.KeyBinding(38,!0,!1,!0),"copyLinesUp");a.setAction("copyLinesUp",function(){return this.copyLinesUp()}.bind(this),{name:n.copyLinesUp});a.setKeyBinding(new t.KeyBinding(40,!0,!1,!0),"copyLinesDown");a.setAction("copyLinesDown",function(){return this.copyLinesDown()}.bind(this),{name:n.copyLinesDown});a.setKeyBinding(new t.KeyBinding("d",!0,!1,!1),
"deleteLines");a.setAction("deleteLines",function(a){return this.deleteLines(a)}.bind(this),{name:n.deleteLines});a.setKeyBinding(new t.KeyBinding("l",!g.isMac,!1,!1,g.isMac),"gotoLine");a.setAction("gotoLine",function(){return this.gotoLine()}.bind(this),{name:n.gotoLine});a.setKeyBinding(new t.KeyBinding(190,!0),"nextAnnotation");a.setAction("nextAnnotation",function(){return this.nextAnnotation(!0)}.bind(this),{name:n.nextAnnotation});a.setKeyBinding(new t.KeyBinding(188,!0),"previousAnnotation");
a.setAction("previousAnnotation",function(){return this.nextAnnotation(!1)}.bind(this),{name:n.prevAnnotation});a.setKeyBinding(new t.KeyBinding("e",!0,!1,!0,!1),"expand");a.setAction("expand",function(){return this.expandAnnotation(!0)}.bind(this),{name:n.expand});a.setKeyBinding(new t.KeyBinding("c",!0,!1,!0,!1),"collapse");a.setAction("collapse",function(){return this.expandAnnotation(!1)}.bind(this),{name:n.collapse});a.setKeyBinding(new t.KeyBinding("e",!0,!0,!0,!1),"expandAll");a.setAction("expandAll",
function(){return this.expandAnnotations(!0)}.bind(this),{name:n.expandAll});a.setKeyBinding(new t.KeyBinding("c",!0,!0,!0,!1),"collapseAll");a.setAction("collapseAll",function(){return this.expandAnnotations(!1)}.bind(this),{name:n.collapseAll});a.setKeyBinding(new t.KeyBinding("q",!g.isMac,!1,!1,g.isMac),"lastEdit");a.setAction("lastEdit",function(){return this.gotoLastEdit()}.bind(this),{name:n.lastEdit})},copyLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;
var b=a.getModel(),e=a.getSelection(),l=b.getLineAtOffset(e.start),e=b.getLineAtOffset(e.end>e.start?e.end-1:e.end),f=b.getLineStart(l),l=b.getLineEnd(e,!0),g=b.getLineCount(),h="",f=b.getText(f,l);e===g-1&&(f=(h=b.getLineDelimiter())+f);a.setText(f,l,l);a.setSelection(l+h.length,l+f.length);return!0},copyLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),e=a.getSelection(),l=b.getLineAtOffset(e.start),e=b.getLineAtOffset(e.end>e.start?e.end-
1:e.end),l=b.getLineStart(l),f=b.getLineEnd(e,!0),g=b.getLineCount(),h="",f=b.getText(l,f);e===g-1&&(f+=h=b.getLineDelimiter());a.setText(f,l,l);a.setSelection(l,l+f.length-h.length);return!0},deleteLines:function(a){var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var e=1;a&&a.count&&(e=a.count);var l=b.getSelection(),f=b.getModel(),g=f.getLineAtOffset(l.start);a=f.getLineStart(g);e=l.start!==l.end||1===e?f.getLineAtOffset(l.end>l.start?l.end-1:l.end):Math.min(g+e-1,f.getLineCount()-
1);e=f.getLineEnd(e,!0);b.setText("",a,e);return!0},expandAnnotation:function(a){var b=this.editor,e=b.getAnnotationModel();if(!e)return!0;var l=b.getModel(),f=b.getCaretOffset(),g=l.getLineAtOffset(f),f=l.getLineStart(g),g=l.getLineEnd(g,!0);l.getBaseModel&&(f=l.mapOffset(f),g=l.mapOffset(g),l.getBaseModel());for(var h,e=e.getAnnotations(f,g);!h&&e.hasNext();)l=e.next(),l.type===r.AnnotationType.ANNOTATION_FOLDING&&(h=l);h&&a!==h.expanded&&(a?h.expand():(b.setCaretOffset(h.start),h.collapse()));
return!0},expandAnnotations:function(a){var b=this.editor,e=b.getTextView(),b=b.getAnnotationModel();if(!b)return!0;var l=b.getAnnotations();for(e.setRedraw(!1);l.hasNext();)b=l.next(),b.type===r.AnnotationType.ANNOTATION_FOLDING&&a!==b.expanded&&(a?b.expand():b.collapse());e.setRedraw(!0);return!0},indentLines:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;if(b.getOptions("tabMode")){var e=a.getModel(),l=a.getSelection(),f=e.getLineAtOffset(l.start),g=e.getLineAtOffset(l.end>
l.start?l.end-1:l.end);if(f!==g){var h=[];h.push("");for(var k=f;k<=g;k++)h.push(e.getLine(k,!0));k=e.getLineStart(f);e=e.getLineEnd(g,!0);b=b.getOptions("tabSize","expandTab");b=b.expandTab?Array(b.tabSize+1).join(" "):"\t";a.setText(h.join(b),k,e);a.setSelection(k===l.start?l.start:l.start+b.length,l.end+(g-f+1)*b.length);return!0}return!1}},gotoLastEdit:function(){"number"===typeof this._lastEditLocation&&this.editor.showSelection(this._lastEditLocation);return!0},gotoLine:function(){var a=this.editor,
b=a.getModel().getLineAtOffset(a.getCaretOffset());if(b=prompt(n.gotoLinePrompty,b+1))b=parseInt(b,10),a.onGotoLine(b-1,0);return!0},moveLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),e=a.getSelection(),l=b.getLineAtOffset(e.start),f=b.getLineAtOffset(e.end>e.start?e.end-1:e.end),g=b.getLineCount();if(f===g-1)return!0;var l=b.getLineStart(l),e=b.getLineEnd(f,!0),h=b.getLineEnd(f+1,!0)-(e-l),k=0;f!==g-2?b=b.getText(l,e):(f=b.getLineEnd(f),
b=b.getText(f,e)+b.getText(l,f),k+=e-f);this.startUndo();a.setText("",l,e);a.setText(b,h,h);a.setSelection(h+k,h+k+b.length);this.endUndo();return!0},moveLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),e=a.getSelection(),l=b.getLineAtOffset(e.start);if(0===l)return!0;var f=b.getLineAtOffset(e.end>e.start?e.end-1:e.end),g=b.getLineCount(),e=b.getLineStart(l-1),h=b.getLineStart(l),k=b.getLineEnd(f,!0),p=b.getText(h,k),n=0;f===g-1&&(f=b.getLineEnd(l-
1),l=b.getLineEnd(l-1,!0),p+=b.getText(f,l),h=f,n=l-f);this.startUndo();a.setText("",h,k);a.setText(p,e,e);a.setSelection(e,e+p.length-n);this.endUndo();return!0},nextAnnotation:function(a){function e(a){return!!a.lineStyle||a.type===b.ANNOTATION_MATCHING_BRACKET||a.type===b.ANNOTATION_CURRENT_BRACKET||!g.isAnnotationTypeVisible(a.type)}var f=this.editor,l=f.getAnnotationModel();if(!l)return!0;var g=f.getOverviewRuler()||f.getAnnotationStyler();if(!g)return!0;for(var h=f.getModel(),p=f.getCaretOffset(),
n=l.getAnnotations(a?p:0,a?h.getCharCount():p),r=null;n.hasNext();){var t=n.next();if(a){if(t.start<=p)continue}else if(t.start>=p)continue;if(!e(t)&&(r=t,a))break}if(r){for(var D=[r],n=l.getAnnotations(r.start,r.start);n.hasNext();)t=n.next(),t!==r&&!e(t)&&D.push(t);var q=f.getTextView(),z=h.getLineAtOffset(r.start),C=k.Tooltip.getTooltip(q);if(!C)return f.moveSelection(r.start),!0;f.moveSelection(r.start,r.start,function(){C.setTarget({getTooltipInfo:function(){var a=q.convert({x:q.getLocationAtOffset(r.start).x,
y:q.getLocationAtOffset(h.getLineStart(z)).y},"document","page");return{contents:D,x:a.x,y:a.y+Math.floor(1.33*q.getLineHeight(z))}}},0)})}return!0},unindentLines:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;if(b.getOptions("tabMode")){for(var e=a.getModel(),l=a.getSelection(),f=e.getLineAtOffset(l.start),g=e.getLineAtOffset(l.end>l.start?l.end-1:l.end),h=b.getOptions("tabSize"),k=Array(h+1).join(" "),p=[],n=b=0,r=f;r<=g;r++){var q=e.getLine(r,!0);if(e.getLineStart(r)!==
e.getLineEnd(r))if(0===q.indexOf("\t"))q=q.substring(1),b++;else if(0===q.indexOf(k))q=q.substring(h),b+=h;else return!0;r===f&&(n=b);p.push(q)}f=e.getLineStart(f);h=e.getLineEnd(g,!0);e=e.getLineStart(g);a.setText(p.join(""),f,h);g=f===l.start?l.start:l.start-n;l=Math.max(g,l.end-b+(l.end===e+1&&l.start!==l.end?1:0));a.setSelection(g,l);return!0}},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()}};a.TextActions=
p;e.prototype={init:function(){var a=this.editor.getTextView();a.setAction("lineStart",function(){return this.lineStart()}.bind(this));a.setAction("enter",function(){return this.autoIndent()}.bind(this));a.setKeyBinding(new t.KeyBinding("t",!0,!1,!0),"trimTrailingWhitespaces");a.setAction("trimTrailingWhitespaces",function(){return this.trimTrailingWhitespaces()}.bind(this),{name:n.trimTrailingWhitespaces});a.setKeyBinding(new t.KeyBinding(191,!0),"toggleLineComment");a.setAction("toggleLineComment",
function(){return this.toggleLineComment()}.bind(this),{name:n.toggleLineComment});a.setKeyBinding(new t.KeyBinding(191,!0,!g.isMac,!1,g.isMac),"addBlockComment");a.setAction("addBlockComment",function(){return this.addBlockComment()}.bind(this),{name:n.addBlockComment});a.setKeyBinding(new t.KeyBinding(220,!0,!g.isMac,!1,g.isMac),"removeBlockComment");a.setAction("removeBlockComment",function(){return this.removeBlockComment()}.bind(this),{name:n.removeBlockComment});a.setKeyBinding(new t.KeyBinding("[",
!1,!1,!1,!1,"keypress"),"autoPairSquareBracket");a.setAction("autoPairSquareBracket",function(){return this.autoPairBrackets("[","]")}.bind(this));a.setKeyBinding(new t.KeyBinding("]",!1,!1,!1,!1,"keypress"),"skipClosingSquareBracket");a.setAction("skipClosingSquareBracket",function(){return this.skipClosingBracket("]")}.bind(this));a.setKeyBinding(new t.KeyBinding("\x3c",!1,!1,!1,!1,"keypress"),"autoPairAngleBracket");a.setAction("autoPairAngleBracket",function(){return this.autoPairBrackets("\x3c",
"\x3e")}.bind(this));a.setKeyBinding(new t.KeyBinding("\x3e",!1,!1,!1,!1,"keypress"),"skipClosingAngleBracket");a.setAction("skipClosingAngleBracket",function(){return this.skipClosingBracket("\x3e")}.bind(this));a.setKeyBinding(new t.KeyBinding("(",!1,!1,!1,!1,"keypress"),"autoPairParentheses");a.setAction("autoPairParentheses",function(){return this.autoPairBrackets("(",")")}.bind(this));a.setKeyBinding(new t.KeyBinding(")",!1,!1,!1,!1,"keypress"),"skipClosingParenthesis");a.setAction("skipClosingParenthesis",
function(){return this.skipClosingBracket(")")}.bind(this));a.setKeyBinding(new t.KeyBinding("{",!1,!1,!1,!1,"keypress"),"autoPairBraces");a.setAction("autoPairBraces",function(){return this.autoPairBrackets("{","}")}.bind(this));a.setKeyBinding(new t.KeyBinding("}",!1,!1,!1,!1,"keypress"),"skipClosingBrace");a.setAction("skipClosingBrace",function(){return this.skipClosingBracket("}")}.bind(this));a.setKeyBinding(new t.KeyBinding("'",!1,!1,!1,!1,"keypress"),"autoPairSingleQuotation");a.setAction("autoPairSingleQuotation",
function(){return this.autoPairQuotations("'")}.bind(this));a.setKeyBinding(new t.KeyBinding('"',!1,!1,!1,!1,"keypress"),"autoPairDblQuotation");a.setAction("autoPairDblQuotation",function(){return this.autoPairQuotations('"')}.bind(this));a.setAction("deletePrevious",function(){return this.deletePrevious()}.bind(this))},autoIndent:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;var e=a.getSelection();if(e.start===e.end){for(var l=a.getModel(),f=l.getLineAtOffset(e.start),
g=l.getLine(f,!1),h=l.getLineStart(f),k=0,p=e.start-h,n;k<p&&(32===(n=g.charCodeAt(k))||9===n);)k++;var h=g.substring(0,k),b=b.getOptions("tabSize","expandTab"),r=b.expandTab?Array(b.tabSize+1).join(" "):"\t",b=l.getLineDelimiter(),q=/^[\s]*\/\*[\*]*[\s]*$/,t=/^[\s]*\*/,C=/\*\/[\s]*$/,E=g.substring(0,p),B=g.substring(p),I;if(this.smartIndentation&&123===g.charCodeAt(I=E.trimRight().length-1))return l=p-I-1,B=B.length-B.trimLeft().length,g=125===g.charCodeAt(p+B)?b+h+r+b+h:b+h+r,a.setText(g,e.start-
l,e.end+B),a.setCaretOffset(e.start+b.length+h.length+r.length-l),!0;if(this.autoCompleteComments&&!C.test(E)&&(q.test(E)||t.test(E))){if(k=q.exec(E)){g=b+h+" * ";g=C.test(B)?g+B.substring(0,B.length-2).trim():g+B.trim();if(l.getLineCount()===f+1||!t.test(l.getLine(f+1)))g+=b+h+" */";a.setText(g,e.start,e.end+B.length);a.setCaretOffset(e.start+b.length+h.length+3);return!0}if(k=t.exec(E))for(f-=1;0<=f;f--){k=l.getLine(f,!1);if(q.test(k))return C.test(B)||47===g.charCodeAt(p)?(g=b+h+"*"+B,h=e.start+
b.length+h.length+1):(g=b+h+"* "+B,h=e.start+b.length+h.length+2),a.setText(g,e.start,e.end+B.length),a.setCaretOffset(h),!0;if(!t.test(k))break}}else{if(C.test(E)&&32===h.charCodeAt(h.length-1))return g=b+h.substring(0,h.length-1),a.setText(g,e.start,e.end),a.setCaretOffset(e.start+g.length),!0;if(0<k){for(k=p;k<g.length&&(32===(n=g.charCodeAt(k++))||9===n);)e.end++;a.setText(l.getLineDelimiter()+h,e.start,e.end);return!0}}}return!1},addBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;
var b=a.getModel(),e=a.getSelection(),f=this._findEnclosingComment(b,e.start,e.end);if(void 0!==f.commentStart&&void 0!==f.commentEnd)return!0;b=b.getText(e.start,e.end);if(0===b.length)return!0;var f=b.length,b=b.replace(/\/\*|\*\//g,""),g=b.length;a.setText("/*"+b+"*/",e.start,e.end);a.setSelection(e.start+2,e.end+2+(g-f));return!0},autoPairBrackets:function(a,b){if("["===a&&!this.autoPairSquareBrackets||"{"===a&&!this.autoPairBraces||"("===a&&!this.autoPairParentheses||"\x3c"===a&&!this.autoPairAngleBrackets)return!1;
var e=this.editor;if(e.getTextView().getOptions("readonly"))return!1;var f=e.getSelection(),g=e.getModel(),h=e.getCaretOffset()===g.getCharCount()?"":g.getText(f.start,f.start+1).trim(),k=/^$|[)}\]>]/;return f.start===f.end&&k.test(h)?(e.setText(a+b,f.start,f.start),e.setCaretOffset(f.start+1),!0):f.start!==f.end?(g=g.getText(f.start,f.end),e.setText(a+g+b,f.start,f.end),e.setSelection(f.start+1,f.end+1),!0):!1},autoPairQuotations:function(a){if(!this.autoPairQuotation)return!1;var b=this.editor;
if(b.getTextView().getOptions("readonly"))return!1;var e=b.getSelection(),f=b.getModel(),g=b.getCaretOffset(),h=0===g?"":f.getText(e.start-1,e.start).trim(),k=g===f.getCharCount()?"":f.getText(e.start,e.start+1).trim(),g=/^"$|^'$/,p=/\w/,n=/^$|[)}\]>]/;if(e.start!==e.end){f=f.getText(e.start,e.end);if(g.test(f))return!1;b.setText(a+f+a,e.start,e.end);b.setSelection(e.start+1,e.end+1)}else{if(k!==a){if(h===a||g.test(k)||p.test(h)||!n.test(k))return!1;b.setText(a+a,e.start,e.start)}b.setCaretOffset(e.start+
1)}return!0},contentAssistProposalApplied:function(a){a=a.data.proposal;if(a.positions&&0<a.positions.length&&this.linkedMode){for(var b=[],e=0;e<a.positions.length;++e)b[e]={positions:[{offset:a.positions[e].offset,length:a.positions[e].length}]};this.linkedMode.enterLinkedMode({groups:b,escapePosition:a.escapePosition})}else a.groups&&0<a.groups.length&&this.linkedMode?this.linkedMode.enterLinkedMode({groups:a.groups,escapePosition:a.escapePosition}):a.escapePosition&&this.editor.getTextView().setCaretOffset(a.escapePosition);
return!0},deletePrevious:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getSelection();if(b.start!==b.end)return!1;var e=a.getModel(),f=a.getCaretOffset(),g=0===f?"":e.getText(b.start-1,b.start),e=f===e.getCharCount()?"":e.getText(b.start,b.start+1);("("===g&&")"===e||"["===g&&"]"===e||"{"===g&&"}"===e||"\x3c"===g&&"\x3e"===e||'"'===g&&'"'===e||"'"===g&&"'"===e)&&a.setText("",b.start,b.start+1);return!1},_findEnclosingComment:function(a,b,e){var f=a.getLineAtOffset(b),
g=a.getLineAtOffset(e),h,k,p,n,r,t;for(h=f;0<=h&&!(k=a.getLine(h),p=h===f?b-a.getLineStart(f):k.length,n=k.lastIndexOf("/*",p),k=k.lastIndexOf("*/",p),k>n);h--)if(-1!==n){r=a.getLineStart(h)+n;break}for(h=g;h<a.getLineCount()&&!(k=a.getLine(h),p=h===g?e-a.getLineStart(g):0,n=k.indexOf("/*",p),k=k.indexOf("*/",p),-1!==n&&n<k);h++)if(-1!==k){t=a.getLineStart(h)+k;break}return{commentStart:r,commentEnd:t}},lineStart:function(){for(var a=this.editor,b=a.getModel(),e=a.getCaretOffset(),f=b.getLineAtOffset(e),
g=b.getLineStart(f),b=b.getLine(f),f=0;f<b.length;f++){var h=b.charCodeAt(f);if(!(32===h||9===h))break}f+=g;return e!==f?(a.setSelection(f,f),!0):!1},removeBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),e=a.getSelection(),f=b.getText(e.start,e.end),g,h,k;for(k=0;k<f.length;k++)if("/*"===f.substring(k,k+2)){g=e.start+k;break}for(;k<f.length;k++)if("*/"===f.substring(k,k+2)){h=e.start+k;break}if(void 0!==g&&void 0!==h)a.setText(b.getText(g+
2,h),g,h+2),a.setSelection(g,h);else{f=this._findEnclosingComment(b,e.start,e.end);if(void 0===f.commentStart||void 0===f.commentEnd)return!0;b=b.getText(f.commentStart+2,f.commentEnd);a.setText(b,f.commentStart,f.commentEnd+2);a.setSelection(e.start-2,e.end-2)}return!0},toggleLineComment:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;for(var e=this.lineComment||"//",f=a.getModel(),g=a.getSelection(),h=f.getLineAtOffset(g.start),k=f.getLineAtOffset(g.end>g.start?
g.end-1:g.end),p=!0,n=[],r,t=h;t<=k;t++){var q=f.getLine(t,!0);r=q.indexOf(e);n.push(r);if(!p||-1===r)p=!1;else if(0!==r){for(p=0;p<r;p++){var z=q.charCodeAt(p);if(!(32===z||9===z))break}p=p===r}}t=e.length;q=f.getLineStart(h);b.setRedraw(!1);this.startUndo();if(p){for(p=n.length-1;0<=p;p--)r=n[p]+f.getLineStart(h+p),a.setText("",r,r+t);f=f.getLineStart(k);e=q===g.start?g.start:g.start-t;g=g.end-t*(k-h+1)+(g.end===f+1?t:0)}else{for(p=n.length-1;0<=p;p--)r=f.getLineStart(h+p),a.setText(e,r,r);e=q===
g.start?g.start:g.start+t;g=g.end+t*(k-h+1)}this.endUndo();b.setRedraw(!0);a.setSelection(e,g);return!0},trimTrailingWhitespaces:function(){var a=this.editor,b=a.getModel(),e=a.getSelection();a.getTextView().setRedraw(!1);a.getUndoStack().startCompoundChange();for(var f=/(\s+$)/,g=b.getLineCount(),h=0;h<g;h++){var k=b.getLine(h),p=f.exec(k);if(p){var n=b.getLineStart(h),k=p[0].length,p=n+p.index;b.setText("",p,p+k);e.start>p&&(e.start=Math.max(p,e.start-k));e.start!==e.end&&e.end>p&&(e.end=Math.max(p,
e.end-k))}}a.getUndoStack().endCompoundChange();a.getTextView().setRedraw(!0);a.setSelection(e.start,e.end,!1)},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},skipClosingBracket:function(a){var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var e=b.getSelection(),f=b.getModel();return(b.getCaretOffset()===f.getCharCount()?"":f.getText(e.start,e.start+1))===a?(b.setCaretOffset(e.start+1),!0):!1},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},
setAutoPairParentheses:function(a){this.autoPairParentheses=a},setAutoPairBraces:function(a){this.autoPairBraces=a},setAutoPairSquareBrackets:function(a){this.autoPairSquareBrackets=a},setAutoPairAngleBrackets:function(a){this.autoPairAngleBrackets=a},setAutoPairQuotations:function(a){this.autoPairQuotation=a},setAutoCompleteComments:function(a){this.autoCompleteComments=a},setLineComment:function(a){this.lineComment=a},setSmartIndentation:function(a){this.smartIndentation=a}};a.SourceCodeActions=
e;String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/g,"")});String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")});return a});
define("orion/editor/templates",[],function(){function n(n,k,f,h){this.prefix=n;this.description=k;this.template=f;this.name=h;this._parse()}function t(n,k){this._keywords=n||[];this._templates=[];this.addTemplates(k||[])}n.prototype={getProposal:function(n,k,f){n=k-n.length;k={};var h,g=void 0!==f.delimiter?f.delimiter:"\n";f.indentation&&(g+=f.indentation);var p=void 0!==f.tab?f.tab:"\t",e=0,b=this.variables,a=this.segments;f=[];for(var d=0;d<a.length;d++){var m=a[d],s=b[m];if(void 0!==s)switch(m){case "${tab}":m=
p;break;case "${delimiter}":m=g;break;case "${cursor}":m="";h=e;break;default:var l=k[m];l||(l=k[m]={data:s.data,positions:[]});m=s.substitution;l.data&&l.data.values&&(m=l.data.values[0]);l.positions.push({offset:n+e,length:m.length})}f.push(m);e+=m.length}var g=[],u;for(u in k)k.hasOwnProperty(u)&&g.push(k[u]);f=f.join("");void 0===h&&(h=f.length);return{proposal:f,name:this.name,description:this.description,groups:g,escapePosition:n+h,style:"noemphasis"}},match:function(n){return 0===this.prefix.indexOf(n)},
_parse:function(){var n=this.template,k=[],f={},h,g=0,n=n.replace(/\n/g,"${delimiter}"),n=n.replace(/\t/g,"${tab}");n.replace(/\$\{((?:[^\\}]+|\\.))*\}/g,function(p,e,b){var a=p.substring(2,p.length-1);e=p;var d=a,m=null,s=d.indexOf(":");-1!==s&&(d=d.substring(0,s),e="${"+d+"}",m=JSON.parse(a.substring(s+1).replace("\\}","}").trim()));(a=f[e])||(a=f[e]={});a.substitution=d;m&&(a.data=m);(h=n.substring(g,b))&&k.push(h);k.push(e);g=b+p.length;return d});(h=n.substring(g,n.length))&&k.push(h);this.segments=
k;this.variables=f}};t.prototype={addTemplates:function(r){for(var k=this.getTemplates(),f=0;f<r.length;f++)k.push(new n(r[f].prefix,r[f].description,r[f].template,r[f].name))},initialize:function(){},computeProposals:function(n,k,f){var h=this.getPrefix(n,k,f),g=[];this.isValid(h,n,k,f)&&(g=g.concat(this.getTemplateProposals(h,k,f)),g=g.concat(this.getKeywordProposals(h)));return g},getKeywords:function(){return this._keywords},getKeywordProposals:function(n){var k=[],f=this.getKeywords();if(f){for(var h=
0;h<f.length;h++)0===f[h].indexOf(n)&&k.push({proposal:f[h].substring(n.length),description:f[h],style:"noemphasis_keyword"});0<k.length&&k.splice(0,0,{proposal:"",description:"Keywords",style:"noemphasis_title_keywords",unselectable:!0})}return k},getPrefix:function(n,k,f){return f.prefix},getTemplates:function(){return this._templates},getTemplateProposals:function(n,k,f){for(var h=[],g=this.getTemplates(),p=0;p<g.length;p++){var e=g[p];e.match(n)&&(e=e.getProposal(n,k,f),this.removePrefix(n,e),
h.push(e))}0<h.length&&(h.sort(function(b,a){return b.name<a.name?-1:b.name>a.name?1:0}),h.splice(0,0,{proposal:"",description:"Templates",style:"noemphasis_title",unselectable:!0}));return h},removePrefix:function(n,k){if(!(k.overwrite=k.proposal.substring(0,n.length)!==n))k.proposal=k.proposal.substring(n.length)},isValid:function(n,k,f,h){return!0}};return{Template:n,TemplateContentAssist:t}});
define("orion/editor/linkedMode","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/editor/templates orion/objects orion/util".split(" "),function(n,t,r,k,f,h){function g(e,b,a){var d=e.getTextView();r.KeyMode.call(this,d);this.editor=e;this.undoStack=b;this.contentAssist=a;this.linkedModeModel=null;d.setAction("linkedModeEnter",function(){this.exitLinkedMode(!0);return!0}.bind(this));d.setAction("linkedModeCancel",function(){this.exitLinkedMode(!1);
return!0}.bind(this));d.setAction("linkedModeNextGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup((a.selectedGroupIndex+1)%a.groups.length);return!0}.bind(this));d.setAction("linkedModePreviousGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup(0<a.selectedGroupIndex?a.selectedGroupIndex-1:a.groups.length-1);return!0}.bind(this));this.linkedModeListener={onActivating:function(a){this._groupContentAssistProvider&&(this.contentAssist.setProviders([this._groupContentAssistProvider]),
this.contentAssist.setProgress(null))}.bind(this),onModelChanged:function(a){if(!this.ignoreVerify){for(var b=this.editor.mapOffset(a.start),d=this.linkedModeModel,e,f;d;)if(e=this._getPositionChanged(d,b,b+a.removedCharCount),f=e.position,void 0===f||f.model!==d)this.exitLinkedMode(!1),d=this.linkedModeModel;else break;if(d){d=0;a=a.addedCharCount-a.removedCharCount;e=e.positions;for(var g,h=0;h<e.length;++h){g=e[h];f=g.position;var k=f.offset<=b&&b<=f.offset+f.length;k&&!g.ansestor?(f.offset+=d,
f.length+=a,d+=a):(f.offset+=d,g.ansestor&&k&&(f.length+=a));g.escape&&(g.model.escapePosition=f.offset)}this._updateAnnotations(e)}}}.bind(this),onVerify:function(a){if(!this.ignoreVerify){for(var b=this.editor,d=b.mapOffset(a.start),e=this.editor.mapOffset(a.end),f=this.linkedModeModel,g,h;f;)if(g=this._getPositionChanged(f,d,e),h=g.position,void 0===h||h.model!==f)this.exitLinkedMode(!1),f=this.linkedModeModel;else break;if(f){var k=this._compoundChange;k?k.owner.model===f&&k.owner.group===h.group||
(this.endUndo(),this.startUndo()):this.startUndo();f.selectedGroupIndex=h.group;var k=0,p=a.text.length-(e-d);g=g.positions;for(var n,d=d-h.position.offset,q=e-h.position.offset,r=0;r<g.length;++r)n=g[r],e=n.position,n.oldOffset=e.offset,n.model===f&&n.group===h.group?(e.offset+=k,e.length+=p,k+=p):(e.offset+=k,n.ansestor&&(e.length+=h.count*p)),n.escape&&(n.model.escapePosition=e.offset);this.ignoreVerify=!0;for(r=g.length-1;0<=r;r--)n=g[r],n.model===f&&n.group===h.group&&b.setText(a.text,n.oldOffset+
d,n.oldOffset+q);this.ignoreVerify=!1;a.text=null;this._updateAnnotations(g)}}}.bind(this)}}var p={};g.prototype=new r.KeyMode;h.mixin(g.prototype,{createKeyBindings:function(){var e=t.KeyBinding,b=[];b.push({actionID:"linkedModeEnter",keyBinding:new e(13)});b.push({actionID:"linkedModeCancel",keyBinding:new e(27)});b.push({actionID:"linkedModeNextGroup",keyBinding:new e(9)});b.push({actionID:"linkedModePreviousGroup",keyBinding:new e(9,!1,!0)});return b},enterLinkedMode:function(e){if(!this.linkedModeModel){var b=
this.editor.getTextView();b.addKeyMode(this);b.addEventListener("Verify",this.linkedModeListener.onVerify);b.addEventListener("ModelChanged",this.linkedModeListener.onModelChanged);this.contentAssist.addEventListener("Activating",this.linkedModeListener.onActivating);this.editor.reportStatus(n.linkedModeEntered,null,!0)}this._sortedPositions=null;this.linkedModeModel&&(e.previousModel=this.linkedModeModel,e.parentGroup=this.linkedModeModel.selectedGroupIndex,this.linkedModeModel.nextModel=e);this.linkedModeModel=
e;this.selectLinkedGroup(0)},exitLinkedMode:function(e){if(this.isActive()){this._compoundChange&&(this.endUndo(),this._compoundChange=null);this._sortedPositions=null;var b=this.linkedModeModel;this.linkedModeModel=b.previousModel;b.parentGroup=b.previousModel=void 0;this.linkedModeModel&&(this.linkedModeModel.nextModel=void 0);if(!this.linkedModeModel){var a=this.editor,d=a.getTextView();d.removeKeyMode(this);d.removeEventListener("Verify",this.linkedModeListener.onVerify);d.removeEventListener("ModelChanged",
this.linkedModeListener.onModelChanged);d=this.contentAssist;d.removeEventListener("Activating",this.linkedModeListener.onActivating);d.offset=void 0;this.editor.reportStatus(n.linkedModeExited,null,!0);e&&a.setCaretOffset(b.escapePosition,!1)}this.selectLinkedGroup(0)}},startUndo:function(){if(this.undoStack){var e=this,b=this.linkedModeModel;this._compoundChange=this.undoStack.startCompoundChange({model:b,group:b.selectedGroupIndex,end:function(){e._compoundChange=null}})}},endUndo:function(){this.undoStack&&
this.undoStack.endCompoundChange()},isActive:function(){return!!this.linkedModeModel},isStatusActive:function(){return!!this.linkedModeModel},selectLinkedGroup:function(e){var b=this.linkedModeModel;if(b){b.selectedGroupIndex=e;e=b.groups[e];var a=e.positions[0],d=this.editor;d.setSelection(a.offset,a.offset+a.length);if(b=this.contentAssist)b.offset=void 0,e.data&&"link"===e.data.type&&e.data.values?((this._groupContentAssistProvider=new f.TemplateContentAssist(e.data.values)).getPrefix=function(){var b=
d.getSelection();return b.start===b.end&&(b=d.getCaretOffset(),a.offset<=b&&b<=a.offset+a.length)?d.getText(a.offset,b):""},b.offset=a.offset,b.deactivate(),b.activate()):this._groupContentAssistProvider&&(this._groupContentAssistProvider=null,b.deactivate())}this._updateAnnotations()},_getModelPositions:function(e,b,a){for(var d=b.groups,f=0;f<d.length;f++)for(var g=d[f].positions,l=0;l<g.length;l++){var h=g[l];a&&(h={offset:h.offset+a,length:h.length});h={index:l,group:f,count:g.length,model:b,
position:h};e.push(h);b.nextModel&&b.nextModel.parentGroup===f&&(h.ansestor=!0,this._getModelPositions(e,b.nextModel,(a||0)+g[l].offset-g[0].offset))}},_getSortedPositions:function(e){var b=this._sortedPositions;if(!b){for(b=[];e.previousModel;)e=e.previousModel;for(this._getModelPositions(b,e);e;)void 0!==e.escapePosition&&b.push({escape:!0,model:e,position:{offset:e.escapePosition,length:0}}),e=e.nextModel;b.sort(function(a,b){return a.position.offset-b.position.offset});this._sortedPositions=b}return b},
_getPositionChanged:function(e,b,a){var d;e=this._getSortedPositions(e);for(var f=e.length-1;0<=f;f--){var g=e[f].position;if(g.offset<=b&&a<=g.offset+g.length){d=e[f];break}}return{position:d,positions:e}},_updateAnnotations:function(e){var b=this.editor.getAnnotationModel();if(b){for(var a=[],d=[],f=b.getAnnotations(),g;f.hasNext();)switch(g=f.next(),g.type){case k.AnnotationType.ANNOTATION_LINKED_GROUP:case k.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP:case k.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:a.push(g)}if(f=
this.linkedModeModel){e=e||this._getSortedPositions(f);for(var l=0;l<e.length;l++)if(g=e[l],g.model===f){var h=k.AnnotationType.ANNOTATION_LINKED_GROUP;g.group===f.selectedGroupIndex&&(h=0===g.index?k.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:k.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP);g=g.position;g=k.AnnotationType.createAnnotation(h,g.offset,g.offset+g.length,"");d.push(g)}}b.replaceAnnotations(a,d)}}});p.LinkedMode=g;return p});
define("orion/editor/factories","orion/editor/actions orion/editor/undoStack orion/editor/rulers orion/editor/annotations orion/editor/textDND orion/editor/linkedMode".split(" "),function(n,t,r,k,f,h){function g(){}function p(){}function e(){}function b(){}function a(){}function d(){}var m={};g.prototype={createKeyBindings:function(a,b,d,e){e=new n.TextActions(a,b,e);var f=new h.LinkedMode(a,b,d);a=new n.SourceCodeActions(a,b,d,f);return{textActions:e,linkedMode:f,sourceCodeActions:a}}};m.KeyBindingsFactory=
g;p.prototype={createUndoStack:function(a){a=a.getTextView();return new t.UndoStack(a,200)}};m.UndoFactory=p;e.prototype={createLineNumberRuler:function(a){return new r.LineNumberRuler(a,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}};m.LineNumberRulerFactory=e;b.prototype={createFoldingRuler:function(a){return new r.FoldingRuler(a,"left",{styleClass:"ruler folding"})}};m.FoldingRulerFactory=b;a.prototype={createAnnotationModel:function(a){return new k.AnnotationModel(a)},
createAnnotationStyler:function(a,b){return new k.AnnotationStyler(a,b)},createAnnotationRulers:function(a){var b=new r.AnnotationRuler(a,"left",{styleClass:"ruler annotations"});a=new r.OverviewRuler(a,"right",{styleClass:"ruler overview"});return{annotationRuler:b,overviewRuler:a}}};m.AnnotationFactory=a;d.prototype={createTextDND:function(a,b){return new f.TextDND(a.getTextView(),b)}};m.TextDNDFactory=d;return m});
define("orion/editor/editorFeatures",["orion/editor/factories","orion/editor/actions","orion/editor/linkedMode","orion/objects"],function(n,t,r,k){return k.mixin({},n,t,r)});
(function(n,t){"function"===typeof define&&define.amd?define("orion/Deferred",t):"object"===typeof exports?module.exports=t():(n.orion=n.orion||{},n.orion.Deferred=t())})(this,function(){function n(){for(var g;g=f.shift();)g();h=!1}function t(k){f.push(k);h||(h=!0,g())}function r(f){return function(e){f(e)}}function k(){function f(){for(var a;a=h.shift();){var b=a.deferred,e="fulfilled"===g?"resolve":"reject";a=a[e];if("function"===typeof a)try{var l=a(d),k=l&&("object"===typeof l||"function"===typeof l)&&
l.then;if("function"===typeof k)if(l===b.promise)b.reject(new TypeError);else{var p=l.cancel;"function"===typeof p?b._parentCancel=p.bind(l):delete b._parentCancel;k.call(l,r(b.resolve),r(b.reject),r(b.progress))}else b.resolve(l)}catch(n){b.reject(n)}else b[e](d)}}function e(a){delete l._parentCancel;g="rejected";d=a;h.length&&t(f)}function b(a){function n(a){return function(b){(!g||"assumed"===g)&&a(b)}}delete l._parentCancel;try{var r=a&&("object"===typeof a||"function"===typeof a)&&a.then;if("function"===
typeof r)if(a===l)e(new TypeError);else{g="assumed";var w=a&&a.cancel;if("function"!==typeof w){var y=new k;a=y.promise;try{r(y.resolve,y.reject,y.progress)}catch(x){y.reject(x)}w=a.cancel;r=a.then}d=a;r.call(a,n(b),n(e));l._parentCancel=w.bind(a)}else g="fulfilled",d=a,h.length&&t(f)}catch(D){n(e)(D)}}function a(){var a=l._parentCancel;a?(delete l._parentCancel,a()):g||(a=Error("Cancel"),a.name="Cancel",e(a))}var d,g,h=[],l=this;this.resolve=function(a){g||b(a);return l};this.reject=function(a){g||
e(a);return l};this.progress=function(a){g||h.forEach(function(b){if(b.progress)try{b.progress(a)}catch(d){}});return l.promise};this.cancel=function(){l._parentCancel?setTimeout(a,0):a();return l};this.then=function(a,b,d){var e=new k;e._parentCancel=l.promise.cancel;h.push({resolve:a,reject:b,progress:d,deferred:e});("fulfilled"===g||"rejected"===g)&&t(f);return e.promise};this.promise={then:l.then,cancel:l.cancel}}var f=[],h=!1,g=function(){if("undefined"!==typeof process&&"function"===typeof process.nextTick){var f=
process.nextTick;return function(){f(n)}}if("function"===typeof MutationObserver){var e=document.createElement("div");(new MutationObserver(n)).observe(e,{attributes:!0});return function(){e.setAttribute("class","_tick")}}return function(){setTimeout(n,0)}}();k.all=function(f,e){function b(a,b){h||(g[a]=b,0===--d&&l.resolve(g))}function a(a,d){if(!h){if(e)try{b(a,e(d));return}catch(f){d=f}l.reject(d)}}var d=f.length,g=[],h=!1,l=new k;l.then(void 0,function(){h=!0;f.forEach(function(a){a.cancel&&a.cancel()})});
0===d?l.resolve(g):f.forEach(function(d,e){d.then(b.bind(void 0,e),a.bind(void 0,e))});return l.promise};k.when=function(f,e,b,a){var d;f&&"function"===typeof f.then||(d=new k,d.resolve(f),f=d.promise);return f.then(e,b,a)};return k});
define("orion/webui/littlelib",["orion/util"],function(n){function t(e,b){b||(b=document);return b.querySelectorAll(e)}function r(e){var b=e.tabIndex;0===b&&n.isIE&&!{a:!0,body:!0,button:!0,frame:!0,iframe:!0,img:!0,input:!0,isindex:!0,object:!0,select:!0,textarea:!0}[e.nodeName.toLowerCase()]&&!e.attributes.tabIndex&&(b=-1);return b}function k(e){if(0<=r(e))return e;if(e.hasChildNodes())for(var b=0;b<e.childNodes.length;b++){var a=k(e.childNodes[b]);if(a)return a}return null}function f(e){if(0<=
r(e))return e;if(e.hasChildNodes())for(var b=e.childNodes.length-1;0<=b;b--){var a=f(e.childNodes[b]);if(a)return a}return null}function h(e,b){if(3===e.nodeType){var a=g.exec(e.nodeValue);a&&1<a.length&&b(e,a)}if(e.hasChildNodes())for(a=0;a<e.childNodes.length;a++)h(e.childNodes[a],b)}var g=/\$\{([^\}]+)\}/,p=null;return{$:function(e,b){b||(b=document);return b.querySelector(e)},$$:t,$$array:function(e,b){return Array.prototype.slice.call(t(e,b))},node:function(e){var b=e;"string"===typeof e&&(b=
document.getElementById(e));return b},contains:function(e,b){if(!e||!b)return!1;if(e===b)return!0;var a=e.compareDocumentPosition(b);return Boolean(a&16)},bounds:function(e){e=e.getBoundingClientRect();return{left:e.left+document.documentElement.scrollLeft,top:e.top+document.documentElement.scrollTop,width:e.width,height:e.height}},empty:function(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)},firstTabbable:k,lastTabbable:f,stop:function(e){window.document.all&&(e.keyCode=0);e.preventDefault&&
(e.preventDefault(),e.stopPropagation())},processTextNodes:function(e,b){h(e,function(a,d){a.parentNode.replaceChild(document.createTextNode(b[d[1]]||d[1]),a)})},processDOMNodes:function(e,b){h(e,function(a,d){var e=b[d[1]];if(e){var f=document.createRange(),l=d.index;f.setStart(a,l);f.setEnd(a,l+d[0].length);f.deleteContents();f.insertNode(e)}})},addAutoDismiss:function(e,b){function a(a){p.forEach(function(b){var e=!1,f=b.excludeNodes.some(function(b){return document.body.contains(b)?(e=!0,b.contains(a.target)):
!1});if(e&&!f)try{b.dismiss(a)}catch(g){"undefined"!==typeof console&&console&&console.error(g&&g.message)}});p=p.filter(function(a){return a.excludeNodes.some(function(a){return document.body.contains(a)})})}null===p&&(p=[],document.addEventListener("click",a,!0),n.isIOS&&document.addEventListener("touchend",function(a){function b(){a.target.removeEventListener("click",b)}0===a.touches.length&&a.target.addEventListener("click",b)},!1));p.push({excludeNodes:e,dismiss:b})},setFramesEnabled:function(e){for(var b=
document.getElementsByTagName("iframe"),a=0;a<b.length;a++)b[a].parentNode.style.pointerEvents=e?"":"none"},removeAutoDismiss:function(e){p=p.filter(function(b){return e!==b.dismiss})},KEY:{BKSPC:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DEL:46}}});
define("orion/editor/contentAssist","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/eventTarget orion/Deferred orion/objects orion/editor/util orion/util orion/webui/littlelib".split(" "),function(n,t,r,k,f,h,g,p,e){function b(a){this.textView=a;this.state=m.INACTIVE;this.clearProviders();var b=this;this._textViewListeners={onModelChanging:function(a){(this._latestModelChangingEvent=a)&&this._updateFilterText(a)}.bind(this),onSelection:function(a){this.isDeactivatingChange(this._latestModelChangingEvent,
a)?this.setState(m.INACTIVE):this.isActive()&&(this.state===m.ACTIVE&&this.setState(m.FILTERING),this.filterProposals());this._latestModelChangingEvent=null}.bind(this),onScroll:function(a){this.setState(m.INACTIVE)}.bind(this)};a.setKeyBinding(p.isMac?new t.KeyBinding(" ",!1,!1,!1,!0):new t.KeyBinding(" ",!0),"contentAssist");a.setKeyBinding(p.isMac?new t.KeyBinding(" ",!1,!1,!0,!0):new t.KeyBinding(" ",!0,!1,!0),"contentAssist");a.setAction("contentAssist",function(){a.getOptions("readonly")||b.activate();
return!0},{name:n.contentAssist})}function a(a,b){var d=a.textView;r.KeyMode.call(this,d);this.contentAssist=a;this.widget=b;this.proposals=[];var e=this;this.contentAssist.addEventListener("ProposalsComputed",function(a){e.proposals=a.data.proposals;if(0===e.proposals.length)e.selectedIndex=-1,e.cancel();else{for(e.selectedIndex=0;e.proposals[e.selectedIndex]&&e.proposals[e.selectedIndex].unselectable;)e.selectedIndex++;if(e.proposals[e.selectedIndex]){if(e.widget){var b=!0;if(a.autoApply){for(a=
e.selectedIndex+1;e.proposals[a]&&e.proposals[a].unselectable;)a++;e.proposals[a]||(b=!1,e.contentAssist.apply(e.proposals[e.selectedIndex]))}b&&(e.widget.show(),e.widget.selectNode(e.selectedIndex))}}else e.selectedIndex=-1,e.cancel()}});d.setAction("contentAssistApply",function(){return this.enter()}.bind(this));d.setAction("contentAssistCancel",function(){return this.cancel()}.bind(this));d.setAction("contentAssistNextProposal",function(){return this.lineDown()}.bind(this));d.setAction("contentAssistPreviousProposal",
function(){return this.lineUp()}.bind(this));d.setAction("contentAssistNextPage",function(){return this.pageDown()}.bind(this));d.setAction("contentAssistPreviousPage",function(){return this.pageUp()}.bind(this));d.setAction("contentAssistHome",function(){this.widget&&this.widget.scrollIndex(0,!0);return this.lineDown(0)}.bind(this));d.setAction("contentAssistEnd",function(){return this.lineUp(this.proposals.length-1)}.bind(this));d.setAction("contentAssistTab",function(){return this.tab()}.bind(this));
this.widget&&(this.widget.setContentAssistMode(this),this.widget.createAccessible())}function d(a,b){this.contentAssist=a;this.textView=this.contentAssist.getTextView();this.isShowing=this.textViewListenerAdded=!1;var d=this.textView.getOptions("parent").ownerDocument;this.parentNode="string"===typeof b?d.getElementById(b):b;if(!this.parentNode){this.parentNode=p.createElement(d,"div");this.parentNode.className="contentassist";var e=d.getElementsByTagName("body")[0];if(e)e.appendChild(this.parentNode);
else throw Error("parentNode is required");}g.addEventListener(this.parentNode,"scroll",this.onScroll.bind(this));var f=this;this.textViewListener={onMouseDown:function(a){(a.event.target||a.event.srcElement).parentElement!==f.parentNode&&f.contentAssist.deactivate()}};this.contentAssist.addEventListener("Deactivating",function(a){f.hide()});this.scrollListener=function(a){f.isShowing&&f.position()};g.addEventListener(d,"scroll",this.scrollListener)}var m={INACTIVE:1,ACTIVE:2,FILTERING:3},s={selected:"selected",
hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",noemphasis_keyword:"proposal-noemphasis-keyword",noemphasis_title:"proposal-noemphasis-title",noemphasis_title_keywords:"proposal-noemphasis-title-keywords",dfault:"proposal-default"};b.prototype={apply:function(a){if(!a)return!1;var b=this.textView,d=b.getSelection(),e=this._initialCaretOffset,f=e,g=d=Math.max(d.start,d.end),h=b.getModel();h.getBaseModel&&(f=h.mapOffset(f),g=h.mapOffset(g),h=h.getBaseModel());a.overwrite&&
(e=this.getPrefixStart(h,f));f={proposal:a,start:f,end:g};this.setState(m.INACTIVE);b.setText("string"===typeof a?a:a.proposal,e,d);this.dispatchEvent({type:"ProposalApplied",data:f});return!0},activate:function(a,b){this.state===m.INACTIVE&&(this._autoTriggered=b?!0:!1,this.setState(m.ACTIVE,a))},deactivate:function(){this.setState(m.INACTIVE)},getTextView:function(){return this.textView},isActive:function(){return this.state===m.ACTIVE||this.state===m.FILTERING},isDeactivatingChange:function(a,
b){var d=!1;b.newValue.start<this._initialCaretOffset||!a?d=!0:a&&(d=0<a.removedLineCount||0<a.addedLineCount);return d},setState:function(a,b){var d;a===m.ACTIVE?(d="Activating",this._mode&&this._mode.setActive(!0)):a===m.INACTIVE&&(d="Deactivating",this._mode&&this._mode.setActive(!1));d&&this.dispatchEvent({type:d,providers:b});this.state=a;this.onStateChange(a)},setMode:function(a){this._mode=a},onStateChange:function(a){a===m.INACTIVE?(this._removeTextViewListeners(),this._filterText="",this._initialCaretOffset=
-1,this._computedProposals=null):a===m.ACTIVE&&(this._filterText="",this._addTextViewListeners(),this.computeProposals())},computeProposals:function(){var a=this.textView.getCaretOffset(),b=this.textView.getSelection(),b=Math.min(b.start,b.end);this._initialCaretOffset=Math.min(a,b);this._computedProposals=null;this._computeProposals(this._initialCaretOffset).then(function(a){if(this.isActive()){var b=this._flatten(a);b&&(Array.isArray(b)&&0<b.length)&&(this._computedProposals=a);this.dispatchEvent({type:"ProposalsComputed",
data:{proposals:b},autoApply:!this._autoTriggered});this._computedProposals&&this._filterText&&this.filterProposals(!0)}}.bind(this))},getPrefixStart:function(a,b){for(var d=b;0<d&&/[A-Za-z0-9_]/.test(a.getText(d-1,d));)d--;return d},handleError:function(a){"undefined"!==typeof console&&(console.log("Error retrieving content assist proposals"),console.log(a&&a.stack))},initialize:function(){this._providers.forEach(function(a){a=a.provider;"function"===typeof a.initialize&&a.initialize()})},_computeProposals:function(a){var b=
this._providers,d=this.textView,e=d.getSelection(),g=d.getModel(),m=a;g.getBaseModel&&(m=g.mapOffset(m),e.start=g.mapOffset(e.start),e.end=g.mapOffset(e.end),g=g.getBaseModel());a=g.getLine(g.getLineAtOffset(m));for(var k=0;k<a.length&&/\s/.test(a.charAt(k));)k++;var k=a.substring(0,k),d=d.getOptions("tabSize","expandTab"),d=d.expandTab?Array(d.tabSize+1).join(" "):"\t",p={line:a,offset:m,prefix:g.getText(this.getPrefixStart(g,m),m),selection:e,delimiter:g.getLineDelimiter(),tab:d,indentation:k},
s=this,b=b.map(function(a){a=a.provider;var b;try{var d,e;if(d=a.computeContentAssist){var l=s.editorContextProvider,k=l.getEditorContext();p=h.mixin(p,l.getOptions());e=d.apply(a,[k,p])}else if(d=a.getProposals||a.computeProposals)e=d.apply(a,[g.getText(),m,p]);b=s.progress?s.progress.progress(e,"Generating content assist proposal"):e}catch(n){return(new f).reject(n)}return f.when(b)});return f.all(b,this.handleError)},filterProposals:function(a){if(this._computedProposals&&(this._latestModelChangingEvent||
a)){a=this.textView.getModel();a.getBaseModel&&(a=a.getBaseModel());a=this.getPrefixStart(a,this._initialCaretOffset);var b=this.textView.getText(a,this._initialCaretOffset),d=[];this._computedProposals.forEach(function(a){a&&Array.isArray(a)&&(a=a.filter(function(a){if(!a)return!1;if(s[a.style]===s.hr||s[a.style]===s.noemphasis_title)return!0;var d="";if(a.overwrite){if(a.name)d=a.name;else if(a.proposal)d=a.proposal;else return!1;return 0===d.indexOf(b+this._filterText)}return a.name||a.proposal?
(d=!1,a.name&&(d=0===a.name.indexOf(b+this._filterText)),!d&&a.proposal&&(d=0===a.proposal.indexOf(this._filterText)),d):"string"===typeof a?0===a.indexOf(this._filterText):!1},this),0<a.length&&d.push(a))},this);a=[];d&&(d=this._removeExtraUnselectableElements(d),a=this._flatten(d));this.dispatchEvent({type:"ProposalsComputed",data:{proposals:a},autoApply:!1})}},_removeExtraUnselectableElements:function(a){return a.map(function(a){return a.filter(function(b,d){var e=!0;if(s[b.style]===s.hr)0===d||
a.length-1===d?e=!1:s.hr===s[a[d-1].style]&&(e=!1);else if(s[b.style]===s.noemphasis_title){var f=a[d+1];f?s[f.style]===s.noemphasis_title&&(e=!1):e=!1}return e})})},setEditorContextProvider:function(a){this.editorContextProvider=a},_generateProviderId:function(){this._idcount?this._idcount++:this._idcount=0;return"ContentAssistGeneratedID_"+this._idcount},setAutoTriggerEnabled:function(a){this._autoTriggerEnabled=a;this._updateAutoTriggerListenerState()},setProviders:function(a){var b=this;this.setProviderInfoArray(a.map(function(a){return a.id?
a:{provider:a,id:b._generateProviderId()}}))},setProviderInfoArray:function(a){this.clearProviders();this._providers=a;this._charTriggersInstalled=a.some(function(a){return a.charTriggers});this._updateAutoTriggerListenerState()},getProviders:function(){return this._providers.slice()},clearProviders:function(){this._providers=[];this._charTriggersInstalled=!1;this._updateAutoTriggerListenerState()},setProgress:function(a){this.progress=a},setStyleAccessor:function(a){this._styleAccessor=a},_flatten:function(a){return a.reduce(function(a,
b){var d=a,e=null;b&&Array.isArray(b)&&(e=b.filter(function(a){return a}));if(e&&Array.isArray(e)&&0<e.length){var d=e,f=a,l=e[0].style;l&&0===s[l].indexOf(s.noemphasis)&&(d=a,f=e);0<d.length&&(e=d[d.length-1].style)&&s.hr!==s[e]&&(d=d.concat({proposal:"",name:"",description:"---------------------------------",style:"hr",unselectable:!0}));d=d.concat(f)}return d},[])},_triggerListener:function(){var a=this.textView.getCaretOffset(),b=null,d=[];if(this._charTriggersInstalled){var e=this.textView.getText(a-
1,a);this._providers.forEach(function(f){var g=f.charTriggers;if(g&&g.test(e)){var g=!1,m=f.excludedStyles;this._styleAccessor&&m&&(b||(b=this._styleAccessor.getStyles(a-1)),g=b.some(function(a){return m.test(a.style)}));g||d.push(f)}},this);0<d.length&&this.activate(d,!0)}},_updateAutoTriggerListenerState:function(){this._boundTriggerListener||(this._boundTriggerListener=this._triggerListener.bind(this));if(this._triggerListenerInstalled){if(!this._autoTriggerEnabled||!this._charTriggersInstalled)this.textView.removeEventListener("Modify",
this._boundTriggerListener),this._triggerListenerInstalled=!1}else this._autoTriggerEnabled&&this._charTriggersInstalled&&(this.textView.addEventListener("Modify",this._boundTriggerListener),this._triggerListenerInstalled=!0)},_addTextViewListeners:function(){this._textViewListenersAdded||(this.textView.addEventListener("ModelChanging",this._textViewListeners.onModelChanging),this.textView.addEventListener("Scroll",this._textViewListeners.onScroll),this.textView.addEventListener("Selection",this._textViewListeners.onSelection),
this._textViewListenersAdded=!0)},_removeTextViewListeners:function(){this._textViewListenersAdded&&(this._latestModelChangingEvent=null,this.textView.removeEventListener("ModelChanging",this._textViewListeners.onModelChanging),this.textView.removeEventListener("Scroll",this._textViewListeners.onScroll),this.textView.removeEventListener("Selection",this._textViewListeners.onSelection),this._textViewListenersAdded=!1)},_updateFilterText:function(a){var b=a.removedCharCount;b&&(this._filterText=this._filterText.substring(0,
this._filterText.length-b));if(a=a.text)this._filterText=this._filterText.concat(a)}};k.EventTarget.addMixin(b.prototype);a.prototype=new r.KeyMode;h.mixin(a.prototype,{createKeyBindings:function(){var a=t.KeyBinding,b=[];b.push({actionID:"contentAssistApply",keyBinding:new a(13)});b.push({actionID:"contentAssistCancel",keyBinding:new a(27)});b.push({actionID:"contentAssistNextProposal",keyBinding:new a(40)});b.push({actionID:"contentAssistPreviousProposal",keyBinding:new a(38)});b.push({actionID:"contentAssistNextPage",
keyBinding:new a(34)});b.push({actionID:"contentAssistPreviousPage",keyBinding:new a(33)});b.push({actionID:"contentAssistHome",keyBinding:new a(e.KEY.HOME)});b.push({actionID:"contentAssistEnd",keyBinding:new a(e.KEY.END)});b.push({actionID:"contentAssistTab",keyBinding:new a(9)});return b},cancel:function(){this.getContentAssist().deactivate()},getContentAssist:function(){return this.contentAssist},getProposals:function(){return this.proposals},isActive:function(){return this.getContentAssist().isActive()},
setActive:function(a){a?this.contentAssist.textView.addKeyMode(this):this.contentAssist.textView.removeKeyMode(this)},lineUp:function(a,b){return this.selectNew(a,b,!1)},lineDown:function(a,b){return this.selectNew(a,b,!0)},selectNew:function(a,b,d){if(d){if(void 0===a&&(a=this.selectedIndex+1),a>=this.proposals.length){if(b)return!0;a=0}}else if(void 0===a&&(a=this.selectedIndex-1),0>a){if(b)return!0;a=this.proposals.length-1}for(var e=a;this.proposals[a]&&this.proposals[a].unselectable;){if(d){if(a++,
a>=this.proposals.length){if(b)return!0;a=0}}else if(a--,0>a){if(b)return!0;a=this.proposals.length-1}if(a===e){a=-1;break}}this.selectedIndex=a;this.widget&&this.widget.selectNode(a);return!0},pageUp:function(){if(this.widget){var a=this.widget.getTopIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!1),a=this.widget.getTopIndex());return 0===a?this.lineDown(a,!0):this.lineUp(a,!0)}return this.lineUp()},pageDown:function(){if(this.widget){var a=this.widget.getBottomIndex();a===this.selectedIndex&&
(this.widget.scrollIndex(a,!0),a=this.widget.getBottomIndex());return this.lineDown(a,!0)}return this.lineDown()},enter:function(){return this.contentAssist.apply(this.proposals[this.selectedIndex]||null)},tab:function(){return this.widget?(this.widget.parentNode.focus(),!0):!1}});d.prototype={onClick:function(a){a||(a=window.event);this.contentAssist.apply(this.getProposal(a.target||a.srcElement));this.textView.focus()},onScroll:function(a){this.previousCloneNode&&!this.preserveCloneThroughScroll&&
(this._removeCloneNode(),this.previousSelectedNode.classList.add(s.selected));this.preserveCloneThroughScroll=!1},createDiv:function(a,b,d){var e=b.ownerDocument,f=p.createElement(e,"div");f.id="contentoption"+d;f.setAttribute("role","option");f.className=s[a.style]?s[a.style]:s.dfault;"hr"===a.style?a=p.createElement(e,"hr"):(a=this._createDisplayNode(f,a,d),f.contentAssistProposalIndex=d);f.appendChild(a);b.appendChild(f)},createAccessible:function(){var a=this._contentAssistMode,b=this;g.addEventListener(this.parentNode,
"keydown",function(d){d||(d=window.event);d.preventDefault&&d.preventDefault();return d.keyCode===e.KEY.ESCAPE?a.cancel():d.keyCode===e.KEY.UP?a.lineUp():d.keyCode===e.KEY.DOWN?a.lineDown():d.keyCode===e.KEY.ENTER?a.enter():d.keyCode===e.KEY.PAGEDOWN?a.pageDown():d.keyCode===e.KEY.PAGEUP?a.pageUp():d.keyCode===e.KEY.HOME?(b.scrollIndex(0,!0),a.lineDown(0)):d.keyCode===e.KEY.END?a.lineUp(a.getProposals().length-1):!1})},_createDisplayNode:function(a,b,d){var e=null,f=null;if("string"===typeof b)f=
b;else if(b.description&&"string"===typeof b.description)if(b.name&&"string"===typeof b.name){var g=this._createNameNode(b.name);g.contentAssistProposalIndex=d;e=document.createElement("span");e.appendChild(g);g=document.createTextNode(b.description);e.appendChild(g);a.setAttribute("title",b.name+b.description)}else f=b.description;else f=b.proposal;f&&(e=this._createNameNode(f),a.setAttribute("title",f));e.contentAssistProposalIndex=d;return e},_createNameNode:function(a){var b=document.createElement("span");
b.classList.add("proposal-name");b.appendChild(document.createTextNode(a));return b},getProposal:function(a){var b=null;a=a.contentAssistProposalIndex;void 0!==a&&(b=this._contentAssistMode.getProposals()[a]||null);return b},getTopIndex:function(){for(var a=this.parentNode.childNodes,b=0;b<a.length;b++)if(a[b].offsetTop>=this.parentNode.scrollTop)return b;return 0},getBottomIndex:function(){for(var a=this.parentNode.childNodes,b=0;b<a.length;b++){var d=a[b];if(d.offsetTop+d.offsetHeight>this.parentNode.scrollTop+
this.parentNode.clientHeight)return Math.max(0,b-1)}return a.length-1},scrollIndex:function(a,b){this.parentNode.childNodes[a].scrollIntoView(b);this.preserveCloneThroughScroll=!0},selectNode:function(a){var b=null;this.previousSelectedNode&&(this.previousSelectedNode.classList.remove(s.selected),this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode());if(-1!==a){b=this.parentNode.childNodes[a];b.classList.add(s.selected);this.parentNode.setAttribute("aria-activedescendant",
b.id);b.focus();b.offsetTop<this.parentNode.scrollTop?(b.scrollIntoView(!0),this.preserveCloneThroughScroll=!0):b.offsetTop+b.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&(b.scrollIntoView(!1),this.preserveCloneThroughScroll=!0);var d=e.bounds(b.firstChild||b),f=e.bounds(this.parentNode);a=window.getComputedStyle(this.parentNode);var g=window.getComputedStyle(b),g=parseInt(a.paddingLeft)+parseInt(a.paddingRight)+parseInt(g.paddingLeft)+parseInt(g.paddingRight);if(d.width>=
f.width-g){g=parseInt(a.top);f=b.cloneNode(!0);f.classList.add("cloneProposal");f.style.top=g+b.offsetTop-this.parentNode.scrollTop+"px";f.style.left=a.left;f.setAttribute("id",f.id+"_clone");d=d.left+d.width-parseInt(document.documentElement.clientWidth);0<d&&(a=parseInt(a.left)-d,0>a&&(a=0),f.style.left=a+"px");a=document.createElement("div");a.id="clone_contentassist";a.classList.add("contentassist");a.classList.add("cloneWrapper");a.appendChild(f);a.onclick=this.parentNode.onclick;this.parentNode.parentNode.insertBefore(a,
this.parentNode);var m=function(a){a.contentAssistProposalIndex=b.contentAssistProposalIndex;if(a.hasChildNodes())for(var d=0;d<a.childNodes.length;d++)m(a.childNodes[d])};m(a);b.classList.remove(s.selected);this.previousCloneNode=a}}this.previousSelectedNode=b},setContentAssistMode:function(a){this._contentAssistMode=a},show:function(){var a=this._contentAssistMode.getProposals();if(0===a.length)this.hide();else{this.parentNode.innerHTML="";for(var b=0;b<a.length;b++)this.createDiv(a[b],this.parentNode,
b);this.position();this.parentNode.onclick=this.onClick.bind(this);this.isShowing=!0;this.textViewListenerAdded||(this.textView.addEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!0)}},hide:function(){this.parentNode.ownerDocument.activeElement===this.parentNode&&this.textView.focus();this.parentNode.style.display="none";this.parentNode.onclick=null;this.isShowing=!1;this.textViewListenerAdded&&(this.textView.removeEventListener("MouseDown",this.textViewListener.onMouseDown),
this.textViewListenerAdded=!1);this.previousSelectedNode&&(this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode())},position:function(){var a=this.contentAssist,b=this.textView;if(void 0!==a.offset){var a=a.offset,d=b.getModel();d.getBaseModel&&(a=d.mapOffset(a,!0))}else a=this.textView.getCaretOffset();a=b.getLocationAtOffset(a);a.y+=b.getLineHeight();this.textView.convert(a,"document","page");this.parentNode.style.position="fixed";this.parentNode.style.left=a.x+"px";this.parentNode.style.top=
a.y+"px";this.parentNode.style.display="block";this.parentNode.scrollTop=0;b=this.parentNode.ownerDocument;d=b.documentElement.clientWidth;a.y+this.parentNode.offsetHeight>b.documentElement.clientHeight&&(this.parentNode.style.top=a.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+"px");a.x+this.parentNode.offsetWidth>d&&(this.parentNode.style.left=d-this.parentNode.offsetWidth+"px")},_removeCloneNode:function(){this.parentNode.parentNode.contains(this.previousCloneNode)&&this.parentNode.parentNode.removeChild(this.previousCloneNode);
this.previousCloneNode=null}};return{ContentAssist:b,ContentAssistMode:a,ContentAssistWidget:d}});
define("orion/editor/stylers/lib/syntax",[],function(){return{id:"orion.lib",grammars:[{id:"orion.lib",repository:{brace_open:{match:"{",name:"punctuation.section.block.begin"},brace_close:{match:"}",name:"punctuation.section.block.end"},bracket_open:{match:"\\[",name:"punctuation.section.bracket.begin"},bracket_close:{match:"\\]",name:"punctuation.section.bracket.end"},parenthesis_open:{match:"\\(",name:"punctuation.section.parens.begin"},parenthesis_close:{match:"\\)",name:"punctuation.section.parens.end"},
doc_block:{begin:{match:"/\\*\\*",literal:"/**"},end:{match:"\\*/",literal:"*/"},name:"comment.block.documentation",patterns:[{match:"@(?:(?!\\*/)\\S)*",name:"keyword.other.documentation.tag"},{match:"\\\x3c\\S*\\\x3e",name:"keyword.other.documentation.markup"},{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]},number_decimal:{match:"\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:[eE][+-]?\\d+)?\\b",name:"constant.numeric.number"},
number_hex:{match:"\\b0[xX][0-9A-Fa-f]+\\b",name:"constant.numeric.hex"},string_doubleQuote:{match:'"(?:\\\\.|[^"])*"?',name:"string.quoted.double"},string_singleQuote:{match:"'(?:\\\\.|[^'])*'?",name:"string.quoted.single"},todo_comment_singleLine:{match:"(\\b)(TODO)(\\b)(.*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}}},{id:"orion.c-like",repository:{comment_singleLine:{match:{match:"//.*",literal:"//"},name:"comment.line.double-slash",
patterns:[{include:"orion.lib#todo_comment_singleLine"}]},comment_block:{begin:{match:"/\\*",literal:"/*"},end:{match:"\\*/",literal:"*/"},name:"comment.block",patterns:[{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]}}}],keywords:[]}});
define("orion/editor/stylers/text_css/syntax",["orion/editor/stylers/lib/syntax"],function(n){var t="alignment-adjust alignment-baseline animation-delay animation-direction animation-duration animation-iteration-count animation-name animation-play-state animation-timing-function animation appearance azimuth backface-visibility background-attachment background-clip background-color background-image background-origin background-position background-repeat background-size background baseline-shift binding bleed bookmark-label bookmark-level bookmark-state bookmark-target border-bottom-color border-bottom-left-radius border-bottom-right-radius border-bottom-style border-bottom-width border-bottom border-collapse border-color border-image-outset border-image-repeat border-image-slice border-image-source border-image-width border-image border-left-color border-left-style border-left-width border-left border-radius border-right-color border-right-style border-right-width border-right border-spacing border-style border-top-color border-top-left-radius border-top-right-radius border-top-style border-top-width border-top border-width border bottom box-align box-decoration-break box-direction box-flex-group box-flex box-lines box-ordinal-group box-orient box-pack box-shadow box-sizing break-after break-before break-inside caption-side clear clip color-profile color column-count column-fill column-gap column-rule-color column-rule-style column-rule-width column-rule column-span column-width columns content counter-increment counter-reset crop cue-after cue-before cue cursor direction display dominant-baseline drop-initial-after-adjust drop-initial-after-align drop-initial-before-adjust drop-initial-before-align drop-initial-size drop-initial-value elevation empty-cells fit-position fit flex-align flex-flow flex-inline-pack flex-order flex-pack float-offset float font-family font-size font-size-adjust font-stretch font-style font-variant font-weight font grid-columns grid-rows hanging-punctuation height hyphenate-after hyphenate-before hyphenate-character hyphenate-lines hyphenate-resource hyphens icon image-orientation image-rendering image-resolution inline-box-align left letter-spacing line-height line-stacking-ruby line-stacking-shift line-stacking-strategy line-stacking list-style-image list-style-position list-style-type list-style margin-bottom margin-left margin-right margin-top margin mark-after mark-before mark marker-offset marks marquee-direction marquee-loop marquee-play-count marquee-speed marquee-style max-height max-width min-height min-width move-to nav-down nav-index nav-left nav-right nav-up opacity orphans outline-color outline-offset outline-style outline-width outline overflow-style overflow-x overflow-y overflow padding-bottom padding-left padding-right padding-top padding page-break-after page-break-before page-break-inside page-policy page pause-after pause-before pause perspective-origin perspective phonemes pitch-range pitch play-during position presentation-level punctuation-trim quotes rendering-intent resize rest-after rest-before rest richness right rotation-point rotation ruby-align ruby-overhang ruby-position ruby-span size speak-header speak-numeral speak-punctuation speak speech-rate stress string-set table-layout target-name target-new target-position target text-align-last text-align text-decoration text-emphasis text-height text-indent text-justify text-outline text-shadow text-transform text-wrap top transform-origin transform-style transform transition-delay transition-duration transition-property transition-timing-function transition unicode-bidi vertical-align visibility voice-balance voice-duration voice-family voice-pitch-range voice-pitch voice-rate voice-stress voice-volume volume white-space-collapse white-space widows width word-break word-spacing word-wrap z-index".split(" ");n=
n.grammars;n.push({id:"orion.css",contentTypes:["text/css"],patterns:[{begin:"'(?:\\\\.|[^\\\\'])*\\\\$",end:"^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))",name:"string.quoted.single.css"},{begin:'"(?:\\\\.|[^\\\\"])*\\\\$',end:'^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))',name:"string.quoted.double.css"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_block"},{include:"orion.lib#brace_open"},{include:"orion.lib#brace_close"},{include:"orion.lib#bracket_open"},
{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#number_decimal"},{include:"#number_hex"},{match:"(?i)\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:%|em|ex|ch|rem|vw|vh|vmin|vmax|in|cm|mm|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?\\b",name:"constant.numeric.value.css"},{match:"(?:-webkit-|-moz-|-ms-|-o-|\\b)(?:"+t.join("|")+")\\b",name:"keyword.control.css"}],repository:{number_hex:{match:"#[0-9A-Fa-f]+\\b",name:"constant.numeric.hex.css"}}});
return{id:n[n.length-1].id,grammars:n,keywords:t}});
define("webtools/cssContentAssist",["orion/editor/templates","orion/editor/stylers/text_css/syntax"],function(n,t){function r(a){return JSON.stringify(a).replace("}","\\}")}function k(){}for(var f={type:"link",values:"visible hidden scroll auto no-display no-content".split(" ")},h={type:"link",values:"solid dashed dotted double groove ridge inset outset".split(" ")},g={type:"link",values:[]},p=0;10>p;p++)g.values.push(p.toString());for(var e={type:"link",values:"black white red green blue magenta yellow cyan grey darkred darkgreen darkblue darkmagenta darkcyan darkyellow darkgray lightgray".split(" ")},
b=[{prefix:"rule",description:"rule - class selector rule",template:".${class} {\n\t${cursor}\n}"},{prefix:"rule",description:"rule - id selector rule",template:"#${id} {\n\t${cursor}\n}"},{prefix:"outline",description:"outline - outline style",template:"outline: ${color:"+r(e)+"} ${style:"+r(h)+"} ${width:"+r(g)+"}px;"},{prefix:"background-image",description:"background-image - image style",template:'background-image: url("${uri}");'},{prefix:"url",description:"url - url image",template:'url("${uri}");'},
{prefix:"rgb",description:"rgb - rgb color",template:"rgb(${red},${green},${blue});"},{prefix:"@",description:"import - import style sheet",template:'@import "${uri}";'}],a=[{prop:"display",values:{type:"link",values:"none block box flex inline inline-block inline-flex inline-table list-item table table-caption table-cell table-column table-column-group table-footer-group table-header-group table-row table-row-group inherit".split(" ")}},{prop:"overflow",values:f},{prop:"overflow-x",values:f},{prop:"overflow-y",
values:f},{prop:"float",values:{type:"link",values:["left","right","none","inherit"]}},{prop:"position",values:{type:"link",values:["absolute","fixed","relative","static","inherit"]}},{prop:"cursor",values:{type:"link",values:"auto crosshair default e-resize help move n-resize ne-resize nw-resize pointer progress s-resize se-resize sw-resize text w-resize wait inherit".split(" ")}},{prop:"color",values:e},{prop:"border-top-color",values:e},{prop:"border-bottom-color",values:e},{prop:"border-right-color",
values:e},{prop:"border-left-color",values:e},{prop:"background-color",values:e},{prop:"font-style",values:{type:"link",values:["italic","normal","oblique","inherit"]}},{prop:"font-weight",values:{type:"link",values:"bold normal bolder lighter 100 200 300 400 500 600 700 800 900 inherit".split(" ")}},{prop:"white-space",values:{type:"link",values:"pre pre-line pre-wrap nowrap normal inherit".split(" ")}},{prop:"word-wrap",values:{type:"link",values:["normal","break-word"]}},{prop:"visibility",values:{type:"link",
values:["hidden","visible","collapse","inherit"]}}],p=0;p<a.length;p++)f=a[p],b.push({prefix:f.prop,description:f.prop+" - "+f.prop+" style",template:f.prop+": ${value:"+r(f.values)+"};"});a="width height top bottom left right min-width min-height max-width max-height margin padding padding-left padding-right padding-top padding-bottom margin-left margin-top margin-bottom margin-right".split(" ");for(p=0;p<a.length;p++)f=a[p],b.push({prefix:f,description:f+" - "+f+" pixel style",template:f+": ${value}px;"});
a=["padding","margin"];for(p=0;p<a.length;p++)f=a[p],b.push({prefix:f,description:f+" - "+f+" top right bottom left style",template:f+": ${top}px ${left}px ${bottom}px ${right}px;"}),b.push({prefix:f,description:f+" - "+f+" top right,left bottom style",template:f+": ${top}px ${right_left}px ${bottom}px;"}),b.push({prefix:f,description:f+" - "+f+" top,bottom right,left style",template:f+": ${top_bottom}px ${right_left}px"});a=["border","border-top","border-bottom","border-left","border-right"];for(p=
0;p<a.length;p++)f=a[p],b.push({prefix:f,description:f+" - "+f+" style",template:f+": ${width:"+r(g)+"}px ${style:"+r(h)+"} ${color:"+r(e)+"};"});k.prototype=new n.TemplateContentAssist(t.keywords,b);k.prototype.getPrefix=function(a,b,e){for(e=b;e&&/[A-Za-z\-\@]/.test(a.charAt(e-1));)e--;return e?a.substring(e,b):""};return{CssContentAssistProvider:k}});
define("webtools/htmlContentAssist",["orion/editor/templates"],function(n){function t(){}var r=new n.Template("","Simple HTML document",'\x3c!DOCTYPE html\x3e\n\x3chtml lang\x3d"en"\x3e\n\t\x3chead\x3e\n\t\t\x3cmeta charset\x3dutf-8\x3e\n\t\t\x3ctitle\x3e${title}\x3c/title\x3e\n\t\x3c/head\x3e\n\t\x3cbody\x3e\n\t\t\x3ch1\x3e${header}\x3c/h1\x3e\n\t\t\x3cp\x3e\n\t\t\t${cursor}\n\t\t\x3c/p\x3e\n\t\x3c/body\x3e\n\x3c/html\x3e'),k=[{prefix:"\x3cimg",name:"\x3cimg\x3e",description:" - HTML image element",
template:'\x3cimg src\x3d"${cursor}" alt\x3d"${Image}"/\x3e'},{prefix:"\x3ca",name:"\x3ca\x3e",description:" - HTML anchor element",template:'\x3ca href\x3d"${cursor}"\x3e\x3c/a\x3e'},{prefix:"\x3cul",name:"\x3cul\x3e",description:" - HTML unordered list",template:"\x3cul\x3e\n\t\x3cli\x3e${cursor}\x3c/li\x3e\n\x3c/ul\x3e"},{prefix:"\x3col",name:"\x3col\x3e",description:" - HTML ordered list",template:"\x3col\x3e\n\t\x3cli\x3e${cursor}\x3c/li\x3e\n\x3c/ol\x3e"},{prefix:"\x3cdl",name:"\x3cdl\x3e",
description:" - HTML definition list",template:"\x3cdl\x3e\n\t\x3cdt\x3e${cursor}\x3c/dt\x3e\n\t\x3cdd\x3e\x3c/dd\x3e\n\x3c/dl\x3e"},{prefix:"\x3ctable",name:"\x3ctable\x3e",description:" - basic HTML table",template:"\x3ctable\x3e\n\t\x3ctr\x3e\n\t\t\x3ctd\x3e${cursor}\x3c/td\x3e\n\t\x3c/tr\x3e\n\x3c/table\x3e"},{prefix:"\x3c!--",name:"\x3c!-- --\x3e",description:" - HTML comment",template:"\x3c!-- ${cursor} --\x3e"}],f,h,g,p,e="abbr b button canvas cite command dd del dfn dt em embed font h1 h2 h3 h4 h5 h6 i ins kbd label li mark meter object option output progress q rp rt samp small strong sub sup td time title tt u var".split(" ");
for(p=0;p<e.length;p++)f=e[p],g="\x3c"+f+"\x3e\x3c/"+f+"\x3e",h="\x3c"+f+"\x3e${cursor}\x3c/"+f+"\x3e",k.push({prefix:"\x3c"+f,description:g,template:h});e="address article aside audio bdo blockquote body caption code colgroup datalist details div fieldset figure footer form head header hgroup iframe legend map menu nav noframes noscript optgroup p pre ruby script section select span style tbody textarea tfoot th thead tr video".split(" ");for(p=0;p<e.length;p++)f=e[p],g="\x3c"+f+"\x3e\x3c/"+f+"\x3e",
h="\x3c"+f+"\x3e\n\t${cursor}\n\x3c/"+f+"\x3e",k.push({prefix:"\x3c"+f,description:g,template:h});e="area base br col hr input link meta param keygen source".split(" ");for(p=0;p<e.length;p++)f=e[p],h=g="\x3c"+f+"/\x3e",k.push({prefix:"\x3c"+f,description:g,template:h});t.prototype=new n.TemplateContentAssist([],k);t.prototype.getPrefix=function(b,a,d){d="";for(var e=a;e&&/[A-Za-z0-9<!-]/.test(b.charAt(e-1));)if(e--,"\x3c"===b.charAt(e)){d=b.substring(e,a);break}return d};t.prototype.computeProposals=
function(b,a,d){return 0===b.length?[r.getProposal("",a,d)]:n.TemplateContentAssist.prototype.computeProposals.call(this,b,a,d).sort(function(a,b){var d=a.prefix||a.proposal,e=b.prefix||b.proposal;if(d){if(!e)return 1}else return-1;return d.toLowerCase().localeCompare(e.toLowerCase())})};return{HTMLContentAssistProvider:t}});
define("orion/editor/AsyncStyler",["i18n!orion/editor/nls/messages","orion/editor/annotations"],function(n,t){function r(g){return-1!==g.getProperty("objectClass").indexOf(f)&&"highlighter"===g.getProperty("type")}function k(f,h,e){this.initialize(f,h,e);this.lineStyles=[]}var f="orion.edit.highlighter",h=f+" service must be an event emitter";t.AnnotationType.registerType("orion.annotation.highlightError",{title:n.syntaxError,html:"\x3cdiv class\x3d'annotationHTML error'\x3e\x3c/div\x3e",rangeStyle:{styleClass:"annotationRange error"}});
k.prototype={initialize:function(g,h,e){this.textView=g;this.serviceRegistry=h;this.annotationModel=e;this.services=[];var b=this;this.listener={onModelChanging:function(a){b.onModelChanging(a)},onModelChanged:function(a){b.onModelChanged(a)},onDestroy:function(a){b.onDestroy(a)},onLineStyle:function(a){b.onLineStyle(a)},onStyleReady:function(a){b.onStyleReady(a)},onServiceAdded:function(a){b.onServiceAdded(a.serviceReference,b.serviceRegistry.getService(a.serviceReference))},onServiceRemoved:function(a){b.onServiceRemoved(a.serviceReference,
b.serviceRegistry.getService(a.serviceReference))}};g.addEventListener("ModelChanging",this.listener.onModelChanging);g.addEventListener("ModelChanged",this.listener.onModelChanged);g.addEventListener("Destroy",this.listener.onDestroy);g.addEventListener("LineStyle",this.listener.onLineStyle);h.addEventListener("registered",this.listener.onServiceAdded);h.addEventListener("unregistering",this.listener.onServiceRemoved);g=h.getServiceReferences(f);for(e=0;e<g.length;e++){var a=g[e];r(a)&&this.addServiceListener(h.getService(a))}},
onDestroy:function(f){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanging",this.listener.onModelChanging),this.textView.removeEventListener("ModelChanged",this.listener.onModelChanged),this.textView.removeEventListener("Destroy",this.listener.onDestroy),this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView=null);if(this.services){for(var f=0;f<this.services.length;f++)this.removeServiceListener(this.services[f]);this.services=
null}this.serviceRegistry&&(this.serviceRegistry.removeEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.removeEventListener("unregistering",this.listener.onServiceRemoved),this.serviceRegistry=null);this.lineStyles=this.listener=null},onModelChanging:function(f){this.startLine=this.textView.getModel().getLineAtOffset(f.start)},onModelChanged:function(f){var h=this.startLine;(f.addedLineCount||f.removedLineCount)&&Array.prototype.splice.apply(this.lineStyles,[h,f.removedLineCount].concat(this._getEmptyStyle(f.addedLineCount)))},
onStyleReady:function(f){var h=f.lineStyles||f.style;f=Number.MAX_VALUE;var e=-1,b=this.textView.getModel(),a;for(a in h)Object.prototype.hasOwnProperty.call(h,a)&&(this.lineStyles[a]=h[a],f=Math.min(f,a),e=Math.max(e,a));f=Math.max(f,0);e=Math.min(e,b.getLineCount());if(h=this.annotationModel){for(var d=h.getAnnotations(b.getLineStart(f),b.getLineEnd(e)),m=[];d.hasNext();){var k=d.next();"orion.annotation.highlightError"===k.type&&m.push(k)}d=[];for(k=f;k<=e;k++){a=k;var l=this.lineStyles[a],l=l&&
l.errors;a=b.getLineStart(a);if(l)for(var n=0;n<l.length;n++){var v=l[n];d.push(t.AnnotationType.createAnnotation("orion.annotation.highlightError",v.start+a,v.end+a))}}h.replaceAnnotations(m,d)}this.textView.redrawLines(f,e+1)},onLineStyle:function(f){var h=this.lineStyles[f.lineIndex];if(h)if(h.ranges){for(var h=h.ranges,e=f.lineStart,b=h.length,a=[],d=0;d<b;d++){var m=h[d];a.push({start:m.start+e,end:m.end+e,style:m.style})}f.ranges=a}else h.style&&(f.style=h.style)},_getEmptyStyle:function(f){for(var h=
[],e=0;e<f;e++)h.push(null);return h},setContentType:function(f){this.contentType=f;if(this.services)for(f=0;f<this.services.length;f++){var h=this.services[f];if(h.setContentType){var e=this.serviceRegistry.getService("orion.page.progress");e?e.progress(h.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):h.setContentType(this.contentType)}}},onServiceAdded:function(f,h){r(f)&&this.addServiceListener(h)},onServiceRemoved:function(f,
h){-1!==this.services.indexOf(h)&&this.removeServiceListener(h)},addServiceListener:function(f){if("function"===typeof f.addEventListener){if(f.addEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),this.services.push(f),f.setContentType&&this.contentType){var k=this.serviceRegistry.getService("orion.page.progress");k?k.progress(f.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):f.setContentType(this.contentType)}}else"undefined"!==
typeof console&&console.log(Error(h))},removeServiceListener:function(f){"function"===typeof f.removeEventListener?(f.removeEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),f=this.services.indexOf(f),-1!==f&&this.services.splice(f,1)):"undefined"!==typeof console&&console.log(Error(h))}};return k});
define("orion/editor/mirror",["i18n!orion/editor/nls/messages","orion/editor/eventTarget","orion/editor/annotations"],function(n,t,r){function k(b){this.string=b;this.tokenStart=this.pos=0}function f(b,a){return{token:function(a,b){return a.skipToEnd()}}}function h(b){this._modes={};this.mimeModes={};this.options={};this.StringStream=k;this.defineMode("null",f);this.defineMIME("text/plain","null")}function g(b){var a=[],d;for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&a.push(d);return a}function p(b,
a,d){d=d||{};this.model=b;this.codeMirror=a;this.isWhitespaceVisible="undefined"===typeof d.whitespacesVisible?!1:d.whitespacesVisible;this.mode=null;this.isModeLoaded=!1;this.lines=[];this.dirtyLines=[];this.startLine=Number.MAX_VALUE;this.endLine=-1;this.timer=null;this.initialize(b)}function e(b,a,d){this.init(b,a,d)}k.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0===this.pos},peek:function(){return this.string[this.pos]},next:function(){return this.string[this.pos++]},
eat:function(b){var a=this.string[this.pos];return"string"===typeof a&&(a===b||b.test&&b.test(a)||"function"===typeof b&&b(a))?this.string[this.pos++]:void 0},eatWhile:function(b){for(var a=!1;void 0!==this.eat(b);)a=!0;return a},eatSpace:function(){return this.eatWhile(/\s/)},skipToEnd:function(){this.pos=this.string.length},skipTo:function(b){b=this.string.indexOf(b,this.pos);return-1!==b?(this.pos=b,!0):!1},match:function(b,a,d){a=!0===a||"undefined"===typeof a;if("string"===typeof b){var e=d?
this.string.toLowerCase():this.string;b=d?b.toLowerCase():b;d=e.indexOf(b,this.pos);-1!==d&&a&&(this.pos=d+b.length);return-1!==d}if((b=this.string.substring(this.pos).match(b))&&a&&"string"===typeof b[0])this.pos+=b.index+b[0].length;return b},backUp:function(b){this.pos-=b},column:function(){for(var b=0,a=0;a<this.tokenStart;)b+="\t"===this.string[a++]?4:1;return b},indentation:function(){for(var b=this.string.search(/\S/),a=0,d=0;d<b;)a+="\t"===this.string[d++]?4:1;return a},current:function(){return this.string.substring(this.tokenStart,
this.pos)},advance:function(){this.tokenStart=this.pos}};h.prototype={options:{},setOption:function(b,a){this.options[b]=a},getOption:function(b){return this.options[b]},copyState:function(b,a){if("function"===typeof b.copyState)return b.copyState(a);var d={},e;for(e in a){var f=a[e];d[e]=f instanceof Array?f.slice():f}return d},startState:function(b,a){return b.startState(a)},defineMode:function(b,a){this._modes[b]=a},defineMIME:function(b,a){this.mimeModes[b]=a},getMode:function(b,a){var d={},e;
"string"===typeof a&&this.mimeModes[a]&&(a=this.mimeModes[a]);"object"===typeof a&&(d=a,e=this._modes[a.name]);e=e||this._modes[a];return"function"!==typeof e?("undefined"!==typeof console&&console&&console.log("Mode not found: "+a),this.getMode(b,"null")):e(b,d)},listModes:function(){return g(this._modes)},listMIMEs:function(){return g(this.mimeModes)},_getModeName:function(b){b=this.mimeModes[b];"object"===typeof b&&(b=b.name);return b}};p.prototype={initialize:function(b){var a=this;this.listener=
{onModelChanging:function(b){a._onModelChanging(b)},onModelChanged:function(b){a._onModelChanged(b)},onDestroy:function(b){a._onDestroy(b)}};this.model.addEventListener("Changing",this.listener.onModelChanging);this.model.addEventListener("Changed",this.listener.onModelChanged);this.model.addEventListener("Destroy",this.listener.onDestroy)},destroy:function(){this.model&&(this.model.removeEventListener("Changing",this.listener.onModelChanging),this.model.removeEventListener("Changed",this.listener.onModelChanged),
this.model.removeEventListener("Destroy",this.listener.onDestroy));this.dirtyLines=this.lines=this.mode=this.codeMirror=this.model=null;clearTimeout(this.timer);this.timer=null},_onModelChanging:function(b){this.startLine=this.model.getLineAtOffset(b.start)},_onModelChanged:function(b){this._dbgEvent(b);var a=this.startLine;(b.removedLineCount||b.addedLineCount)&&Array.prototype.splice.apply(this.lines,[a+1,b.removedLineCount].concat(this._newLines(b.addedLineCount)));this.mode&&(b=Math.max(b.addedLineCount,
b.removedLineCount),b=a+Math.min(b,500),this.highlight(a,b),this.highlightLater(b+1))},_onDestroy:function(b){this.destroy()},setViewportIndex:function(b){this.viewportIndex=b},_dbgEvent:function(b){},_dbgStyle:function(){},_newLines:function(b,a){for(var d=[],e=0;e<b;e++)d.push({style:null,eolState:null});return d},setMode:function(b,a){b&&(this.mode=this.codeMirror.getMode(this.codeMirror.options,b),this.lines=this._newLines(this.model.getLineCount()),a&&this.highlight())},highlight:function(b,
a,d){if(this.mode){var e=this.model.getLineCount();b="undefined"===typeof b?0:b;a="undefined"===typeof a?e-1:Math.min(a,e-1);for(var e=this.mode,f=this.getState(b),g=b;g<=a;g++){var h=this.lines[g];this.highlightLine(g,h,f);h.eolState=this.codeMirror.copyState(e,f)}this._expandRange(b,a);if(!d)this.onHighlightDone()}},highlightLater:function(b){this.dirtyLines.push(b);var a=this;this.timer=setTimeout(function(){a._highlightJob()},50)},_highlightJob:function(){for(var b=+new Date+30,a=this.mode.compareStates,
d=this.model.getLineCount();this.dirtyLines.length;){var e=this.viewportIndex,f=this.lines[e],e=f&&!f.eolState?e:this.dirtyLines.pop();if(e>=d)break;this._expandRange(e,e);for(var f=this._getResumeLineIndex(e),e=f+1,f=(f=0<=f&&this.lines[f].eolState)?this.codeMirror.copyState(this.mode,f):this.mode.startState(),g=0,h=e;h<d;h++){var k=this.lines[h],p=k.eolState,n=this.highlightLine(h,k,f);k.eolState=this.codeMirror.copyState(this.mode,f);n&&this._expandRange(e,h+1);var k=a&&p&&a(p,k.eolState),r=!a&&
!n&&3<g++;if(k||r)break;else if(!p||n)g=0;p=h<d||this.dirtyLines.length;if(+new Date>b&&p){this.highlightLater(h+1);this.onHighlightDone();return}}}this.onHighlightDone()},onHighlightDone:function(){this.startLine!==Number.MAX_VALUE&&-1!==this.endLine&&this.dispatchEvent({type:"Highlight",start:this.startLine,end:this.endLine});this.startLine=Number.MAX_VALUE;this.endLine=-1},_getResumeLineIndex:function(b){for(var a=this.lines,d=b-1;0<=d;d--)if(a[d].eolState||40<b-d)return d;return-1},getState:function(b){var a=
this.mode,d=this.lines,e,f;for(e=b-1;0<=e&&!(f=d[e],f.eolState||40<b-e);e--);var g=0<=e&&d[e].eolState;if(g){g=this.codeMirror.copyState(a,g);for(e=Math.max(0,e);e<b-1;e++)f=d[e],this.highlightLine(e,f,g),f.eolState=this.codeMirror.copyState(a,g);return g}return a.startState()},highlightLine:function(b,a,d){if(this.mode){var e=this.model;e.getLineStart(b)===e.getLineEnd(b)&&this.mode.blankLine&&this.mode.blankLine(d);var f=a.style||[];b=e.getLine(b);b=new k(b);for(var e=!a.style,g=[],h=0;!b.eol();h++){var p=
this.mode.token(b,d)||null,n=b.current();this._whitespaceStyle(p,n,b.tokenStart);p=[b.tokenStart,b.pos,p];n=f[h];g.push(p);e=e||!n||n[0]!==p[0]||n[1]!==p[1]||n[2]!==p[2];b.advance()}if(e=e||g.length!==f.length)a.style=g.length?g:null;return e}},_whitespaceStyle:function(b,a,d){if(!b&&this.isWhitespaceVisible&&/\s+/.test(a)){b=[];for(var e,f,g=0;g<a.length;g++){var h=a[g];h!==f&&(f&&b.push([d+e,d+g,"\t"===f?"punctuation separator tab":"punctuation separator space"]),e=g,f=h)}b.push([d+e,d+g,"\t"===
f?"punctuation separator tab":"punctuation separator space"]);return b}return null},_expandRange:function(b,a){this.startLine=Math.min(this.startLine,b);this.endLine=Math.max(this.endLine,a)},toStyleRangesAndErrors:function(b,a){var d=b.style;if(!d)return null;for(var e=[],f=[],g="undefined"===typeof a?0:this.model.getLineStart(a),h=0;h<d.length;h++){var k=d[h],p;p=(p=k[2])?"punctuation separator tab"===p||"punctuation separator space"===p?p:"cm-"+p:null;p&&(k={start:g+k[0],end:g+k[1],style:{styleClass:p}},
e.push(k),"cm-error"===p&&f.push(k))}return[e,f]},getLineStyle:function(b){return this.lines[b]},getLineStyles:function(){return this.lines}};t.EventTarget.addMixin(p.prototype);r.AnnotationType.registerType("orion.annotation.highlightError",{title:n.syntaxError,html:"\x3cdiv class\x3d'annotationHTML error'\x3e\x3c/div\x3e",rangeStyle:{styleClass:"annotationRange error"}});e.prototype={init:function(b,a,d){this.textView=b;this.annotationModel=d;this.modeApplier=new p(b.getModel(),a);var e=this;this.listener=
{onLineStyle:function(a){e.onLineStyle(a)},onDestroy:function(a){e.onDestroy(a)},onHighlight:function(a){e.onHighlight(a)}};b.addEventListener("LineStyle",this.listener.onLineStyle);b.addEventListener("Destroy",this.listener.onDestroy);this.modeApplier.addEventListener("Highlight",this.listener.onHighlight)},destroy:function(){this.modeApplier&&(this.modeApplier.removeEventListener("Highlight",this.listener.onHighlight),this.modeApplier.destroy());this.textView&&(this.textView.removeEventListener("LineStyle",
this.listener.onLineStyle),this.textView.removeEventListener("Destroy",this.listener.onDestroy));this.listener=this.modeApplier=this.annotationModel=this.textView=null},setMode:function(b){this.modeApplier.setMode(b)},onLineStyle:function(b){var a=b.lineIndex,d=this.modeApplier,e=d.getLineStyle(a);if(!e||!e.eolState){var f=this.textView.getModel().getLineCount();d.highlight(a,Math.min(a+20,f-1),!0);e=d.getLineStyle(a)}f=this.textView.getModel();if(e){var g=d.toStyleRangesAndErrors(e,a);if(g&&(b.ranges=
g[0],b=this.annotationModel)){d=[];e=[];if(g=g[1])for(var h=0;h<g.length;h++){var k=g[h];"cm-error"===k.style.styleClass&&e.push(r.AnnotationType.createAnnotation("orion.annotation.highlightError",k.start,k.end))}for(a=b.getAnnotations(f.getLineStart(a),f.getLineEnd(a));a.hasNext();)f=a.next(),"orion.annotation.highlightError"===f.type&&d.push(f);b.replaceAnnotations(d,e)}}},onHighlight:function(b){this.textView.redrawLines(b.start,b.end)},onDestroy:function(b){this.destroy()}};return{Mirror:h,ModeApplier:p,
CodeMirrorStyler:e}});
define("orion/editor/textMateStyler",["orion/regex"],function(n){function t(f){var h;if(f instanceof Array){h=Array(f.length);for(var g=0;g<f.length;g++)h[g]=t(f[g])}else for(g in h={},f)if(Object.prototype.hasOwnProperty.call(f,g)){var k=f[g];h[g]="object"===typeof k&&null!==k?t(k):k}return h}function r(f,h,g){this.initialize(f);this.grammar=t(h);this.externalGrammars=g?t(g):[];this._styles={};this._tree=null;this._allGrammars={};this.preprocess(this.grammar)}var k={unsupported:[{regex:/\(\?[ims\-]:/,func:function(f){return"option on/off for subexp"}},
{regex:/\(\?<([=!])/,func:function(f){return"\x3d"===f[1]?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(f){return"atomic group"}}],toRegExp:function(f){function h(b,a){throw Error('Unsupported regex feature "'+b+'": "'+a[0]+'" at index: '+a.index+" in "+a.input);}var g="",p;f=k.processGlobalFlag("x",f,function(b){for(var a="",d=!1,e=b.length,f=0;f<e;){var g=b.charAt(f);if(!d&&"#"===g)for(;f<e&&"\r"!==g&&"\n"!==g;)g=b.charAt(++f);else if(!d&&/\s/.test(g))for(;f<e&&/\s/.test(g);)g=
b.charAt(++f);else"\\"===g?(a+=g,/\s/.test(b.charAt(f+1))||(a+=b.charAt(f+1),f+=1)):("["===g?d=!0:"]"===g&&(d=!1),a+=g),f+=1}return a});f=k.processGlobalFlag("i",f,function(b){g+="i";return b});for(p=0;p<this.unsupported.length;p++){var e;(e=this.unsupported[p].regex.exec(f))&&h(this.unsupported[p].func(e),e)}return RegExp(f,g)},processGlobalFlag:function(f,h,g){var k="(?"+f+")";f="(?"+f+":";if(h.substring(0,k.length)===k)return g(h.substring(k.length));if(h.substring(0,f.length)===f){for(var k=0,
e=h.length,b=-1,a=0;a<e&&-1===b;a++)switch(h.charAt(a)){case "\\":a++;break;case "(":k++;break;case ")":k--,0===k&&(b=a)}k=b;if(k<h.length-1)throw Error("Only a "+f+") group that encloses the entire regex is supported in: "+h);return g(h.substring(f.length,k))}return h},hasBackReference:function(f){return/\\\d+/.test(f.source)},getSubstitutedRegex:function(f,h,g){g="undefined"===typeof g?!0:!1;f=f.source.split(/(\\\d+)/g);for(var k=[],e=0;e<f.length;e++){var b=f[e],a=/\\(\d+)/.exec(b);a?(b=h[a[1]]||
"",k.push(g?n.escape(b):b)):k.push(b)}return RegExp(k.join(""))},groupify:function(f,h){for(var g=f.source,k=g.length,e=[],b=0,a=[],d=1,m=1,s=[],l={},n={},r=0;r<k;r++){var t=e[e.length-1],w=g.charAt(r);switch(w){case "(":4===t&&(e.pop(),s.push(")"),a[a.length-1].end=r);var y=r+2<k?g.charAt(r+1)+""+g.charAt(r+2):null;if("?:"===y||"?\x3d"===y||"?!"===y){var x;"?:"===y?x=1:(x=3,b++);e.push(x);a.push({start:r,end:-1,type:x});s.push(w);s.push(y);r+=y.length}else e.push(2),a.push({start:r,end:-1,type:2,
oldNum:d,num:m}),s.push(w),0===b&&(n[m]=null),l[d]=m,d++,m++;break;case ")":t=e.pop();3===t&&b--;a[a.length-1].end=r;s.push(w);break;case "*":case "+":case "?":case "}":var D=w,q=g.charAt(r-1),y=r-1;if("}"===w){for(x=r-1;"{"!==g.charAt(x)&&0<=x;x--);q=g.charAt(x-1);y=x-1;D=g.substring(x,r+1)}x=a[a.length-1];if(")"===q&&(2===x.type||4===x.type)){s.splice(x.start,0,"(");s.push(D);s.push(")");w={start:x.start,end:s.length-1,type:4,num:x.num};for(q=0;q<a.length;q++)if(t=a[q],(2===t.type||4===t.type)&&
t.start>=x.start&&t.end<=y)t.start+=1,t.end+=1,t.num+=1,2===t.type&&(l[t.oldNum]=t.num);a.push(w);m++;break}default:"|"!==w&&(2!==t&&4!==t)&&0===b&&(e.push(4),a.push({start:r,end:-1,type:4,num:m}),s.push("("),n[m]=null,m++),s.push(w),"\\"===w&&(w=g.charAt(r+1),s.push(w),r+=1)}}for(;e.length;)e.pop(),s.push(")");g=RegExp(s.join(""));k={};h=h||l;for(var z in h)h.hasOwnProperty(z)&&(k[z]="\\"+h[z]);g=this.getSubstitutedRegex(g,k,!1);return[g,l,n]},complexCaptures:function(f){if(!f)return!1;for(var h in f)if(f.hasOwnProperty(h)&&
"0"!==h)return!0;return!1}};r.prototype={initialize:function(f){this.textView=f;this.textView.stylerOptions=this;var h=this;this._listener={onModelChanged:function(f){h.onModelChanged(f)},onDestroy:function(f){h.onDestroy(f)},onLineStyle:function(f){h.onLineStyle(f)},onStorage:function(f){h.onStorage(f)}};f.addEventListener("ModelChanged",this._listener.onModelChanged);f.addEventListener("Destroy",this._listener.onDestroy);f.addEventListener("LineStyle",this._listener.onLineStyle);f.redrawLines()},
onDestroy:function(f){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null);this._listener=this._tree=this._styles=this.grammar=null},preprocess:function(f){for(f=[f];0!==f.length;){var h=f.pop();if(!h._resolvedRule||!h._typedRule)if(h._resolvedRule=this._resolve(h),
h._typedRule=this._createTypedRule(h),this.addStyles(h.name),this.addStyles(h.contentName),this.addStylesForCaptures(h.captures),this.addStylesForCaptures(h.beginCaptures),this.addStylesForCaptures(h.endCaptures),h._resolvedRule!==h&&f.push(h._resolvedRule),h.patterns)for(var g=0;g<h.patterns.length;g++)f.push(h.patterns[g])}},addStyles:function(f){if(f&&!this._styles[f]){this._styles[f]=[];for(var h=f.split("."),g=0;g<h.length;g++)this._styles[f].push(h.slice(0,g+1).join("-"))}},addStylesForCaptures:function(f){for(var h in f)f.hasOwnProperty(h)&&
this.addStyles(f[h].name)},ContainerRule:function(){function f(f){this.rule=f;this.subrules=f.patterns}f.prototype.valueOf=function(){return"aa"};return f}(),BeginEndRule:function(){function f(f){this.rule=f;this.beginRegex=k.toRegExp(f.begin);this.endRegex=k.toRegExp(f.end);this.subrules=f.patterns||[];this.endRegexHasBackRef=k.hasBackReference(this.endRegex);var g=k.complexCaptures(f.captures);f=k.complexCaptures(f.beginCaptures)||k.complexCaptures(f.endCaptures);if(this.isComplex=g||f)g=k.groupify(this.beginRegex),
this.beginRegex=g[0],this.beginOld2New=g[1],this.beginConsuming=g[2],g=k.groupify(this.endRegex,this.beginOld2New),this.endRegex=g[0],this.endOld2New=g[1],this.endConsuming=g[2]}f.prototype.valueOf=function(){return this.beginRegex};return f}(),MatchRule:function(){function f(f){this.rule=f;this.matchRegex=k.toRegExp(f.match);if(this.isComplex=k.complexCaptures(f.captures))f=k.groupify(this.matchRegex),this.matchRegex=f[0],this.matchOld2New=f[1],this.matchConsuming=f[2]}f.prototype.valueOf=function(){return this.matchRegex};
return f}(),_createTypedRule:function(f){return f.match?new this.MatchRule(f):f.begin?new this.BeginEndRule(f):new this.ContainerRule(f)},_resolve:function(f){var h=f;if(f.include){if(f.begin||f.end||f.match)throw Error('Unexpected regex pattern in "include" rule '+f.include);f=f.include;if("#"===f.charAt(0)){if(h=this.grammar.repository&&this.grammar.repository[f.substring(1)],!h)throw Error("Couldn't find included rule "+f+" in grammar repository");}else if("$self"===f)h=this.grammar;else{if("$base"===
f)throw Error('Include "$base" is not supported');h=this._allGrammars[f];if(!h)for(var g=0;g<this.externalGrammars.length;g++){var k=this.externalGrammars[g];if(k.scopeName===f){this.preprocess(k);h=this._allGrammars[f]=k;break}}}}return h},ContainerNode:function(){function f(f,g){this.parent=f;this.rule=g;this.children=[];this.end=this.start=null}f.prototype.addChild=function(f){this.children.push(f)};f.prototype.valueOf=function(){var f=this.rule;return"ContainerNode { "+(f.include||"")+" "+(f.name||
"")+(f.comment||"")+"}"};return f}(),BeginEndNode:function(){function f(f,g,p){this.parent=f;this.rule=g;this.children=[];this.setStart(p);this.endMatch=this.end=null;this.endRegexSubstituted=g.endRegexHasBackRef?k.getSubstitutedRegex(g.endRegex,p):null}f.prototype.addChild=function(f){this.children.push(f)};f.prototype.getIndexInParent=function(f){return this.parent?this.parent.children.indexOf(this):-1};f.prototype.setStart=function(f){this.start=f.index;this.beginMatch=f};f.prototype.setEnd=function(f){f&&
"object"===typeof f?(this.endMatch=f,this.end=f.index+f[0].length):(this.endMatch=null,this.end=f)};f.prototype.shiftStart=function(f){this.start+=f;this.beginMatch.index+=f};f.prototype.shiftEnd=function(f){this.end+=f;this.endMatch&&(this.endMatch.index+=f)};f.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range\x3d"+this.start+".."+this.end+"}"};return f}(),push:function(f,h){if(h)for(var g=h.length;0<g;)f.push(h[--g])},exec:function(f,h,g){if(h=f.exec(h))h.index+=g;f.lastIndex=
0;return h},afterMatch:function(f){return f.index+f[0].length},getEndMatch:function(f,h,g){if(f instanceof this.BeginEndNode){var k=f.rule;f=f.endRegexSubstituted||k.endRegex;return!f?null:this.exec(f,h,g)}return null},initialParse:function(){this.textView.getModel().getCharCount();this._tree=new this.ContainerNode(null,this.grammar._typedRule);this.parse(this._tree,!1,0)},onModelChanged:function(f){var h=f.addedCharCount,g=f.removedCharCount;f=f.start;if(this._tree){var k=this.textView.getModel(),
e=k.getCharCount(),k=k.getLineEnd(k.getLineAtOffset(f)-1),b=this.getFirstDamaged(k,k),k=-1===k?0:k,h=b?this.parse(b,!0,k,f,h,g):e;this.textView.redrawRange(k,h)}else this.initialParse()},getFirstDamaged:function(f,h){if(0>f)return this._tree;for(var g=[this._tree],k=null;g.length;){var e=g.pop();if(!e.parent||this.isDamaged(e,f,h)){e instanceof this.BeginEndNode&&(k=e);for(var b=0;b<e.children.length;b++)g.push(e.children[b])}}return k||this._tree},isDamaged:function(f,h,g){return f.start<=g&&f.end>
h},parse:function(f,h,g,k,e,b){var a=this.textView.getModel(),d=a.getLineStart(a.getLineCount()-1),m=a.getCharCount(),n=this.getInitialExpected(f,g),l=-1;h&&(f.repaired=!0,f.endNeedsUpdate=!0,l=(l=f.children[f.children.length-1])?a.getLineEnd(a.getLineAtOffset(l.end+(e-b))):-1,k=a.getLineEnd(a.getLineAtOffset(k+b)),l=Math.max(l,k));l=-1===l?m:l;k=n;for(var u=f,r=!1,t=g,w=-1;u&&(!h||t<l);){var y=this.getNextMatch(a,u,t);y||(t=t>=d?m:a.getLineStart(a.getLineAtOffset(t)+1));var x=y&&y.match,D=y&&y.rule,
q=y&&y.isEnd;if(y&&y.isSub)t=this.afterMatch(x),D instanceof this.BeginEndRule&&(r=!0,h&&D===k.rule&&u===k.parent?(u=k,u.setStart(x),u.repaired=!0,u.endNeedsUpdate=!0,k=this.getNextExpected(k,"begin")):(h&&(this.prune(u,k),h=!1),x=new this.BeginEndNode(u,D,x),u.addChild(x),u=x));else if(q||t===m)u instanceof this.BeginEndNode&&(x?(r=!0,w=Math.max(w,u.end),u.setEnd(x),t=this.afterMatch(x),h&&u===k&&u.parent===k.parent?(u.repaired=!0,delete u.endNeedsUpdate,k=this.getNextExpected(k,"end")):h&&(this.prune(u,
k),h=!1)):(u.setEnd(m),delete u.endNeedsUpdate)),u=u.parent;h&&(t>=l&&!r)&&(this.prune(f,n),h=!1)}this.removeUnrepairedChildren(f,h,g);this.cleanup(h,f,g,l,m,e,b);return h?Math.max(w,t):t},removeUnrepairedChildren:function(f,h,g){if(h){h=f.children;for(var k=-1,e=0;e<h.length;e++){var b=h[e];if(!b.repaired&&this.isDamaged(b,g,Number.MAX_VALUE)){k=e;break}}-1!==k&&(f.children.length=k)}},cleanup:function(f,h,g,k,e,b,a){if(f){f=b-a;e=this.getIntersecting(k-f+1,e);h=this.getIntersecting(g,k);for(g=0;g<
e.length;g++)k=e[g],!k.repaired&&k instanceof this.BeginEndNode&&(k.shiftEnd(f),k.shiftStart(f));for(g=0;g<h.length;g++)k=h[g],k.repaired&&k.endNeedsUpdate&&k.shiftEnd(f),delete k.endNeedsUpdate,delete k.repaired}else{h=this.getIntersecting(g,k);for(g=0;g<h.length;g++)delete h[g].repaired}},getNextMatch:function(f,h,g,k){var e=f.getLineAtOffset(g),e=f.getLineEnd(e),b=f.getText(g,e),a=[],d=[];f=[];e=[];for(this.push(a,h.rule.subrules);a.length;){var m=a.length?a.pop():null,m=m&&m._resolvedRule._typedRule;
if(m instanceof this.ContainerRule&&-1===d.indexOf(m))d.push(m),this.push(a,m.subrules);else if(!m||!k||m.matchRegex){var n=m&&this.exec(m.matchRegex||m.beginRegex,b,g);n&&(f.push(n),e.push(m))}}a=Number.MAX_VALUE;d=-1;for(m=0;m<f.length;m++)n=f[m],n.index<a&&(a=n.index,d=m);if(!k&&(g=this.getEndMatch(h,b,g)))if(k=h.rule.applyEndPatternLast,-1===d||g.index<a||!k&&g.index===a)return{isEnd:!0,rule:h.rule,match:g};return-1===d?null:{isSub:!0,rule:e[d],match:f[d]}},getInitialExpected:function(f,h){var g,
k;if(f===this._tree)for(g=0;g<f.children.length;g++){if(k=f.children[g],k.start>=h)return k}else if(f instanceof this.BeginEndNode&&f.endMatch){var e=f.endMatch.index;for(g=0;g<f.children.length&&!(k=f.children[g],k.start>=h);g++);if(k&&k.start<e)return k}return f},getNextExpected:function(f,h){if("begin"===h){var g=f.children[0];return g?g:f}if("end"===h&&(g=f.parent)){var k=g.children[g.children.indexOf(f)+1];return k?k:g}return null},prune:function(f,h){h.parent===f?f.children.length=h.getIndexInParent():
f instanceof this.BeginEndNode&&(f.endMatch=null,f.end=null);f.parent&&(f.parent.children.length=f.getIndexInParent()+1)},onLineStyle:function(f){this._tree||this.initialParse();var h=f.lineStart,g=this.textView.getModel(),k=g.getLineEnd(f.lineIndex),e=g.getLineEnd(g.getLineAtOffset(h)-1),e=this.getFirstDamaged(e,e),h=this.getLineScope(g,e,h,k);f.ranges=this.toStyleRanges(h);f.ranges.sort(function(b,a){return b.start-a.start})},getLineScope:function(f,h,g,k){for(var e=g,b=this.getInitialExpected(h,
g),a=[],d=[];h&&e<k;){var m=this.getNextMatch(f,h,e);if(!m)break;var n=m&&m.match,l=m&&m.rule,u=m&&m.isSub,m=m&&m.isEnd;n.index!==e&&d.push({start:e,end:n.index,node:h});u?(e=this.afterMatch(n),l instanceof this.BeginEndRule?(this.addBeginScope(a,n,l),h=b,b=this.getNextExpected(b,"begin")):this.addMatchScope(a,n,l)):m&&(e=this.afterMatch(n),this.addEndScope(a,n,l),b=this.getNextExpected(b,"end"),h=h.parent)}e<k&&d.push({start:e,end:k,node:h});f=this.getInheritedLineScope(d,g,k);return a.concat(f)},
getInheritedLineScope:function(f,h,g){h=[];for(g=0;g<f.length;g++)for(var k=f[g],e=k.node;e;){var b=e.rule.rule,a=b.name;if(b=b.contentName||a){this.addScopeRange(h,k.start,k.end,b);break}e=e.parent}return h},addBeginScope:function(f,h,g){var k=g.rule;this.addCapturesScope(f,h,k.beginCaptures||k.captures,g.isComplex,g.beginOld2New,g.beginConsuming)},addEndScope:function(f,h,g){var k=g.rule;this.addCapturesScope(f,h,k.endCaptures||k.captures,g.isComplex,g.endOld2New,g.endConsuming)},addMatchScope:function(f,
h,g){var k=g.rule,e=k.name;(k=k.captures)?this.addCapturesScope(f,h,k,g.isComplex,g.matchOld2New,g.matchConsuming):this.addScope(f,h,e)},addScope:function(f,h,g){g&&f.push({start:h.index,end:this.afterMatch(h),scope:g})},addScopeRange:function(f,h,g,k){k&&f.push({start:h,end:g,scope:k})},addCapturesScope:function(f,h,g,k,e,b){if(g)if(k){k={1:0};for(var a=0,d=1;void 0!==h[d];d++)void 0!==b[d]&&(a+=h[d].length),void 0!==h[d+1]&&(k[d+1]=a);b=h.index;for(a=1;g[a];a++){var d=g[a].name,m=e[a],n=b+k[m];
"undefined"!==typeof h[m]&&this.addScopeRange(f,n,n+h[m].length,d)}}else this.addScope(f,h,g[0]&&g[0].name)},getIntersecting:function(f,h){for(var g=[],k=this._tree?[this._tree]:[];k.length;){var e=k.pop(),b=!1;e instanceof this.ContainerNode?b=!0:this.isDamaged(e,f,h)&&(b=!0,g.push(e));if(b)for(var b=e.children.length,a=0;a<b;a++)k.push(e.children[a])}return g.reverse()},toStyleRanges:function(f){for(var h=[],g=0;g<f.length;g++){var k=f[g],e=this._styles[k.scope];if(!e)throw Error("styles not found for "+
k.scope);e=e.join(" ");h.push({start:k.start,end:k.end,style:{styleClass:e}})}return h}};return{RegexUtil:k,TextMateStyler:r}});
define("orion/editor/htmlGrammar",[],function(){return{HtmlGrammar:function(){return{scopeName:"source.html",uuid:"3B5C76FB-EBB5-D930-F40C-047D082CE99B",patterns:[{begin:"\x3c!(doctype|DOCTYPE)",end:"\x3e",contentName:"entity.name.tag.doctype.html",beginCaptures:{0:{name:"entity.name.tag.doctype.html"}},endCaptures:{0:{name:"entity.name.tag.doctype.html"}}},{begin:"\x3c!--",end:"--\x3e",beginCaptures:{0:{name:"punctuation.definition.comment.html"}},endCaptures:{0:{name:"punctuation.definition.comment.html"}},
patterns:[{match:"--",name:"invalid.illegal.badcomment.html"}],contentName:"comment.block.html"},{match:"\x3c[A-Za-z0-9_\\-:]+(?\x3d ?)",name:"entity.name.tag.html"},{include:"#attrName"},{include:"#qString"},{include:"#qqString"},{include:"#entity"},{match:"\x3c/[A-Za-z0-9_\\-:]+\x3e",name:"entity.name.tag.html"},{match:"\x3e",name:"entity.name.tag.html"}],repository:{attrName:{match:"[A-Za-z\\-:]+(?\x3d\\s*\x3d\\s*['\"])",name:"entity.other.attribute.name.html"},qqString:{match:'(")[^"]+(")',name:"string.quoted.double.html"},
qString:{match:"(')[^']+(')",name:"string.quoted.single.html"},entity:{match:"\x26[A-Za-z0-9]+;",name:"constant.character.entity.html"}}}}}});
define("orion/editor/textStyler",["orion/editor/annotations","orion/editor/eventTarget"],function(n,t){function r(e,b){this._patternManager=new k(e,b)}function k(e,b){this._unnamedCounter=0;this._patterns=[];this._rootId=b;e.forEach(function(a){this._addRepositoryPatterns(a.repository||{},a.id);this._addPatterns(a.patterns||[],a.id)}.bind(this))}function f(e,b,a,d,f,g,l){this.start=e.start;this.end=e.end;this.contentStart=e.contentStart;this.contentEnd=e.contentEnd;this.name=b;this.typeId=a;this.styler=
d;this.parent=g;l&&l(this);this._subBlocks=d.computeBlocks(f,f.getText(this.start,this.end),this,this.start,null,null,null)}function h(e){this._styler=e}function g(e,b,a){this._highlightCaretLine=this._whitespacesVisible=this._spacesVisible=this._tabsVisible=!1;this._detectTasks=this._foldingEnabled=!0;this._view=e;this._annotationModel=b;this._stylerAdapter=a;this._stylerAdapter.setStyler(this);this._accessor=new h(this);this._bracketAnnotations;var d=this;this._listener={onChanged:function(a){d._onModelChanged(a)},
onDestroy:function(a){d._onDestroy(a)},onLineStyle:function(a){d._onLineStyle(a)},onMouseDown:function(a){d._onMouseDown(a)},onSelection:function(a){d._onSelection(a)}};a=e.getModel();a.getBaseModel&&(a=a.getBaseModel());a.addEventListener("Changed",this._listener.onChanged);e.addEventListener("MouseDown",this._listener.onMouseDown);e.addEventListener("Selection",this._listener.onSelection);e.addEventListener("Destroy",this._listener.onDestroy);e.addEventListener("LineStyle",this._listener.onLineStyle);
var f=a.getCharCount();this._rootBlock=this._stylerAdapter.createBlock({start:0,contentStart:0,end:f,contentEnd:f},this,a,null);b&&(f=[],b.removeAnnotations(n.AnnotationType.ANNOTATION_FOLDING),this._computeFolding(this._rootBlock.getBlocks(),e.getModel(),f),this._detectTasks&&(b.removeAnnotations(n.AnnotationType.ANNOTATION_TASK),this._computeTasks(this._rootBlock,a,f)),b.replaceAnnotations([],f));e.redrawLines()}var p=function(e,b,a,d,f){var g;void 0===d&&(d=-1);void 0===f&&(f=e.length);for(;1<
f-d;)if(g=Math.floor((f+d)/2),b<=e[g].start)f=g;else if(a&&b<e[g].end){f=g;break}else d=g;return f};r.prototype={blockSpansBeyondEnd:function(e){return e.pattern.regexEnd===this._eolRegex},computeBlocks:function(e,b,a,d,f,g,l){if(!b)return[];var h=[],k=[];f=f||0;g=g||Infinity;l=l||Infinity;a.blockPatterns.forEach(function(a){var d=this._findMatch(a.regexBegin||a.regex,b,f);d&&k.push({result:d,pattern:a})}.bind(this));if(!k.length)return h;k.sort(function(a,b){return a.result.index<b.result.index?
-1:a.result.index>b.result.index?1:a.pattern.pattern.index<b.pattern.pattern.index?-1:1});for(var n=0;0<k.length;){var p=k[0];k.splice(0,1);if(g<p.result.index)break;if(!(p.result.index<n)){var n=d+p.result.index,r=p.result.index,t=null,D=p.pattern.regexEnd;if(D){var r=r+p.result[0].length,q=p.pattern,z=this._substituteCaptureValues(D,p.result);z!==D&&(q={pattern:q.pattern,regexBegin:q.regexBegin,regexEnd:z},D=z);for(z=r;!t;){z=this._findMatch(D,b,z);z||(this._eolRegex.lastIndex=0,z=this._eolRegex.exec(b),
q={pattern:q.pattern,regexBegin:q.regexBegin,regexEnd:this._eolRegex});var C=this.createBlock({start:n,end:d+z.index+z[0].length,contentStart:d+r,contentEnd:d+z.index},a.styler,e,a,q),E=C.getBlocks();if(!E.length||E[E.length-1].end<=z.index+d)t=C;z=z.index+z[0].length}}else t=this.createBlock({start:n,end:n+p.result[0].length,contentStart:n,contentEnd:n+p.result[0].length},a.styler,e,a,p.pattern);h.push(t);if(h.length===l||g<=t.end)break;n=t.end-d}this._updateMatch(p,b,k,n,g)}return h},computeStyle:function(e,
b,a){if(!e.pattern)return null;var d={start:e.start,end:e.end,style:e.pattern.pattern.name};if(e.contentStart<=a&&a<e.contentEnd)return e.pattern.pattern.contentName?{start:e.contentStart,end:e.contentEnd,style:e.pattern.pattern.contentName}:d;var f,g;if(a<e.contentStart){g=e.pattern.pattern.beginCaptures||e.pattern.pattern.captures;if(!g)return d;f=e.pattern.regexBegin;b=b.getText(e.start,e.contentStart);e=e.start}else{g=e.pattern.pattern.endCaptures||e.pattern.pattern.captures;if(!g)return d;f=
e.pattern.regexEnd;b=b.getText(e.contentEnd,e.end);e=e.contentEnd}f.lastIndex=0;if(f=f.exec(b))if(b=[],this._getCaptureStyles(f,g,e,b),(g=b[p(b,a,!0)])&&g.start<=a&&a<g.end)return g;return d},createBlock:function(e,b,a,d,g){return new f(e,g?g.pattern.name:null,g?g.pattern.id:null,b,a,d,function(a){a.pattern=g;a.linePatterns=[];a.blockPatterns=[];a.enclosurePatterns={};this._initPatterns(this._patternManager,a)}.bind(this))},getBlockContentStyleName:function(e){return e.pattern.pattern.contentName||
e.pattern.pattern.name},getBlockEndStyle:function(e,b,a,d){var f;if(e.pattern.regexEnd&&(f=this._findMatch(e.pattern.regexEnd,b,0)))(b=e.pattern.pattern.endCaptures||e.pattern.pattern.captures)?this._getCaptureStyles(f,b,a-f[0].length,d):e.pattern.pattern.name&&d.push({start:a-f[0].length,end:a,style:e.pattern.pattern.name});return f?f[0]:null},getBlockStartStyle:function(e,b,a,d){var f;if(e.pattern.regexBegin&&(f=this._findMatch(e.pattern.regexBegin,b,0)))(b=e.pattern.pattern.beginCaptures||e.pattern.pattern.captures)?
this._getCaptureStyles(f,b,a,d):d.push({start:a,end:a+f[0].length,style:e.pattern.pattern.name});return f?f[0]:null},getBracketMatch:function(e,b){for(var a,d=Object.keys(e.enclosurePatterns),f=0;f<d.length;f++){var g=e.enclosurePatterns[d[f]],l=this._findMatch(g.regex,b,0);if(l&&0===l.index){a=g;break}}if(!a)return null;f=!1;-1!==a.pattern.name.indexOf(this._PUNCTUATION_SECTION_BEGIN)?(f=!0,d=a.pattern.name.replace(this._PUNCTUATION_SECTION_BEGIN,this._PUNCTUATION_SECTION_END)):d=a.pattern.name.replace(this._PUNCTUATION_SECTION_END,
this._PUNCTUATION_SECTION_BEGIN);return!e.enclosurePatterns[d]?null:{beginName:a.pattern.name,endName:d,atStart:f}},parse:function(e,b,a,d,f){if(e&&(a=a.linePatterns)){var g=[];a.forEach(function(a){var b=a.regex||a.regexBegin;b.oldLastIndex=b.lastIndex;(b=this._findMatch(b,e,0))&&g.push({result:b,pattern:a})}.bind(this));g.sort(function(a,b){return a.result.index<b.result.index?-1:a.result.index>b.result.index?1:a.pattern.pattern.index<b.pattern.pattern.index?-1:1});for(var l=0;0<g.length;){var h=
g[0];g.splice(0,1);if(!(h.result.index<l)){var k=h.result.index,p,n=[];if(h.pattern.regex){l=h.result;p=k+l[0].length;p={start:b+k,end:b+p,style:h.pattern.pattern.name};if(!f){h.pattern.pattern.captures&&this._getCaptureStyles(l,h.pattern.pattern.captures,b+k,n);n.sort(function(a,b){return a.start<b.start?-1:a.start>b.start?1:0});for(k=0;k<n.length-1;k++)if(n[k+1].start<n[k].end){var r={start:n[k+1].end,end:n[k].end,style:n[k].style};n[k].end=n[k+1].start;n.splice(k+2,0,r)}}this._mergeStyles(p,n,
d)}else l=h.pattern.regexEnd,l=this._substituteCaptureValues(l,h.result),l=this._findMatch(l,e,h.result.index+h.result[0].length),l||(this._eolRegex.lastIndex=0,l=this._eolRegex.exec(e)),p=l.index+l[0].length,d.push({start:b+k,end:b+p,style:h.pattern.pattern.name});l=l.index+l[0].length}this._updateMatch(h,e,g,l)}a.forEach(function(a){a=a.regex||a.regexBegin;a.lastIndex=a.oldLastIndex})}},setStyler:function(){},verifyBlock:function(e,b,a,d){var f=null,g=[];a.parent.blockPatterns.forEach(function(a){var d=
this._findMatch(a.regexBegin||a.regex,b,0);d&&g.push({result:d,pattern:a})}.bind(this));g.sort(function(a,b){return!a.result.index&&b.result.index?-1:a.result.index&&!b.result.index?1:!a.result.index&&!b.result.index?a.pattern.pattern.index<b.pattern.pattern.index?-1:1:0});if(!g.length||0!==g[0].result.index||g[0].pattern.pattern.id!==a.pattern.pattern.id)f=!1;else{var l=g[0],h=l.pattern.regexEnd;if(h){for(var h=this._substituteCaptureValues(h,l.result),l=l.result[0].length,k=this._findMatch(h,b,
l);null===f&&k&&a.start+k.index!==a.contentEnd+d;){var n=this.computeBlocks(e,b,a,a.start,l,k.index+1,null);!n.length||n[n.length-1].end<=a.start+k.index?f=!1:n.length?(l=n[n.length-1].end-a.start,k=this._findMatch(h,b,l)):k=null}k||(this._eolRegex.lastIndex=0,k=this._eolRegex.exec(b),f=a.start+k.index===a.end+d)}else f=a.start+l.result[0].length===a.end+d}return null!==f?f:!0},_findMatch:function(e,b,a,d){var f=a,g=e.lastIndex;this._linebreakRegex.lastIndex=a;a=this._linebreakRegex.exec(b);var l,
h;e.lastIndex=0;if(a){for(h=a.index;0<=--h&&!(l=b.charAt(h),l===this._NEWLINE||l===this._CR););l=b.substring(h+1,a.index+a[1].length);e.lastIndex=h=a.index-h-1}for(;a&&a.index<b.length;){var k;if(d){var n=e.lastIndex;e.test(l)&&(e.lastIndex=n,k=e.exec(l))}else k=e.exec(l);if(k)return k.index+=f,k.index-=h,e.lastIndex=g,k;h=0;f+=a[0].length;if(a=this._linebreakRegex.exec(b))l=a[1],e.lastIndex=0}e.lastIndex=g;return null},_getCaptureStyles:function(e,b,a,d){if(b[0])d.push({start:a,end:a+e[0].length,
style:b[0].name});else for(var f=0,g=1;g<e.length;g++)if(e[g]){var l=b[g];if(l){var h=a+f;d.push({start:h,end:h+e[g].length,style:l.name})}f+=e[g].length}},_initPatterns:function(e,b){if(b.pattern&&b.pattern.pattern.linePatterns)b.linePatterns=b.pattern.pattern.linePatterns,b.blockPatterns=b.pattern.pattern.blockPatterns,b.enclosurePatterns=b.pattern.pattern.enclosurePatterns;else{var a=e.getPatterns(b.pattern?b.pattern.pattern:null),d=function(a){a="string"===typeof a?a:a.match;var b=this._ignoreCaseRegex.exec(a),
d=this._FLAGS;b&&(a=a.substring(b[0].length),d+="i");return RegExp(a,d)}.bind(this),f=-1,g=0;a.forEach(function(a){var e;if(a.match&&!a.begin&&!a.end){if(e={regex:d(a.match),pattern:a},b.linePatterns.push(e),a.name&&0===a.name.indexOf("punctuation.section")&&(-1!==a.name.indexOf(this._PUNCTUATION_SECTION_BEGIN)||-1!==a.name.indexOf(this._PUNCTUATION_SECTION_END)))b.enclosurePatterns[a.name]=e}else!a.match&&(a.begin&&a.end)&&(f=g,e={regexBegin:d(a.begin),regexEnd:d(a.end),pattern:a},b.linePatterns.push(e));
g++}.bind(this));b.blockPatterns=b.linePatterns.slice(0,f+1);b.pattern&&(b.pattern.pattern.enclosurePatterns=b.enclosurePatterns,b.pattern.pattern.linePatterns=b.linePatterns,b.pattern.pattern.blockPatterns=b.blockPatterns)}},_mergeStyles:function(e,b,a){var d=e.start;b.forEach(function(b){d<=b.start&&a.push({start:d,end:b.start,style:e.style});a.push(b);d=b.end});d<e.end&&a.push({start:d,end:e.end,style:e.style})},_substituteCaptureValues:function(e,b){var a=e.toString();this._captureReferenceRegex.lastIndex=
0;if(!this._captureReferenceRegex.test(a))return e;this._captureReferenceRegex.lastIndex=0;for(var d=this._captureReferenceRegex.exec(a);d;)a=a.replace(d[0],b[d[1]]||""),this._captureReferenceRegex.lastIndex=0,d=this._captureReferenceRegex.exec(a);return RegExp(a.substring(1,a.length-1-this._FLAGS.length),this._FLAGS)},_updateMatch:function(e,b,a,d,f){var g=e.pattern.regex?e.pattern.regex:e.pattern.regexBegin;f=f||Infinity;if((b=this._findMatch(g,b,d,!0))&&b.index<f){e.result=b;for(f=0;f<a.length;f++)if(b.index<
a[f].result.index||b.index===a[f].result.index&&e.pattern.pattern.index<a[f].pattern.pattern.index){a.splice(f,0,e);return}a.push(e)}},_captureReferenceRegex:/\\(\d)/g,_eolRegex:/$/,_ignoreCaseRegex:/^\(\?i\)\s*/,_linebreakRegex:/(.*)(?:[\r\n]|$)/g,_CR:"\r",_FLAGS:"g",_NEWLINE:"\n",_PUNCTUATION_SECTION_BEGIN:".begin",_PUNCTUATION_SECTION_END:".end"};k.prototype={getPatterns:function(e){e?(e="string"===typeof e?e:e.qualifiedId,e+="#"):e=this._rootId+"#"+this._NO_ID;var b=[0],a={},d=RegExp("^"+e+"[^#]+$");
this._patterns.forEach(function(e){d.test(e.qualifiedId)&&(e.include?this._processInclude(e,b,a):(e.index=b[0]++,a[e.id]=e))}.bind(this));var f=[];Object.keys(a).forEach(function(b){f.push(a[b])});return f},_addPattern:function(e,b,a){e.parentId=a;e.id=b;e.qualifiedId=e.parentId+"#"+e.id;this._patterns.push(e);e.patterns&&!e.include&&this._addPatterns(e.patterns,e.qualifiedId)},_addPatterns:function(e,b){e.forEach(function(a){this._addPattern(a,this._NO_ID+this._unnamedCounter++,b)}.bind(this))},
_addRepositoryPatterns:function(e,b){Object.keys(e).forEach(function(a){this._addPattern(e[a],a,b)}.bind(this))},_processInclude:function(e,b,a){var d,f=e.include.indexOf("#");d=0===f?RegExp("^"+e.qualifiedId.substring(0,e.qualifiedId.indexOf("#"))+e.include+"$"):-1===f?RegExp("^"+e.include+"#"+this._NO_ID+"[^#]+$"):RegExp("^"+e.include+"$");this._patterns.forEach(function(e){d.test(e.qualifiedId)&&(e.include?this._processInclude(e,b,a):a[e.id]||(e.index=b[0]++,a[e.id]=e))}.bind(this))},_NO_ID:"NoID"};
f.prototype={adjustBounds:function(e,b){e<this.start&&(this.start+=b);e<this.contentStart&&(this.contentStart+=b);e<=this.end&&(this.end+=b);e<=this.contentEnd&&(this.contentEnd+=b);this._subBlocks.forEach(function(a){e<=a.end&&a.adjustBounds(e,b)})},getBlocks:function(){return this._subBlocks},getBlockAtIndex:function(e){return p(this.getBlocks(),e,!0)},isRenderingWhitespace:function(){return this.styler._isRenderingWhitespace()}};h.prototype={getStyles:function(e){return this._styler.getStyles(e)}};
g.prototype={computeBlocks:function(e,b,a,d,f,g,h){return this._stylerAdapter.computeBlocks(e,b,a,d,f,g,h)},destroy:function(){if(this._view){var e=this._view.getModel();e.getBaseModel&&(e=e.getBaseModel());e.removeEventListener("Changed",this._listener.onChanged);this._view.removeEventListener("MouseDown",this._listener.onMouseDown);this._view.removeEventListener("Selection",this._listener.onSelection);this._view.removeEventListener("Destroy",this._listener.onDestroy);this._view.removeEventListener("LineStyle",
this._listener.onLineStyle);this._view=null}},getBlockAtIndex:function(e){return this._findBlock(this._rootBlock,e)},getRootBlock:function(){return this._rootBlock},getStyleAccessor:function(){return this._accessor},getStyles:function(e){var b=[],a=this._view.getModel();a.getBaseModel&&(a=a.getBaseModel());var d=this._findBlock(this._rootBlock,e),f=a.getLineAtOffset(e),g=a.getLine(f),h=[];this._stylerAdapter.parse(g,a.getLineStart(f),d,h);for((f=h[p(h,e,!0)])&&(f.start<=e&&e<f.end)&&b.push(f);d;)(f=
this._stylerAdapter.computeStyle(d,a,e))&&b.splice(0,0,f),d=d.parent;return b},setDetectHyperlinks:function(){},setDetectTasks:function(e){this._detectTasks=e},setFoldingEnabled:function(e){this._foldingEnabled=e},setHighlightCaretLine:function(e){this._highlightCaretLine=e},setSpacesVisible:function(e){this._spacesVisible!==e&&(this._spacesVisible=e,this.setWhitespacesVisible(this._tabsVisible||this._spacesVisible,!1),this._view.redraw())},setTabsVisible:function(e){this._tabsVisible!==e&&(this._tabsVisible=
e,this.setWhitespacesVisible(this._tabsVisible||this._spacesVisible,!1),this._view.redraw())},setWhitespacesVisible:function(e,b){this._whitespacesVisible!==e&&(this._whitespacesVisible=e,b&&this._view.redraw())},_computeFolding:function(e,b,a){if(b.getBaseModel){var d=b.getBaseModel();e.forEach(function(e){var f=this._createFoldingAnnotation(b,d,e.start,e.end);f&&a.push(f);this._computeFolding(e.getBlocks(),b,a)}.bind(this))}},_computeTasks:function(e,b,a,d,f){d=d||e.start;f=f||e.end;if(e.start<=
f&&d<=e.end&&this._annotationModel){var g=n.AnnotationType.ANNOTATION_TASK;if(e.name&&0===e.name.indexOf("comment")){var h=[];this._stylerAdapter.parse(b.getText(e.contentStart,e.end),e.contentStart,e,h,!0);for(var k=0;k<h.length;k++)"meta.annotation.task.todo"===h[k].style&&(d<=h[k].start&&h[k].end<=f)&&a.push(n.AnnotationType.createAnnotation(g,h[k].start,h[k].end,b.getText(h[k].start,h[k].end)))}e.getBlocks().forEach(function(e){this._computeTasks(e,b,a,d,f)}.bind(this))}},_createFoldingAnnotation:function(e,
b,a,d){var f=b.getLineAtOffset(a),g=b.getLineAtOffset(d);return f===g||f+1===g&&b.getLineStart(g)===b.getLineEnd(g)?null:new (n.AnnotationType.getType(n.AnnotationType.ANNOTATION_FOLDING))(a,d,e)},_findBlock:function(e,b){var a=e.getBlocks();if(!a.length)return e;var d=p(a,b,!0);return d<a.length&&a[d].start<=b&&b<a[d].end?this._findBlock(a[d],b):e},_findBrackets:function(e,b,a,d,f){for(var g=[],h=[],k=d,n=b.getBlocks(),r=p(n,d,!0);r<n.length&&!(n[r].start>=f);r++){var t=n[r].start,y=n[r].end;k<t&&
(this._stylerAdapter.parse(a.substring(k-d,t-d),k,b,h),h.forEach(function(a){0===a.style.indexOf(e.beginName)?g.push(a.start+1):0===a.style.indexOf(e.endName)&&g.push(-(a.start+1))}),h=[]);k=y}k<f&&(this._stylerAdapter.parse(a.substring(k-d,f-d),k,b,h),h.forEach(function(a){a.style&&(0===a.style.indexOf(e.beginName)?g.push(a.start+1):0===a.style.indexOf(e.endName)&&g.push(-(a.start+1)))}));return g},_findMatchingBracket:function(e,b,a){var d=e.getLineAtOffset(a),f=e.getLineEnd(d),g=e.getText(a,f),
g=this._stylerAdapter.getBracketMatch(b,g);if(!g)return-1;for(var h=e.getLine(d),k=e.getLineStart(d),f=this._findBrackets(g,b,h,k,f),n=0;n<f.length;n++)if(h=0<=f[n]?1:-1,f[n]*h-1===a){a=1;if(g.atStart){for(n++;n<f.length;n++)if(h=0<=f[n]?1:-1,a+=h,0===a)return f[n]*h-1;d+=1;for(n=e.getLineCount();d<n;){h=e.getLine(d);k=e.getLineStart(d);f=e.getLineEnd(d);f=this._findBrackets(g,b,h,k,f);for(k=0;k<f.length;k++)if(h=0<=f[k]?1:-1,a+=h,0===a)return f[k]*h-1;d++}}else{for(n--;0<=n;n--)if(h=0<=f[n]?1:-1,
a+=h,0===a)return f[n]*h-1;for(d-=1;0<=d;){h=e.getLine(d);k=e.getLineStart(d);f=e.getLineEnd(d);f=this._findBrackets(g,b,h,k,f);for(n=f.length-1;0<=n;n--)if(h=0<=f[n]?1:-1,a+=h,0===a)return f[n]*h-1;d--}}break}return-1},_getLineStyle:function(e){if(this._highlightCaretLine){var b=this._view.getModel(),a=this._view.getSelection();if(a.start===a.end&&b.getLineAtOffset(a.start)===e)return this._caretLineStyle}return null},_getStyles:function(e,b,a,d){b.getBaseModel&&(d=b.mapOffset(d));for(var f=d+a.length,
g=[],h=d,k=e.getBlocks(),n=p(k,d,!0);n<k.length&&!(k[n].start>=f);n++){var r=k[n].start,t=k[n].end;h<r&&this._stylerAdapter.parse(a.substring(h-d,r-d),h,e,g);var y=Math.max(h,r);y===r&&(r=this._stylerAdapter.getBlockStartStyle(k[n],a.substring(y-d),y,g))&&(y+=r.length);var r=Math.min(f,t),x=[];r===t&&(h=a.substring(r-h-(k[n].end-k[n].contentEnd)),(h=this._stylerAdapter.getBlockEndStyle(k[n],h,r,x))&&(r-=h.length));var h=this._getStyles(k[n],b,a.substring(y-d,r-d),y),D=this._stylerAdapter.getBlockContentStyleName(k[n]);
if(D){var q=y;h.forEach(function(a){a.start-q&&g.push({start:q,end:a.start,style:D});a.mergeable&&(a.style+=","+D);g.push(a);q=a.end});r-q&&g.push({start:q,end:r,style:D})}else g=g.concat(h);g=g.concat(x);h=t}h<f&&this._stylerAdapter.parse(a.substring(h-d,f-d),h,e,g);if(b.getBaseModel)for(e=0;e<g.length;e++)a=g[e].end-g[e].start,g[e].start=b.mapOffset(g[e].start,!0),g[e].end=g[e].start+a;return g},_isRenderingWhitespace:function(){return this._whitespacesVisible&&(this._tabsVisible||this._spacesVisible)},
_onDestroy:function(){this.destroy()},_onLineStyle:function(e){e.textView===this._view&&(e.style=this._getLineStyle(e.lineIndex));e.ranges=this._getStyles(this._rootBlock,e.textView.getModel(),e.lineText,e.lineStart);e.ranges.forEach(function(b){b.style&&(b.style={styleClass:b.style.replace(/\./g," ")})});this._isRenderingWhitespace()&&(this._spacesVisible&&this._spliceStyles(this._spacePattern,e.ranges,e.lineText,e.lineStart),this._tabsVisible&&this._spliceStyles(this._tabPattern,e.ranges,e.lineText,
e.lineStart))},_onModelChanged:function(e){var b=e.start,a=e.removedCharCount;e=e.addedCharCount-a;var d=this._view.getModel(),f=d.getBaseModel?d.getBaseModel():d,a=b+a,g=f.getCharCount(),h=f.getLineStart(f.getLineAtOffset(b)),k=this._findBlock(this._rootBlock,b),r,t,w,y,x,D,q;do{w=k.parent;if(!r&&w&&(x=f.getText(k.start,Math.min(g,k.end+e+1)),!this._stylerAdapter.verifyBlock(f,x,k,e))){k=w;continue}t=k.getBlocks();var z=t.length,C=p(t,h,!0),E=p(t,a,!1,C-1,z);r=!1;if(C&&t.length&&t[C-1].end===b){x=
f.getText(t[C-1].start,Math.min(g,b+1));var B=this.computeBlocks(f,x,k,t[C-1].start,null,null,null);B.length&&B[0].end!==t[C-1].end&&(C--,r=!0)}C<z&&t[C].start<=h&&(h<t[C].end||r)?(q=t[C].start,q>b&&(q+=e)):C===z&&0<z&&k.end-e===t[z-1].end?(q=t[--C].start,q>b&&(q+=e)):q=Math.max(h,k.contentStart);D=E<z?t[E].end:k.contentEnd;b<=D&&(D+=e);D=Math.min(D,g-1);x=f.getText(q,D+1);B=this.computeBlocks(f,x,k,q,null,null,null);if(E<z){if(B.length&&B[B.length-1].end===D&&B[B.length-1].typeId===t[E].typeId)break;
if(B.length&&this._stylerAdapter.blockSpansBeyondEnd(B[B.length-1])){E++;for(var I=B[B.length-1].getBlocks(),I=(I.length?I[I.length-1]:B[B.length-1]).typeId;E<z;){if(t[E].typeId===I){var L=t[E].end+e,L=Math.min(L,g-1);x=f.getText(q,L+1);x=this.computeBlocks(f,x,k,q,null,null,null);if(x.length&&x[x.length-1].end===L){D=L;B=x;break}}E++}if(E<z)break}}else if(!B.length||B[B.length-1].end<=k.contentEnd+e)break;if(!w){D=g;E=z;x=f.getText(q,D);B=this.computeBlocks(f,x,k,q,null,null,null);break}k=w;y=!0}while(1);
this._rootBlock.adjustBounds(b,e);E=Math.min(E+1,z);y||(y=E-C!==B.length);if(!y)for(z=0;z<B.length;z++)if(r=t[C+z],g=B[z],r.start!==g.start||r.end!==g.end||r.typeId!==g.typeId){y=!0;break}!t.length&&!B.length?this.dispatchEvent({type:"BlocksChanged",old:[k],"new":[k]}):this.dispatchEvent({type:"BlocksChanged",old:t.slice(C,E),"new":B});C=[C,E-C].concat(B);Array.prototype.splice.apply(t,C);y&&(t=q,y=D,d!==f&&(t=d.mapOffset(t,!0),y=d.mapOffset(y,!0)),this._view.redrawRange(t,y));if(this._annotationModel){t=
[];var O=[],H=[];y=this._annotationModel.getAnnotations(q,D);C=this._foldingEnabled&&f!==d;for(E=k.parent||k;y.hasNext();)B=y.next(),C&&B.type===n.AnnotationType.ANNOTATION_FOLDING?(H.push(B),r=this._findBlock(E,B.start),!r||!(B.start===r.start&&B.end===r.end)?(t.push(B),B.expand()):(r=B.start,z=B.end,r>b&&(r-=e),z>b&&(z-=e),r<=b&&(b<z&&r<=a&&a<z)&&(r=f.getLineAtOffset(B.start),z=f.getLineAtOffset(B.end),r!==z?B.expanded||B.expand():t.push(B)))):B.type===n.AnnotationType.ANNOTATION_TASK&&k.start<=
B.start&&B.end<=k.end&&t.push(B);C&&E.getBlocks().forEach(function(a){this._updateFolding(a,f,d,H,O,q,D)}.bind(this));this._detectTasks&&this._computeTasks(k,f,O,q,D);this._annotationModel.replaceAnnotations(t,O)}},_onMouseDown:function(e){if(2===e.clickCount){var b=this._view.getModel(),a=this._view.getOffsetAtLocation(e.x,e.y);if(0<a){var d=a-1,f=b;b.getBaseModel&&(d=b.mapOffset(d),f=b.getBaseModel());var g=this._findBlock(this._rootBlock,d),d=this._findMatchingBracket(f,g,d);-1!==d&&(e.preventDefault(),
e=d,b.getBaseModel&&(e=b.mapOffset(e,!0)),a>e&&(a--,e++),this._view.setSelection(e,a))}}},_onSelection:function(e){var b=e.oldValue,a=e.newValue;e=this._view.getModel();var d;if(this._highlightCaretLine){var f=e.getLineAtOffset(b.start);d=e.getLineAtOffset(a.start);var g=a.start===a.end,b=b.start===b.end;f===d&&b&&g||(b&&this._view.redrawLines(f,f+1),(f!==d||!b)&&g&&this._view.redrawLines(d,d+1))}if(this._annotationModel){var b=this._bracketAnnotations,h,k;if(a.start===a.end&&0<(k=this._view.getCaretOffset()))k-=
1,e.getBaseModel&&(k=e.mapOffset(k),e=e.getBaseModel()),a=this._findBlock(this._rootBlock,k),e=this._findMatchingBracket(e,a,k),-1!==e&&(h=[n.AnnotationType.createAnnotation(n.AnnotationType.ANNOTATION_MATCHING_BRACKET,e,e+1),n.AnnotationType.createAnnotation(n.AnnotationType.ANNOTATION_CURRENT_BRACKET,k,k+1)]);this._bracketAnnotations=h;this._annotationModel.replaceAnnotations(b,h)}},_spliceStyles:function(e,b,a,d){for(var f=e.regex,g=f.lastIndex=0,h=f.exec(a);h;){for(h=d+h.index;g<b.length&&!(h<
b[g].end);)g++;var k={start:h,end:h+1,style:e.style};if(g<b.length&&b[g].start<=h){var n={start:h+1,end:b[g].end,style:b[g].style};b[g].end=h;b.splice(g+1,0,n);b.splice(g+1,0,k);g+=2}else b.splice(g,0,k),g++;h=f.exec(a)}},_updateFolding:function(e,b,a,d,f,g,h){g=g||e.start;h=h||e.end;if(!e.doNotFold&&e.start<=h&&g<=e.end){var k=p(d,e.start,!0);k<d.length&&d[k].start===e.start&&d[k].end===e.end||(k=this._createFoldingAnnotation(a,b,e.start,e.end))&&f.push(k);e.getBlocks().forEach(function(e){this._updateFolding(e,
b,a,d,f,g,h)}.bind(this))}},_caretLineStyle:{styleClass:"meta annotation currentLine"},_spacePattern:{regex:/[ ]/g,style:{styleClass:"punctuation separator space",unmergeable:!0}},_tabPattern:{regex:/\t/g,style:{styleClass:"punctuation separator tab",unmergeable:!0}}};t.EventTarget.addMixin(g.prototype);return{TextStyler:g,Block:f,createPatternBasedAdapter:function(e,b){return new r(e,b)}}});
define("orion/editor/stylers/application_javascript/syntax",["orion/editor/stylers/lib/syntax"],function(n){var t="break case class catch continue const debugger default delete do else enum export extends false finally for function if implements import in instanceof interface let new null package private protected public return static super switch this throw true try typeof undefined var void while with yield".split(" ");n=n.grammars;n.push({id:"orion.js",contentTypes:["application/javascript"],patterns:[{begin:"'(?:\\\\.|[^\\\\'])*\\\\$",
end:"^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))",name:"string.quoted.single.js"},{begin:'"(?:\\\\.|[^\\\\"])*\\\\$',end:'^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))',name:"string.quoted.double.js"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_singleLine"},{match:"/(?![\\s\\*])(?:\\\\.|[^/])+/(?:[gim]{0,3})",name:"string.regexp.js"},{include:"orion.lib#doc_block"},{include:"orion.c-like#comment_block"},{include:"orion.lib#brace_open"},{include:"orion.lib#brace_close"},
{include:"orion.lib#bracket_open"},{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#number_decimal"},{include:"orion.lib#number_hex"},{match:"\\b(?:"+t.join("|")+")\\b",name:"keyword.control.js"}]});return{id:n[n.length-1].id,grammars:n,keywords:t}});
define("orion/editor/stylers/application_xml/syntax",["orion/editor/stylers/lib/syntax"],function(n){n=n.grammars;n.push({id:"orion.xml",contentTypes:["application/xml","application/xhtml+xml"],patterns:[{include:"#comment"},{include:"#doctype"},{include:"#xmlDeclaration"},{include:"#tag"},{include:"#ampersandEscape"}],repository:{ampersandEscape:{match:"\x26lt;|\x26gt;|\x26amp;",name:"constant.character"},comment:{begin:{match:"\x3c!--",literal:"\x3c!--"},end:{match:"--\x3e",literal:"--\x3e"},name:"comment.block.xml",
patterns:[{match:"(\\b)(TODO)(\\b)(((?!--\x3e).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}]},doctype:{begin:"\x3c!(?:doctype|DOCTYPE)",end:"\x3e",name:"meta.tag.doctype.xml",captures:{0:{name:"entity.name.tag.doctype.xml"}},patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}]},tag:{begin:"\x3c/?[A-Za-z0-9]+",end:"/?\x3e",captures:{0:{name:"entity.name.tag.xml"}},name:"meta.tag.xml",
patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}]},xmlDeclaration:{begin:"\x3c\\?xml",end:"\\?\x3e",captures:{0:{name:"entity.name.tag.declaration.xml"}},patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}],name:"meta.tag.declaration.xml"}}});return{id:n[n.length-1].id,grammars:n,keywords:[]}});
define("orion/editor/stylers/text_html/syntax",["orion/editor/stylers/lib/syntax","orion/editor/stylers/application_javascript/syntax","orion/editor/stylers/text_css/syntax","orion/editor/stylers/application_xml/syntax"],function(n,t,r,k){n=n.grammars.concat(t.grammars).concat(r.grammars).concat(k.grammars);n.push({id:"orion.html",contentTypes:["text/html"],patterns:[{begin:"(?i)(\x3cstyle)([^\x3e]*)(\x3e)",end:"(?i)(\x3c/style\x3e)",captures:{1:{name:"entity.name.tag.html"},3:{name:"entity.name.tag.html"}},
contentName:"source.css.embedded.html",patterns:[{include:"orion.css"}]},{begin:"(?i)\x3cscript\\s*\x3e|\x3cscript\\s.*?(?:language\\s*\x3d\\s*(['\"])javascript\\1|type\\s*\x3d\\s*(['\"])(?:text|application)/(?:javascript|ecmascript)\\2).*?\x3e",end:"(?i)\x3c/script\x3e",captures:{0:{name:"entity.name.tag.html"}},contentName:"source.js.embedded.html",patterns:[{include:"orion.js"}]},{include:"orion.xml#comment"},{include:"orion.xml#doctype"},{include:"orion.xml#tag"},{include:"orion.xml#ampersandEscape"}]});
return{id:n[n.length-1].id,grammars:n,keywords:[]}});
define("orion/editor/edit","require orion/editor/config orion/editor/shim orion/editor/textView orion/editor/textModel orion/editor/textTheme orion/editor/projectionTextModel orion/editor/eventTarget orion/keyBinding orion/editor/rulers orion/editor/annotations orion/editor/tooltip orion/editor/undoStack orion/editor/textDND orion/editor/editor orion/editor/editorFeatures orion/editor/contentAssist webtools/cssContentAssist webtools/htmlContentAssist orion/editor/AsyncStyler orion/editor/mirror orion/editor/textMateStyler orion/editor/htmlGrammar orion/editor/textStyler orion/editor/stylers/application_javascript/syntax orion/editor/stylers/text_css/syntax orion/editor/stylers/text_html/syntax".split(" "),function(n,
t,r,k,f,h,g,p,e,b,a,d,m,s,l,u,v,A,w,y,x,D,q,z,C,E,B){function I(a,b,d){for(var e;d&&d!==b&&"none"!==e;)e=a.getComputedStyle?a.getComputedStyle(d,null).getPropertyValue("display"):d.currentStyle.display,d=d.parentNode;return!d||!e?"none":e}function L(a){var b=a.firstChild;if(b&&"TEXTAREA"===b.tagName)return b.value;var d=a.ownerDocument,e=d.defaultView||d.parentWindow;if(!e.getSelection||1===a.childNodes.length&&b.nodeType===Node.TEXT_NODE||"none"===I(e,d,a))return a.innerText||a.textContent;b=d.createRange();
b.selectNode(a);a=e.getSelection();e=[];for(d=0;d<a.rangeCount;d++)e.push(a.getRangeAt(d));a.removeAllRanges();a.addRange(b);b=a.toString();a.removeAllRanges();for(d=0;d<e.length;d++)a.addRange(e[d]);return b}function O(a){if("data-editor-"===a.substring(0,12))return a=a.substring(12),a=a.replace(/-([a-z])/ig,function(a,b){return b.toUpperCase()})}function H(a,b){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])}function T(a,b){var d={};H(d,b);for(var e,f=0,g=a.attributes,h=g.length;f<h;f++){e=g.item(f);
var k=O(e.nodeName);if(k){e=e.nodeValue;if("true"===e||"false"===e)e="true"===e;d[k]=e}}return d}function U(a,b){if(a.getElementsByClassName)return a.getElementsByClassName(b);b=b.replace(/ *$/,"");return a.querySelectorAll?a.querySelectorAll((" "+b).replace(/ +/g,".")):null}function Q(a){var b=a.document||document,d=a.parent;d||(d="editor");"string"===typeof d&&(d=b.getElementById(d));if(!d&&a.className){var e=U(b,a.className);if(e){a.className=void 0;1<e.length&&void 0===a.noFocus&&(a.noFocus=!0);
for(var b=[],m=e.length-1;0<=m;m--)a.parent=e[m],b.push(Q(a));return b}}if(!d)throw"no parent";a=T(d,a);if("string"===typeof a.theme){var e=h.TextTheme.getTheme(a.theme),p=a.theme.lastIndexOf("/"),q=a.theme;-1!==p&&(q=q.substring(p+1));".css"===q.substring(q.length-4)&&(q=q.substring(0,q.length-4));e.setThemeClass(q,{href:a.theme});a.theme=e}var r;a.readonly||(m={createContentAssistMode:function(a){r=new v.ContentAssist(a.getTextView());a=new v.ContentAssistWidget(r);a=new v.ContentAssistMode(r,a);
r.setMode(a);return a}});var s=new l.Editor({textViewFactory:function(){return new k.TextView({parent:d,model:new g.ProjectionTextModel(a.model?a.model:new f.TextModel("")),tabSize:a.tabSize?a.tabSize:4,readonly:a.readonly,fullSelection:a.fullSelection,tabMode:a.tabMode,expandTab:a.expandTab,singleMode:a.singleMode,themeClass:a.themeClass,theme:a.theme,wrapMode:a.wrapMode,wrappable:a.wrappable})},undoStackFactory:new u.UndoFactory,annotationFactory:new u.AnnotationFactory,lineNumberRulerFactory:new u.LineNumberRulerFactory,
foldingRulerFactory:new u.FoldingRulerFactory,textDNDFactory:new u.TextDNDFactory,contentAssistFactory:m,keyBindingFactory:new u.KeyBindingsFactory,statusReporter:a.statusReporter,domNode:d});s.addEventListener("TextViewInstalled",function(){var b=s.getLineNumberRuler();b&&void 0!==a.firstLineIndex&&b.setFirstLine(a.firstLineIndex);if(b=s.getSourceCodeActions())b.setAutoPairParentheses(a.autoPairParentheses),b.setAutoPairBraces(a.autoPairBraces),b.setAutoPairSquareBrackets(a.autoPairSquareBrackets),
b.setAutoPairAngleBrackets(a.autoPairAngleBrackets),b.setAutoPairQuotations(a.autoPairQuotations),b.setAutoCompleteComments(a.autoCompleteComments),b.setSmartIndentation(a.smartIndentation)});m=a.contents;void 0===m&&(m=L(d));m||(m="");s.installTextView();s.setLineNumberRulerVisible(void 0===a.showLinesRuler||a.showLinesRuler);s.setAnnotationRulerVisible(void 0===a.showAnnotationRuler||a.showFoldingRuler);s.setOverviewRulerVisible(void 0===a.showOverviewRuler||a.showOverviewRuler);s.setFoldingRulerVisible(void 0===
a.showFoldingRuler||a.showFoldingRuler);s.setInput(a.title,null,m,!1,a.noFocus);({styler:null,highlight:function(b,d){this.styler&&this.styler.destroy&&this.styler.destroy();this.styler=null;"js"===b?b="application/javascript":"css"===b?b="text/css":"html"===b?b="text/html":"java"===b&&(b="text/x-java-source");var e=d.getTextView(),f=d.getAnnotationModel();b&&(b=b.replace(/[*|:/".<>?+]/g,"_"),n(["./stylers/"+b+"/syntax"],function(a){a=new z.createPatternBasedAdapter(a.grammars,a.id);this.styler=new z.TextStyler(e,
f,a)}));"text/css"===b&&d.setFoldingRulerVisible(void 0===a.showFoldingRuler||a.showFoldingRuler)}}).highlight(a.contentType||a.lang,s);if(r){var t=new A.CssContentAssistProvider,x=new w.HTMLContentAssistProvider;r.addEventListener("Activating",function(){/css$/.test(a.lang)?r.setProviders([t]):/html$/.test(a.lang)&&r.setProviders([x])})}m=b.defaultView||b.parentWindow;!a.noComputeSize&&("none"!==I(m,b,d)&&50>=d.clientHeight)&&(b=s.getTextView().computeSize().height,d.style.height=b+"px");return s}
var M=this.orion?this.orion.editor:void 0;if(M){for(var R=0;R<arguments.length;R++)H(M,arguments[R]);M.edit=Q}return Q});var orion=this.orion||(this.orion={}),editor=orion.editor||(orion.editor={});